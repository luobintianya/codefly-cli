
 RUN  v3.2.4 /Users/robinx/code/codefly-cli/packages/cli
      Coverage enabled with v8

stderr | src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > renders the initial "main" view correctly
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

stderr | src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > renders "main" view with preview options when preview features are enabled
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

stderr | src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > switches to "manual" view when "Manual" is selected
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

stderr | src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > renders "manual" view with preview options when preview features are enabled
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

stderr | src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > sets model and closes when a model is selected in "main" view
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

stderr | src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > sets model and closes when a model is selected in "manual" view
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

stderr | src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > toggles persist mode with Tab key
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

stderr | src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > closes dialog on escape in "main" view
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

stderr | src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > goes back to "main" view on escape in "manual" view
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

stderr | src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > Preview Logic > should NOT show preview options if user has no access
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

stderr | src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > Preview Logic > should NOT show preview options if user has access but preview features are disabled
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

stderr | src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > Preview Logic > should show preview options if user has access AND preview features are enabled
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

stderr | src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > Preview Logic > should show "Gemini 3 is now available" header if user has access but preview features disabled
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

stderr | src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > Preview Logic > should show "Gemini 3 is coming soon" header if user has no access
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

stderr | src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > Preview Logic > should NOT show header/subheader if preview options are shown
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

 ‚ùØ src/ui/components/ModelDialog.test.tsx (15 tests | 12 failed) 1884ms
   √ó <ModelDialog /> > renders the initial "main" view correctly 33ms
     ‚Üí expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'Select Model'
   √ó <ModelDialog /> > renders "main" view with preview options when preview features are enabled 12ms
     ‚Üí expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'Auto (Gemini 3)'
   √ó <ModelDialog /> > switches to "manual" view when "Manual" is selected 314ms
     ‚Üí expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'gemini-3-pro-preview'
   √ó <ModelDialog /> > renders "manual" view with preview options when preview features are enabled 315ms
     ‚Üí expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'gemini-3-pro-preview'
   √ó <ModelDialog /> > sets model and closes when a model is selected in "main" view 168ms
     ‚Üí expected "spy" to be called with arguments: [ 'auto-gemini-3', true ][90m

Number of calls: [1m0[22m
[39m
   √ó <ModelDialog /> > sets model and closes when a model is selected in "manual" view 465ms
     ‚Üí expected "spy" to be called with arguments: [ 'gemini-3-pro-preview', true ][90m

Number of calls: [1m0[22m
[39m
   √ó <ModelDialog /> > toggles persist mode with Tab key 25ms
     ‚Üí expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'Remember model for future sessions: f‚Ä¶'
   √ó <ModelDialog /> > closes dialog on escape in "main" view 163ms
     ‚Üí expected "spy" to be called at least once
   √ó <ModelDialog /> > goes back to "main" view on escape in "manual" view 322ms
     ‚Üí expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'gemini-3-pro-preview'
   ‚úì <ModelDialog /> > Preview Logic > should NOT show preview options if user has no access 15ms
   ‚úì <ModelDialog /> > Preview Logic > should NOT show preview options if user has access but preview features are disabled 12ms
   √ó <ModelDialog /> > Preview Logic > should show preview options if user has access AND preview features are enabled 13ms
     ‚Üí expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'Auto (Gemini 3)'
   √ó <ModelDialog /> > Preview Logic > should show "Gemini 3 is now available" header if user has access but preview features disabled 10ms
     ‚Üí expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'Gemini 3 is now available.'
   √ó <ModelDialog /> > Preview Logic > should show "Gemini 3 is coming soon" header if user has no access 9ms
     ‚Üí expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'Gemini 3 is coming soon.'
   ‚úì <ModelDialog /> > Preview Logic > should NOT show header/subheader if preview options are shown 7ms

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 12 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > renders the initial "main" view correctly
AssertionError: expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'Select Model'

[32m- Expected[39m
[31m+ Received[39m

[32m- Select Model[39m
[31m+[39m
[31m+   ERROR  useSettings must be used within a SettingsProvider[39m
[31m+[39m
[31m+  src/ui/contexts/SettingsContext.tsx:17:11[39m
[31m+[39m
[31m+  14: export const useSettings = () => {[39m
[31m+  15:   const context = useContext(SettingsContext);[39m
[31m+  16:   if (context === undefined) {[39m
[31m+  17:     throw new Error('useSettings must be used within a SettingsProvider');[39m
[31m+  18:   }[39m
[31m+  19:   return context;[39m
[31m+  20: };[39m
[31m+[39m
[31m+  - useSettings (src/ui/contexts/SettingsContext.tsx:17:11)[39m
[31m+  - ModelDialog (src/ui/components/ModelDialog.tsx:40:20)[39m
[31m+  -Object.react-stack-bott[39m
[31m+   m-frame                (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-re[39m
[31m+                          conciler.development.js:15859:20)[39m
[31m+  -renderWithHoo[39m
[31m+   s            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.d[39m
[31m+                evelopment.js:3221:22)[39m
[31m+  -updateFunctionComp[39m
[31m+   nent              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconci[39m
[31m+                     ler.development.js:6475:19)[39m
[31m+  -beginWor[39m
[31m+           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.develo[39m
[31m+           pment.js:8009:18)[39m
[31m+  -runWithFiberIn[39m
[31m+   EV            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:1738:13)[39m
[31m+  -performUnitOfW[39m
[31m+   rk            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:12834:22)[39m
[31m+  -workLoopSyn[39m
[31m+              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.dev[39m
[31m+              elopment.js:12644:41)[39m
[31m+  -renderRootSy[39m
[31m+   c           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.de[39m
[31m+               velopment.js:12624:11)[39m
[31m+[39m

 ‚ùØ src/ui/components/ModelDialog.test.tsx:91:25
     89|   it('renders the initial "main" view correctly', () => {
     90|     const { lastFrame } = renderComponent();
     91|     expect(lastFrame()).toContain('Select Model');
       |                         ^
     92|     expect(lastFrame()).toContain('Remember model for future sessions:‚Ä¶
     93|     expect(lastFrame()).toContain('Auto');

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/12]‚éØ

 FAIL  src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > renders "main" view with preview options when preview features are enabled
AssertionError: expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'Auto (Gemini 3)'

[32m- Expected[39m
[31m+ Received[39m

[32m- Auto (Gemini 3)[39m
[31m+[39m
[31m+   ERROR  useSettings must be used within a SettingsProvider[39m
[31m+[39m
[31m+  src/ui/contexts/SettingsContext.tsx:17:11[39m
[31m+[39m
[31m+  14: export const useSettings = () => {[39m
[31m+  15:   const context = useContext(SettingsContext);[39m
[31m+  16:   if (context === undefined) {[39m
[31m+  17:     throw new Error('useSettings must be used within a SettingsProvider');[39m
[31m+  18:   }[39m
[31m+  19:   return context;[39m
[31m+  20: };[39m
[31m+[39m
[31m+  - useSettings (src/ui/contexts/SettingsContext.tsx:17:11)[39m
[31m+  - ModelDialog (src/ui/components/ModelDialog.tsx:40:20)[39m
[31m+  -Object.react-stack-bott[39m
[31m+   m-frame                (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-re[39m
[31m+                          conciler.development.js:15859:20)[39m
[31m+  -renderWithHoo[39m
[31m+   s            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.d[39m
[31m+                evelopment.js:3221:22)[39m
[31m+  -updateFunctionComp[39m
[31m+   nent              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconci[39m
[31m+                     ler.development.js:6475:19)[39m
[31m+  -beginWor[39m
[31m+           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.develo[39m
[31m+           pment.js:8009:18)[39m
[31m+  -runWithFiberIn[39m
[31m+   EV            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:1738:13)[39m
[31m+  -performUnitOfW[39m
[31m+   rk            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:12834:22)[39m
[31m+  -workLoopSyn[39m
[31m+              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.dev[39m
[31m+              elopment.js:12644:41)[39m
[31m+  -renderRootSy[39m
[31m+   c           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.de[39m
[31m+               velopment.js:12624:11)[39m
[31m+[39m

 ‚ùØ src/ui/components/ModelDialog.test.tsx:101:25
     99|     mockGetHasAccessToPreviewModel.mockReturnValue(true); // Must have‚Ä¶
    100|     const { lastFrame } = renderComponent();
    101|     expect(lastFrame()).toContain('Auto (Gemini 3)');
       |                         ^
    102|   });
    103| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/12]‚éØ

 FAIL  src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > switches to "manual" view when "Manual" is selected
AssertionError: expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'gemini-3-pro-preview'

[32m- Expected[39m
[31m+ Received[39m

[32m- gemini-3-pro-preview[39m
[31m+[39m
[31m+   ERROR  useSettings must be used within a SettingsProvider[39m
[31m+[39m
[31m+  src/ui/contexts/SettingsContext.tsx:17:11[39m
[31m+[39m
[31m+  14: export const useSettings = () => {[39m
[31m+  15:   const context = useContext(SettingsContext);[39m
[31m+  16:   if (context === undefined) {[39m
[31m+  17:     throw new Error('useSettings must be used within a SettingsProvider');[39m
[31m+  18:   }[39m
[31m+  19:   return context;[39m
[31m+  20: };[39m
[31m+[39m
[31m+  - useSettings (src/ui/contexts/SettingsContext.tsx:17:11)[39m
[31m+  - ModelDialog (src/ui/components/ModelDialog.tsx:40:20)[39m
[31m+  -Object.react-stack-bott[39m
[31m+   m-frame                (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-re[39m
[31m+                          conciler.development.js:15859:20)[39m
[31m+  -renderWithHoo[39m
[31m+   s            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.d[39m
[31m+                evelopment.js:3221:22)[39m
[31m+  -updateFunctionComp[39m
[31m+   nent              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconci[39m
[31m+                     ler.development.js:6475:19)[39m
[31m+  -beginWor[39m
[31m+           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.develo[39m
[31m+           pment.js:8009:18)[39m
[31m+  -runWithFiberIn[39m
[31m+   EV            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:1738:13)[39m
[31m+  -performUnitOfW[39m
[31m+   rk            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:12834:22)[39m
[31m+  -workLoopSyn[39m
[31m+              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.dev[39m
[31m+              elopment.js:12644:41)[39m
[31m+  -renderRootSy[39m
[31m+   c           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.de[39m
[31m+               velopment.js:12624:11)[39m
[31m+[39m

 ‚ùØ src/ui/components/ModelDialog.test.tsx:119:25
    117| 
    118|     // Should now show manual options
    119|     expect(lastFrame()).toContain(DEFAULT_CODEFLY_MODEL);
       |                         ^
    120|     expect(lastFrame()).toContain(DEFAULT_CODEFLY_FLASH_MODEL);
    121|     expect(lastFrame()).toContain(DEFAULT_GEMINI_FLASH_LITE_MODEL);

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/12]‚éØ

 FAIL  src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > renders "manual" view with preview options when preview features are enabled
AssertionError: expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'gemini-3-pro-preview'

[32m- Expected[39m
[31m+ Received[39m

[32m- gemini-3-pro-preview[39m
[31m+[39m
[31m+   ERROR  useSettings must be used within a SettingsProvider[39m
[31m+[39m
[31m+  src/ui/contexts/SettingsContext.tsx:17:11[39m
[31m+[39m
[31m+  14: export const useSettings = () => {[39m
[31m+  15:   const context = useContext(SettingsContext);[39m
[31m+  16:   if (context === undefined) {[39m
[31m+  17:     throw new Error('useSettings must be used within a SettingsProvider');[39m
[31m+  18:   }[39m
[31m+  19:   return context;[39m
[31m+  20: };[39m
[31m+[39m
[31m+  - useSettings (src/ui/contexts/SettingsContext.tsx:17:11)[39m
[31m+  - ModelDialog (src/ui/components/ModelDialog.tsx:40:20)[39m
[31m+  -Object.react-stack-bott[39m
[31m+   m-frame                (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-re[39m
[31m+                          conciler.development.js:15859:20)[39m
[31m+  -renderWithHoo[39m
[31m+   s            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.d[39m
[31m+                evelopment.js:3221:22)[39m
[31m+  -updateFunctionComp[39m
[31m+   nent              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconci[39m
[31m+                     ler.development.js:6475:19)[39m
[31m+  -beginWor[39m
[31m+           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.develo[39m
[31m+           pment.js:8009:18)[39m
[31m+  -runWithFiberIn[39m
[31m+   EV            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:1738:13)[39m
[31m+  -performUnitOfW[39m
[31m+   rk            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:12834:22)[39m
[31m+  -workLoopSyn[39m
[31m+              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.dev[39m
[31m+              elopment.js:12644:41)[39m
[31m+  -renderRootSy[39m
[31m+   c           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.de[39m
[31m+               velopment.js:12624:11)[39m
[31m+[39m

 ‚ùØ src/ui/components/ModelDialog.test.tsx:140:25
    138|     await waitForUpdate();
    139| 
    140|     expect(lastFrame()).toContain(PREVIEW_CODEFLY_MODEL);
       |                         ^
    141|   });
    142| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/12]‚éØ

 FAIL  src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > sets model and closes when a model is selected in "main" view
AssertionError: expected "spy" to be called with arguments: [ 'auto-gemini-3', true ][90m

Number of calls: [1m0[22m
[39m
 ‚ùØ src/ui/components/ModelDialog.test.tsx:150:26
    148|     await waitForUpdate();
    149| 
    150|     expect(mockSetModel).toHaveBeenCalledWith(
       |                          ^
    151|       DEFAULT_CODEFLY_MODEL_AUTO,
    152|       true, // Session only by default

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/12]‚éØ

 FAIL  src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > sets model and closes when a model is selected in "manual" view
AssertionError: expected "spy" to be called with arguments: [ 'gemini-3-pro-preview', true ][90m

Number of calls: [1m0[22m
[39m
 ‚ùØ src/ui/components/ModelDialog.test.tsx:172:26
    170|     await waitForUpdate();
    171| 
    172|     expect(mockSetModel).toHaveBeenCalledWith(DEFAULT_CODEFLY_MODEL, t‚Ä¶
       |                          ^
    173|     expect(mockOnClose).toHaveBeenCalled();
    174|   });

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/12]‚éØ

 FAIL  src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > toggles persist mode with Tab key
AssertionError: expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'Remember model for future sessions: f‚Ä¶'

[32m- Expected[39m
[31m+ Received[39m

[32m- Remember model for future sessions: false[39m
[31m+[39m
[31m+   ERROR  useSettings must be used within a SettingsProvider[39m
[31m+[39m
[31m+  src/ui/contexts/SettingsContext.tsx:17:11[39m
[31m+[39m
[31m+  14: export const useSettings = () => {[39m
[31m+  15:   const context = useContext(SettingsContext);[39m
[31m+  16:   if (context === undefined) {[39m
[31m+  17:     throw new Error('useSettings must be used within a SettingsProvider');[39m
[31m+  18:   }[39m
[31m+  19:   return context;[39m
[31m+  20: };[39m
[31m+[39m
[31m+  - useSettings (src/ui/contexts/SettingsContext.tsx:17:11)[39m
[31m+  - ModelDialog (src/ui/components/ModelDialog.tsx:40:20)[39m
[31m+  -Object.react-stack-bott[39m
[31m+   m-frame                (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-re[39m
[31m+                          conciler.development.js:15859:20)[39m
[31m+  -renderWithHoo[39m
[31m+   s            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.d[39m
[31m+                evelopment.js:3221:22)[39m
[31m+  -updateFunctionComp[39m
[31m+   nent              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconci[39m
[31m+                     ler.development.js:6475:19)[39m
[31m+  -beginWor[39m
[31m+           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.develo[39m
[31m+           pment.js:8009:18)[39m
[31m+  -runWithFiberIn[39m
[31m+   EV            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:1738:13)[39m
[31m+  -performUnitOfW[39m
[31m+   rk            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:12834:22)[39m
[31m+  -workLoopSyn[39m
[31m+              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.dev[39m
[31m+              elopment.js:12644:41)[39m
[31m+  -renderRootSy[39m
[31m+   c           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.de[39m
[31m+               velopment.js:12624:11)[39m
[31m+[39m

 ‚ùØ src/ui/components/ModelDialog.test.tsx:179:25
    177|     const { lastFrame, stdin } = renderComponent();
    178| 
    179|     expect(lastFrame()).toContain('Remember model for future sessions:‚Ä¶
       |                         ^
    180| 
    181|     // Press Tab to toggle persist mode

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/12]‚éØ

 FAIL  src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > closes dialog on escape in "main" view
AssertionError: expected "spy" to be called at least once
 ‚ùØ src/ui/components/ModelDialog.test.tsx:204:25
    202|     await waitForUpdate();
    203| 
    204|     expect(mockOnClose).toHaveBeenCalled();
       |                         ^
    205|   });
    206| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[8/12]‚éØ

 FAIL  src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > goes back to "main" view on escape in "manual" view
AssertionError: expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'gemini-3-pro-preview'

[32m- Expected[39m
[31m+ Received[39m

[32m- gemini-3-pro-preview[39m
[31m+[39m
[31m+   ERROR  useSettings must be used within a SettingsProvider[39m
[31m+[39m
[31m+  src/ui/contexts/SettingsContext.tsx:17:11[39m
[31m+[39m
[31m+  14: export const useSettings = () => {[39m
[31m+  15:   const context = useContext(SettingsContext);[39m
[31m+  16:   if (context === undefined) {[39m
[31m+  17:     throw new Error('useSettings must be used within a SettingsProvider');[39m
[31m+  18:   }[39m
[31m+  19:   return context;[39m
[31m+  20: };[39m
[31m+[39m
[31m+  - useSettings (src/ui/contexts/SettingsContext.tsx:17:11)[39m
[31m+  - ModelDialog (src/ui/components/ModelDialog.tsx:40:20)[39m
[31m+  -Object.react-stack-bott[39m
[31m+   m-frame                (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-re[39m
[31m+                          conciler.development.js:15859:20)[39m
[31m+  -renderWithHoo[39m
[31m+   s            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.d[39m
[31m+                evelopment.js:3221:22)[39m
[31m+  -updateFunctionComp[39m
[31m+   nent              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconci[39m
[31m+                     ler.development.js:6475:19)[39m
[31m+  -beginWor[39m
[31m+           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.develo[39m
[31m+           pment.js:8009:18)[39m
[31m+  -runWithFiberIn[39m
[31m+   EV            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:1738:13)[39m
[31m+  -performUnitOfW[39m
[31m+   rk            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:12834:22)[39m
[31m+  -workLoopSyn[39m
[31m+              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.dev[39m
[31m+              elopment.js:12644:41)[39m
[31m+  -renderRootSy[39m
[31m+   c           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.de[39m
[31m+               velopment.js:12624:11)[39m
[31m+[39m

 ‚ùØ src/ui/components/ModelDialog.test.tsx:218:25
    216|     await waitForUpdate();
    217| 
    218|     expect(lastFrame()).toContain(DEFAULT_CODEFLY_MODEL);
       |                         ^
    219| 
    220|     // Press Escape

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[9/12]‚éØ

 FAIL  src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > Preview Logic > should show preview options if user has access AND preview features are enabled
AssertionError: expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'Auto (Gemini 3)'

[32m- Expected[39m
[31m+ Received[39m

[32m- Auto (Gemini 3)[39m
[31m+[39m
[31m+   ERROR  useSettings must be used within a SettingsProvider[39m
[31m+[39m
[31m+  src/ui/contexts/SettingsContext.tsx:17:11[39m
[31m+[39m
[31m+  14: export const useSettings = () => {[39m
[31m+  15:   const context = useContext(SettingsContext);[39m
[31m+  16:   if (context === undefined) {[39m
[31m+  17:     throw new Error('useSettings must be used within a SettingsProvider');[39m
[31m+  18:   }[39m
[31m+  19:   return context;[39m
[31m+  20: };[39m
[31m+[39m
[31m+  - useSettings (src/ui/contexts/SettingsContext.tsx:17:11)[39m
[31m+  - ModelDialog (src/ui/components/ModelDialog.tsx:40:20)[39m
[31m+  -Object.react-stack-bott[39m
[31m+   m-frame                (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-re[39m
[31m+                          conciler.development.js:15859:20)[39m
[31m+  -renderWithHoo[39m
[31m+   s            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.d[39m
[31m+                evelopment.js:3221:22)[39m
[31m+  -updateFunctionComp[39m
[31m+   nent              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconci[39m
[31m+                     ler.development.js:6475:19)[39m
[31m+  -beginWor[39m
[31m+           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.develo[39m
[31m+           pment.js:8009:18)[39m
[31m+  -runWithFiberIn[39m
[31m+   EV            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:1738:13)[39m
[31m+  -performUnitOfW[39m
[31m+   rk            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:12834:22)[39m
[31m+  -workLoopSyn[39m
[31m+              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.dev[39m
[31m+              elopment.js:12644:41)[39m
[31m+  -renderRootSy[39m
[31m+   c           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.de[39m
[31m+               velopment.js:12624:11)[39m
[31m+[39m

 ‚ùØ src/ui/components/ModelDialog.test.tsx:248:27
    246|       mockGetPreviewFeatures.mockReturnValue(true);
    247|       const { lastFrame } = renderComponent();
    248|       expect(lastFrame()).toContain('Auto (Gemini 3)');
       |                           ^
    249|     });
    250| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[10/12]‚éØ

 FAIL  src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > Preview Logic > should show "Gemini 3 is now available" header if user has access but preview features disabled
AssertionError: expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'Gemini 3 is now available.'

[32m- Expected[39m
[31m+ Received[39m

[32m- Gemini 3 is now available.[39m
[31m+[39m
[31m+   ERROR  useSettings must be used within a SettingsProvider[39m
[31m+[39m
[31m+  src/ui/contexts/SettingsContext.tsx:17:11[39m
[31m+[39m
[31m+  14: export const useSettings = () => {[39m
[31m+  15:   const context = useContext(SettingsContext);[39m
[31m+  16:   if (context === undefined) {[39m
[31m+  17:     throw new Error('useSettings must be used within a SettingsProvider');[39m
[31m+  18:   }[39m
[31m+  19:   return context;[39m
[31m+  20: };[39m
[31m+[39m
[31m+  - useSettings (src/ui/contexts/SettingsContext.tsx:17:11)[39m
[31m+  - ModelDialog (src/ui/components/ModelDialog.tsx:40:20)[39m
[31m+  -Object.react-stack-bott[39m
[31m+   m-frame                (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-re[39m
[31m+                          conciler.development.js:15859:20)[39m
[31m+  -renderWithHoo[39m
[31m+   s            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.d[39m
[31m+                evelopment.js:3221:22)[39m
[31m+  -updateFunctionComp[39m
[31m+   nent              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconci[39m
[31m+                     ler.development.js:6475:19)[39m
[31m+  -beginWor[39m
[31m+           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.develo[39m
[31m+           pment.js:8009:18)[39m
[31m+  -runWithFiberIn[39m
[31m+   EV            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:1738:13)[39m
[31m+  -performUnitOfW[39m
[31m+   rk            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:12834:22)[39m
[31m+  -workLoopSyn[39m
[31m+              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.dev[39m
[31m+              elopment.js:12644:41)[39m
[31m+  -renderRootSy[39m
[31m+   c           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.de[39m
[31m+               velopment.js:12624:11)[39m
[31m+[39m

 ‚ùØ src/ui/components/ModelDialog.test.tsx:255:27
    253|       mockGetPreviewFeatures.mockReturnValue(false);
    254|       const { lastFrame } = renderComponent();
    255|       expect(lastFrame()).toContain('Gemini 3 is now available.');
       |                           ^
    256|       expect(lastFrame()).toContain('Enable "Preview features" in /set‚Ä¶
    257|     });

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[11/12]‚éØ

 FAIL  src/ui/components/ModelDialog.test.tsx > <ModelDialog /> > Preview Logic > should show "Gemini 3 is coming soon" header if user has no access
AssertionError: expected '\n  ERROR  useSettings must be used w‚Ä¶' to contain 'Gemini 3 is coming soon.'

[32m- Expected[39m
[31m+ Received[39m

[32m- Gemini 3 is coming soon.[39m
[31m+[39m
[31m+   ERROR  useSettings must be used within a SettingsProvider[39m
[31m+[39m
[31m+  src/ui/contexts/SettingsContext.tsx:17:11[39m
[31m+[39m
[31m+  14: export const useSettings = () => {[39m
[31m+  15:   const context = useContext(SettingsContext);[39m
[31m+  16:   if (context === undefined) {[39m
[31m+  17:     throw new Error('useSettings must be used within a SettingsProvider');[39m
[31m+  18:   }[39m
[31m+  19:   return context;[39m
[31m+  20: };[39m
[31m+[39m
[31m+  - useSettings (src/ui/contexts/SettingsContext.tsx:17:11)[39m
[31m+  - ModelDialog (src/ui/components/ModelDialog.tsx:40:20)[39m
[31m+  -Object.react-stack-bott[39m
[31m+   m-frame                (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-re[39m
[31m+                          conciler.development.js:15859:20)[39m
[31m+  -renderWithHoo[39m
[31m+   s            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.d[39m
[31m+                evelopment.js:3221:22)[39m
[31m+  -updateFunctionComp[39m
[31m+   nent              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconci[39m
[31m+                     ler.development.js:6475:19)[39m
[31m+  -beginWor[39m
[31m+           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.develo[39m
[31m+           pment.js:8009:18)[39m
[31m+  -runWithFiberIn[39m
[31m+   EV            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:1738:13)[39m
[31m+  -performUnitOfW[39m
[31m+   rk            (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.[39m
[31m+                 development.js:12834:22)[39m
[31m+  -workLoopSyn[39m
[31m+              (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.dev[39m
[31m+              elopment.js:12644:41)[39m
[31m+  -renderRootSy[39m
[31m+   c           (/Users/robinx/code/codefly-cli/node_modules/react-reconciler/cjs/react-reconciler.de[39m
[31m+               velopment.js:12624:11)[39m
[31m+[39m

 ‚ùØ src/ui/components/ModelDialog.test.tsx:263:27
    261|       mockGetPreviewFeatures.mockReturnValue(false);
    262|       const { lastFrame } = renderComponent();
    263|       expect(lastFrame()).toContain('Gemini 3 is coming soon.');
       |                           ^
    264|     });
    265| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[12/12]‚éØ


 Test Files  1 failed (1)
      Tests  12 failed | 3 passed (15)
   Start at  19:51:18
   Duration  3.94s (transform 432ms, setup 18ms, collect 1.04s, tests 1.88s, environment 0ms, prepare 33ms)

JUNIT report written to /Users/robinx/code/codefly-cli/packages/cli/junit.xml

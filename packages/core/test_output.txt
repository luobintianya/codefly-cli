
> @codeflyai/codefly-core@0.24.0-nightly.20251227.37be16243 test
> vitest run --reporter=verbose


 RUN  v3.2.4 /Users/robinx/code/codefly-cli/packages/core
      Coverage enabled with v8

 âœ“ src/config/models.test.ts > supportsMultimodalFunctionResponse > should return true for gemini-3 model 1ms
 âœ“ src/config/models.test.ts > supportsMultimodalFunctionResponse > should return false for gemini-2 models 0ms
 âœ“ src/config/models.test.ts > supportsMultimodalFunctionResponse > should return false for other models 0ms
 Ã— src/config/models.test.ts > resolveModel > delegation logic > should return the Preview Pro model when auto-gemini-3 is requested 5ms
   â†’ expected 'gemini-3-flash-preview' to be 'gemini-3-pro-preview' // Object.is equality
 âœ“ src/config/models.test.ts > resolveModel > delegation logic > should return the Default Pro model when auto-gemini-2.5 is requested 0ms
 âœ“ src/config/models.test.ts > resolveModel > delegation logic > should return the requested model as-is for explicit specific models 0ms
 âœ“ src/config/models.test.ts > resolveModel > delegation logic > should return a custom model name when requested 0ms
 âœ“ src/config/models.test.ts > resolveModel > delegation logic > with preview features > should return the preview model when pro alias is requested 0ms
 âœ“ src/config/models.test.ts > resolveModel > delegation logic > with preview features > should return the default pro model when pro alias is requested and preview is off 0ms
 âœ“ src/config/models.test.ts > resolveModel > delegation logic > with preview features > should return the flash model when flash is requested and preview is on 0ms
 âœ“ src/config/models.test.ts > resolveModel > delegation logic > with preview features > should return the flash model when lite is requested and preview is on 0ms
 âœ“ src/config/models.test.ts > resolveModel > delegation logic > with preview features > should return the flash model when the flash model name is explicitly requested and preview is on 0ms
 âœ“ src/config/models.test.ts > resolveModel > delegation logic > with preview features > should return the lite model when the lite model name is requested and preview is on 0ms
 âœ“ src/config/models.test.ts > resolveModel > delegation logic > with preview features > should return the default gemini model when the model is explicitly set and preview is on 0ms
 âœ“ src/config/models.test.ts > isCodefly2Model > should return true for gemini-2.5-pro 0ms
 âœ“ src/config/models.test.ts > isCodefly2Model > should return true for gemini-2.5-flash 0ms
 âœ“ src/config/models.test.ts > isCodefly2Model > should return true for gemini-2.0-flash 0ms
 âœ“ src/config/models.test.ts > isCodefly2Model > should return false for gemini-1.5-pro 0ms
 âœ“ src/config/models.test.ts > isCodefly2Model > should return false for gemini-3-pro 0ms
 âœ“ src/config/models.test.ts > isCodefly2Model > should return false for arbitrary strings 0ms
 âœ“ src/config/models.test.ts > resolveClassifierModel > should return flash model when alias is flash 0ms
 Ã— src/config/models.test.ts > resolveClassifierModel > should return pro model when alias is pro 1ms
   â†’ expected 'gemini-3-flash-preview' to be 'gemini-3-pro-preview' // Object.is equality
 âœ“ src/config/models.test.ts > resolveClassifierModel > should handle preview features being enabled 0ms
 âœ“ src/routing/strategies/fallbackStrategy.test.ts > FallbackStrategy > should return null if the requested model is available 1ms
 âœ“ src/routing/strategies/fallbackStrategy.test.ts > FallbackStrategy > should return null if fallback selection is same as requested model 0ms
 Ã— src/routing/strategies/fallbackStrategy.test.ts > FallbackStrategy > should return fallback decision if model is unavailable and fallback found 2ms
   â†’ expected null not to be null
 âœ“ src/routing/strategies/fallbackStrategy.test.ts > FallbackStrategy > should correctly handle "auto" alias by resolving it before checking availability 0ms
 âœ“ src/availability/policyHelpers.test.ts > policyHelpers > resolvePolicyChain > returns a single-model chain for a custom model 1ms
 âœ“ src/availability/policyHelpers.test.ts > policyHelpers > resolvePolicyChain > leaves catalog order untouched when active model already present 0ms
 Ã— src/availability/policyHelpers.test.ts > policyHelpers > resolvePolicyChain > returns the default chain when active model is "auto" 7ms
   â†’ expected [ { â€¦(4) } ] to have a length of 2 but got 1
 âœ“ src/availability/policyHelpers.test.ts > policyHelpers > resolvePolicyChain > starts chain from preferredModel when model is "auto" 0ms
 Ã— src/availability/policyHelpers.test.ts > policyHelpers > resolvePolicyChain > wraps around the chain when wrapsAround is true 0ms
   â†’ expected [ { model: 'gemini-2.5-flash', â€¦(3) } ] to have a length of 2 but got 1
 âœ“ src/availability/policyHelpers.test.ts > policyHelpers > buildFallbackPolicyContext > returns remaining candidates after the failed model 0ms
 âœ“ src/availability/policyHelpers.test.ts > policyHelpers > buildFallbackPolicyContext > wraps around when building fallback context if wrapsAround is true 0ms
 âœ“ src/availability/policyHelpers.test.ts > policyHelpers > buildFallbackPolicyContext > returns full chain when model is not in policy list 0ms
 âœ“ src/availability/policyHelpers.test.ts > policyHelpers > applyModelSelection > returns requested model if it is available 1ms
 âœ“ src/availability/policyHelpers.test.ts > policyHelpers > applyModelSelection > switches to backup model and updates config if requested is unavailable 0ms
 âœ“ src/availability/policyHelpers.test.ts > policyHelpers > applyModelSelection > consumes sticky attempt if indicated 0ms
 âœ“ src/availability/policyHelpers.test.ts > policyHelpers > applyModelSelection > does not consume sticky attempt if consumeAttempt is false 0ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should return ASK_USER for write tools and ALLOW for read-only tools by default 209ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should allow tools in tools.allowed 1ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should deny tools in tools.exclude 0ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should allow tools from allowed MCP servers 0ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should deny tools from excluded MCP servers 0ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should allow tools from trusted MCP servers 0ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should handle multiple MCP server configurations together 0ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should allow all tools in YOLO mode 4ms
 Ã— src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should include available_skills when provided in config 11ms
   â†’ Snapshot `Core System Prompt (prompts.ts) > should include available_skills when provided in config 1` mismatched
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should NOT include skill guidance or available_skills when NO skills are provided 1ms
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should use chatty system prompt for preview model 0ms
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should use chatty system prompt for preview flash model 0ms
 Ã— src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should return the base prompt when userMemory is empty string 4ms
   â†’ expected 'You are an interactive CLI agent specâ€¦' to contain 'No Chitchat:'
 Ã— src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should return the base prompt when userMemory is whitespace only 4ms
   â†’ expected 'You are an interactive CLI agent specâ€¦' to contain 'No Chitchat:'
 Ã— src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should append userMemory with separator when provided 4ms
   â†’ Snapshot `Core System Prompt (prompts.ts) > should append userMemory with separator when provided 1` mismatched
 Ã— src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should include correct sandbox instructions for SANDBOX=true 4ms
   â†’ Snapshot `Core System Prompt (prompts.ts) > should include correct sandbox instructions for SANDBOX=true 1` mismatched
 Ã— src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should include correct sandbox instructions for SANDBOX=sandbox-exec 5ms
   â†’ Snapshot `Core System Prompt (prompts.ts) > should include correct sandbox instructions for SANDBOX=sandbox-exec 1` mismatched
 Ã— src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should include correct sandbox instructions for SANDBOX=undefined 5ms
   â†’ Snapshot `Core System Prompt (prompts.ts) > should include correct sandbox instructions for SANDBOX=undefined 1` mismatched
 Ã— src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should handle git instructions when isGitRepository=true 4ms
   â†’ Snapshot `Core System Prompt (prompts.ts) > should handle git instructions when isGitRepository=true 1` mismatched
 Ã— src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should handle git instructions when isGitRepository=false 4ms
   â†’ Snapshot `Core System Prompt (prompts.ts) > should handle git instructions when isGitRepository=false 1` mismatched
 Ã— src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should return the interactive avoidance prompt when in non-interactive mode 4ms
   â†’ Snapshot `Core System Prompt (prompts.ts) > should return the interactive avoidance prompt when in non-interactive mode 1` mismatched
 Ã— src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should handle CodebaseInvestigator with tools=codebase_investigator 4ms
   â†’ Snapshot `Core System Prompt (prompts.ts) > should handle CodebaseInvestigator with tools=codebase_investigator 1` mismatched
 Ã— src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should handle CodebaseInvestigator with tools= 4ms
   â†’ Snapshot `Core System Prompt (prompts.ts) > should handle CodebaseInvestigator with tools= 1` mismatched
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > GEMINI_SYSTEM_MD environment variable > should use default prompt when GEMINI_SYSTEM_MD is "false" 1ms
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > GEMINI_SYSTEM_MD environment variable > should use default prompt when GEMINI_SYSTEM_MD is "0" 0ms
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > GEMINI_SYSTEM_MD environment variable > should throw error if GEMINI_SYSTEM_MD points to a non-existent file 1ms
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > GEMINI_SYSTEM_MD environment variable > should read from default path when GEMINI_SYSTEM_MD is "true" 1ms
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > GEMINI_SYSTEM_MD environment variable > should read from default path when GEMINI_SYSTEM_MD is "1" 0ms
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > GEMINI_SYSTEM_MD environment variable > should read from custom path when GEMINI_SYSTEM_MD provides one, preserving case 0ms
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > GEMINI_SYSTEM_MD environment variable > should expand tilde in custom path when GEMINI_SYSTEM_MD is set 0ms
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > GEMINI_WRITE_SYSTEM_MD environment variable > should not write to file when GEMINI_WRITE_SYSTEM_MD is "false" 0ms
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > GEMINI_WRITE_SYSTEM_MD environment variable > should not write to file when GEMINI_WRITE_SYSTEM_MD is "0" 0ms
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > GEMINI_WRITE_SYSTEM_MD environment variable > should write to default path when GEMINI_WRITE_SYSTEM_MD is "true" 1ms
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > GEMINI_WRITE_SYSTEM_MD environment variable > should write to default path when GEMINI_WRITE_SYSTEM_MD is "1" 0ms
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > GEMINI_WRITE_SYSTEM_MD environment variable > should write to custom path when GEMINI_WRITE_SYSTEM_MD provides one 0ms
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > GEMINI_WRITE_SYSTEM_MD environment variable > should expand tilde in custom path when GEMINI_WRITE_SYSTEM_MD is "~/custom/system.md" 0ms
 âœ“ src/core/prompts.test.ts > Core System Prompt (prompts.ts) > GEMINI_WRITE_SYSTEM_MD environment variable > should expand tilde in custom path when GEMINI_WRITE_SYSTEM_MD is "~" 0ms
 âœ“ src/core/prompts.test.ts > resolvePathFromEnv helper function > when envVar is undefined, empty, or whitespace > should return null for undefined 0ms
 âœ“ src/core/prompts.test.ts > resolvePathFromEnv helper function > when envVar is undefined, empty, or whitespace > should return null for empty string 0ms
 âœ“ src/core/prompts.test.ts > resolvePathFromEnv helper function > when envVar is undefined, empty, or whitespace > should return null for whitespace only 0ms
 âœ“ src/core/prompts.test.ts > resolvePathFromEnv helper function > when envVar is a boolean-like string > should handle "0" as disabled switch 0ms
 âœ“ src/core/prompts.test.ts > resolvePathFromEnv helper function > when envVar is a boolean-like string > should handle "false" as disabled switch 0ms
 âœ“ src/core/prompts.test.ts > resolvePathFromEnv helper function > when envVar is a boolean-like string > should handle "1" as enabled switch 0ms
 âœ“ src/core/prompts.test.ts > resolvePathFromEnv helper function > when envVar is a boolean-like string > should handle "true" as enabled switch 0ms
 âœ“ src/core/prompts.test.ts > resolvePathFromEnv helper function > when envVar is a boolean-like string > should handle "FALSE" (case-insensitive) 0ms
 âœ“ src/core/prompts.test.ts > resolvePathFromEnv helper function > when envVar is a boolean-like string > should handle "TRUE" (case-insensitive) 0ms
 âœ“ src/core/prompts.test.ts > resolvePathFromEnv helper function > when envVar is a file path > should resolve path: /absolute/path/file.txt 0ms
 âœ“ src/core/prompts.test.ts > resolvePathFromEnv helper function > when envVar is a file path > should resolve path: relative/path/file.txt 0ms
 âœ“ src/core/prompts.test.ts > resolvePathFromEnv helper function > when envVar is a file path > should expand tilde path: ~/documents/file.txt 0ms
 âœ“ src/core/prompts.test.ts > resolvePathFromEnv helper function > when envVar is a file path > should expand tilde path: ~ 0ms
 âœ“ src/core/prompts.test.ts > resolvePathFromEnv helper function > when envVar is a file path > should handle os.homedir() errors gracefully 0ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should allow edit tool in AUTO_EDIT mode 4ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should prioritize exclude over allow 0ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should prioritize specific tool allows over MCP server excludes 0ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should handle MCP server allows and tool excludes 0ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should handle complex priority scenarios correctly 31ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should handle MCP servers with undefined trust property 0ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should have YOLO allow-all rule beat write tool rules in YOLO mode 28ms
 Ã— src/policy/config.test.ts > createPolicyEngineConfig > should support argsPattern in policy rules 14ms
   â†’ expected undefined to be defined
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should perform complete OAuth flow with PKCE 15ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should handle OAuth discovery when no authorization URL provided 13ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should perform dynamic client registration when no client ID is provided but registration URL is provided 11ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should perform OAuth discovery and dynamic client registration when no client ID or registration URL provided 12ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should perform OAuth discovery once and dynamic client registration when no client ID, authorization URL or registration URL provided 11ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should handle OAuth callback errors 13ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should handle state mismatch in callback 13ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should handle token exchange failure 11ms
 Ã— src/policy/config.test.ts > createPolicyEngineConfig > should load safety_checker configuration from TOML 30ms
   â†’ expected undefined to be defined
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should reject invalid in-process checker names 29ms
 âœ“ src/policy/config.test.ts > createPolicyEngineConfig > should have default ASK_USER rule for discovered tools 18ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should handle OAuth discovery failure 1ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should handle authorization server metadata discovery failure 1ms
 âœ“ src/tools/ripGrep.test.ts > canUseRipgrep > should return true if ripgrep already exists 8ms
 âœ“ src/tools/ripGrep.test.ts > canUseRipgrep > should download ripgrep and return true if it does not exist initially 3ms
 âœ“ src/tools/ripGrep.test.ts > canUseRipgrep > should return false if download fails and file does not exist 1ms
 âœ“ src/tools/ripGrep.test.ts > canUseRipgrep > should propagate errors from downloadRipGrep 2ms
 âœ“ src/tools/ripGrep.test.ts > canUseRipgrep > should only download once when called concurrently 4ms
 âœ“ src/tools/ripGrep.test.ts > ensureRgPath > should return rg path if ripgrep already exists 5ms
 âœ“ src/tools/ripGrep.test.ts > ensureRgPath > should return rg path if ripgrep is downloaded successfully 4ms
 âœ“ src/tools/ripGrep.test.ts > ensureRgPath > should throw an error if ripgrep cannot be used after download attempt 1ms
 âœ“ src/tools/ripGrep.test.ts > ensureRgPath > should propagate errors from downloadRipGrep 1ms
 â†“ src/tools/ripGrep.test.ts > ensureRgPath > should detect ripgrep when only rg.exe exists on Windows
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > validateToolParams > should return null for valid params ('pattern only') 18ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > validateToolParams > should return null for valid params ('pattern and path') 11ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > validateToolParams > should return null for valid params ('pattern, path, and include') 32ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > validateToolParams > should return null for valid params ('invalid regex pattern') 5ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Successful Execution > should execute a command and capture output 9ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Successful Execution > should strip ANSI color codes from output 3ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Successful Execution > should correctly decode multi-byte characters split across chunks 6ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Successful Execution > should handle commands with no output 1ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Successful Execution > should capture large output (10000 lines) 62ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Successful Execution > should not wrap long lines in the final output 3ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Successful Execution > should not add extra padding but preserve explicit trailing whitespace 2ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Successful Execution > should truncate output exceeding the scrollback limit 2ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Successful Execution > should call onPid with the process id 1ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > pty interaction > should write to the pty and trigger a render 8ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > getCredentials > should return null when file does not exist 29ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > getCredentials > should return null for expired tokens 27ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > getCredentials > should return credentials for valid tokens 23ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > validateToolParams > should return error if pattern is missing 8ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > validateToolParams > should return error if path does not exist 9ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > validateToolParams > should allow path to be a file 11ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > execute > should find matches for a simple pattern in all files 12ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > execute > should find matches in a specific path 9ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > execute > should find matches with an include glob 10ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > execute > should find matches with an include glob and path 8ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > execute > should return "No matches found" when pattern does not exist 7ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > execute > should return an error from ripgrep for invalid regex pattern 8ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > execute > should handle regex special characters correctly 16ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > execute > should be case-insensitive by default (JS fallback) 8ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > getCredentials > should throw error for corrupted files 31ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > setCredentials > should save credentials with encryption 24ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > setCredentials > should update existing credentials 29ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > deleteCredentials > should throw when credentials do not exist 22ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > deleteCredentials > should delete file when last credential is removed 22ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > execute > should throw an error if params are invalid 6ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > execute > should throw an error if ripgrep is not available 3ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > multi-directory workspace > should search only CWD when no path is specified (default behavior) 6ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > multi-directory workspace > should search only specified path within workspace directories 6ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > abort signal handling > should handle AbortSignal during search 5ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > abort signal handling > should abort streaming search when signal is triggered 5ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > error handling and edge cases > should handle workspace boundary violations 3ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > error handling and edge cases > should handle 'empty directories' gracefully 6ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > error handling and edge cases > should handle 'empty files' gracefully 5ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > error handling and edge cases > should handle special characters in file names 7ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > error handling and edge cases > should handle deeply nested directories 15ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > regex pattern validation > should handle complex regex patterns 15ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > regex pattern validation > should handle case sensitivity correctly in JS fallback 11ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > pty interaction > should resize the pty and the headless terminal 3ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > pty interaction > should not resize the pty if it is not active 1ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > pty interaction > should ignore errors when resizing an exited pty 1ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > pty interaction > should re-throw other errors during resize 1ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > pty interaction > should scroll the headless terminal 2ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > pty interaction > should not throw when resizing a pty that has already exited (Windows) 0ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Failed Execution > should capture a non-zero exit code 2ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Failed Execution > should capture a termination signal 1ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Failed Execution > should handle a synchronous spawn error 1ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Aborting Commands > should abort a running process and set the aborted flag 1ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Aborting Commands > should send SIGTERM and then SIGKILL on abort 202ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > deleteCredentials > should update file when other credentials remain 22ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > listServers > should return empty list when file does not exist 22ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > listServers > should return list of server names 22ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > clearAll > should delete the token file 22ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > clearAll > should not throw when file does not exist 22ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > regex pattern validation > should handle escaped regex special characters 15ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > include pattern filtering > should handle multiple file extensions in include pattern 8ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > include pattern filtering > should handle directory patterns in include 11ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > advanced search options > should handle case_sensitive parameter 9ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > advanced search options > should handle 'fixed_strings parameter' 18ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > advanced search options > should handle no_ignore parameter 11ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > advanced search options > should add .geminiignore when enabled and patterns exist 9ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > advanced search options > should skip .geminiignore when disabled 6ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > advanced search options > should handle context parameters 10ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > getDescription > should generate correct description with 'pattern only' 8ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > encryption > should encrypt and decrypt data correctly 22ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > encryption > should produce different encrypted output each time 22ms
 âœ“ src/mcp/token-storage/file-token-storage.test.ts > FileTokenStorage > encryption > should throw on invalid encrypted data format 22ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Aborting Commands > should resolve without waiting for the processing chain on abort 2ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Binary Output > should detect binary output and switch to progress events 1ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Binary Output > should not emit data events after binary is detected 1ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Platform-Specific Behavior > should use powershell.exe on Windows 1ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > Platform-Specific Behavior > should use bash on Linux 6ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > AnsiOutput rendering > should call onOutputEvent with AnsiOutput when showColor is true 3ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > AnsiOutput rendering > should call onOutputEvent with AnsiOutput when showColor is false 3ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService > AnsiOutput rendering > should handle multi-line output correctly when showColor is false 3ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Successful Execution > should execute a command and capture stdout and stderr 1ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Successful Execution > should strip ANSI color codes from output 0ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Successful Execution > should correctly decode multi-byte characters split across chunks 0ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Successful Execution > should handle commands with no output 0ms
 â†“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Successful Execution > should truncate stdout using a sliding window and show a warning
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Failed Execution > should capture a non-zero exit code and format output correctly 0ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Failed Execution > should capture a termination signal 0ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Failed Execution > should handle a spawn error 0ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Failed Execution > handles errors that do not fire the exit event 1ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Aborting Commands > on 'linux' > should abort a running process and set the aborted flag 0ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Aborting Commands > on 'win32' > should abort a running process and set the aborted flag 0ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Aborting Commands > should gracefully attempt SIGKILL on linux if SIGTERM fails 14ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Binary Output > should detect binary output and switch to progress events 1ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Binary Output > should not emit data events after binary is detected 0ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Platform-Specific Behavior > should use powershell.exe on Windows 0ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService child_process fallback > Platform-Specific Behavior > should use bash and detached process group on Linux 0ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService execution method selection > should use node-pty when shouldUseNodePty is true and pty is available 1ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService execution method selection > should use child_process when shouldUseNodePty is false 0ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService execution method selection > should fall back to child_process if pty is not available even if shouldUseNodePty is true 0ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService environment variables > should use a sanitized environment when in a GitHub run 27ms
 âœ“ src/services/shellExecutionService.test.ts > ShellExecutionService environment variables > should include the full process.env when not in a GitHub run 34ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > getDescription > should generate correct description with 'pattern and include' 16ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > getDescription > should generate correct description with 'root path in description' 14ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > getDescription > should generate correct description with pattern and path 11ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > getDescription > should use ./ when no path is specified (defaults to CWD) 6ms
 âœ“ src/tools/ripGrep.test.ts > RipGrepTool > getDescription > should generate correct description with pattern, include, and path 17ms
 âœ“ src/utils/errorParsing.test.ts > parseAndFormatApiError > should format a valid API error JSON 1ms
 Ã— src/utils/errorParsing.test.ts > parseAndFormatApiError > should format a 429 API error with the default message 4ms
   â†’ expected '[API Error: Rate limit exceeded (Statâ€¦' to contain 'Possible quota limitations in place oâ€¦'
 âœ“ src/utils/errorParsing.test.ts > parseAndFormatApiError > should format a 429 API error with the vertex message 0ms
 âœ“ src/utils/errorParsing.test.ts > parseAndFormatApiError > should return the original message if it is not a JSON error 0ms
 âœ“ src/utils/errorParsing.test.ts > parseAndFormatApiError > should return the original message for malformed JSON 0ms
 âœ“ src/utils/errorParsing.test.ts > parseAndFormatApiError > should handle JSON that does not match the ApiError structure 0ms
 âœ“ src/utils/errorParsing.test.ts > parseAndFormatApiError > should format a nested API error 0ms
 âœ“ src/utils/errorParsing.test.ts > parseAndFormatApiError > should format a StructuredError 0ms
 âœ“ src/utils/errorParsing.test.ts > parseAndFormatApiError > should format a 429 StructuredError with the vertex message 0ms
 âœ“ src/utils/errorParsing.test.ts > parseAndFormatApiError > should handle an unknown error type 0ms
 Ã— src/fallback/handler.test.ts > handleFallback > policy-driven flow > uses availability selection with correct candidates when enabled 4ms
   â†’ expected "spy" to be called with arguments: [ [ 'gemini-3-flash-preview' ] ][90m

Number of calls: [1m0[22m
[39m
 âœ“ src/fallback/handler.test.ts > handleFallback > policy-driven flow > falls back to last resort when availability returns null 1ms
 Ã— src/fallback/handler.test.ts > handleFallback > policy-driven flow > executes silent policy action without invoking UI handler 1ms
   â†’ expected null to be true // Object.is equality
 âœ“ src/fallback/handler.test.ts > handleFallback > policy-driven flow > does not wrap around to upgrade candidates if the current model was selected at the end (e.g. by router) 0ms
 âœ“ src/fallback/handler.test.ts > handleFallback > policy-driven flow > successfully follows expected availability response for Preview Chain 0ms
 âœ“ src/fallback/handler.test.ts > handleFallback > policy-driven flow > should launch upgrade flow and avoid fallback mode when handler returns "upgrade" 0ms
 âœ“ src/fallback/handler.test.ts > handleFallback > policy-driven flow > should catch errors from the handler, log an error, and return null 0ms
 âœ“ src/fallback/handler.test.ts > handleFallback > policy-driven flow > should pass TerminalQuotaError (429) correctly to the handler 0ms
 âœ“ src/fallback/handler.test.ts > handleFallback > policy-driven flow > should pass RetryableQuotaError correctly to the handler 0ms
 âœ“ src/fallback/handler.test.ts > handleFallback > policy-driven flow > Call the handler with fallback model same as the failed model when the failed model is the last-resort policy 0ms
 âœ“ src/fallback/handler.test.ts > handleFallback > policy-driven flow > calls setActiveModel and logs telemetry when handler returns "retry_always" 0ms
 âœ“ src/fallback/handler.test.ts > handleFallback > policy-driven flow > does NOT call setActiveModel when handler returns "stop" 0ms
 âœ“ src/fallback/handler.test.ts > handleFallback > policy-driven flow > does NOT call setActiveModel when handler returns "retry_once" 0ms
 âœ“ src/services/chatCompressionService.test.ts > findCompressSplitPoint > should throw an error for non-positive numbers 2ms
 âœ“ src/services/chatCompressionService.test.ts > findCompressSplitPoint > should throw an error for a fraction greater than or equal to 1 0ms
 âœ“ src/services/chatCompressionService.test.ts > findCompressSplitPoint > should handle an empty history 0ms
 âœ“ src/services/chatCompressionService.test.ts > findCompressSplitPoint > should handle a fraction in the middle 0ms
 âœ“ src/services/chatCompressionService.test.ts > findCompressSplitPoint > should handle a fraction of last index 0ms
 âœ“ src/services/chatCompressionService.test.ts > findCompressSplitPoint > should handle a fraction of after last index 0ms
 âœ“ src/services/chatCompressionService.test.ts > findCompressSplitPoint > should return earlier splitpoint if no valid ones are after threshold 0ms
 âœ“ src/services/chatCompressionService.test.ts > findCompressSplitPoint > should handle a history with only one item 0ms
 âœ“ src/services/chatCompressionService.test.ts > findCompressSplitPoint > should handle history with weird parts 0ms
 âœ“ src/services/chatCompressionService.test.ts > modelStringToModelConfigAlias > should return the default model for unexpected aliases 0ms
 Ã— src/services/chatCompressionService.test.ts > modelStringToModelConfigAlias > should handle valid names 4ms
   â†’ expected 'chat-compression-default' to be 'chat-compression-2.5-pro' // Object.is equality
 âœ“ src/services/chatCompressionService.test.ts > ChatCompressionService > should return NOOP if history is empty 1ms
 âœ“ src/services/chatCompressionService.test.ts > ChatCompressionService > should return NOOP if previously failed and not forced 0ms
 âœ“ src/services/chatCompressionService.test.ts > ChatCompressionService > should return NOOP if under token threshold and not forced 0ms
 âœ“ src/services/chatCompressionService.test.ts > ChatCompressionService > should compress if over token threshold 1ms
 âœ“ src/services/chatCompressionService.test.ts > ChatCompressionService > should force compress even if under threshold 0ms
 âœ“ src/services/chatCompressionService.test.ts > ChatCompressionService > should return FAILED if new token count is inflated 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logChatCompression > logs the chat compression event to Clearcut 2ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logChatCompression > records the chat compression event to OTEL 1ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logCliConfiguration > should log the cli configuration 1ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logUserPrompt > should log a user prompt 0ms
 Ã— src/telemetry/loggers.test.ts > loggers > logUserPrompt > should not log prompt if disabled 7ms
   â†’ expected "spy" to be called with arguments: [ { â€¦(2) } ][90m

Received: 

[1m  1st spy call:

[22m[33m@@ -1,9 +1,9 @@[90m
[2m  [[22m
[2m    {[22m
[2m      "attributes": {[22m
[32m-       "auth_type": "compute-default-credentials",[90m
[31m+       "auth_type": "gemini-api-key",[90m
[2m        "event.name": "gemini_cli.user_prompt",[22m
[2m        "event.timestamp": "2025-01-01T00:00:00.000Z",[22m
[2m        "installation.id": "test-installation-id",[22m
[2m        "interactive": false,[22m
[2m        "prompt_id": "prompt-id-9",[22m
[39m[90m

Number of calls: [1m1[22m
[39m
 Ã— src/telemetry/loggers.test.ts > loggers > logApiResponse > should log an API response with all fields 2ms
   â†’ expected "spy" to be called with arguments: [ { â€¦(5) }, 100, { â€¦(3) } ][90m

Received: 

[1m  1st spy call:

[22m[33m@@ -8,11 +8,11 @@[90m
[2m    },[22m
[2m    100,[22m
[2m    {[22m
[2m      "genAiAttributes": {[22m
[2m        "gen_ai.operation.name": "generate_content",[22m
[32m-       "gen_ai.provider.name": "gcp.vertex_ai",[90m
[31m+       "gen_ai.provider.name": "gcp.gen_ai",[90m
[2m        "gen_ai.request.model": "test-model",[22m
[2m        "gen_ai.response.model": "test-model",[22m
[2m      },[22m
[2m      "model": "test-model",[22m
[2m      "status_code": 200,[22m
[39m[90m

Number of calls: [1m1[22m
[39m
 Ã— src/telemetry/loggers.test.ts > loggers > logApiError > should log an API error with all fields 1ms
   â†’ expected "spy" to be called with arguments: [ { â€¦(5) }, 100, { â€¦(3) } ][90m

Received: 

[1m  1st spy call:

[22m[33m@@ -9,11 +9,11 @@[90m
[2m    100,[22m
[2m    {[22m
[2m      "genAiAttributes": {[22m
[2m        "error.type": "ApiError",[22m
[2m        "gen_ai.operation.name": "generate_content",[22m
[32m-       "gen_ai.provider.name": "gcp.vertex_ai",[90m
[31m+       "gen_ai.provider.name": "gcp.gen_ai",[90m
[2m        "gen_ai.request.model": "test-model",[22m
[2m        "gen_ai.response.model": "test-model",[22m
[2m      },[22m
[2m      "model": "test-model",[22m
[2m      "status_code": 503,[22m
[39m[90m

Number of calls: [1m1[22m
[39m
 Ã— src/telemetry/loggers.test.ts > loggers > logApiRequest > should log an API request with request_text 1ms
   â†’ expected 2nd "spy" call to have been called with [ { â€¦(2) } ]
 Ã— src/telemetry/loggers.test.ts > loggers > logApiRequest > should log an API request without request_text 1ms
   â†’ expected 2nd "spy" call to have been called with [ { â€¦(2) } ]
 âœ“ src/telemetry/loggers.test.ts > loggers > logApiRequest > should log an API request with full semantic details when logPrompts is enabled 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logApiRequest > should log an API request with semantic details, but without prompts when logPrompts is disabled 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logApiRequest > should correctly derive model from prompt details if available in semantic log 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logFlashFallback > should log flash fallback event 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logRipgrepFallback > should log ripgrep fallback event 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logRipgrepFallback > should log ripgrep fallback event with an error 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logToolCall > should log a tool call with all fields 2ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logToolCall > should log a tool call with a reject decision 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logToolCall > should log a tool call with a modify decision 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logToolCall > should log a tool call without a decision 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logToolCall > should log a failed tool call with an error 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logToolCall > should log a tool call with mcp_server_name for MCP tools 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logMalformedJsonResponse > logs the event to Clearcut and OTEL 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logFileOperation > should log a file operation event 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logToolOutputTruncated > should log a tool output truncated event 0ms
 Ã— src/telemetry/loggers.test.ts > loggers > logModelRouting > should log the event to Clearcut and OTEL, and record metrics 1ms
   â†’ expected "recordModelRoutingMetrics" to be called with arguments: [ { â€¦(2) } ][90m

Received: 

[1m  1st recordModelRoutingMetrics call:

[22m[2m  [[22m
[2m    {[22m
[2m      "getSessionId": [Function getSessionId],[22m
[2m      "isInteractive": [Function isInteractive],[22m
[2m    },[22m
[31m+   ModelRoutingEvent {[90m
[31m+     "decision_model": "gemini-pro",[90m
[31m+     "decision_source": "default",[90m
[31m+     "error_message": undefined,[90m
[31m+     "event.name": "model_routing",[90m
[31m+     "event.timestamp": "2025-01-01T00:00:00.000Z",[90m
[31m+     "failed": false,[90m
[31m+     "reasoning": "test-reason",[90m
[31m+     "routing_latency_ms": 100,[90m
[31m+   },[90m
[2m  ][22m
[39m[90m

Number of calls: [1m1[22m
[39m
 âœ“ src/telemetry/loggers.test.ts > loggers > logModelRouting > should only log to Clearcut if OTEL SDK is not initialized 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logExtensionInstall > should log extension install event 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logExtensionUpdate > should log extension update event 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logExtensionUninstall > should log extension uninstall event 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logExtensionEnable > should log extension enable event 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logExtensionDisable > should log extension disable event 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logAgentStart > should log agent start event 0ms
 Ã— src/telemetry/loggers.test.ts > loggers > logAgentFinish > should log agent finish event and record metrics 0ms
   â†’ expected "recordAgentRunMetrics" to be called with arguments: [ { â€¦(2) } ][90m

Received: 

[1m  1st recordAgentRunMetrics call:

[22m[2m  [[22m
[2m    {[22m
[2m      "getSessionId": [Function getSessionId],[22m
[2m      "isInteractive": [Function isInteractive],[22m
[2m    },[22m
[31m+   AgentFinishEvent {[90m
[31m+     "agent_id": "agent-123",[90m
[31m+     "agent_name": "TestAgent",[90m
[31m+     "duration_ms": 1000,[90m
[31m+     "event.name": "agent_finish",[90m
[31m+     "event.timestamp": "2025-01-01T00:00:00.000Z",[90m
[31m+     "terminate_reason": "GOAL",[90m
[31m+     "turn_count": 5,[90m
[31m+   },[90m
[2m  ][22m
[39m[90m

Number of calls: [1m1[22m
[39m
 âœ“ src/telemetry/loggers.test.ts > loggers > logWebFetchFallbackAttempt > should log web fetch fallback attempt event 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > logHookCall > should log hook call event to Clearcut and OTEL 0ms
 âœ“ src/telemetry/loggers.test.ts > loggers > Telemetry Buffering > should buffer events when SDK is not initialized 0ms
 âœ“ src/telemetry/sdk.test.ts > Telemetry SDK > should use gRPC exporters when protocol is grpc 6ms
 âœ“ src/telemetry/sdk.test.ts > Telemetry SDK > should use HTTP exporters when protocol is http 1ms
 âœ“ src/telemetry/sdk.test.ts > Telemetry SDK > should parse gRPC endpoint correctly 1ms
 âœ“ src/telemetry/sdk.test.ts > Telemetry SDK > should parse HTTP endpoint correctly 1ms
 âœ“ src/telemetry/sdk.test.ts > Telemetry SDK > should use direct GCP exporters when target is gcp, project ID is set, and useCollector is false 1ms
 âœ“ src/telemetry/sdk.test.ts > Telemetry SDK > should use OTLP exporters when target is gcp but useCollector is true 0ms
 âœ“ src/telemetry/sdk.test.ts > Telemetry SDK > should use GCP exporters even when project ID environment variable is not set 1ms
 âœ“ src/telemetry/sdk.test.ts > Telemetry SDK > should use GOOGLE_CLOUD_PROJECT as fallback when OTLP_GOOGLE_CLOUD_PROJECT is not set 1ms
 âœ“ src/telemetry/sdk.test.ts > Telemetry SDK > should not use OTLP exporters when telemetryOutfile is set 1ms
 âœ“ src/telemetry/sdk.test.ts > Telemetry SDK > should defer initialization when useCliAuth is true and no credentials are provided 0ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should handle invalid callback request 1002ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should handle token exchange failure with non-json response 11ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should handle token exchange with unexpected content type 13ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should handle refresh token failure with non-json response 1ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should handle refresh token with unexpected content type 0ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should continue authentication when browser fails to open 12ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should return null when token is expired and no refresh token is available 1ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > authenticate > should handle callback timeout 1ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > refreshAccessToken > should refresh token successfully 1ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > refreshAccessToken > should include client secret in refresh request when available 1ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > refreshAccessToken > should handle refresh token failure 0ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > getValidToken > should return valid token when not expired 0ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > getValidToken > should refresh expired token and return new token 0ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > getValidToken > should return null when no credentials exist 1ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > getValidToken > should handle refresh failure and remove invalid token 1ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > getValidToken > should return null for token without refresh capability 0ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > PKCE parameter generation > should generate valid PKCE parameters 11ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > Authorization URL building > should build correct authorization URL with all parameters 12ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > Authorization URL building > should correctly append parameters to an authorization URL that already has query params 13ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > Authorization URL building > should correctly append parameters to a URL with a fragment 12ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > McpClient > should discover tools 5ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > McpClient > should not skip tools even if a parameter is missing a type 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > McpClient > should handle errors when discovering prompts 2ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > McpClient > should not discover tools if server does not support them 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > McpClient > should discover tools if server supports them 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > McpClient > should discover tools with $defs and $ref in schema 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > McpClient > should discover resources when a server only exposes resources 2ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > McpClient > refreshes registry when resource list change notification is received 2ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > McpClient > should remove tools and prompts on disconnect 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > Dynamic Tool Updates > should set up notification handler if server supports tool list changes 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > Dynamic Tool Updates > should NOT set up notification handler if server lacks capability 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > Dynamic Tool Updates > should refresh tools and notify manager when notification is received 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > Dynamic Tool Updates > should handle errors during tool refresh gracefully 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > Dynamic Tool Updates > should handle concurrent updates from multiple servers 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > Dynamic Tool Updates > should abort discovery and log error if timeout is exceeded during refresh 2ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > Dynamic Tool Updates > should pass abort signal to onToolsUpdated callback 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > appendMcpServerCommand > should do nothing if no MCP servers or command are configured 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > appendMcpServerCommand > should discover tools via mcpServerCommand 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > appendMcpServerCommand > should handle error if mcpServerCommand parsing fails 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > createTransport > should connect via httpUrl > without headers 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > createTransport > should connect via httpUrl > with headers 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > createTransport > should connect via url > without headers 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > createTransport > should connect via url > with headers 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > createTransport > should connect via url > with type="http" creates StreamableHTTPClientTransport 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > createTransport > should connect via url > with type="sse" creates SSEClientTransport 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > createTransport > should connect via url > without type defaults to StreamableHTTPClientTransport 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > createTransport > should connect via url > with type="http" and headers applies headers correctly 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > createTransport > should connect via url > with type="sse" and headers applies headers correctly 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > createTransport > should connect via url > httpUrl takes priority over url when both are present 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > createTransport > should connect via command 1ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > isEnabled > should return true if no include or exclude lists are provided 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > isEnabled > should return false if the tool is in the exclude list 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > isEnabled > should return true if the tool is in the include list 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > isEnabled > should return true if the tool is in the include list with parentheses 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > isEnabled > should return false if the include list exists but does not contain the tool 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > isEnabled > should return false if the tool is in both the include and exclude lists 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > isEnabled > should return false if the function declaration has no name 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > hasNetworkTransport > should return true if only url is provided 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > hasNetworkTransport > should return true if only httpUrl is provided 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > hasNetworkTransport > should return true if both url and httpUrl are provided 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > hasNetworkTransport > should return false if neither url nor httpUrl is provided 0ms
 âœ“ src/tools/mcp-client.test.ts > mcp-client > hasNetworkTransport > should return false for an empty config object 0ms
 âœ“ src/tools/mcp-client.test.ts > connectToMcpServer with OAuth > should handle automatic OAuth flow on 401 with www-authenticate header 1ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > Authorization URL building > should use user-configured scopes over discovered scopes 12ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > Authorization URL building > should use discovered scopes when no user-configured scopes are provided 13ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > issuer discovery conformance > falls back to path-based issuer when origin discovery fails 1ms
 âœ“ src/mcp/oauth-provider.test.ts > MCPOAuthProvider > issuer discovery conformance > trims versioned segments from authorization endpoints 1ms
 âœ“ src/tools/glob.test.ts > GlobTool > execute > should find files matching a simple pattern in the root 116ms
 âœ“ src/tools/glob.test.ts > GlobTool > execute > should find files case-sensitively when case_sensitive is true 66ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > addHistory > should call chat.addHistory with the provided content 8ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > resetChat > should create a new chat session, clearing the old history 1ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > startChat > should include environment context when resuming a session 1ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > tryCompressChat > when compression inflates the token count > allows compression to be forced/manual after a failure 1ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > tryCompressChat > when compression inflates the token count > yields the result even if the compression inflated the tokens 1ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > tryCompressChat > when compression inflates the token count > does not manipulate the source chat 1ms
 â†“ src/core/client.test.ts > Gemini Client (client.ts) > tryCompressChat > when compression inflates the token count > will not attempt to compress context after a failure
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > tryCompressChat > should correctly latch hasFailedCompressionAttempt flag 1ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > tryCompressChat > should not trigger summarization if token count is below threshold 1ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > tryCompressChat > should return NOOP if history is too short to compress 1ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > emits a compression event when the context was automatically compressed 2ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > does not emit a compression event when the status is 2 2ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > does not emit a compression event when the status is 4 3ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should include editor context when ideMode is enabled 2ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should not add context if ideMode is enabled but no open files 1ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should add context if ideMode is enabled and there is one active file 6ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should add context if ideMode is enabled and there are open files but no active file 2ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should use local estimation for text-only requests and NOT call countTokens 2ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should use countTokens API for requests with non-text parts 2ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should estimate CJK characters more conservatively (closer to 1 token/char) 2ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should return the turn instance after the stream is complete 2ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should stop infinite loop after MAX_TURNS when nextSpeaker always returns model 8ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should yield MaxSessionTurns and stop when session turn limit is reached 3ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should respect MAX_TURNS limit even when turns parameter is set to a large value 8ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should yield ContextWindowWillOverflow when the context window is about to overflow 4ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should use the sticky model's token limit for the overflow check 4ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should not trigger overflow warning for requests with large binary data (PDFs/images) 3ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > Model Routing > should use the model router service to select a model on the first turn 4ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > Model Routing > should use the same model for subsequent turns in the same prompt (stickiness) 4ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > Model Routing > should reset the sticky model and re-route when the prompt_id changes 6ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should use getGlobalMemory for system instruction when JIT is enabled 6ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should use getUserMemory for system instruction when JIT is disabled 6ms
 âœ“ src/tools/glob.test.ts > GlobTool > execute > should find files case-insensitively by default (pattern: *.TXT) 60ms
 âœ“ src/tools/glob.test.ts > GlobTool > execute > should find files case-insensitively when case_sensitive is false (pattern: *.TXT) 65ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > initialization > should initialize git ignore parser by default in a git repo 4ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > initialization > should not load git repo patterns when not in a git repo 6ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > initialization > should load .geminiignore patterns even when not in a git repo 2ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > filterFiles > should filter out git-ignored and gemini-ignored files by default 5ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > filterFiles > should not filter files when respectGitIgnore is false 2ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > filterFiles > should not filter files when respectCodeflyIgnore is false 4ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > filterFiles > should handle empty file list 5ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > filterFilesWithReport > should return filtered paths and correct ignored count 5ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > filterFilesWithReport > should handle no ignored files 4ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > shouldGitIgnoreFile & shouldGeminiIgnoreFile > should return true for git-ignored files 4ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > shouldGitIgnoreFile & shouldGeminiIgnoreFile > should return false for non-git-ignored files 2ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > shouldGitIgnoreFile & shouldGeminiIgnoreFile > should return true for gemini-ignored files 2ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > shouldGitIgnoreFile & shouldGeminiIgnoreFile > should return false for non-gemini-ignored files 2ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > edge cases > should handle relative project root paths 4ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > edge cases > should handle filterFiles with undefined options 3ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > precedence (.geminiignore over .gitignore) > should un-ignore a file in .geminiignore that is ignored in .gitignore 2ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > precedence (.geminiignore over .gitignore) > should un-ignore a directory in .geminiignore that is ignored in .gitignore 2ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > precedence (.geminiignore over .gitignore) > should extend ignore rules in .geminiignore 3ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > precedence (.geminiignore over .gitignore) > should use .gitignore rules if respectCodeflyIgnore is false 4ms
 âœ“ src/services/fileDiscoveryService.test.ts > FileDiscoveryService > precedence (.geminiignore over .gitignore) > should use .geminiignore rules if respectGitIgnore is false 6ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > constructor > should initialize lastPromptTokenCount based on history size 2ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > constructor > should initialize lastPromptTokenCount for empty history 0ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should succeed if a tool call is followed by an empty part 2ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordFlickerFrame > does not record metrics if not initialized 311ms
 âœ“ src/tools/grep.test.ts > GrepTool > validateToolParams > should return null for valid params (pattern only) 21ms
 âœ“ src/tools/grep.test.ts > GrepTool > validateToolParams > should return null for valid params (pattern and path) 3ms
 âœ“ src/tools/grep.test.ts > GrepTool > validateToolParams > should return null for valid params (pattern, path, and include) 4ms
 âœ“ src/tools/grep.test.ts > GrepTool > validateToolParams > should return error if pattern is missing 4ms
 âœ“ src/tools/grep.test.ts > GrepTool > validateToolParams > should return error for invalid regex pattern 3ms
 âœ“ src/tools/grep.test.ts > GrepTool > validateToolParams > should return error if path does not exist 3ms
 âœ“ src/tools/grep.test.ts > GrepTool > validateToolParams > should return error if path is a file, not a directory 7ms
 âœ“ src/tools/grep.test.ts > GrepTool > execute > should find matches for a simple pattern in all files 15ms
 âœ“ src/tools/grep.test.ts > GrepTool > execute > should find matches in a specific path 6ms
 âœ“ src/tools/grep.test.ts > GrepTool > execute > should find matches with an include glob 7ms
 âœ“ src/tools/grep.test.ts > GrepTool > execute > should find matches with an include glob and path 6ms
 âœ“ src/tools/grep.test.ts > GrepTool > execute > should return "No matches found" when pattern does not exist 7ms
 âœ“ src/tools/grep.test.ts > GrepTool > execute > should handle regex special characters correctly 5ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should recursively call sendMessageStream with "Please continue." when InvalidStream event is received 8ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should not recursively call sendMessageStream with "Please continue." when InvalidStream event is received and flag is false 7ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should stop recursing after one retry when InvalidStream events are repeatedly received 7ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > Editor context delta > 'sends delta when active file changes' 7ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > Editor context delta > 'sends delta when cursor line changes' 7ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > Editor context delta > 'sends delta when cursor character chaâ€¦' 8ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > Editor context delta > 'sends delta when selected text changes' 9ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > Editor context delta > 'sends delta when selected text is addâ€¦' 10ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > Editor context delta > 'sends delta when selected text is remâ€¦' 9ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > Editor context delta > 'does not send context when nothing châ€¦' 13ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > Editor context delta > sends full context when history is cleared, even if editor state is unchanged 7ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > Availability Service Integration > should select first available model, set active, and not consume sticky attempt (done lower in chain) 7ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > Availability Service Integration > should default to last resort model if selection returns null 6ms
 âœ“ src/tools/grep.test.ts > GrepTool > execute > should be case-insensitive by default (JS fallback) 11ms
 âœ“ src/tools/grep.test.ts > GrepTool > execute > should throw an error if params are invalid 3ms
 âœ“ src/tools/grep.test.ts > GrepTool > execute > should return a GREP_EXECUTION_ERROR on failure 5ms
 âœ“ src/tools/grep.test.ts > GrepTool > multi-directory workspace > should search across all workspace directories when no path is specified 9ms
 âœ“ src/tools/grep.test.ts > GrepTool > multi-directory workspace > should search only specified path within workspace directories 9ms
 âœ“ src/tools/grep.test.ts > GrepTool > getDescription > should generate correct description with pattern only 5ms
 âœ“ src/tools/grep.test.ts > GrepTool > getDescription > should generate correct description with pattern and include 5ms
 âœ“ src/tools/grep.test.ts > GrepTool > getDescription > should generate correct description with pattern and path 5ms
 âœ“ src/tools/grep.test.ts > GrepTool > getDescription > should indicate searching across all workspace directories when no path specified 4ms
 âœ“ src/tools/grep.test.ts > GrepTool > getDescription > should generate correct description with pattern, include, and path 4ms
 âœ“ src/tools/grep.test.ts > GrepTool > getDescription > should use ./ for root path in description 2ms
 âœ“ src/tools/glob.test.ts > GlobTool > execute > should find files using a pattern that includes a subdirectory 60ms
 âœ“ src/tools/glob.test.ts > GlobTool > execute > should find files in a specified relative path (relative to rootDir) 56ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > Availability Service Integration > should reset turn on new message stream 6ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > Availability Service Integration > should NOT reset turn on invalid stream retry 7ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > IDE context with pending tool calls > should NOT add IDE context when a tool call is pending 7ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > IDE context with pending tool calls > should add IDE context when no tool call is pending 9ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > IDE context with pending tool calls > should send the latest IDE context on the next message after a skipped context 7ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > IDE context with pending tool calls > should send a context DELTA on the next message after a skipped context 7ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should not call checkNextSpeaker when turn.run() yields an error 7ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should not call checkNextSpeaker when turn.run() yields a value then an error 8ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > sendMessageStream > should abort linked signal when loop is detected 8ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > generateContent > should call generateContent with the correct parameters 8ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > generateContent > should use current model from config for content generation 7ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > generateContent > Hook System > should fire BeforeAgent and AfterAgent exactly once for a simple turn 12ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordFlickerFrame > records a flicker frame event when initialized 131ms
 âœ“ src/tools/glob.test.ts > GlobTool > execute > should find files using a deep globstar pattern (e.g., **/*.log) 57ms
 âœ“ src/tools/glob.test.ts > GlobTool > execute > should return "No files found" message when pattern matches nothing 64ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > generateContent > Hook System > should fire BeforeAgent once and AfterAgent once even with recursion 12ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > generateContent > Hook System > should use original request in AfterAgent hook even when continuation happened 13ms
 âœ“ src/core/client.test.ts > Gemini Client (client.ts) > generateContent > Hook System > should cleanup state when prompt_id changes 14ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler > should cancel a tool call if the signal is aborted before confirmation 2ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler > should cancel all tools when cancelAll is called 13ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler > should cancel all tools in a batch when one is cancelled via confirmation 12ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler > should mark tool call as cancelled when abort happens during confirmation error 11ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler > should error when tool requires confirmation in non-interactive mode 0ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler with payload > should update args and diff and execute tool when payload is provided 3ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler edit cancellation > should preserve diff when an edit is cancelled 1ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler YOLO mode > should execute tool requiring confirmation directly without waiting 1ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler request queueing > should queue a request if another is running 11ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler request queueing > should auto-approve a tool call if it is on the allowedTools list 1ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler request queueing > should require approval for a chained shell command even when prefix is allowlisted 1ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler request queueing > should handle two synchronous calls to schedule 0ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > build > should return an invocation for valid params (absolute path within root) 14ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > build > should return an invocation for valid params (relative path within root) 1ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > build > should throw error if path is outside root 1ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > build > should allow access to files in project temp directory 2ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > build > should show temp directory in error message when path is outside workspace and temp dir 1ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > build > should throw error if path is empty 1ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > build > should throw error if offset is negative 1ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > build > should throw error if limit is zero or negative 1ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > getDescription > should return relative path without limit/offset 2ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > getDescription > should return shortened path when file path is deep 2ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > getDescription > should handle non-normalized file paths correctly 1ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > getDescription > should return . if path is the root directory 1ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > should successfully read a file with a relative path 10ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > should return error if file does not exist 2ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > should return success result for a text file 5ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > should return error if path is a directory 2ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > should return error for a file that is too large 21ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > should handle text file with lines exceeding maximum length 2ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > should handle image file and return appropriate content 2ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > should handle PDF file and return appropriate content 2ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > should handle binary file and skip content 2ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > should handle SVG file as text 2ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > should handle large SVG file 3ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > should handle empty file 6ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > should support offset and limit for text files 3ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > should successfully read files from project temp directory 3ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > with .geminiignore > should throw error if path is ignored by a .geminiignore pattern 2ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > with .geminiignore > should throw error if file is in an ignored directory 2ms
 âœ“ src/core/logger.test.ts > Logger > initialize > should create .gemini directory and an empty log file if none exist 6ms
 âœ“ src/core/logger.test.ts > Logger > initialize > should load existing logs and set correct messageId for the current session 2ms
 âœ“ src/core/logger.test.ts > Logger > initialize > should set messageId to 0 for a new session if log file exists but has no logs for current session 1ms
 âœ“ src/core/logger.test.ts > Logger > initialize > should be idempotent 2ms
 âœ“ src/core/logger.test.ts > Logger > initialize > should handle invalid JSON in log file by backing it up and starting fresh 5ms
 âœ“ src/core/logger.test.ts > Logger > initialize > should handle non-array JSON in log file by backing it up and starting fresh 3ms
 âœ“ src/core/logger.test.ts > Logger > logMessage > should append a message to the log file and update in-memory logs 4ms
 âœ“ src/core/logger.test.ts > Logger > logMessage > should correctly increment messageId for subsequent messages in the same session 10ms
 âœ“ src/core/logger.test.ts > Logger > logMessage > should handle logger not initialized 6ms
 âœ“ src/core/logger.test.ts > Logger > logMessage > should simulate concurrent writes from different logger instances to the same file 4ms
 âœ“ src/core/logger.test.ts > Logger > logMessage > should not throw, not increment messageId, and log error if writing to file fails 2ms
 âœ“ src/core/logger.test.ts > Logger > getPreviousUserMessages > should retrieve all user messages from logs, sorted newest first 4ms
 âœ“ src/core/logger.test.ts > Logger > getPreviousUserMessages > should return empty array if no user messages exist 1ms
 âœ“ src/core/logger.test.ts > Logger > getPreviousUserMessages > should return empty array if logger not initialized 6ms
 âœ“ src/core/logger.test.ts > Logger > saveCheckpoint > should save a checkpoint 2ms
 âœ“ src/core/logger.test.ts > Logger > saveCheckpoint > should save a checkpoint 2ms
 âœ“ src/core/logger.test.ts > Logger > saveCheckpoint > should save a checkpoint 3ms
 âœ“ src/core/logger.test.ts > Logger > saveCheckpoint > should save a checkpoint 2ms
 âœ“ src/core/logger.test.ts > Logger > saveCheckpoint > should not throw if logger is not initialized 2ms
 âœ“ src/core/logger.test.ts > Logger > loadCheckpoint > should load from a checkpoint 2ms
 âœ“ src/core/logger.test.ts > Logger > loadCheckpoint > should load from a checkpoint 3ms
 âœ“ src/core/logger.test.ts > Logger > loadCheckpoint > should load from a checkpoint 3ms
 âœ“ src/core/logger.test.ts > Logger > loadCheckpoint > should load from a checkpoint 3ms
 âœ“ src/core/logger.test.ts > Logger > loadCheckpoint > should load a legacy checkpoint without authType 5ms
 âœ“ src/core/logger.test.ts > Logger > loadCheckpoint > should return an empty history if a tagged checkpoint file does not exist 2ms
 âœ“ src/core/logger.test.ts > Logger > loadCheckpoint > should return an empty history if the checkpoint file does not exist 3ms
 âœ“ src/core/logger.test.ts > Logger > loadCheckpoint > should return an empty history if the file contains invalid JSON 1ms
 âœ“ src/core/logger.test.ts > Logger > loadCheckpoint > should return an empty history if logger is not initialized 1ms
 âœ“ src/core/logger.test.ts > Logger > deleteCheckpoint > should delete the specified checkpoint file and return true 1ms
 âœ“ src/core/logger.test.ts > Logger > deleteCheckpoint > should delete both new and old checkpoint files if they exist 1ms
 âœ“ src/core/logger.test.ts > Logger > deleteCheckpoint > should return false if the checkpoint file does not exist 1ms
 âœ“ src/core/logger.test.ts > Logger > deleteCheckpoint > should re-throw an error if file deletion fails for reasons other than not existing 3ms
 âœ“ src/core/logger.test.ts > Logger > deleteCheckpoint > should return false if logger is not initialized 2ms
 âœ“ src/core/logger.test.ts > Logger > checkpointExists > should return true if the checkpoint file exists 1ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordExitFail > does not record metrics if not initialized 131ms
 âœ“ src/tools/read-file.test.ts > ReadFileTool > execute > with .geminiignore > should allow reading non-ignored files 2ms
 âœ“ src/core/logger.test.ts > Logger > checkpointExists > should return false if the checkpoint file does not exist 1ms
 âœ“ src/core/logger.test.ts > Logger > checkpointExists > should throw an error if logger is not initialized 1ms
 âœ“ src/core/logger.test.ts > Logger > checkpointExists > should re-throw an error if fs.access fails for reasons other than not existing 1ms
 âœ“ src/core/logger.test.ts > Logger > Backward compatibility > should load from a checkpoint with a raw special character tag 2ms
 âœ“ src/core/logger.test.ts > Logger > close > should reset logger state 1ms
 âœ“ src/tools/glob.test.ts > GlobTool > execute > should find files with special characters in the name 62ms
 âœ“ src/tools/glob.test.ts > GlobTool > execute > should find files with special characters like [] and () in the path 59ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler request queueing > should auto-approve remaining tool calls when first tool call is approved with ProceedAlways 52ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler Sequential Execution > should execute tool calls in a batch sequentially 52ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordExitFail > records a exit fail event when initialized 134ms
 âœ“ src/tools/glob.test.ts > GlobTool > execute > should correctly sort files by modification time (newest first) 55ms
 âœ“ src/tools/glob.test.ts > GlobTool > execute > should return a PATH_NOT_IN_WORKSPACE error if path is outside workspace 57ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler Sequential Execution > should cancel subsequent tools when the signal is aborted. 102ms
 âœ“ src/core/coreToolScheduler.test.ts > CoreToolScheduler Sequential Execution > should pass confirmation diff data into modifyWithEditor overrides 1ms
 âœ“ src/core/geminiChat_network_retry.test.ts > CodeflyChat Network Retries > should retry when a 503 ApiError occurs during stream iteration 506ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should fail if the stream ends with an empty part and has no finishReason 502ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should succeed if the stream ends with an invalid part but has a finishReason and contained a valid part 1ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should consolidate subsequent text chunks after receiving an empty text chunk 1ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should consolidate adjacent text parts that arrive in separate stream chunks 1ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should preserve text parts that stream in the same chunk as a thought 1ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordSlowRender > does not record metrics if not initialized 107ms
 âœ“ src/tools/glob.test.ts > GlobTool > execute > should return a GLOB_EXECUTION_ERROR on glob failure 61ms
 âœ“ src/tools/glob.test.ts > GlobTool > validateToolParams > 'should return null for valid parameteâ€¦' 58ms
 âœ“ src/tools/ls.test.ts > LSTool > parameter validation > should accept valid absolute paths within workspace 18ms
 âœ“ src/tools/ls.test.ts > LSTool > parameter validation > should accept relative paths 3ms
 âœ“ src/tools/ls.test.ts > LSTool > parameter validation > should reject paths outside workspace with clear error message 4ms
 âœ“ src/tools/ls.test.ts > LSTool > parameter validation > should accept paths in secondary workspace directory 2ms
 âœ“ src/tools/ls.test.ts > LSTool > execute > should list files in a directory 9ms
 âœ“ src/tools/ls.test.ts > LSTool > execute > should list files from secondary workspace directory 5ms
 âœ“ src/tools/ls.test.ts > LSTool > execute > should handle empty directories 4ms
 âœ“ src/tools/ls.test.ts > LSTool > execute > should respect ignore patterns 4ms
 âœ“ src/tools/ls.test.ts > LSTool > execute > should respect gitignore patterns 11ms
 âœ“ src/tools/ls.test.ts > LSTool > execute > should respect geminiignore patterns 4ms
 âœ“ src/tools/ls.test.ts > LSTool > execute > should handle non-directory paths 4ms
 âœ“ src/tools/ls.test.ts > LSTool > execute > should handle non-existent paths 2ms
 âœ“ src/tools/ls.test.ts > LSTool > execute > should sort directories first, then files alphabetically 3ms
 âœ“ src/tools/ls.test.ts > LSTool > execute > should handle permission errors gracefully 3ms
 âœ“ src/tools/ls.test.ts > LSTool > execute > should handle errors accessing individual files during listing 4ms
 âœ“ src/tools/ls.test.ts > LSTool > getDescription > should return shortened relative path 3ms
 âœ“ src/tools/ls.test.ts > LSTool > getDescription > should handle paths in secondary workspace 3ms
 âœ“ src/tools/ls.test.ts > LSTool > workspace boundary validation > should accept paths in primary workspace directory 3ms
 âœ“ src/tools/ls.test.ts > LSTool > workspace boundary validation > should accept paths in secondary workspace directory 5ms
 âœ“ src/tools/ls.test.ts > LSTool > workspace boundary validation > should reject paths outside all workspace directories 2ms
 âœ“ src/tools/ls.test.ts > LSTool > workspace boundary validation > should list files from secondary workspace directory 4ms
 âœ“ src/tools/mcp-client.test.ts > connectToMcpServer with OAuth > should discover oauth config if not in www-authenticate header 876ms
 âœ“ src/tools/mcp-client.test.ts > connectToMcpServer - HTTPâ†’SSE fallback > should NOT trigger fallback when type="http" is explicit 1ms
 âœ“ src/tools/mcp-client.test.ts > connectToMcpServer - HTTPâ†’SSE fallback > should NOT trigger fallback when type="sse" is explicit 1ms
 âœ“ src/tools/mcp-client.test.ts > connectToMcpServer - HTTPâ†’SSE fallback > should trigger fallback when url provided without type and HTTP fails 1ms
 âœ“ src/tools/mcp-client.test.ts > connectToMcpServer - HTTPâ†’SSE fallback > should throw original HTTP error when both HTTP and SSE fail (non-401) 1ms
 âœ“ src/tools/mcp-client.test.ts > connectToMcpServer - HTTPâ†’SSE fallback > should handle HTTP 404 followed by SSE success 1ms
 âœ“ src/tools/mcp-client.test.ts > connectToMcpServer - OAuth with transport fallback > should handle HTTP 404 â†’ SSE 401 â†’ OAuth â†’ SSE+OAuth succeeds 7ms
(node:9838) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGTERM listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
(node:9838) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 SIGINT listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > when untrusted > does not load context files from untrusted workspaces 6ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > when untrusted > loads context from outside the untrusted workspace 11ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > should return empty memory and count if no context files are found 6ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > should load only the global context file if present and others are not (default filename) 11ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > should load only the global custom context file if present and filename is changed 15ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > should load context files by upward traversal with custom filename 7ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > should load context files by downward traversal with custom filename 4ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > should load ORIGINAL_GEMINI_MD_FILENAME files by upward traversal from CWD to project root 6ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > should load ORIGINAL_GEMINI_MD_FILENAME files by downward traversal from CWD 7ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > should load and correctly order global, upward, and downward ORIGINAL_GEMINI_MD_FILENAME files 4ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > should ignore specified directories during downward scan 10ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > should respect the maxDirs parameter during downward scan 9ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > readWasmBinaryFromDisk > loads a WASM binary from disk as a Uint8Array 3ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isWithinRoot > should return true for 'a path directly within the root' 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isWithinRoot > should return true for 'a path in a subdirectory within the râ€¦' 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isWithinRoot > should return true for 'the root path itself' 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isWithinRoot > should return true for 'a path with a trailing slash' 0ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isWithinRoot > should return true for 'the root path with a trailing slash' 0ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isWithinRoot > should return true for 'a sub-path of the path to check' 0ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isWithinRoot > should return false for 'a path outside the root' 0ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isWithinRoot > should return false for 'an unrelated path' 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isWithinRoot > should return false for 'a path that only partially matches thâ€¦' 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isWithinRoot > should return false for 'a root path that is a sub-path of theâ€¦' 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isWithinRoot > should return true for 'a POSIX path inside' 0ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isWithinRoot > should return false for 'a POSIX path outside' 0ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > fileExists > should return true if the file exists 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > fileExists > should return false if the file does not exist 0ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > fileExists > should return true for a directory that exists 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isBinaryFile > should return false for an empty file 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isBinaryFile > should return false for a typical text file 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isBinaryFile > should return true for a file with many null bytes 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isBinaryFile > should return true for a file with high percentage of non-printable ASCII 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > isBinaryFile > should return false if file access fails (e.g., ENOENT) 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > detectBOM > should detect UTF-8 BOM 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > detectBOM > should detect UTF-16 LE BOM 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > detectBOM > should detect UTF-16 BE BOM 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > detectBOM > should detect UTF-32 LE BOM 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > detectBOM > should detect UTF-32 BE BOM 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > detectBOM > should return null for no BOM 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > detectBOM > should return null for empty buffer 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > detectBOM > should return null for partial BOM 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > readFileWithEncoding > should read UTF-8 BOM file correctly 8ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > readFileWithEncoding > should read UTF-16 LE BOM file correctly 5ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > readFileWithEncoding > should read UTF-16 BE BOM file correctly 3ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > readFileWithEncoding > should read UTF-32 LE BOM file correctly 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > readFileWithEncoding > should read UTF-32 BE BOM file correctly 4ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > readFileWithEncoding > should read file without BOM as UTF-8 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > readFileWithEncoding > should handle empty file 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > isBinaryFile with BOM awareness > should not treat UTF-8 BOM file as binary 4ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > isBinaryFile with BOM awareness > should not treat UTF-16 LE BOM file as binary 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > isBinaryFile with BOM awareness > should not treat UTF-16 BE BOM file as binary 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > isBinaryFile with BOM awareness > should not treat UTF-32 LE BOM file as binary 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > isBinaryFile with BOM awareness > should not treat UTF-32 BE BOM file as binary 3ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > isBinaryFile with BOM awareness > should still treat actual binary file as binary 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > BOM detection and encoding > isBinaryFile with BOM awareness > should treat file with null bytes (no BOM) as binary 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > detectFileType > should detect typescript type by extension (ts, mts, cts, tsx) 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > detectFileType > should detect 'image' type for 'file.png' by extension 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > detectFileType > should detect 'image' type for 'file.jpg' by extension 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > detectFileType > should detect 'pdf' type for 'file.pdf' by extension 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > detectFileType > should detect 'audio' type for 'song.mp3' by extension 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > detectFileType > should detect 'video' type for 'movie.mp4' by extension 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > detectFileType > should detect 'binary' type for 'archive.zip' by extension 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > detectFileType > should detect 'binary' type for 'app.exe' by extension 0ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > detectFileType > should detect svg type by extension 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > detectFileType > should use isBinaryFile for unknown extensions and detect as binary 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > detectFileType > should default to text if mime type is unknown and content is not binary 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should read a text file successfully 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should handle file not found 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should handle read errors for text files 3ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should handle read errors for image/pdf files 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should process an image file 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should process a PDF file 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should process an audio file 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should read an SVG file as text when under 1MB 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should skip binary files 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should handle path being a directory 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should paginate text files correctly (offset and limit) 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should identify truncation when reading the end of a file 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should handle limit exceeding file length 2ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordSlowRender > records a slow render event when initialized 141ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > build > should return an invocation for valid relative paths within root 15ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > build > should return an invocation for valid glob patterns within root 2ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > build > should return an invocation for paths trying to escape the root (e.g., ../) as execute handles this 1ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > build > should return an invocation for absolute paths as execute handles this 1ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > build > should throw error if paths array is empty 2ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > build > should return an invocation for valid exclude and include patterns 3ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > build > should throw error if paths array contains an empty string 3ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > build > should throw error if include array contains non-string elements 2ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > build > should throw error if exclude array contains non-string elements 2ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should read a single specified file 15ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should read multiple specified files 6ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should handle glob patterns 5ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should respect exclude patterns 5ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should handle nonexistent specific files gracefully 3ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should use default excludes 6ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should NOT use default excludes if useDefaultExcludes is false 6ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should include images as inlineData parts if explicitly requested by extension 4ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should include images as inlineData parts if explicitly requested by name 4ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should skip PDF files if not explicitly requested by extension or name 6ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should include PDF files as inlineData parts if explicitly requested by extension 4ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should truncate long lines in text files 5ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should truncate when line count exceeds the limit 3ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should truncate when a line length exceeds the character limit 3ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should truncate both line count and line length when both exceed limits 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > processSingleFileContent > should return an error if the file size exceeds 20MB 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > saveTruncatedContent > should return content unchanged if below threshold 1ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > saveTruncatedContent > should truncate content by lines when content has many lines 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > saveTruncatedContent > should wrap and truncate content when content has few but long lines 3ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > saveTruncatedContent > should save to correct file path with call ID 2ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > saveTruncatedContent > should include helpful instructions in truncated message 3ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > saveTruncatedContent > should sanitize callId to prevent path traversal 5ms
 âœ“ src/utils/fileUtils.test.ts > fileUtils > saveTruncatedContent > should handle file write errors gracefully 1ms
 âœ“ src/tools/glob.test.ts > GlobTool > validateToolParams > 'should return null for valid parameteâ€¦' 61ms
 âœ“ src/tools/glob.test.ts > GlobTool > validateToolParams > 'should return null for valid parameteâ€¦' 58ms
 Ã— src/telemetry/sdk.test.ts > Telemetry SDK > should initialize with GCP exporters when credentials are provided via post_auth 1007ms
   â†’ expected "spy" to be called with arguments: [ Array(1) ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[32m-   "Telemetry reinit with credentials.",[90m
[31m+   "CLI auth is requested but no credentials, deferring telemetry initialization.",[90m
[2m  ][22m
[39m[90m

Number of calls: [1m1[22m
[39m
 âœ“ src/telemetry/sdk.test.ts > Telemetry SDK > bufferTelemetryEvent > should execute immediately if SDK is initialized 1ms
 âœ“ src/telemetry/sdk.test.ts > Telemetry SDK > bufferTelemetryEvent > should buffer if SDK is not initialized, and flush on initialization 1ms
 âœ“ src/telemetry/sdk.test.ts > Telemetry SDK > should disable telemetry and log error if useCollector and useCliAuth are both true 0ms
 âœ“ src/telemetry/sdk.test.ts > Telemetry SDK > should log error when re-initializing with different credentials 0ms
 âœ“ src/telemetry/sdk.test.ts > Telemetry SDK > should NOT log error when re-initializing with SAME credentials 1ms
 âœ“ src/tools/confirmation-policy.test.ts > Tool Confirmation Policy Updates > 'EditTool' policy updates > should handle 'proceed_always' correctly 72ms
 âœ“ src/tools/confirmation-policy.test.ts > Tool Confirmation Policy Updates > 'EditTool' policy updates > should handle 'proceed_always_and_save' correctly 3ms
 âœ“ src/tools/confirmation-policy.test.ts > Tool Confirmation Policy Updates > 'SmartEditTool' policy updates > should handle 'proceed_always' correctly 3ms
 âœ“ src/tools/confirmation-policy.test.ts > Tool Confirmation Policy Updates > 'SmartEditTool' policy updates > should handle 'proceed_always_and_save' correctly 2ms
 âœ“ src/tools/confirmation-policy.test.ts > Tool Confirmation Policy Updates > 'WriteFileTool' policy updates > should handle 'proceed_always' correctly 2ms
 âœ“ src/tools/confirmation-policy.test.ts > Tool Confirmation Policy Updates > 'WriteFileTool' policy updates > should handle 'proceed_always_and_save' correctly 1ms
 âœ“ src/tools/confirmation-policy.test.ts > Tool Confirmation Policy Updates > 'WebFetchTool' policy updates > should handle 'proceed_always' correctly 1ms
 âœ“ src/tools/confirmation-policy.test.ts > Tool Confirmation Policy Updates > 'WebFetchTool' policy updates > should handle 'proceed_always_and_save' correctly 1ms
 âœ“ src/utils/getFolderStructure.test.ts > getFolderStructure > should return basic folder structure 12ms
 âœ“ src/utils/getFolderStructure.test.ts > getFolderStructure > should handle an empty folder 1ms
 âœ“ src/utils/getFolderStructure.test.ts > getFolderStructure > should ignore folders specified in ignoredFolders (default) 8ms
 âœ“ src/utils/getFolderStructure.test.ts > getFolderStructure > should ignore folders specified in custom ignoredFolders 7ms
 âœ“ src/utils/getFolderStructure.test.ts > getFolderStructure > should filter files by fileIncludePattern 3ms
 âœ“ src/utils/getFolderStructure.test.ts > getFolderStructure > should handle maxItems truncation for files within a folder 4ms
 âœ“ src/utils/getFolderStructure.test.ts > getFolderStructure > should handle maxItems truncation for subfolders 8ms
 âœ“ src/utils/getFolderStructure.test.ts > getFolderStructure > should handle maxItems that only allows the root folder itself 3ms
 âœ“ src/utils/getFolderStructure.test.ts > getFolderStructure > should handle non-existent directory 2ms
 âœ“ src/utils/getFolderStructure.test.ts > getFolderStructure > should handle deep folder structure within limits 7ms
 âœ“ src/utils/getFolderStructure.test.ts > getFolderStructure > should truncate deep folder structure if maxItems is small 3ms
 âœ“ src/utils/getFolderStructure.test.ts > getFolderStructure > with gitignore > should ignore files and folders specified in .gitignore 11ms
 âœ“ src/utils/getFolderStructure.test.ts > getFolderStructure > with gitignore > should not ignore files if respectGitIgnore is false 4ms
 âœ“ src/utils/getFolderStructure.test.ts > getFolderStructure > with geminiignore > should ignore geminiignore files by default 5ms
 âœ“ src/utils/getFolderStructure.test.ts > getFolderStructure > with geminiignore > should not ignore files if respectCodeflyIgnore is false 4ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should include PDF files as inlineData parts if explicitly requested by name 5ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should return error if path is ignored by a .geminiignore pattern 5ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should read files from multiple workspace directories 6ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should add a warning for truncated files 8ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should read files with special characters like [] and () in the path 5ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > execute > should read files with special characters in the name 4ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > Error handling > should return an INVALID_TOOL_PARAMS error if no paths are provided 2ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > Error handling > should return a READ_MANY_FILES_SEARCH_ERROR on glob failure 2ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > Batch Processing > should process files in parallel 18ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > Batch Processing > should handle batch processing errors gracefully 4ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > should load extension context file paths 9ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > should load memory from included directories 9ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > should handle multiple directories and files in parallel correctly 11ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > should preserve order and prevent duplicates when processing multiple directories 10ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > loadGlobalMemory > should load global memory file if it exists 8ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > loadGlobalMemory > should return empty content if global memory file does not exist 3ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > loadEnvironmentMemory > should load extension memory 3ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > loadEnvironmentMemory > should NOT traverse upward beyond trusted root (even with .git) 8ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > loadEnvironmentMemory > should NOT traverse upward beyond trusted root (no .git) 6ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > loadEnvironmentMemory > should deduplicate paths when same root is trusted multiple times 4ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > loadEnvironmentMemory > should keep multiple memory files from the same directory adjacent and in order 4ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > loadJitSubdirectoryMemory > should load JIT memory when target is inside a trusted root 3ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > loadJitSubdirectoryMemory > should skip JIT memory when target is outside trusted roots 1ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > loadJitSubdirectoryMemory > should skip already loaded paths 2ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > loadJitSubdirectoryMemory > should use the deepest trusted root when multiple nested roots exist 5ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > refreshServerHierarchicalMemory should refresh memory and update config 9ms
 âœ“ src/utils/memoryDiscovery.test.ts > memoryDiscovery > should include MCP instructions in user memory 2ms
 âœ“ src/tools/glob.test.ts > GlobTool > validateToolParams > 'should return error if pattern is misâ€¦' 61ms
 âœ“ src/tools/glob.test.ts > GlobTool > validateToolParams > 'should return error if pattern is an â€¦' 59ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > initializeMetrics > should apply common attributes including email 171ms
 âœ“ src/tools/read-many-files.test.ts > ReadManyFilesTool > Batch Processing > should execute file operations concurrently 58ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > loadPoliciesFromToml > should load and parse a simple policy file 7ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > loadPoliciesFromToml > should expand commandPrefix array to multiple rules 2ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > loadPoliciesFromToml > should transform commandRegex to argsPattern 3ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > loadPoliciesFromToml > should expand toolName array 4ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > loadPoliciesFromToml > should transform mcpName to composite toolName 5ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > loadPoliciesFromToml > should NOT filter rules by mode at load time but preserve modes property 5ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > loadPoliciesFromToml > should return error if modes property is used for Tier 2 and Tier 3 policies 3ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > loadPoliciesFromToml > should handle TOML parse errors 2ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > loadPoliciesFromToml > should handle schema validation errors 6ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > loadPoliciesFromToml > should reject commandPrefix without run_shell_command 5ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > loadPoliciesFromToml > should reject commandPrefix + argsPattern combination 2ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > loadPoliciesFromToml > should handle invalid regex patterns 7ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > loadPoliciesFromToml > should escape regex special characters in commandPrefix 3ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > loadPoliciesFromToml > should handle a mix of valid and invalid policy files 2ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > Negative Tests > should return a schema_validation error if priority is missing 1ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > Negative Tests > should return a schema_validation error if priority is a float 1ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > Negative Tests > should return a schema_validation error if priority is negative 1ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > Negative Tests > should return a schema_validation error if priority is much lower than 0 2ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > Negative Tests > should return a schema_validation error if priority is >= 1000 5ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > Negative Tests > should return a schema_validation error if priority is much higher than 1000 1ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > Negative Tests > should return a schema_validation error if decision is invalid 1ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > Negative Tests > should return a schema_validation error if toolName is not a string or array 1ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > Negative Tests > should return a rule_validation error if commandRegex is used with wrong toolName 1ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > Negative Tests > should return a rule_validation error if commandPrefix and commandRegex are combined 1ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > Negative Tests > should return a regex_compilation error for invalid argsPattern 5ms
 âœ“ src/policy/toml-loader.test.ts > policy-toml-loader > Negative Tests > should return a file_read error if readdir fails 10ms
 âœ“ src/tools/glob.test.ts > GlobTool > validateToolParams > 'should return error if pattern is onlâ€¦' 66ms
 âœ“ src/tools/glob.test.ts > GlobTool > validateToolParams > 'should return error if dir_path is noâ€¦' 57ms
 âœ“ src/core/geminiChat_network_retry.test.ts > CodeflyChat Network Retries > should retry on generic network error if retryFetchErrors is true 501ms
 âœ“ src/core/geminiChat_network_retry.test.ts > CodeflyChat Network Retries > should NOT retry on 400 ApiError 1ms
 âœ“ src/tools/edit.test.ts > EditTool > applyReplacement > should return newString if isNewFile is true 2ms
 âœ“ src/tools/edit.test.ts > EditTool > applyReplacement > should return newString if currentContent is null and oldString is empty (defensive) 1ms
 âœ“ src/tools/edit.test.ts > EditTool > applyReplacement > should return empty string if currentContent is null and oldString is not empty (defensive) 0ms
 âœ“ src/tools/edit.test.ts > EditTool > applyReplacement > should replace oldString with newString in currentContent 0ms
 âœ“ src/tools/edit.test.ts > EditTool > applyReplacement > should return currentContent if oldString is empty and not a new file 0ms
 âœ“ src/tools/edit.test.ts > EditTool > applyReplacement > should handle '$ literal' 0ms
 âœ“ src/tools/edit.test.ts > EditTool > applyReplacement > should handle '$\' literal' 0ms
 âœ“ src/tools/edit.test.ts > EditTool > applyReplacement > should handle '$& literal' 0ms
 âœ“ src/tools/edit.test.ts > EditTool > applyReplacement > should handle '$` literal' 1ms
 âœ“ src/tools/edit.test.ts > EditTool > applyReplacement > should handle '$1, $2 capture groups literal' 1ms
 âœ“ src/tools/edit.test.ts > EditTool > applyReplacement > should handle 'normal strings without problematic $' 1ms
 âœ“ src/tools/edit.test.ts > EditTool > applyReplacement > should handle 'multiple occurrences with $ sequences' 2ms
 âœ“ src/tools/edit.test.ts > EditTool > applyReplacement > should handle 'complex regex patterns with $ at end' 1ms
 âœ“ src/tools/edit.test.ts > EditTool > applyReplacement > should handle 'empty replacement with problematic $' 1ms
 âœ“ src/tools/edit.test.ts > EditTool > applyReplacement > should handle '$$ (escaped dollar)' 0ms
 âœ“ src/tools/edit.test.ts > EditTool > validateToolParams > should return null for valid params 13ms
 âœ“ src/tools/edit.test.ts > EditTool > validateToolParams > should return error for path outside root 2ms
 âœ“ src/tools/edit.test.ts > EditTool > shouldConfirmExecute > should resolve relative path and request confirmation 4ms
 âœ“ src/tools/edit.test.ts > EditTool > shouldConfirmExecute > should request confirmation for valid edit 4ms
 âœ“ src/tools/edit.test.ts > EditTool > shouldConfirmExecute > should return false if old_string is not found (ensureCorrectEdit returns 0) 3ms
 âœ“ src/tools/edit.test.ts > EditTool > shouldConfirmExecute > should return false if multiple occurrences of old_string are found (ensureCorrectEdit returns > 1) 2ms
 âœ“ src/tools/edit.test.ts > EditTool > shouldConfirmExecute > should request confirmation for creating a new file (empty old_string) 2ms
 âœ“ src/tools/edit.test.ts > EditTool > shouldConfirmExecute > should use corrected params from ensureCorrectEdit for diff generation 2ms
 âœ“ src/tools/edit.test.ts > EditTool > shouldConfirmExecute > should rethrow calculateEdit errors when the abort signal is triggered 2ms
 âœ“ src/tools/edit.test.ts > EditTool > execute > should resolve relative path and execute successfully 3ms
 âœ“ src/tools/edit.test.ts > EditTool > execute > should throw error if file path is empty 2ms
 âœ“ src/tools/edit.test.ts > EditTool > execute > should reject when calculateEdit fails after an abort signal 1ms
 âœ“ src/tools/edit.test.ts > EditTool > execute > should edit an existing file and return diff with fileName 4ms
 âœ“ src/tools/edit.test.ts > EditTool > execute > should create a new file if old_string is empty and file does not exist, and return created message 5ms
 âœ“ src/tools/edit.test.ts > EditTool > execute > should return error if old_string is not found in file 7ms
 âœ“ src/tools/edit.test.ts > EditTool > execute > should return error if multiple occurrences of old_string are found 5ms
 âœ“ src/tools/edit.test.ts > EditTool > execute > should successfully replace multiple occurrences when expected_replacements specified 12ms
 âœ“ src/tools/edit.test.ts > EditTool > execute > should return error if expected_replacements does not match actual occurrences 4ms
 âœ“ src/tools/edit.test.ts > EditTool > execute > should return error if trying to create a file that already exists (empty old_string) 8ms
 âœ“ src/tools/edit.test.ts > EditTool > execute > should include modification message when proposed content is modified 4ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearch > should find a file in the root directory 10ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearch > should find a file in a nested directory 3ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearch > should find multiple files with the same name 2ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearch > should return an empty array if no file is found 1ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearch > should ignore directories specified in ignoreDirs 1ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearch > should respect the maxDirs limit and not find the file 4ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearch > should respect the maxDirs limit and find the file 6ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearch > with FileDiscoveryService > should ignore gitignored files 10ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearch > with FileDiscoveryService > should ignore geminiignored files 8ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearch > with FileDiscoveryService > should not ignore files if respect flags are false 11ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > checkKeychainAvailability > should return true if keytar is available and functional 4ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > checkKeychainAvailability > should return false if keytar fails to set password 2ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > checkKeychainAvailability > should return false if retrieved password does not match 2ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > checkKeychainAvailability > should cache the availability result 1ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain unavailable > getCredentials should throw 3ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain unavailable > setCredentials should throw 1ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain unavailable > deleteCredentials should throw 1ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain unavailable > listServers should throw 1ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain unavailable > getAllCredentials should throw 2ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > getCredentials > should return null if no credentials are found 1ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > getCredentials > should return credentials if found and not expired 2ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > getCredentials > should return null if credentials have expired 4ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > getCredentials > should throw if stored data is corrupted JSON 3ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > setCredentials > should save credentials to keychain 3ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > setCredentials > should throw if saving to keychain fails 4ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > deleteCredentials > should delete credentials from keychain 1ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > deleteCredentials > should throw if no credentials were found to delete 3ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > deleteCredentials > should throw if deleting from keychain fails 4ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > listServers > should return a list of server names 2ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > listServers > should not include internal test keys in the server list 3ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > listServers > should return an empty array on error 2ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > getAllCredentials > should return a map of all valid credentials and emit feedback for invalid ones 3ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > getAllCredentials > should emit feedback and return empty map if findCredentials fails 2ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > clearAll > should delete all credentials for the service 3ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > clearAll > should throw an aggregated error if deletions fail 7ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > Secrets > should set and get a secret 2ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > Secrets > should delete a secret 2ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > Secrets > should list secrets 8ms
 âœ“ src/mcp/token-storage/keychain-token-storage.test.ts > KeychainTokenStorage > with keychain available > Secrets > should not list secrets in listServers 2ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearch > should find all files in a complex directory structure 45ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearchSync > should find a file in the root directory synchronously 5ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearchSync > should find a file in a nested directory synchronously 3ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearchSync > should respect the maxDirs limit and not find the file synchronously 7ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearchSync > should ignore directories synchronously 5ms
 âœ“ src/utils/bfsFileSearch.test.ts > bfsFileSearchSync > should work with FileDiscoveryService synchronously 5ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHook > security checks > should block project hooks in untrusted folders 2ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHook > security checks > should allow project hooks in trusted folders 12ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHook > security checks > should allow non-project hooks even in untrusted folders 11ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHook > command hooks > should execute command hook successfully 1ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHook > command hooks > should handle command hook failure 1ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHook > command hooks > should use hook name in error messages if available 1ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHook > command hooks > should handle command hook timeout 51ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHook > command hooks > should expand environment variables in commands 2ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHook > command hooks > should not allow command injection via GEMINI_PROJECT_DIR 1ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHooksParallel > should execute multiple hooks in parallel 2ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHooksParallel > should handle mixed success and failure 1ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHooksSequential > should execute multiple hooks in sequence 1ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHooksSequential > should continue execution even if a hook fails 1ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHooksSequential > should pass modified input from one hook to the next for BeforeAgent 1ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHooksSequential > should pass modified LLM request from one hook to the next for BeforeModel 2ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > executeHooksSequential > should not modify input if hook fails 1ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > invalid JSON handling > should handle invalid JSON output gracefully 1ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > invalid JSON handling > should handle malformed JSON with exit code 0 1ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > invalid JSON handling > should handle invalid JSON with exit code 1 (non-blocking error) 1ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > invalid JSON handling > should handle invalid JSON with exit code 2 (blocking error) 1ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > invalid JSON handling > should handle empty JSON output 1ms
 âœ“ src/hooks/hookRunner.test.ts > HookRunner > invalid JSON handling > should handle double-encoded JSON string 1ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > Basic ignore behaviors > should not ignore files when no .gitignore exists 4ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > Basic ignore behaviors > should ignore files based on a root .gitignore 5ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > Basic ignore behaviors > should handle git exclude file 6ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > isIgnored path handling > should always ignore .git directory 4ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > isIgnored path handling > should ignore files matching patterns 8ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > isIgnored path handling > should ignore files with path-specific patterns 11ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > isIgnored path handling > should handle negation patterns 12ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > isIgnored path handling > should not ignore files that do not match patterns 7ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > isIgnored path handling > should handle absolute paths correctly 5ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > isIgnored path handling > should handle paths outside project root by not ignoring them 7ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > isIgnored path handling > should handle relative paths correctly 5ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > isIgnored path handling > should normalize path separators on Windows 2ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > isIgnored path handling > should handle root path "/" without throwing error 4ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > isIgnored path handling > should handle absolute-like paths without throwing error 2ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > isIgnored path handling > should handle paths that start with forward slash 3ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > isIgnored path handling > should handle backslash-prefixed files without crashing 3ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > isIgnored path handling > should handle files with absolute-like names 3ms
 âœ“ src/services/gitService.test.ts > GitService > constructor > should successfully create an instance 4ms
 âœ“ src/services/gitService.test.ts > GitService > verifyGitAvailability > should resolve true if git --version command succeeds 3ms
 âœ“ src/services/gitService.test.ts > GitService > verifyGitAvailability > should resolve false if git --version command fails 3ms
 âœ“ src/services/gitService.test.ts > GitService > initialize > should throw an error if Git is not available 4ms
 âœ“ src/services/gitService.test.ts > GitService > initialize > should call setupShadowGitRepository if Git is available 2ms
 âœ“ src/services/gitService.test.ts > GitService > setupShadowGitRepository > should create history and repository directories 27ms
 âœ“ src/services/gitService.test.ts > GitService > setupShadowGitRepository > should create a .gitconfig file with the correct content 19ms
 âœ“ src/services/gitService.test.ts > GitService > setupShadowGitRepository > should initialize git repo in historyDir if not already initialized 11ms
 âœ“ src/services/gitService.test.ts > GitService > setupShadowGitRepository > should not initialize git repo if already initialized 9ms
 âœ“ src/services/gitService.test.ts > GitService > setupShadowGitRepository > should copy .gitignore from projectRoot if it exists 9ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should throw an error when a tool call is followed by an empty stream response 501ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should succeed when there is a tool call without finish reason 1ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > nested .gitignore files > should handle nested .gitignore files correctly 14ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > precedence rules > should prioritize nested .gitignore over root .gitignore 5ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > precedence rules > should prioritize .gitignore over .git/info/exclude 4ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > Escaped Characters > should correctly handle escaped characters in .gitignore 2ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > Trailing Spaces > should correctly handle significant trailing spaces 12ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > Extra Patterns > should apply extraPatterns with higher precedence than .gitignore 6ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > Extra Patterns > should handle extraPatterns that unignore directories 4ms
 âœ“ src/utils/gitIgnoreParser.test.ts > GitIgnoreParser > Extra Patterns > should handle extraPatterns that unignore directories with nested gitignore 13ms
 âœ“ src/tools/glob.test.ts > GlobTool > validateToolParams > 'should return error if case_sensitiveâ€¦' 66ms
 âœ“ src/tools/glob.test.ts > GlobTool > validateToolParams > 'should return error if search path reâ€¦' 61ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordChatCompressionMetrics > does not record metrics if not initialized 231ms
 âœ“ src/services/gitService.test.ts > GitService > setupShadowGitRepository > should not create a .gitignore in shadow repo if project .gitignore does not exist 13ms
 âœ“ src/services/gitService.test.ts > GitService > setupShadowGitRepository > should throw an error if reading projectRoot .gitignore fails with other errors 6ms
 âœ“ src/services/gitService.test.ts > GitService > setupShadowGitRepository > should make an initial commit if no commits exist in history repo 6ms
 âœ“ src/services/gitService.test.ts > GitService > setupShadowGitRepository > should not make an initial commit if commits already exist 15ms
 âœ“ src/services/gitService.test.ts > GitService > setupShadowGitRepository > should handle checkIsRepo failure gracefully and initialize repo 12ms
 âœ“ src/services/gitService.test.ts > GitService > createFileSnapshot > should commit with --no-verify flag 19ms
 âœ“ src/services/gitService.test.ts > GitService > createFileSnapshot > should create a new commit if there are staged changes 2ms
 âœ“ src/services/gitService.test.ts > GitService > createFileSnapshot > should return the current HEAD commit hash if there are no staged changes 6ms
 âœ“ src/tools/edit.test.ts > EditTool > execute > should not include modification message when 'modified_by_user is false' 6ms
 âœ“ src/tools/edit.test.ts > EditTool > execute > should not include modification message when 'modified_by_user is not provided' 4ms
 âœ“ src/tools/edit.test.ts > EditTool > execute > should return error if old_string and new_string are identical 3ms
 âœ“ src/tools/edit.test.ts > EditTool > execute > should return EDIT_NO_CHANGE error if replacement results in identical content 2ms
 âœ“ src/tools/edit.test.ts > EditTool > Error Scenarios > should return 'FILE_NOT_FOUND error' 2ms
 âœ“ src/tools/edit.test.ts > EditTool > Error Scenarios > should return 'ATTEMPT_TO_CREATE_EXISTING_FILE error' 2ms
 âœ“ src/tools/edit.test.ts > EditTool > Error Scenarios > should return 'NO_OCCURRENCE_FOUND error' 2ms
 âœ“ src/tools/edit.test.ts > EditTool > Error Scenarios > should return 'EXPECTED_OCCURRENCE_MISMATCH error' 3ms
 âœ“ src/tools/edit.test.ts > EditTool > Error Scenarios > should return 'NO_CHANGE error' 3ms
 âœ“ src/tools/edit.test.ts > EditTool > Error Scenarios > should return 'relative path (should not throw)' 2ms
 âœ“ src/tools/edit.test.ts > EditTool > Error Scenarios > should return 'FILE_WRITE_FAILURE on write error' 2ms
 âœ“ src/tools/edit.test.ts > EditTool > getDescription > should handle 'identical strings (no change)' 2ms
 âœ“ src/tools/edit.test.ts > EditTool > getDescription > should handle 'different strings (full)' 1ms
 âœ“ src/tools/edit.test.ts > EditTool > getDescription > should handle 'very short strings' 1ms
 âœ“ src/tools/edit.test.ts > EditTool > getDescription > should handle 'long strings (truncated)' 1ms
 âœ“ src/tools/edit.test.ts > EditTool > workspace boundary validation > should validate paths are within workspace root 1ms
 âœ“ src/tools/edit.test.ts > EditTool > workspace boundary validation > should reject paths outside workspace root 1ms
 âœ“ src/tools/edit.test.ts > EditTool > constructor > should use windows-style path examples on windows 1ms
 âœ“ src/tools/edit.test.ts > EditTool > constructor > should use unix-style path examples on non-windows platforms 1ms
 âœ“ src/tools/edit.test.ts > EditTool > IDE mode > should call ideClient.openDiff and update params on confirmation 4ms
 âœ“ src/tools/edit.test.ts > EditTool > multiple file edits > should perform multiple removals and report correct diff stats 11ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > build > should return an invocation for a valid absolute path within root 17ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > build > should return an invocation for a valid relative path within root 2ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > build > should throw an error for a path outside root 2ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > build > should throw an error if path is a directory 1ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > build > should throw an error if the content is null 1ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > build > should throw error if the file_path is empty 1ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > getCorrectedFileContent > should call ensureCorrectFileContent for a new file 3ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > getCorrectedFileContent > should call ensureCorrectEdit for an existing file 5ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > getCorrectedFileContent > should return error if reading an existing file fails (e.g. permissions) 1ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > shouldConfirmExecute > should return false if _getCorrectedFileContent returns an error 1ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > shouldConfirmExecute > should request confirmation with diff for a new file (with corrected content) 2ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > shouldConfirmExecute > should request confirmation with diff for an existing file (with corrected content) 3ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > shouldConfirmExecute > with IDE integration > should call openDiff and await it when in IDE mode and connected 2ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > shouldConfirmExecute > with IDE integration > should not call openDiff if not in IDE mode 2ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > shouldConfirmExecute > with IDE integration > should not call openDiff if IDE is not connected 2ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > shouldConfirmExecute > with IDE integration > should update params.content with IDE content when onConfirm is called 2ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > shouldConfirmExecute > with IDE integration > should not await ideConfirmation promise 52ms
 âœ“ src/tools/mcp-tool.test.ts > generateValidName > should return a valid name for a simple function 1ms
 âœ“ src/tools/mcp-tool.test.ts > generateValidName > should replace invalid characters with underscores 0ms
 âœ“ src/tools/mcp-tool.test.ts > generateValidName > should truncate long names 0ms
 âœ“ src/tools/mcp-tool.test.ts > generateValidName > should handle names with only invalid characters 0ms
 âœ“ src/tools/mcp-tool.test.ts > generateValidName > should handle names that are 'exactly 63 characters' long 0ms
 âœ“ src/tools/mcp-tool.test.ts > generateValidName > should handle names that are 'exactly 64 characters' long 0ms
 âœ“ src/tools/mcp-tool.test.ts > generateValidName > should handle names that are 'longer than 64 characters' long 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > constructor > should set properties correctly 14ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should call mcpTool.callTool with correct parameters and format display output 1ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should handle empty result from getStringifiedResultForDisplay 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should propagate rejection if mcpTool.callTool rejects 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should return a structured error if MCP tool reports an error 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should return a structured error if MCP tool reports an error 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should return a structured error if MCP tool reports a top-level isError (spec compliant) 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should consider a ToolResult with isError ${description} to be a success 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should consider a ToolResult with isError ${description} to be a success 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should handle a simple text response correctly 2ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should handle an AudioBlock response 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should handle a ResourceLinkBlock response 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should handle an embedded text ResourceBlock response 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should handle an embedded binary ResourceBlock response 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should handle a mix of content block types 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should ignore unknown content block types 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > should handle a complex mix of content block types 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > AbortSignal support > should abort immediately if signal is already aborted 1ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > AbortSignal support > should abort during tool execution 50ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > AbortSignal support > should complete successfully if not aborted 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > AbortSignal support > should handle tool error even when abort signal is provided 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > AbortSignal support > should handle callTool rejection with abort signal 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > AbortSignal support > should cleanup event listeners properly on 'successful completion' 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > execute > AbortSignal support > should cleanup event listeners properly on 'error' 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > shouldConfirmExecute > should return false if trust is true 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > shouldConfirmExecute > should return false if server is allowlisted 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > shouldConfirmExecute > should return false if tool is allowlisted 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > shouldConfirmExecute > should return confirmation details if not trusted and not allowlisted 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > shouldConfirmExecute > should 'add server to allowlist on ProceedAlwâ€¦' 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > shouldConfirmExecute > should 'add tool to allowlist on ProceedAlwayâ€¦' 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > shouldConfirmExecute > should 'handle Cancel confirmation outcome' 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > shouldConfirmExecute > should 'handle ProceedOnce confirmation outcoâ€¦' 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > shouldConfirmExecute with folder trust > should 'return false if trust is true and folâ€¦' 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > shouldConfirmExecute with folder trust > should 'return confirmation details if trust â€¦' 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > shouldConfirmExecute with folder trust > should 'return confirmation details if trust â€¦' 0ms
 âœ“ src/tools/mcp-tool.test.ts > DiscoveredMCPTool > DiscoveredMCPToolInvocation > should return the stringified params from getDescription 0ms
 âœ“ src/tools/glob.test.ts > GlobTool > validateToolParams > 'should return error if specified searâ€¦' 67ms
 âœ“ src/tools/glob.test.ts > GlobTool > validateToolParams > 'should return error if specified searâ€¦' 60ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > execute > should write a new file with a relative path 3ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > execute > should return error if _getCorrectedFileContent returns an error during execute 1ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > execute > should write a new file with corrected content and return diff 4ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > execute > should overwrite an existing file with corrected content and return diff 3ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > execute > should create directory if it does not exist 2ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > execute > should 'when modified_by_user is true' include modification message 3ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > execute > should 'when modified_by_user is false' include modification message 2ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > execute > should 'when modified_by_user is not provided' include modification message 1ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > workspace boundary validation > should validate paths are within workspace root 1ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > workspace boundary validation > should reject paths outside workspace root 1ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > specific error types for write failures > should return 'permission_denied' error when write fails with 'EACCES' 2ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > specific error types for write failures > should return 'no_space_left' error when write fails with 'ENOSPC' 2ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > specific error types for write failures > should return 'target_is_directory' error when write fails with 'EISDIR' 2ms
 âœ“ src/tools/write-file.test.ts > WriteFileTool > specific error types for write failures > should return 'file_write_failure' error when write fails with undefined 1ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > parseAgentToml > should parse a valid MVA TOML file 10ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > parseAgentToml > should parse a valid remote agent TOML file 5ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > parseAgentToml > should infer remote agent kind from agent_card_url 1ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > parseAgentToml > should parse a remote agent without description 1ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > parseAgentToml > should parse multiple agents in one file 3ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > parseAgentToml > should allow omitting kind in remote_agents block 3ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > parseAgentToml > should throw AgentLoadError if file reading fails 1ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > parseAgentToml > should throw AgentLoadError if TOML parsing fails 1ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > parseAgentToml > should throw AgentLoadError if validation fails (missing required field) 1ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > parseAgentToml > should throw AgentLoadError if name is not a slug 1ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > parseAgentToml > should throw AgentLoadError if delegate_to_agent is included in tools 1ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > parseAgentToml > should throw AgentLoadError if tools contains invalid names 4ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > parseAgentToml > should throw AgentLoadError if file contains both single and multiple agents 3ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > parseAgentToml > should show both options in error message when validation fails ambiguously 2ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > tomlToAgentDefinition > should convert valid TOML to AgentDefinition with defaults 0ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > tomlToAgentDefinition > should pass through model aliases 1ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > tomlToAgentDefinition > should pass through unknown model names (e.g. auto) 0ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > loadAgentsFromDirectory > should load definitions from a directory 5ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > loadAgentsFromDirectory > should return empty result if directory does not exist 1ms
 âœ“ src/agents/toml-loader.test.ts > toml-loader > loadAgentsFromDirectory > should capture errors for malformed individual files 1ms
 âœ“ src/tools/glob.test.ts > GlobTool > workspace boundary validation > should validate search paths are within workspace boundaries 66ms
 âœ“ src/tools/glob.test.ts > GlobTool > workspace boundary validation > should provide clear error messages when path is outside workspace 58ms
 âœ“ src/tools/modifiable-tool.test.ts > modifyWithEditor > successful modification > should successfully modify content with VSCode editor 6ms
 âœ“ src/tools/modifiable-tool.test.ts > modifyWithEditor > successful modification > should create temp directory and files with restrictive permissions 3ms
 âœ“ src/tools/modifiable-tool.test.ts > modifyWithEditor > should handle missing old temp file gracefully 3ms
 âœ“ src/tools/modifiable-tool.test.ts > modifyWithEditor > should handle missing new temp file gracefully 3ms
 âœ“ src/tools/modifiable-tool.test.ts > modifyWithEditor > should honor override content values when provided 2ms
 âœ“ src/tools/modifiable-tool.test.ts > modifyWithEditor > should treat null override as explicit empty content 2ms
 âœ“ src/tools/modifiable-tool.test.ts > modifyWithEditor > should clean up temp files even if editor fails 5ms
 âœ“ src/tools/modifiable-tool.test.ts > modifyWithEditor > should handle temp file cleanup errors gracefully 2ms
 âœ“ src/tools/modifiable-tool.test.ts > modifyWithEditor > should create temp files with correct naming with extension 1ms
 âœ“ src/tools/modifiable-tool.test.ts > modifyWithEditor > should create temp files with correct naming without extension 2ms
 âœ“ src/tools/modifiable-tool.test.ts > isModifiableTool > should return true for objects with getModifyContext method 0ms
 âœ“ src/tools/modifiable-tool.test.ts > isModifiableTool > should return false for objects without getModifyContext method 0ms
 âœ“ src/utils/shell-utils.test.ts > getCommandRoots > should return a single command 7ms
 âœ“ src/utils/shell-utils.test.ts > getCommandRoots > should handle paths and return the binary name 0ms
 âœ“ src/utils/shell-utils.test.ts > getCommandRoots > should return an empty array for an empty string 0ms
 âœ“ src/utils/shell-utils.test.ts > getCommandRoots > should handle a mix of operators 0ms
 âœ“ src/utils/shell-utils.test.ts > getCommandRoots > should correctly parse a chained command with quotes 0ms
 âœ“ src/utils/shell-utils.test.ts > getCommandRoots > should include nested command substitutions 0ms
 âœ“ src/utils/shell-utils.test.ts > getCommandRoots > should include process substitutions 0ms
 âœ“ src/utils/shell-utils.test.ts > getCommandRoots > should include backtick substitutions 0ms
 âœ“ src/utils/shell-utils.test.ts > getCommandRoots > should treat parameter expansions with prompt transformations as unsafe 7ms
 âœ“ src/utils/shell-utils.test.ts > getCommandRoots > should not return roots for prompt transformation expansions 4ms
 âœ“ src/utils/shell-utils.test.ts > getCommandRoots > should include nested command substitutions in redirected statements 0ms
 âœ“ src/utils/shell-utils.test.ts > getCommandRoots > should handle parser initialization failures gracefully 13ms
 âœ“ src/utils/shell-utils.test.ts > hasRedirection > should detect output redirection 0ms
 âœ“ src/utils/shell-utils.test.ts > hasRedirection > should detect input redirection 0ms
 âœ“ src/utils/shell-utils.test.ts > hasRedirection > should detect append redirection 0ms
 âœ“ src/utils/shell-utils.test.ts > hasRedirection > should detect heredoc 0ms
 âœ“ src/utils/shell-utils.test.ts > hasRedirection > should detect herestring 0ms
 âœ“ src/utils/shell-utils.test.ts > hasRedirection > should return false for simple commands 0ms
 âœ“ src/utils/shell-utils.test.ts > hasRedirection > should return false for pipes (pipes are not redirections in this context) 0ms
 â†“ src/utils/shell-utils.test.ts > PowerShell integration > should return command roots using PowerShell AST output
 âœ“ src/utils/shell-utils.test.ts > stripShellWrapper > should strip sh -c with quotes 0ms
 âœ“ src/utils/shell-utils.test.ts > stripShellWrapper > should strip bash -c with extra whitespace 0ms
 âœ“ src/utils/shell-utils.test.ts > stripShellWrapper > should strip zsh -c without quotes 0ms
 âœ“ src/utils/shell-utils.test.ts > stripShellWrapper > should strip cmd.exe /c 0ms
 âœ“ src/utils/shell-utils.test.ts > stripShellWrapper > should strip powershell.exe -Command with optional -NoProfile 0ms
 âœ“ src/utils/shell-utils.test.ts > stripShellWrapper > should strip pwsh -Command wrapper 0ms
 âœ“ src/utils/shell-utils.test.ts > stripShellWrapper > should not strip anything if no wrapper is present 0ms
 âœ“ src/utils/shell-utils.test.ts > escapeShellArg > POSIX (bash) > should use shell-quote for escaping 0ms
 âœ“ src/utils/shell-utils.test.ts > escapeShellArg > POSIX (bash) > should handle empty strings 0ms
 âœ“ src/utils/shell-utils.test.ts > escapeShellArg > Windows > when shell is cmd.exe > should wrap simple arguments in double quotes 0ms
 âœ“ src/utils/shell-utils.test.ts > escapeShellArg > Windows > when shell is cmd.exe > should escape internal double quotes by doubling them 1ms
 âœ“ src/utils/shell-utils.test.ts > escapeShellArg > Windows > when shell is cmd.exe > should handle empty strings 1ms
 âœ“ src/utils/shell-utils.test.ts > escapeShellArg > Windows > when shell is PowerShell > should wrap simple arguments in single quotes 0ms
 âœ“ src/utils/shell-utils.test.ts > escapeShellArg > Windows > when shell is PowerShell > should escape internal single quotes by doubling them 0ms
 âœ“ src/utils/shell-utils.test.ts > escapeShellArg > Windows > when shell is PowerShell > should handle double quotes without escaping them 0ms
 âœ“ src/utils/shell-utils.test.ts > escapeShellArg > Windows > when shell is PowerShell > should handle empty strings 0ms
 âœ“ src/utils/shell-utils.test.ts > getShellConfiguration > should return bash configuration on Linux 0ms
 âœ“ src/utils/shell-utils.test.ts > getShellConfiguration > should return bash configuration on macOS (darwin) 0ms
 âœ“ src/utils/shell-utils.test.ts > getShellConfiguration > on Windows > should return PowerShell configuration by default 0ms
 âœ“ src/utils/shell-utils.test.ts > getShellConfiguration > on Windows > should ignore ComSpec when pointing to cmd.exe 0ms
 âœ“ src/utils/shell-utils.test.ts > getShellConfiguration > on Windows > should return PowerShell configuration if ComSpec points to powershell.exe 0ms
 âœ“ src/utils/shell-utils.test.ts > getShellConfiguration > on Windows > should return PowerShell configuration if ComSpec points to pwsh.exe 0ms
 âœ“ src/utils/shell-utils.test.ts > getShellConfiguration > on Windows > should be case-insensitive when checking ComSpec 0ms
 âœ“ src/utils/shell-utils.test.ts > hasRedirection (PowerShell via mock) > should return true when PowerShell parser detects redirection 0ms
 âœ“ src/utils/shell-utils.test.ts > hasRedirection (PowerShell via mock) > should return false when PowerShell parser does not detect redirection 0ms
 âœ“ src/utils/shell-utils.test.ts > hasRedirection (PowerShell via mock) > should return false when quoted redirection chars are used but not actual redirection 0ms
 âœ“ src/utils/shell-utils.test.ts > hasRedirection (PowerShell via mock) > should fallback to regex if parsing fails (simulating safety) 0ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordChatCompressionMetrics > records token compression with the correct attributes 288ms
 âœ“ src/tools/glob.test.ts > GlobTool > workspace boundary validation > should work with paths in workspace subdirectories 67ms
 âœ“ src/tools/glob.test.ts > GlobTool > ignore file handling > 'should respect .gitignore files by deâ€¦' 66ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > should read a text file from the CWD 7ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > should read a file from a secondary workspace directory 2ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > should prioritize CWD when file exists in both CWD and secondary dir 3ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > should read an image file and return it as inlineData (Part object) 2ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > should read a generic binary file and return an info string 2ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > should read a file from an absolute path if within workspace 2ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > Directory Expansion > should expand a directory and read the content of its files 8ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > Directory Expansion > should recursively expand a directory and read all nested files 6ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > Directory Expansion > should handle mixed content and include files from subdirectories 4ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > Directory Expansion > should handle an empty directory 2ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > File Ignoring > should return an empty array for an ignored file 1ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > File Ignoring > should not read ignored files when expanding a directory 10ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > File Ignoring > should pass correct ignore flags to file service for a single file 1ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > File Ignoring > should pass correct ignore flags to file service for a directory 9ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > should throw an error for an absolute path outside the workspace 3ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > should throw an error if a relative path is not found anywhere 2ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > should return an error string if reading a file with no permissions 2ms
 âœ“ src/utils/pathReader.test.ts > readPathFromWorkspace > should return an error string for files exceeding the size limit 21ms
 âœ“ src/tools/shell.test.ts > ShellTool > isCommandAllowed > should allow a command if no restrictions are provided 7ms
 âœ“ src/tools/shell.test.ts > ShellTool > isCommandAllowed > should allow a command with command substitution using $() 1ms
 âœ“ src/tools/shell.test.ts > ShellTool > build > should return an invocation for a valid command 13ms
 âœ“ src/tools/shell.test.ts > ShellTool > build > should throw an error for an empty command 2ms
 âœ“ src/tools/shell.test.ts > ShellTool > build > should return an invocation for a valid relative directory path 2ms
 âœ“ src/tools/shell.test.ts > ShellTool > build > should throw an error for a directory outside the workspace 2ms
 âœ“ src/tools/shell.test.ts > ShellTool > build > should return an invocation for a valid absolute directory path 1ms
 âœ“ src/tools/shell.test.ts > ShellTool > execute > should wrap command on linux and parse pgrep output 5ms
 âœ“ src/tools/shell.test.ts > ShellTool > execute > should use the provided absolute directory as cwd 2ms
 âœ“ src/tools/shell.test.ts > ShellTool > execute > should use the provided relative directory as cwd 2ms
 â†“ src/tools/shell.test.ts > ShellTool > execute > should not wrap command on windows
 âœ“ src/tools/shell.test.ts > ShellTool > execute > should format error messages correctly 1ms
 âœ“ src/tools/shell.test.ts > ShellTool > execute > should return a SHELL_EXECUTE_ERROR for a command failure 1ms
 âœ“ src/tools/shell.test.ts > ShellTool > execute > should throw an error for invalid parameters 1ms
 âœ“ src/tools/shell.test.ts > ShellTool > execute > should summarize output when configured 2ms
 âœ“ src/tools/shell.test.ts > ShellTool > execute > should NOT start a timeout if timeoutMs is <= 0 3ms
 âœ“ src/tools/shell.test.ts > ShellTool > execute > should clean up the temp file on synchronous execution error 2ms
 âœ“ src/tools/shell.test.ts > ShellTool > execute > Streaming to `updateOutput` > should immediately show binary detection message and throttle progress 2ms
 âœ“ src/tools/shell.test.ts > ShellTool > shouldConfirmExecute > should return confirmation details when PolicyEngine delegates 8ms
 âœ“ src/tools/shell.test.ts > ShellTool > shouldConfirmExecute > should throw an error if validation fails 1ms
 âœ“ src/tools/shell.test.ts > ShellTool > shouldConfirmExecute > in non-interactive mode > should not throw an error or block for an allowed command 1ms
 âœ“ src/tools/shell.test.ts > ShellTool > shouldConfirmExecute > in non-interactive mode > should not throw an error or block for an allowed command with arguments 1ms
 âœ“ src/tools/shell.test.ts > ShellTool > shouldConfirmExecute > in non-interactive mode > should throw an error for command that is not allowed 2ms
 âœ“ src/tools/shell.test.ts > ShellTool > shouldConfirmExecute > in non-interactive mode > should throw an error for a command that is a prefix of an allowed command 2ms
 âœ“ src/tools/shell.test.ts > ShellTool > shouldConfirmExecute > in non-interactive mode > should require all segments of a chained command to be allowlisted 1ms
 âœ“ src/tools/shell.test.ts > ShellTool > getDescription > should return the windows description when on windows 4ms
 âœ“ src/tools/shell.test.ts > ShellTool > getDescription > should return the non-windows description when not on windows 1ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should throw InvalidStreamError when no tool call and no finish reason 502ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > serializeTerminalToObject > should handle an empty terminal 5ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > serializeTerminalToObject > should serialize a single line of text 3ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > serializeTerminalToObject > should serialize multiple lines of text 2ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > serializeTerminalToObject > should handle bold text 3ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > serializeTerminalToObject > should handle italic text 3ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > serializeTerminalToObject > should handle underlined text 3ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > serializeTerminalToObject > should handle dim text 3ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > serializeTerminalToObject > should handle inverse text 3ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > serializeTerminalToObject > should handle foreground colors 1ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > serializeTerminalToObject > should handle background colors 3ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > serializeTerminalToObject > should handle RGB colors 2ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > serializeTerminalToObject > should handle a combination of styles 2ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > serializeTerminalToObject > should set inverse for the cursor position 4ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > convertColorToHex > should convert RGB color to hex 0ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > convertColorToHex > should convert palette color to hex 0ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > convertColorToHex > should return default color for ColorMode.DEFAULT 0ms
 âœ“ src/utils/terminalSerializer.test.ts > terminalSerializer > convertColorToHex > should return default color for invalid palette index 0ms
 âœ“ src/tools/glob.test.ts > GlobTool > ignore file handling > 'should respect .geminiignore files byâ€¦' 63ms
 âœ“ src/tools/glob.test.ts > GlobTool > ignore file handling > 'should not respect .gitignore when reâ€¦' 65ms
 âœ“ src/utils/errorReporting.test.ts > reportError > should generate a report and log the path 8ms
 âœ“ src/utils/errorReporting.test.ts > reportError > should handle errors that are plain objects with a message property 13ms
 âœ“ src/utils/errorReporting.test.ts > reportError > should handle string errors 8ms
 âœ“ src/utils/errorReporting.test.ts > reportError > should log fallback message if writing report fails 8ms
 âœ“ src/utils/errorReporting.test.ts > reportError > should handle stringification failure of report content (e.g. BigInt in context) 9ms
 âœ“ src/utils/errorReporting.test.ts > reportError > should generate a report without context if context is not provided 3ms
 âœ“ src/tools/web-fetch.test.ts > parsePrompt > should extract valid URLs separated by whitespace 1ms
 âœ“ src/tools/web-fetch.test.ts > parsePrompt > should accept URLs with trailing punctuation 0ms
 âœ“ src/tools/web-fetch.test.ts > parsePrompt > should detect 'URLs wrapped in punctuation' as errors 0ms
 âœ“ src/tools/web-fetch.test.ts > parsePrompt > should detect 'unsupported protocols (httpshttps://)' as errors 0ms
 âœ“ src/tools/web-fetch.test.ts > parsePrompt > should detect 'unsupported protocols (ftp://)' as errors 0ms
 âœ“ src/tools/web-fetch.test.ts > parsePrompt > should detect 'malformed URLs (http://)' as errors 0ms
 âœ“ src/tools/web-fetch.test.ts > parsePrompt > should handle prompts with no URLs 0ms
 âœ“ src/tools/web-fetch.test.ts > parsePrompt > should handle mixed valid and invalid URLs 0ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > validateToolParamValues > should throw if 'empty prompt' 13ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > validateToolParamValues > should throw if 'prompt with no URLs' 0ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > validateToolParamValues > should throw if 'prompt with malformed URLs' 0ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > validateToolParamValues > should pass if prompt contains at least one valid URL 0ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > execute > should return WEB_FETCH_FALLBACK_FAILED on fallback fetch failure 1ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > execute > should return WEB_FETCH_PROCESSING_ERROR on general processing failure 0ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > execute > should log telemetry when falling back due to private IP 1ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > execute > should log telemetry when falling back due to primary fetch failure 1ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > execute (fallback) > should handle 'HTML content using html-to-text' 1ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > execute (fallback) > should handle 'raw text for JSON content' 0ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > execute (fallback) > should handle 'raw text for plain text content' 0ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > execute (fallback) > should handle 'content with no Content-Type header aâ€¦' 0ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > shouldConfirmExecute > should return confirmation details with the correct prompt and parsed urls 0ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > shouldConfirmExecute > should convert github urls to raw format 0ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > shouldConfirmExecute > should return false if approval mode is AUTO_EDIT 1ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > shouldConfirmExecute > should call setApprovalMode when onConfirm is called with ProceedAlways 1ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > Message Bus Integration > should use message bus for confirmation when available 1ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > Message Bus Integration > should reject promise when confirmation is denied via message bus 1ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > Message Bus Integration > should handle timeout gracefully 2ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > Message Bus Integration > should handle abort signal during confirmation 2ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > Message Bus Integration > should fall back to legacy confirmation when no message bus 1ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > Message Bus Integration > should ignore responses with wrong correlation ID 1ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > Message Bus Integration > should handle message bus publish errors gracefully 1ms
 âœ“ src/tools/web-fetch.test.ts > WebFetchTool > Message Bus Integration > should execute normally after confirmation approval 1ms
 âœ“ src/tools/glob.test.ts > GlobTool > ignore file handling > 'should not respect .geminiignore whenâ€¦' 82ms
 âœ“ src/tools/glob.test.ts > sortFileEntries > 'should sort a mix of recent and olderâ€¦' 1ms
 âœ“ src/tools/glob.test.ts > sortFileEntries > 'should sort only recent files by mtimâ€¦' 0ms
 âœ“ src/tools/glob.test.ts > sortFileEntries > 'should sort only older files alphabetâ€¦' 0ms
 âœ“ src/tools/glob.test.ts > sortFileEntries > 'should handle an empty array' 0ms
 âœ“ src/tools/glob.test.ts > sortFileEntries > 'should correctly sort files when mtimâ€¦' 0ms
 âœ“ src/tools/glob.test.ts > sortFileEntries > 'should use recencyThresholdMs parametâ€¦' 0ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > cacheGoogleAccount > should create directory and write initial account file 3ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > cacheGoogleAccount > should update active account and move previous to old 2ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > cacheGoogleAccount > should not add a duplicate to the old list 2ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > cacheGoogleAccount > should handle corrupted JSON by starting fresh 3ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > cacheGoogleAccount > should handle valid JSON with incorrect schema by starting fresh 1ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > getCachedGoogleAccount > should return the active account if file exists and is valid 1ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > getCachedGoogleAccount > should return null if file does not exist 0ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > getCachedGoogleAccount > should return null if file is empty 0ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > getCachedGoogleAccount > should return null and log if file is corrupted 1ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > getCachedGoogleAccount > should return null if active key is missing 1ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > clearCachedGoogleAccount > should set active to null and move it to old 3ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > clearCachedGoogleAccount > should handle empty file gracefully 1ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > clearCachedGoogleAccount > should handle corrupted JSON by creating a fresh file 1ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > clearCachedGoogleAccount > should be idempotent if active account is already null 2ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > clearCachedGoogleAccount > should not add a duplicate to the old list 2ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > getLifetimeGoogleAccounts > should return 0 if the file does not exist 2ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > getLifetimeGoogleAccounts > should return 0 if the file is empty 1ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > getLifetimeGoogleAccounts > should return 0 if the file is corrupted 1ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > getLifetimeGoogleAccounts > should return 1 if there is only an active account 1ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > getLifetimeGoogleAccounts > should correctly count old accounts when active is null 1ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > getLifetimeGoogleAccounts > should correctly count both active and old accounts 1ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > getLifetimeGoogleAccounts > should handle valid JSON with incorrect schema by returning 0 1ms
 âœ“ src/utils/userAccountManager.test.ts > UserAccountManager > getLifetimeGoogleAccounts > should not double count if active account is also in old list 1ms
 âœ“ src/safety/built-in.test.ts > AllowedPathChecker > should allow paths within CWD 9ms
 âœ“ src/safety/built-in.test.ts > AllowedPathChecker > should allow paths within workspace roots 4ms
 âœ“ src/safety/built-in.test.ts > AllowedPathChecker > should deny paths outside allowed areas 4ms
 âœ“ src/safety/built-in.test.ts > AllowedPathChecker > should deny paths using ../ to escape 4ms
 âœ“ src/safety/built-in.test.ts > AllowedPathChecker > should check multiple path arguments 6ms
 âœ“ src/safety/built-in.test.ts > AllowedPathChecker > should handle non-existent paths gracefully if they are inside allowed dir 2ms
 âœ“ src/safety/built-in.test.ts > AllowedPathChecker > should deny access if path contains a symlink pointing outside allowed directories 7ms
 âœ“ src/safety/built-in.test.ts > AllowedPathChecker > should allow access if path contains a symlink pointing INSIDE allowed directories 6ms
 âœ“ src/safety/built-in.test.ts > AllowedPathChecker > should check explicitly included arguments 9ms
 âœ“ src/safety/built-in.test.ts > AllowedPathChecker > should skip explicitly excluded arguments 3ms
 âœ“ src/safety/built-in.test.ts > AllowedPathChecker > should handle both included and excluded arguments 4ms
 âœ“ src/safety/built-in.test.ts > AllowedPathChecker > should check nested path arguments 4ms
 âœ“ src/safety/built-in.test.ts > AllowedPathChecker > should support dot notation for included_args 4ms
 âœ“ src/safety/built-in.test.ts > AllowedPathChecker > should support dot notation for excluded_args 2ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordTokenUsageMetrics > should not record metrics if not initialized 296ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > constructor > should use default config when none provided 2ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > constructor > should respect custom default decision 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > constructor > should sort rules by priority 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > check > should match tool by name 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > check > should match by args pattern 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > check > should apply rules by priority 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > check > should apply wildcard rules (no toolName) 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > check > should handle non-interactive mode 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > check > should dynamically switch between modes and respect rule modes 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > addRule > should add a new rule and maintain priority order 1ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > addRule > should apply newly added rules 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > removeRulesForTool > should remove rules for specific tool 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > removeRulesForTool > should handle removing non-existent tool 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > getRules > should return readonly array of rules 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > MCP server wildcard patterns > should match MCP server wildcard patterns 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > MCP server wildcard patterns > should prioritize specific tool rules over server wildcards 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > MCP server wildcard patterns > should NOT match spoofed server names when using wildcards 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > MCP server wildcard patterns > should verify tool name prefix even if serverName matches 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > MCP server wildcard patterns > should allow when both serverName and tool name prefix match 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should handle multiple matching rules with different priorities 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should handle tools with no args 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should match args pattern regardless of property order 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should handle nested objects in args with stable stringification 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should handle circular references without stack overflow 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should handle deep circular references 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should handle repeated non-circular objects correctly 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should omit undefined and function values from objects 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should convert undefined and functions to null in arrays 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should produce valid JSON for all inputs 1ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should respect toJSON methods on objects 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should handle toJSON that returns primitives 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should handle toJSON that throws an error 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should downgrade ALLOW to ASK_USER for redirected shell commands 24ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should allow redirected shell commands when allowRedirection is true 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should NOT downgrade ALLOW to ASK_USER for quoted redirection chars 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > complex scenarios > should avoid infinite recursion for commands with substitution 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > safety checker integration > should call checker when rule allows and has safety_checker 1ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > safety checker integration > should handle checker errors as DENY 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > safety checker integration > should return DENY when checker denies 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > safety checker integration > should not call checker if decision is not ALLOW 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > safety checker integration > should run checkers when rule allows 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > safety checker integration > should not call checker if rule has no safety_checker 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > serverName requirement > should require serverName for checks 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > serverName requirement > should run multiple checkers in priority order and stop at first denial 1ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > addChecker > should add a new checker and maintain priority order 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checker matching logic > should match checkers using toolName and argsPattern 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checker matching logic > should support wildcard patterns for checkers 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checker matching logic > should run safety checkers when decision is ASK_USER and downgrade to DENY on failure 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checker matching logic > should run safety checkers when decision is ASK_USER and keep ASK_USER on success 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checker matching logic > should downgrade ALLOW to ASK_USER if checker returns ASK_USER 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checker matching logic > should DENY if checker returns ASK_USER in non-interactive mode 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checkHook > should allow hooks by default 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checkHook > should deny all hooks when allowHooks is false 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checkHook > should deny project hooks in untrusted folders 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checkHook > should allow project hooks in trusted folders 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checkHook > should allow user hooks in untrusted folders 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checkHook > should run hook checkers and deny on DENY decision 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checkHook > should run hook checkers and allow on ALLOW decision 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checkHook > should return ASK_USER when checker requests it 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checkHook > should return DENY for ASK_USER in non-interactive mode 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checkHook > should match hook checkers by eventName 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checkHook > should match hook checkers by hookSource 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checkHook > should deny when hook checker throws an error 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > checkHook > should run hook checkers in priority order 0ms
 âœ“ src/policy/policy-engine.test.ts > PolicyEngine > addHookChecker > should add a new hook checker and maintain priority order 0ms
 âœ“ src/policy/shell-safety.test.ts > Shell Safety Policy > SHOULD match "git log" exactly 26ms
 âœ“ src/policy/shell-safety.test.ts > Shell Safety Policy > SHOULD match "git log" with arguments 0ms
 âœ“ src/policy/shell-safety.test.ts > Shell Safety Policy > SHOULD NOT match "git logout" when prefix is "git log" (strict word boundary) 0ms
 âœ“ src/policy/shell-safety.test.ts > Shell Safety Policy > SHOULD NOT allow "git log && rm -rf /" completely when prefix is "git log" (compound command safety) 0ms
 âœ“ src/policy/shell-safety.test.ts > Shell Safety Policy > SHOULD NOT allow "git log &&& rm -rf /" when prefix is "git log" (parse failure) 7ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpTraceExporter > should create a trace exporter with correct configuration 1ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpTraceExporter > should create a trace exporter without project ID 0ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpMetricExporter > should create a metric exporter with correct configuration 0ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpMetricExporter > should create a metric exporter without project ID 0ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpLogExporter > constructor > should create a log exporter with project ID 1ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpLogExporter > constructor > should create a log exporter without project ID 0ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpLogExporter > export > should export logs successfully 3ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpLogExporter > export > should handle export failures 2ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpLogExporter > export > should handle synchronous errors 0ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpLogExporter > severity mapping > should map OpenTelemetry severity numbers to Cloud Logging levels 1ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpLogExporter > forceFlush > should resolve immediately when no pending writes exist 0ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpLogExporter > forceFlush > should wait for pending writes to complete 2ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpLogExporter > forceFlush > should handle multiple pending writes 0ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpLogExporter > forceFlush > should handle write failures gracefully 11ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpLogExporter > shutdown > should call forceFlush 0ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpLogExporter > shutdown > should handle shutdown gracefully 0ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpLogExporter > shutdown > should wait for pending writes before shutting down 2ms
 âœ“ src/telemetry/gcp-exporters.test.ts > GCP Exporters > GcpLogExporter > shutdown > should clear pending writes array after shutdown 12ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should throw InvalidStreamError when no tool call and empty response text 503ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should succeed when there is finish reason and response text 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > initialization > should initialize with a single directory (cwd) 2ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > initialization > should validate and resolve directories to absolute paths 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > initialization > should handle empty initialization 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > adding directories > should add valid directories 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > adding directories > should resolve relative paths to absolute 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > adding directories > should prevent duplicate directories 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > adding directories > should handle symbolic links correctly 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > should accept paths within workspace directories 2ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > should accept non-existent paths within workspace directories 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > should reject paths outside workspace 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > should reject non-existent paths outside workspace 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > should handle nested directories correctly 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > should handle edge cases (root, parent references) 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > should handle non-existent paths correctly 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > with symbolic link > in the workspace > should accept dir paths 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > with symbolic link > in the workspace > should accept non-existent paths 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > with symbolic link > in the workspace > should accept non-existent deep paths 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > with symbolic link > outside the workspace > should reject dir paths 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > with symbolic link > outside the workspace > should reject non-existent paths 2ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > with symbolic link > outside the workspace > should reject non-existent deep paths 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > with symbolic link > outside the workspace > should reject partially non-existent deep paths 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > with symbolic link > should reject symbolic file links outside the workspace 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > with symbolic link > should reject non-existent symbolic file links outside the workspace 0ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > path validation > with symbolic link > should handle circular symlinks gracefully 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > onDirectoriesChanged > should call listener when adding a directory 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > onDirectoriesChanged > should not call listener when adding a duplicate directory 0ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > onDirectoriesChanged > should call listener when setting different directories 0ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > onDirectoriesChanged > should not call listener when setting same directories 0ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > onDirectoriesChanged > should support multiple listeners 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > onDirectoriesChanged > should allow unsubscribing a listener 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > onDirectoriesChanged > should not fail if a listener throws an error 2ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with real filesystem > getDirectories > should return a copy of directories array 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with optional directories > should skip a missing optional directory and log a warning 1ms
 âœ“ src/utils/workspaceContext.test.ts > WorkspaceContext with optional directories > should include an existing optional directory 1ms
 âœ“ src/utils/codeflyIgnoreParser.test.ts > CodeflyIgnoreParser > when .geminiignore exists > should ignore files specified in .geminiignore 10ms
 âœ“ src/utils/codeflyIgnoreParser.test.ts > CodeflyIgnoreParser > when .geminiignore exists > should return ignore file path when patterns exist 10ms
 âœ“ src/utils/codeflyIgnoreParser.test.ts > CodeflyIgnoreParser > when .geminiignore exists > should return true for hasPatterns when patterns exist 5ms
 âœ“ src/utils/codeflyIgnoreParser.test.ts > CodeflyIgnoreParser > when .geminiignore exists > should return false for hasPatterns when .geminiignore is deleted 28ms
 âœ“ src/utils/codeflyIgnoreParser.test.ts > CodeflyIgnoreParser > when .geminiignore does not exist > should not load any patterns and not ignore any files 1ms
 âœ“ src/utils/codeflyIgnoreParser.test.ts > CodeflyIgnoreParser > when .geminiignore does not exist > should return null for getIgnoreFilePath when no patterns exist 14ms
 âœ“ src/utils/codeflyIgnoreParser.test.ts > CodeflyIgnoreParser > when .geminiignore does not exist > should return false for hasPatterns when no patterns exist 4ms
 âœ“ src/utils/codeflyIgnoreParser.test.ts > CodeflyIgnoreParser > when .geminiignore is empty > should return null for getIgnoreFilePath 7ms
 âœ“ src/utils/codeflyIgnoreParser.test.ts > CodeflyIgnoreParser > when .geminiignore is empty > should return false for hasPatterns 5ms
 âœ“ src/utils/codeflyIgnoreParser.test.ts > CodeflyIgnoreParser > when .geminiignore only has comments > should return null for getIgnoreFilePath 9ms
 âœ“ src/utils/codeflyIgnoreParser.test.ts > CodeflyIgnoreParser > when .geminiignore only has comments > should return false for hasPatterns 7ms
 âœ“ src/tools/get-internal-docs.test.ts > GetInternalDocsTool (Integration) > should find the documentation root and list files 20ms
 âœ“ src/tools/get-internal-docs.test.ts > GetInternalDocsTool (Integration) > should read a specific documentation file 3ms
 âœ“ src/tools/get-internal-docs.test.ts > GetInternalDocsTool (Integration) > should prevent access to files outside the docs directory (Path Traversal) 2ms
 âœ“ src/tools/get-internal-docs.test.ts > GetInternalDocsTool (Integration) > should handle non-existent files 1ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > calculateReplacement > should 'perform an exact replacement' 2ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > calculateReplacement > should 'perform a flexible, whitespace-insensâ€¦' 1ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > calculateReplacement > should 'return 0 occurrences if no match is fâ€¦' 0ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > calculateReplacement > should perform a regex-based replacement for flexible intra-line whitespace 2ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > validateToolParams > should return null for valid params 12ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > validateToolParams > should return an error if path is outside the workspace 1ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > execute > should reject when calculateEdit fails after an abort signal 2ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > execute > should edit an existing file and return diff with fileName 5ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > execute > should return error if old_string is not found in file 6ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > execute > should succeed if FixLLMEditWithInstruction corrects the params 7ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > execute > should preserve CRLF line endings when editing a file 5ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > execute > should create a new file with CRLF line endings if new_string has them 3ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > execute > should return NO_CHANGE if FixLLMEditWithInstruction determines no changes are needed 4ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > self-correction with content refresh to pull in external edits > should use refreshed file content for self-correction if file was modified externally 4ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > Error Scenarios > should return 'FILE_NOT_FOUND' error 3ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > Error Scenarios > should return 'ATTEMPT_TO_CREATE_EXISTING_FILE' error 4ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > Error Scenarios > should return 'NO_OCCURRENCE_FOUND' error 8ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > Error Scenarios > should return 'EXPECTED_OCCURRENCE_MISMATCH' error 4ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > expected_replacements > should 'succeed when occurrences match expectâ€¦' 3ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > expected_replacements > should 'fail when occurrences do not match exâ€¦' 3ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > expected_replacements > should 'default to 1 expected replacement if â€¦' 4ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > IDE mode > should call ideClient.openDiff and update params on confirmation 3ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > shouldConfirmExecute > should rethrow calculateEdit errors when the abort signal is triggered 2ms
 âœ“ src/tools/smart-edit.test.ts > SmartEditTool > multiple file edits > should perform multiple removals and report correct diff stats 18ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordTokenUsageMetrics > should record token usage for 'input' type with 100 tokens for model 'gemini-pro' 315ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should allow a command if no restrictions are provided 6ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should allow a command if it is in the global allowlist 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block a command if it is not in a strict global allowlist 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block a command if it is in the blocked list 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should prioritize the blocklist over the allowlist 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should allow any command when a wildcard is in coreTools 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block any command when a wildcard is in excludeTools 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block a command on the blocklist even with a wildcard allow 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should allow a chained command if all parts are on the global allowlist 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block a chained command if any part is blocked 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block a command that redefines an allowed function to run an unlisted command 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block a multi-line function body that runs an unlisted command 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block a function keyword declaration that runs an unlisted command 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block command substitution that invokes an unlisted command 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block pipelines that invoke an unlisted command 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block background jobs that invoke an unlisted command 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block command substitution inside a here-document when the inner command is unlisted 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block backtick substitution that invokes an unlisted command 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block process substitution using <() when the inner command is unlisted 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block process substitution using >() when the inner command is unlisted 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block commands containing prompt transformations 7ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > should block simple prompt transformation expansions 4ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > command substitution > should allow command substitution using `$(...)` 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > command substitution > should allow command substitution using `<(...)` 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > command substitution > should allow command substitution using `>(...)` 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > command substitution > should allow command substitution using backticks 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > command substitution > should allow substitution-like patterns inside single quotes 0ms
 âœ“ src/utils/shell-permissions.test.ts > isCommandAllowed > command substitution > should block a command when parsing fails 5ms
 âœ“ src/utils/shell-permissions.test.ts > checkCommandPermissions > in "Default Allow" mode (no sessionAllowlist) > should return a detailed success object for an allowed command 0ms
 âœ“ src/utils/shell-permissions.test.ts > checkCommandPermissions > in "Default Allow" mode (no sessionAllowlist) > should block commands that cannot be parsed safely 2ms
 âœ“ src/utils/shell-permissions.test.ts > checkCommandPermissions > in "Default Allow" mode (no sessionAllowlist) > should return a detailed failure object for a blocked command 0ms
 âœ“ src/utils/shell-permissions.test.ts > checkCommandPermissions > in "Default Allow" mode (no sessionAllowlist) > should return a detailed failure object for a command not on a strict allowlist 0ms
 âœ“ src/utils/shell-permissions.test.ts > checkCommandPermissions > in "Default Deny" mode (with sessionAllowlist) > should allow a command on the sessionAllowlist 0ms
 âœ“ src/utils/shell-permissions.test.ts > checkCommandPermissions > in "Default Deny" mode (with sessionAllowlist) > should block a command not on the sessionAllowlist or global allowlist 0ms
 âœ“ src/utils/shell-permissions.test.ts > checkCommandPermissions > in "Default Deny" mode (with sessionAllowlist) > should allow a command on the global allowlist even if not on the session allowlist 0ms
 âœ“ src/utils/shell-permissions.test.ts > checkCommandPermissions > in "Default Deny" mode (with sessionAllowlist) > should allow a chained command if parts are on different allowlists 0ms
 âœ“ src/utils/shell-permissions.test.ts > checkCommandPermissions > in "Default Deny" mode (with sessionAllowlist) > should block a command on the sessionAllowlist if it is also globally blocked 0ms
 âœ“ src/utils/shell-permissions.test.ts > checkCommandPermissions > in "Default Deny" mode (with sessionAllowlist) > should block a chained command if one part is not on any allowlist 0ms
 â†“ src/utils/shell-permissions.test.ts > PowerShell integration > should block commands when PowerShell parser reports errors
 âœ“ src/utils/shell-permissions.test.ts > isShellInvocationAllowlisted > should return false when any chained command segment is not allowlisted 0ms
 âœ“ src/utils/shell-permissions.test.ts > isShellInvocationAllowlisted > should return true when every segment is explicitly allowlisted 0ms
 âœ“ src/utils/shell-permissions.test.ts > isShellInvocationAllowlisted > should return true when the allowlist contains a wildcard shell entry 0ms
 âœ“ src/utils/shell-permissions.test.ts > isShellInvocationAllowlisted > should treat piped commands as separate segments that must be allowlisted 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > connect > should connect using HTTP when port is provided in config file 4ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > connect > should connect using stdio when stdio config is provided in file 1ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > connect > should prioritize port over stdio when both are in config file 1ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > connect > should connect using HTTP when port is provided in environment variables 1ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > connect > should connect using stdio when stdio config is in environment variables 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > connect > should prioritize file config over environment variables 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > connect > should be disconnected if no config is found 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > getConnectionConfigFromFile > should return config from the specific pid file if it exists 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > getConnectionConfigFromFile > should return undefined if no config files are found 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > getConnectionConfigFromFile > should find and parse a single config file with the new naming scheme 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > getConnectionConfigFromFile > should filter out configs with invalid workspace paths 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > getConnectionConfigFromFile > should return the first valid config when multiple workspaces are valid 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > getConnectionConfigFromFile > should prioritize the config matching the port from the environment variable 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > getConnectionConfigFromFile > should handle invalid JSON in one of the config files 6ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > getConnectionConfigFromFile > should return undefined if readdir throws an error 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > getConnectionConfigFromFile > should ignore files with invalid names 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > getConnectionConfigFromFile > should match env port string to a number port in the config 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > isDiffingEnabled > should return false if not connected 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > isDiffingEnabled > should return false if tool discovery fails 1ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > isDiffingEnabled > should return false if diffing tools are not available 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > isDiffingEnabled > should return false if only openDiff tool is available 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > isDiffingEnabled > should return true if connected and diffing tools are available 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > resolveDiffFromCli > should resolve an open diff as 'accepted' and return the final content 1ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > resolveDiffFromCli > should resolve an open diff as 'rejected' 2ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > resolveDiffFromCli > should do nothing if no diff is open for the given file path 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > closeDiff > should return undefined if client is not connected 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > closeDiff > should call client.request with correct arguments 1ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > closeDiff > should return content from a valid JSON response 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > closeDiff > should return undefined for a valid JSON response with null content 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > closeDiff > should return undefined if response is not valid JSON 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > closeDiff > should return undefined if request result has isError: true 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > closeDiff > should return undefined if client.request throws 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > closeDiff > should return undefined if response has no text part 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > closeDiff > should return undefined if response is falsy 0ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > authentication > should connect with an auth token if provided in the discovery file 1ms
 âœ“ src/ide/ide-client.test.ts > IdeClient > authentication > should connect with an auth token from environment variable if config file is missing 1ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordTokenUsageMetrics > should record token usage for 'output' type with 50 tokens for model 'gemini-pro' 325ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Tool Call Loop Detection > should not detect a loop for fewer than TOOL_CALL_LOOP_THRESHOLD identical calls 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Tool Call Loop Detection > should detect a loop on the TOOL_CALL_LOOP_THRESHOLD-th identical call 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Tool Call Loop Detection > should detect a loop on subsequent identical calls 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Tool Call Loop Detection > should not detect a loop for different tool calls 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Tool Call Loop Detection > should not reset tool call counter for other event types 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Tool Call Loop Detection > should not detect a loop when disabled for session 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Tool Call Loop Detection > should stop reporting a loop if disabled after detection 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection > should not detect a loop for random content 20ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection > should detect a loop when a chunk of content repeats consecutively 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection > should not detect a loop if repetitions are very far apart 17ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection > should detect a loop with longer repeating patterns (e.g. ~150 chars) 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection > should detect the specific user-provided loop example 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection > should detect the second specific user-provided loop example 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection > should detect a loop of alternating short phrases 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection > should detect a loop of repeated complex thought processes 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should not detect a loop when repetitive content is inside a code block 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should not detect loops when content transitions into a code block 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should skip loop detection when already inside a code block (this.inCodeBlock) 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should correctly track inCodeBlock state with multiple fence transitions 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should detect a loop when repetitive content is outside a code block 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should handle content with multiple code blocks and no loops 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should handle content with mixed code blocks and looping text 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should not detect a loop for a long code block with some repeating tokens 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should reset tracking when a code fence is found 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should reset tracking when a table is detected 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should reset tracking when a list item is detected 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should reset tracking when a heading is detected 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should reset tracking when a blockquote is detected 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should reset tracking for various list item formats 4ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should reset tracking for various table formats 3ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Content Loop Detection with Code Blocks > should reset tracking for various heading levels 4ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Edge Cases > should handle empty content 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Divider Content Detection > should not detect a loop for repeating divider-like content 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Divider Content Detection > should not detect a loop for repeating complex box-drawing dividers 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > Reset Functionality > tool call should reset content count 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService > General Behavior > should return false for unhandled event types 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService LLM Checks > should not trigger LLM check before LLM_CHECK_AFTER_TURNS 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService LLM Checks > should trigger LLM check on the 30th turn 2ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService LLM Checks > should detect a cognitive loop when confidence is high 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService LLM Checks > should not detect a loop when confidence is low 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService LLM Checks > should adjust the check interval based on confidence 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService LLM Checks > should handle errors from generateJson gracefully 5ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService LLM Checks > should not trigger LLM check when disabled for session 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService LLM Checks > should prepend user message if history starts with a function call 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService LLM Checks > should detect a loop when confidence is exactly equal to the threshold (0.9) 1ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService LLM Checks > should not detect a loop when Flash is confident (0.9) but Main model is not (0.89) 0ms
 âœ“ src/services/loopDetectionService.test.ts > LoopDetectionService LLM Checks > should only call Flash model if main model is unavailable 1ms
 âœ“ src/tools/activate-skill.test.ts > ActivateSkillTool > should return enhanced description 13ms
 âœ“ src/tools/activate-skill.test.ts > ActivateSkillTool > should return enhanced confirmation details 1ms
 âœ“ src/tools/activate-skill.test.ts > ActivateSkillTool > should activate a valid skill and return its content in XML tags 2ms
 âœ“ src/tools/activate-skill.test.ts > ActivateSkillTool > should throw error if skill is not in enum 1ms
 âœ“ src/tools/activate-skill.test.ts > ActivateSkillTool > should return an error if skill content cannot be read 1ms
 âœ“ src/tools/activate-skill.test.ts > ActivateSkillTool > should validate that name is provided 2ms
 âœ“ src/tools/message-bus-integration.test.ts > Message Bus Integration > BaseToolInvocation with MessageBus > should use message bus for confirmation when available 15ms
 âœ“ src/tools/message-bus-integration.test.ts > Message Bus Integration > BaseToolInvocation with MessageBus > should reject promise when confirmation is denied 1ms
 âœ“ src/tools/message-bus-integration.test.ts > Message Bus Integration > BaseToolInvocation with MessageBus > should handle timeout 2ms
 âœ“ src/tools/message-bus-integration.test.ts > Message Bus Integration > BaseToolInvocation with MessageBus > should handle abort signal 1ms
 âœ“ src/tools/message-bus-integration.test.ts > Message Bus Integration > BaseToolInvocation with MessageBus > should fall back to default behavior when no message bus 0ms
 âœ“ src/tools/message-bus-integration.test.ts > Message Bus Integration > BaseToolInvocation with MessageBus > should ignore responses with wrong correlation ID 0ms
 âœ“ src/tools/message-bus-integration.test.ts > Message Bus Integration > Backward Compatibility > should work with existing tools that do not use message bus 0ms
 âœ“ src/tools/message-bus-integration.test.ts > Message Bus Integration > Backward Compatibility > should work with tools that have message bus but use default confirmation 0ms
 âœ“ src/tools/message-bus-integration.test.ts > Message Bus Integration > Error Handling > should handle message bus publish errors gracefully 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > initialize > should throw an error if checkpointing is enabled and GitService fails 3ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > initialize > should not throw an error if checkpointing is disabled and GitService fails 4ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > initialize > should throw an error if initialized more than once 1ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > refreshAuth > should refresh auth and update config 1ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > refreshAuth > should reset model availability status 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > refreshAuth > should strip thoughts when switching from GenAI to Vertex AI 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > refreshAuth > should not strip thoughts when switching from Vertex to GenAI 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Config constructor should store userMemory correctly 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Config constructor should default userMemory to empty string if not provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Config constructor should call setCodeflyMdFilename with contextFileName if provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Config constructor should not call setCodeflyMdFilename if contextFileName is not provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > should set default file filtering settings when not provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > should set custom file filtering settings when provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Config constructor should set telemetry to true when provided as true 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Config constructor should set telemetry to false when provided as false 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Config constructor should default telemetry to default value if not provided 2ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Config constructor should set telemetry useCollector to true when provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Config constructor should set telemetry useCollector to false when provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Config constructor should default telemetry useCollector to false if not provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > should have a getFileService method that returns FileDiscoveryService 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Telemetry Settings > should return default telemetry target if not provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Telemetry Settings > should return provided OTLP endpoint 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Telemetry Settings > should return default OTLP endpoint if not provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Telemetry Settings > should return provided logPrompts setting 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Telemetry Settings > should return default logPrompts setting (true) if not provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Telemetry Settings > should return default logPrompts setting (true) if telemetry object is not provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Telemetry Settings > should return default telemetry target if telemetry object is not provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Telemetry Settings > should return default OTLP endpoint if telemetry object is not provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Telemetry Settings > should return provided OTLP protocol 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Telemetry Settings > should return default OTLP protocol if not provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Telemetry Settings > should return default OTLP protocol if telemetry object is not provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Shell Tool Inactivity Timeout > should default to 300000ms (300 seconds) when not provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Shell Tool Inactivity Timeout > should convert provided seconds to milliseconds 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > ContinueOnFailedApiCall Configuration > should default continueOnFailedApiCall to false when not provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > ContinueOnFailedApiCall Configuration > should set continueOnFailedApiCall to true when provided as true 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > ContinueOnFailedApiCall Configuration > should set continueOnFailedApiCall to false when explicitly provided as false 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > createToolRegistry > should register a tool if coreTools contains an argument-specific pattern 9ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > createToolRegistry > should register subagents as tools when codebaseInvestigatorSettings.enabled is true 8ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > createToolRegistry > should not register subagents as tools when codebaseInvestigatorSettings.enabled is false 8ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > createToolRegistry > should not set default codebase investigator model in config (defaults in registry) 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > createToolRegistry > with minified tool class names > should register a tool if coreTools contains the non-minified class name 1ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > createToolRegistry > with minified tool class names > should register a tool if coreTools contains an argument-specific pattern with the non-minified class name 1ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > getTruncateToolOutputThreshold > should return the calculated threshold when it is smaller than the default 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > getTruncateToolOutputThreshold > should return the default threshold when the calculated value is larger 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > getTruncateToolOutputThreshold > should use a custom truncateToolOutputThreshold if provided 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Proxy Configuration Error Handling > should call setGlobalProxy when proxy is configured 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Proxy Configuration Error Handling > should not call setGlobalProxy when proxy is not configured 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Proxy Configuration Error Handling > should emit error feedback when setGlobalProxy throws an error 0ms
 âœ“ src/config/config.test.ts > Server Config (config.ts) > Proxy Configuration Error Handling > should not emit error feedback when setGlobalProxy succeeds 0ms
 âœ“ src/config/config.test.ts > setApprovalMode with folder trust > should throw an error when setting YOLO mode in an untrusted folder 0ms
 âœ“ src/config/config.test.ts > setApprovalMode with folder trust > should throw an error when setting AUTO_EDIT mode in an untrusted folder 0ms
 âœ“ src/config/config.test.ts > setApprovalMode with folder trust > should NOT throw an error when setting DEFAULT mode in an untrusted folder 0ms
 âœ“ src/config/config.test.ts > setApprovalMode with folder trust > should NOT throw an error when setting any mode in a trusted folder 0ms
 âœ“ src/config/config.test.ts > setApprovalMode with folder trust > should NOT throw an error when setting any mode if trustedFolder is undefined 0ms
 âœ“ src/config/config.test.ts > setApprovalMode with folder trust > registerCoreTools > should register RipGrepTool when useRipgrep is true and it is available 1ms
 âœ“ src/config/config.test.ts > setApprovalMode with folder trust > registerCoreTools > should register GrepTool as a fallback when useRipgrep is true but it is not available 1ms
 âœ“ src/config/config.test.ts > setApprovalMode with folder trust > registerCoreTools > should register GrepTool as a fallback when canUseRipgrep throws an error 1ms
 âœ“ src/config/config.test.ts > setApprovalMode with folder trust > registerCoreTools > should register GrepTool when useRipgrep is false 1ms
 âœ“ src/config/config.test.ts > isYoloModeDisabled > should return false when yolo mode is not disabled and folder is trusted 0ms
 âœ“ src/config/config.test.ts > isYoloModeDisabled > should return true when yolo mode is disabled by parameter 0ms
 âœ“ src/config/config.test.ts > isYoloModeDisabled > should return true when folder is untrusted 0ms
 âœ“ src/config/config.test.ts > isYoloModeDisabled > should return true when yolo is disabled and folder is untrusted 0ms
 âœ“ src/config/config.test.ts > BaseLlmClient Lifecycle > should throw an error if getBaseLlmClient is called before refreshAuth 0ms
 âœ“ src/config/config.test.ts > BaseLlmClient Lifecycle > should successfully initialize BaseLlmClient after refreshAuth is called 0ms
 âœ“ src/config/config.test.ts > Generation Config Merging (HACK) > should merge default aliases when user provides only overrides 0ms
 âœ“ src/config/config.test.ts > Generation Config Merging (HACK) > should merge default overrides when user provides only aliases 0ms
 âœ“ src/config/config.test.ts > Generation Config Merging (HACK) > should use user-provided aliases if they exist 0ms
 âœ“ src/config/config.test.ts > Generation Config Merging (HACK) > should use default generation config if none is provided 0ms
 âœ“ src/config/config.test.ts > Config getHooks > should return undefined when no hooks are provided 0ms
 âœ“ src/config/config.test.ts > Config getHooks > should return empty object when empty hooks are provided 0ms
 âœ“ src/config/config.test.ts > Config getHooks > should return the hooks configuration when provided 0ms
 âœ“ src/config/config.test.ts > Config getHooks > should return hooks with all supported event types 0ms
 âœ“ src/config/config.test.ts > Config getHooks > setModel > should allow setting a pro (any) model and reset availability 0ms
 âœ“ src/config/config.test.ts > Config getHooks > setModel > should allow setting auto model from non-auto model and reset availability 0ms
 âœ“ src/config/config.test.ts > Config getHooks > setModel > should allow setting auto model from auto model and reset availability 0ms
 âœ“ src/config/config.test.ts > Config getHooks > setModel > should reset active model when setModel is called with the current model after a fallback 0ms
 âœ“ src/config/config.test.ts > Config getHooks > setModel > should call onModelChange when a new model is set 0ms
 âœ“ src/config/config.test.ts > Config getHooks > setModel > should NOT call onModelChange when a new model is set as a fallback 0ms
 âœ“ src/config/config.test.ts > Config JIT Initialization > should initialize ContextManager, load memory, and delegate to it when experimentalJitContext is enabled 1ms
 âœ“ src/config/config.test.ts > Config JIT Initialization > should NOT initialize ContextManager when experimentalJitContext is disabled 1ms
 âœ“ src/hooks/hookSystem.test.ts > HookSystem Integration > initialize > should initialize successfully 3ms
 âœ“ src/hooks/hookSystem.test.ts > HookSystem Integration > initialize > should not initialize twice 0ms
 âœ“ src/hooks/hookSystem.test.ts > HookSystem Integration > initialize > should handle initialization errors gracefully 0ms
 âœ“ src/hooks/hookSystem.test.ts > HookSystem Integration > getEventHandler > should return event bus when initialized 12ms
 âœ“ src/hooks/hookSystem.test.ts > HookSystem Integration > hook execution > should execute hooks and return results 11ms
 âœ“ src/hooks/hookSystem.test.ts > HookSystem Integration > hook execution > should handle no matching hooks 0ms
 âœ“ src/hooks/hookSystem.test.ts > HookSystem Integration > hook disabling via settings > should not execute disabled hooks from settings 11ms
 âœ“ src/hooks/hookSystem.test.ts > HookSystem Integration > hook disabling via command > should disable hook when setHookEnabled is called 24ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > create (Initialization and Validation) > should create successfully with allowed tools 3ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > create (Initialization and Validation) > should allow any tool for experimentation (formerly SECURITY check) 0ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > create (Initialization and Validation) > should create an isolated ToolRegistry for the agent 1ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > create (Initialization and Validation) > should use parentPromptId from context to create agentId 0ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > create (Initialization and Validation) > should correctly apply templates to initialMessages 5ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Execution Loop and Logic) > should log AgentFinish with error if run throws 3ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Execution Loop and Logic) > should execute successfully when model calls complete_task with output (Happy Path with Output) 1ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Execution Loop and Logic) > should execute successfully when model calls complete_task without output (Happy Path No Output) 1ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Execution Loop and Logic) > should error immediately if the model stops tools without calling complete_task (Protocol Violation) 1ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Execution Loop and Logic) > should report an error if complete_task is called with missing required arguments 0ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Execution Loop and Logic) > should handle multiple calls to complete_task in the same turn (accept first, block rest) 0ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Execution Loop and Logic) > should execute parallel tool calls and then complete 1ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Execution Loop and Logic) > SECURITY: should block unauthorized tools and provide explicit failure to model 1ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > Edge Cases and Error Handling > should report an error if complete_task output fails schema validation 1ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > Edge Cases and Error Handling > should throw and log if CodeflyChat creation fails 6ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > Edge Cases and Error Handling > should handle a failed tool call and feed the error to the model 1ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Termination Conditions) > should terminate when max_turns is reached 0ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Termination Conditions) > should terminate with TIMEOUT if a model call takes too long 2ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Termination Conditions) > should terminate with TIMEOUT if a tool call takes too long 3ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Termination Conditions) > should terminate when AbortSignal is triggered 1ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Recovery Turns) > should recover successfully if complete_task is called during the grace turn after MAX_TURNS 0ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Recovery Turns) > should fail if complete_task is NOT called during the grace turn after MAX_TURNS 0ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Recovery Turns) > should recover successfully from a protocol violation (no complete_task) 0ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Recovery Turns) > should fail recovery from a protocol violation if it violates again 0ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Recovery Turns) > should recover successfully from a TIMEOUT 2ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > run (Recovery Turns) > should fail recovery from a TIMEOUT if the grace period also times out 2ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > Telemetry and Logging > should log a RecoveryAttemptEvent when a recoverable error occurs and recovery fails 1ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > Telemetry and Logging > should log a successful RecoveryAttemptEvent when recovery succeeds 0ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > Chat Compression > should attempt to compress chat history on each turn 0ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > Chat Compression > should update chat history when compression is successful 0ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > Chat Compression > should pass hasFailedCompressionAttempt=true to compression after a failure 0ms
 âœ“ src/agents/local-executor.test.ts > LocalAgentExecutor > Chat Compression > should reset hasFailedCompressionAttempt flag after a successful compression 0ms
 âœ“ src/utils/events.test.ts > CoreEventEmitter > should emit feedback immediately when a listener is present 2ms
 âœ“ src/utils/events.test.ts > CoreEventEmitter > should buffer feedback when no listener is present 0ms
 âœ“ src/utils/events.test.ts > CoreEventEmitter > should respect the backlog size limit and maintain FIFO order 8ms
 âœ“ src/utils/events.test.ts > CoreEventEmitter > should clear the backlog after draining 0ms
 âœ“ src/utils/events.test.ts > CoreEventEmitter > should include optional error object in payload 0ms
 âœ“ src/utils/events.test.ts > CoreEventEmitter > should handle multiple listeners correctly 0ms
 âœ“ src/utils/events.test.ts > CoreEventEmitter > should stop receiving events after off() is called 0ms
 âœ“ src/utils/events.test.ts > CoreEventEmitter > should handle re-entrant feedback emission during draining safely 1ms
 âœ“ src/utils/events.test.ts > CoreEventEmitter > ConsoleLog Event > should emit console log immediately when a listener is present 0ms
 âœ“ src/utils/events.test.ts > CoreEventEmitter > ConsoleLog Event > should buffer console logs when no listener is present 0ms
 âœ“ src/utils/events.test.ts > CoreEventEmitter > ConsoleLog Event > should respect the backlog size limit for console logs 5ms
 âœ“ src/utils/events.test.ts > CoreEventEmitter > Output Event > should emit output immediately when a listener is present 0ms
 âœ“ src/utils/events.test.ts > CoreEventEmitter > Output Event > should buffer output when no listener is present 0ms
 âœ“ src/utils/events.test.ts > CoreEventEmitter > Output Event > should respect the backlog size limit for output 6ms
 âœ“ src/utils/events.test.ts > CoreEventEmitter > ModelChanged Event > should emit ModelChanged event with correct payload 0ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should throw InvalidStreamError when finishReason is MALFORMED_FUNCTION_CALL 503ms
 âœ“ src/agents/delegate-to-agent-tool.test.ts > DelegateToAgentTool > should use dynamic description from registry 2ms
 âœ“ src/agents/delegate-to-agent-tool.test.ts > DelegateToAgentTool > should validate agent_name exists in registry 14ms
 âœ“ src/agents/delegate-to-agent-tool.test.ts > DelegateToAgentTool > should validate correct arguments 2ms
 âœ“ src/agents/delegate-to-agent-tool.test.ts > DelegateToAgentTool > should throw error for missing required argument 1ms
 âœ“ src/agents/delegate-to-agent-tool.test.ts > DelegateToAgentTool > should throw error for invalid argument type 1ms
 âœ“ src/agents/delegate-to-agent-tool.test.ts > DelegateToAgentTool > should allow optional arguments to be omitted 1ms
 âœ“ src/agents/delegate-to-agent-tool.test.ts > DelegateToAgentTool > should throw error if an agent has an input named "agent_name" 1ms
 âœ“ src/agents/delegate-to-agent-tool.test.ts > DelegateToAgentTool > should use correct tool name "delegate_to_agent" when requesting confirmation 2ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > setCodeflyMdFilename > should update currentCodeflyMdFilename when a valid new name is provided 2ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > setCodeflyMdFilename > should not update currentCodeflyMdFilename if the new name is empty or whitespace 0ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > setCodeflyMdFilename > should handle an array of filenames 0ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > performAddMemoryEntry (static method) > should create section and save a fact if file does not exist 1ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > performAddMemoryEntry (static method) > should create section and save a fact if file is empty 0ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > performAddMemoryEntry (static method) > should add a fact to an existing section 0ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > performAddMemoryEntry (static method) > should add a fact to an existing empty section 0ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > performAddMemoryEntry (static method) > should add a fact when other ## sections exist and preserve spacing 0ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > performAddMemoryEntry (static method) > should correctly trim and add a fact that starts with a dash 0ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > performAddMemoryEntry (static method) > should handle error from fsAdapter.writeFile 1ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > execute (instance method) > should have correct name, displayName, description, and schema 1ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > execute (instance method) > should call performAddMemoryEntry with correct parameters and return success 16ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > execute (instance method) > should return an error if fact is empty 0ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > execute (instance method) > should handle errors from performAddMemoryEntry 0ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > shouldConfirmExecute > should return confirmation details when memory file is not allowlisted 1ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > shouldConfirmExecute > should return false when memory file is already allowlisted 0ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > shouldConfirmExecute > should add memory file to allowlist when ProceedAlways is confirmed 0ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > shouldConfirmExecute > should not add memory file to allowlist when other outcomes are confirmed 0ms
 âœ“ src/tools/memoryTool.test.ts > MemoryTool > shouldConfirmExecute > should handle existing memory file with content 0ms
 âœ“ src/skills/skillManager.test.ts > SkillManager > should discover skills from Storage with project precedence 33ms
 âœ“ src/skills/skillManager.test.ts > SkillManager > should filter disabled skills in getSkills but not in getAllSkills 14ms
 âœ“ src/skills/skillLoader.test.ts > skillLoader > should load skills from a directory with valid SKILL.md 13ms
 âœ“ src/skills/skillLoader.test.ts > skillLoader > should ignore directories without SKILL.md 7ms
 âœ“ src/skills/skillLoader.test.ts > skillLoader > should ignore SKILL.md without valid frontmatter 9ms
 âœ“ src/skills/skillLoader.test.ts > skillLoader > should return empty array for non-existent directory 1ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should process basic md file imports 10ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should import non-md files just like md files 1ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should handle circular imports 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should handle file not found errors 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should respect max depth limit 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should handle nested imports recursively 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should handle absolute paths in imports 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should handle multiple imports in same content 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should ignore imports inside code blocks 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should ignore imports inside inline code 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should handle nested tokens and non-unique content correctly 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should not process imports in repeated inline code blocks 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should not import when @ is inside an inline code block 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should allow imports from parent and subdirectories within project root 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should reject imports outside project root 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should build import tree structure 1ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should produce flat output in Claude-style with unique files in order 1ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should not duplicate files in flat output if imported multiple times 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > processImports > should handle nested imports in flat output 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > validateImportPath > should reject URLs 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > validateImportPath > should allow paths within allowed directories 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > validateImportPath > should reject paths outside allowed directories 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > validateImportPath > should handle multiple allowed directories 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > validateImportPath > should handle relative paths correctly 0ms
 âœ“ src/utils/memoryImportProcessor.test.ts > memoryImportProcessor > validateImportPath > should handle absolute paths correctly 0ms
 âœ“ src/core/contentGenerator.test.ts > createContentGenerator > should create a FakeContentGenerator 2ms
 âœ“ src/core/contentGenerator.test.ts > createContentGenerator > should create a RecordingContentGenerator 0ms
 âœ“ src/core/contentGenerator.test.ts > createContentGenerator > should include custom headers from GEMINI_CLI_CUSTOM_HEADERS for GoogleGenAI requests without inferring auth mechanism 6ms
 âœ“ src/core/contentGenerator.test.ts > createContentGenerator > should pass api key as Authorization Header when GEMINI_API_KEY_AUTH_MECHANISM is set to bearer 4ms
 âœ“ src/core/contentGenerator.test.ts > createContentGenerator > should not pass api key as Authorization Header when GEMINI_API_KEY_AUTH_MECHANISM is not set (default behavior) 9ms
 âœ“ src/core/contentGenerator.test.ts > createContentGenerator > should create a GoogleGenAI content generator with client install id logging disabled 3ms
 âœ“ src/core/contentGenerator.test.ts > createContentGenerator > should create an OpenAICompatibleContentGenerator for AuthType.OPENAI 1ms
 âœ“ src/core/contentGenerator.test.ts > createContentGeneratorConfig > should configure for Gemini using GEMINI_API_KEY when set 1ms
 âœ“ src/core/contentGenerator.test.ts > createContentGeneratorConfig > should not configure for Gemini if GEMINI_API_KEY is empty 0ms
 âœ“ src/core/contentGenerator.test.ts > createContentGeneratorConfig > should not configure for Gemini if GEMINI_API_KEY is not set and storage is empty 0ms
 âœ“ src/core/contentGenerator.test.ts > createContentGeneratorConfig > should configure for Vertex AI using GOOGLE_API_KEY when set 0ms
 âœ“ src/core/contentGenerator.test.ts > createContentGeneratorConfig > should configure for Vertex AI using GCP project and location when set 1ms
 âœ“ src/core/contentGenerator.test.ts > createContentGeneratorConfig > should not configure for Vertex AI if required env vars are empty 0ms
 âœ“ src/core/contentGenerator.test.ts > createContentGeneratorConfig > should configure for OpenAI using OPENAI_API_KEY when set 0ms
 âœ“ src/core/contentGenerator.test.ts > createContentGeneratorConfig > should configure for OpenAI with custom base URL and model 0ms
 âœ“ src/core/contentGenerator.test.ts > createContentGeneratorConfig > should configure for Zhipu AI using ZHIPU_API_KEY when set 0ms
 âœ“ src/utils/schemaValidator.test.ts > SchemaValidator > should allow any params if schema is undefined 1ms
 âœ“ src/utils/schemaValidator.test.ts > SchemaValidator > rejects null params 0ms
 âœ“ src/utils/schemaValidator.test.ts > SchemaValidator > rejects params that are not objects 0ms
 âœ“ src/utils/schemaValidator.test.ts > SchemaValidator > allows schema with extra properties 14ms
 âœ“ src/utils/schemaValidator.test.ts > SchemaValidator > allows custom format values 1ms
 âœ“ src/utils/schemaValidator.test.ts > SchemaValidator > allows valid values for known formats 0ms
 âœ“ src/utils/schemaValidator.test.ts > SchemaValidator > rejects invalid values for known formats 2ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordTokenUsageMetrics > should record token usage for 'thought' type with 25 tokens for model 'gemini-pro' 457ms
 âœ“ src/tools/write-todos.test.ts > WriteTodosTool > validation > should not throw for valid parameters 16ms
 âœ“ src/tools/write-todos.test.ts > WriteTodosTool > validation > should not throw for an empty list 0ms
 âœ“ src/tools/write-todos.test.ts > WriteTodosTool > validation > should throw an error if todos is not an array 1ms
 âœ“ src/tools/write-todos.test.ts > WriteTodosTool > validation > should throw an error if a todo item is not an object 0ms
 âœ“ src/tools/write-todos.test.ts > WriteTodosTool > validation > should throw an error if a todo description is missing or empty 0ms
 âœ“ src/tools/write-todos.test.ts > WriteTodosTool > validation > should throw an error if a todo status is invalid 0ms
 âœ“ src/tools/write-todos.test.ts > WriteTodosTool > validation > should throw an error if more than one task is in_progress 0ms
 âœ“ src/tools/write-todos.test.ts > WriteTodosTool > execute > should return a success message for clearing the list 0ms
 âœ“ src/tools/write-todos.test.ts > WriteTodosTool > execute > should return a formatted todo list on success 0ms
 âœ“ src/tools/tool-registry.test.ts > ToolRegistry > registerTool > should register a new tool 2ms
 âœ“ src/tools/tool-registry.test.ts > ToolRegistry > excluded tools > 'should match simple names' 1ms
 âœ“ src/tools/tool-registry.test.ts > ToolRegistry > excluded tools > 'should match simple MCP tool names, wâ€¦' 1ms
 âœ“ src/tools/tool-registry.test.ts > ToolRegistry > excluded tools > 'should match qualified MCP tool namesâ€¦' 0ms
 âœ“ src/tools/tool-registry.test.ts > ToolRegistry > excluded tools > 'should match class names' 0ms
 âœ“ src/tools/tool-registry.test.ts > ToolRegistry > getAllTools > should return all registered tools sorted alphabetically by displayName 0ms
 âœ“ src/tools/tool-registry.test.ts > ToolRegistry > getAllToolNames > should return all registered tool names 0ms
 âœ“ src/tools/tool-registry.test.ts > ToolRegistry > getToolsByServer > should return an empty array if no tools match the server name 0ms
 âœ“ src/tools/tool-registry.test.ts > ToolRegistry > getToolsByServer > should return only tools matching the server name, sorted by name 0ms
 âœ“ src/tools/tool-registry.test.ts > ToolRegistry > sortTools > should sort tools by priority: built-in, discovered, then MCP (by server name) 0ms
 âœ“ src/tools/tool-registry.test.ts > ToolRegistry > discoverTools > should will preserve tool parametersJsonSchema during discovery from command 1ms
 âœ“ src/tools/tool-registry.test.ts > ToolRegistry > discoverTools > should return a DISCOVERED_TOOL_EXECUTION_ERROR on tool failure 14ms
 âœ“ src/tools/tool-registry.test.ts > ToolRegistry > discoverTools > should pass MessageBus to DiscoveredTool and its invocations 1ms
 âœ“ src/tools/tool-registry.test.ts > ToolRegistry > DiscoveredToolInvocation > should return the stringified params from getDescription 0ms
 âœ“ src/utils/delay.test.ts > abortableDelay > resolves after the specified duration without a signal 2ms
 âœ“ src/utils/delay.test.ts > abortableDelay > resolves when a non-aborted signal is provided 1ms
 âœ“ src/utils/delay.test.ts > abortableDelay > rejects immediately if the signal is already aborted 1ms
 âœ“ src/utils/delay.test.ts > abortableDelay > rejects if the signal aborts while waiting 1ms
 âœ“ src/utils/delay.test.ts > abortableDelay > cleans up signal listeners after resolving 1ms
 âœ“ src/utils/delay.test.ts > abortableDelay > cleans up signal listeners when aborted before completion 0ms
 âœ“ src/utils/delay.test.ts > abortableDelay > cleans up timeout when aborted before completion 0ms
 âœ“ src/utils/environmentContext.test.ts > getDirectoryContextString > should return context string for a single directory 1ms
 âœ“ src/utils/environmentContext.test.ts > getDirectoryContextString > should return context string for multiple directories 0ms
 âœ“ src/utils/environmentContext.test.ts > getEnvironmentContext > should return basic environment context for a single directory 11ms
 âœ“ src/utils/environmentContext.test.ts > getEnvironmentContext > should return basic environment context for multiple directories 0ms
 âœ“ src/utils/environmentContext.test.ts > getEnvironmentContext > should handle read_many_files returning no content 0ms
 âœ“ src/utils/environmentContext.test.ts > getEnvironmentContext > should handle read_many_files tool not being found 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > vscode > should return true if first command "code" exists on non-windows 2ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > vscode > should return false if none of the commands exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > vscode > should return true if first command "code.cmd" exists on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > vscode > should return false if none of the commands exist on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > vscodium > should return true if first command "codium" exists on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > vscodium > should return false if none of the commands exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > vscodium > should return true if first command "codium.cmd" exists on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > vscodium > should return false if none of the commands exist on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > windsurf > should return true if first command "windsurf" exists on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > windsurf > should return false if none of the commands exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > windsurf > should return true if first command "windsurf" exists on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > windsurf > should return false if none of the commands exist on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > cursor > should return true if first command "cursor" exists on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > cursor > should return false if none of the commands exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > cursor > should return true if first command "cursor" exists on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > cursor > should return false if none of the commands exist on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > vim > should return true if first command "vim" exists on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > vim > should return false if none of the commands exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > vim > should return true if first command "vim" exists on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > vim > should return false if none of the commands exist on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > neovim > should return true if first command "nvim" exists on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > neovim > should return false if none of the commands exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > neovim > should return true if first command "nvim" exists on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > neovim > should return false if none of the commands exist on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > zed > should return true if first command "zed" exists on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > zed > should return true if first command doesn't exist but second command "zeditor" exists on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > zed > should return false if none of the commands exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > zed > should return true if first command "zed" exists on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > zed > should return false if none of the commands exist on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > emacs > should return true if first command "emacs" exists on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > emacs > should return false if none of the commands exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > emacs > should return true if first command "emacs.exe" exists on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > emacs > should return false if none of the commands exist on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > antigravity > should return true if first command "agy" exists on non-windows 3ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > antigravity > should return false if none of the commands exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > antigravity > should return true if first command "agy.cmd" exists on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > checkHasEditorType > antigravity > should return false if none of the commands exist on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should use first command "code" when it exists on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should fall back to last command "code" when none exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should use first command "code.cmd" when it exists on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should fall back to last command "code.cmd" when none exist on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should use first command "codium" when it exists on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should fall back to last command "codium" when none exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should use first command "codium.cmd" when it exists on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should fall back to last command "codium.cmd" when none exist on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should use first command "windsurf" when it exists on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should fall back to last command "windsurf" when none exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should use first command "windsurf" when it exists on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should fall back to last command "windsurf" when none exist on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should use first command "cursor" when it exists on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should fall back to last command "cursor" when none exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should use first command "cursor" when it exists on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should fall back to last command "cursor" when none exist on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should use first command "zed" when it exists on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should use second command "zeditor" when first doesn't exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should fall back to last command "zeditor" when none exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should use first command "zed" when it exists on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should fall back to last command "zed" when none exist on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should use first command "agy" when it exists on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should fall back to last command "agy" when none exist on non-windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should use first command "agy.cmd" when it exists on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should fall back to last command "agy.cmd" when none exist on windows 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should return the correct command for vim 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should return the correct command for neovim 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should return the correct command for emacs 0ms
 âœ“ src/utils/editor.test.ts > editor utils > getDiffCommand > should return null for an unsupported editor 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should call spawn for vscode 1ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should reject if spawn for vscode fails 1ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should reject if vscode exits with non-zero code 1ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should call spawn for vscodium 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should reject if spawn for vscodium fails 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should reject if vscodium exits with non-zero code 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should call spawn for windsurf 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should reject if spawn for windsurf fails 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should reject if windsurf exits with non-zero code 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should call spawn for cursor 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should reject if spawn for cursor fails 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should reject if cursor exits with non-zero code 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should call spawn for zed 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should reject if spawn for zed fails 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should reject if zed exits with non-zero code 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should call spawnSync for vim 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should call spawnSync for neovim 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should call spawnSync for emacs 0ms
 âœ“ src/utils/editor.test.ts > editor utils > openDiff > should log an error if diff command is not available 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should allow vim in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should allow vim when not in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should allow emacs in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should allow emacs when not in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should allow neovim in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should allow neovim when not in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should not allow vscode in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should allow vscode when not in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should not allow vscodium in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should allow vscodium when not in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should not allow windsurf in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should allow windsurf when not in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should not allow cursor in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should allow cursor when not in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should not allow zed in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > allowEditorTypeInSandbox > should allow zed when not in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > isEditorAvailable > should return false for undefined editor 0ms
 âœ“ src/utils/editor.test.ts > editor utils > isEditorAvailable > should return false for empty string editor 0ms
 âœ“ src/utils/editor.test.ts > editor utils > isEditorAvailable > should return false for invalid editor type 0ms
 âœ“ src/utils/editor.test.ts > editor utils > isEditorAvailable > should return true for vscode when installed and not in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > isEditorAvailable > should return false for vscode when not installed and not in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > isEditorAvailable > should return false for vscode when installed and in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > isEditorAvailable > should return true for vim when installed and in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > isEditorAvailable > should return true for emacs when installed and in sandbox mode 0ms
 âœ“ src/utils/editor.test.ts > editor utils > isEditorAvailable > should return true for neovim when installed and in sandbox mode 0ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should retry when finishReason is MALFORMED_FUNCTION_CALL 503ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should call generateContentStream with the correct parameters 3ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should use thinkingLevel and remove thinkingBudget for gemini-3 models 2ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream > should use thinkingBudget and remove thinkingLevel for non-gemini-3 models 1ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > addHistory > should add a new content item to the history 1ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > addHistory > should add multiple items correctly 1ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream with retries > should not retry on invalid content if model does not start with gemini-2 1ms
 âœ“ src/policy/persistence.test.ts > createPolicyUpdater > should persist policy when persist flag is true 8ms
 âœ“ src/policy/persistence.test.ts > createPolicyUpdater > should not persist policy when persist flag is false or undefined 2ms
 âœ“ src/policy/persistence.test.ts > createPolicyUpdater > should persist policy with commandPrefix when provided 2ms
 âœ“ src/policy/persistence.test.ts > createPolicyUpdater > should persist policy with mcpName and toolName when provided 1ms
 âœ“ src/policy/persistence.test.ts > createPolicyUpdater > should escape special characters in toolName and mcpName 1ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > constructor > should create a new MemoryMonitor instance without config to avoid multi-session attribution 2ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > takeSnapshot > should take a memory snapshot and record metrics when performance monitoring is active 1ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > takeSnapshot > should not record metrics when performance monitoring is inactive 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > getCurrentMemoryUsage > should return current memory usage without recording metrics 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > start and stop > should start and stop memory monitoring with proper lifecycle 1ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > start and stop > should not start monitoring when performance monitoring is inactive 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > start and stop > should not start monitoring when already running 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > start and stop > should handle stop when not running 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > start and stop > should stop without taking final snapshot when no config provided 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > start and stop > should periodically cleanup tracker state to prevent growth 2ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > getMemoryGrowth > should calculate memory growth between snapshots 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > getMemoryGrowth > should return null when no previous snapshot exists 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > checkMemoryThreshold > should return true when memory usage exceeds threshold 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > checkMemoryThreshold > should return false when memory usage is below threshold 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > getMemoryUsageSummary > should return memory usage summary in MB with proper rounding 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > getHeapStatistics > should return V8 heap statistics 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > getHeapSpaceStatistics > should return V8 heap space statistics 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > getProcessMetrics > should return process CPU and memory metrics 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > recordComponentMemoryUsage > should record memory usage for specific component 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > recordComponentMemoryUsage > should record memory usage for component with operation 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > MemoryMonitor Class > destroy > should stop monitoring and cleanup resources 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > Global Memory Monitor Functions > initializeMemoryMonitor > should create singleton instance 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > Global Memory Monitor Functions > getMemoryMonitor > should return null when not initialized 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > Global Memory Monitor Functions > getMemoryMonitor > should return initialized monitor 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > Global Memory Monitor Functions > recordCurrentMemoryUsage > should initialize monitor and take snapshot 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > Global Memory Monitor Functions > startGlobalMemoryMonitoring > should initialize and start global monitoring 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > Global Memory Monitor Functions > stopGlobalMemoryMonitoring > should stop global monitoring when monitor exists 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > Global Memory Monitor Functions > stopGlobalMemoryMonitoring > should handle stop when no global monitor exists 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > Error Scenarios > should handle process.memoryUsage() errors gracefully 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > Error Scenarios > should handle v8.getHeapStatistics() errors gracefully 0ms
 âœ“ src/telemetry/memory-monitor.test.ts > MemoryMonitor > Error Scenarios > should handle metric recording errors gracefully 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Basic Functionality > should generate summary for valid conversation 6ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Basic Functionality > should return null for empty messages array 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Basic Functionality > should return null when all messages have empty content 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Basic Functionality > should handle maxMessages limit correctly 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Message Type Filtering > should include only user and gemini messages 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Message Type Filtering > should exclude info messages 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Message Type Filtering > should exclude error messages 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Message Type Filtering > should exclude warning messages 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Message Type Filtering > should handle mixed message types correctly 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Message Type Filtering > should return null when only system messages present 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Timeout and Abort Handling > should timeout after specified duration 2ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Timeout and Abort Handling > should detect AbortError by name only (not message) 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Timeout and Abort Handling > should handle API errors gracefully 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Timeout and Abort Handling > should handle empty response from LLM 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Text Processing > should clean newlines and extra whitespace 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Text Processing > should remove surrounding quotes 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Text Processing > should handle messages longer than 500 chars 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Text Processing > should preserve important content in truncation 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Sliding Window Message Selection > should return all messages when fewer than 20 exist 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Sliding Window Message Selection > should select first 10 + last 10 from 50 messages 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Sliding Window Message Selection > should return all messages when exactly 20 exist 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Sliding Window Message Selection > should preserve message ordering in sliding window 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Sliding Window Message Selection > should not count system messages when calculating window 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Edge Cases > should handle conversation with only user messages 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Edge Cases > should handle conversation with only gemini messages 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Edge Cases > should handle very long individual messages (>500 chars) 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Edge Cases > should handle messages with special characters 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Edge Cases > should handle malformed message content 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Internationalization Support > should preserve international characters (Chinese) 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Internationalization Support > should preserve international characters (Arabic) 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Internationalization Support > should preserve accented characters 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Internationalization Support > should preserve emojis in summaries 0ms
 âœ“ src/services/sessionSummaryService.test.ts > SessionSummaryService > Internationalization Support > should preserve zero-width characters for language rendering 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > countOccurrences > should return 0 for empty string 1ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > countOccurrences > should return 0 for empty substring 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > countOccurrences > should return 0 if substring is not found 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > countOccurrences > should return 1 if substring is found once 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > countOccurrences > should return correct count for multiple occurrences 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > countOccurrences > should count non-overlapping occurrences 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > countOccurrences > should correctly count occurrences when substring is longer 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > countOccurrences > should be case-sensitive 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > unescapeStringForGeminiBug > should unescape common sequences 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > unescapeStringForGeminiBug > should handle multiple escaped sequences 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > unescapeStringForGeminiBug > should not alter already correct sequences 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > unescapeStringForGeminiBug > should handle mixed correct and incorrect sequences 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > unescapeStringForGeminiBug > should handle backslash followed by actual newline character 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > unescapeStringForGeminiBug > should handle multiple backslashes before an escapable character (aggressive unescaping) 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > unescapeStringForGeminiBug > should return empty string for empty input 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > unescapeStringForGeminiBug > should not alter strings with no targeted escape sequences 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > unescapeStringForGeminiBug > should correctly process strings with some targeted escapes 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > unescapeStringForGeminiBug > should handle complex cases with mixed slashes and characters 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > unescapeStringForGeminiBug > should handle escaped backslashes 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > unescapeStringForGeminiBug > should handle escaped backslashes mixed with other escapes (aggressive unescaping) 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectEdit > Scenario Group 1: originalParams.old_string matches currentContent directly > Test 1.1: old_string (no literal \), new_string (escaped by Gemini) -> new_string unescaped 1ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectEdit > Scenario Group 1: originalParams.old_string matches currentContent directly > Test 1.2: old_string (no literal \), new_string (correctly formatted) -> new_string unchanged 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectEdit > Scenario Group 1: originalParams.old_string matches currentContent directly > Test 1.3: old_string (with literal \), new_string (escaped by Gemini) -> new_string unchanged (still escaped) 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectEdit > Scenario Group 1: originalParams.old_string matches currentContent directly > Test 1.4: old_string (with literal \), new_string (correctly formatted) -> new_string unchanged 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectEdit > Scenario Group 2: originalParams.old_string does NOT match, but unescapeStringForGeminiBug(originalParams.old_string) DOES match > Test 2.1: old_string (over-escaped, no intended literal \), new_string (escaped by Gemini) -> new_string unescaped 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectEdit > Scenario Group 2: originalParams.old_string does NOT match, but unescapeStringForGeminiBug(originalParams.old_string) DOES match > Test 2.2: old_string (over-escaped, no intended literal \), new_string (correctly formatted) -> new_string unescaped (harmlessly) 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectEdit > Scenario Group 2: originalParams.old_string does NOT match, but unescapeStringForGeminiBug(originalParams.old_string) DOES match > Test 2.3: old_string (over-escaped, with intended literal \), new_string (simple) -> new_string corrected 2ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectEdit > Scenario Group 3: LLM Correction Path > Test 3.1: old_string (no literal \), new_string (escaped by Gemini), LLM re-escapes new_string -> final new_string is double unescaped 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectEdit > Scenario Group 3: LLM Correction Path > Test 3.2: old_string (with literal \), new_string (escaped by Gemini), LLM re-escapes new_string -> final new_string is unescaped once 1ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectEdit > Scenario Group 3: LLM Correction Path > Test 3.3: old_string needs LLM, new_string is fine -> old_string corrected, new_string original 1ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectEdit > Scenario Group 3: LLM Correction Path > Test 3.4: LLM correction path, correctNewString returns the originalNewString it was passed (which was unescaped) -> final new_string is unescaped 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectEdit > Scenario Group 4: No Match Found / Multiple Matches > Test 4.1: No version of old_string (original, unescaped, LLM-corrected) matches -> returns original params, 0 occurrences 1ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectEdit > Scenario Group 4: No Match Found / Multiple Matches > Test 4.2: unescapedOldStringAttempt results in >1 occurrences -> returns original params, count occurrences 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectEdit > Scenario Group 5: Specific unescapeStringForGeminiBug checks (integrated into ensureCorrectEdit) > Test 5.1: old_string needs LLM to become currentContent, new_string also needs correction 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectEdit > Scenario Group 6: Concurrent Edits > Test 6.1: should return early if file was modified by another process 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectFileContent > should return content unchanged if no escaping issues detected 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectFileContent > should call correctStringEscaping for potentially escaped content 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectFileContent > should handle correctStringEscaping returning corrected content via correct property name 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectFileContent > should return original content if LLM correction fails 0ms
 âœ“ src/utils/editCorrector.test.ts > editCorrector > ensureCorrectFileContent > should handle various escape sequences that need correction 0ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordTokenUsageMetrics > should record token usage for 'cache' type with 75 tokens for model 'gemini-pro' 357ms
 âœ“ src/utils/summarizer.test.ts > summarizers > summarizeToolOutput > should return original text if it is shorter than maxLength 3ms
 âœ“ src/utils/summarizer.test.ts > summarizers > summarizeToolOutput > should return original text if it is empty 2ms
 âœ“ src/utils/summarizer.test.ts > summarizers > summarizeToolOutput > should call generateContent if text is longer than maxLength 1ms
 âœ“ src/utils/summarizer.test.ts > summarizers > summarizeToolOutput > should return original text if generateContent throws an error 2ms
 âœ“ src/utils/summarizer.test.ts > summarizers > summarizeToolOutput > should construct the correct prompt for summarization 2ms
 âœ“ src/utils/summarizer.test.ts > summarizers > llmSummarizer > should summarize tool output using summarizeToolOutput 5ms
 âœ“ src/utils/summarizer.test.ts > summarizers > llmSummarizer > should handle different llmContent types 3ms
 âœ“ src/utils/summarizer.test.ts > summarizers > defaultSummarizer > should stringify the llmContent 6ms
 âœ“ src/hooks/hookAggregator.test.ts > HookAggregator > aggregateResults > should handle empty results 1ms
 âœ“ src/hooks/hookAggregator.test.ts > HookAggregator > aggregateResults > should aggregate successful results 0ms
 âœ“ src/hooks/hookAggregator.test.ts > HookAggregator > aggregateResults > should handle errors in results 0ms
 âœ“ src/hooks/hookAggregator.test.ts > HookAggregator > aggregateResults > should handle blocking decisions with OR logic 0ms
 âœ“ src/hooks/hookAggregator.test.ts > HookAggregator > aggregateResults > should handle continue=false with precedence 0ms
 âœ“ src/hooks/hookAggregator.test.ts > HookAggregator > BeforeToolSelection merge strategy > should merge tool configurations with NONE mode precedence 0ms
 âœ“ src/hooks/hookAggregator.test.ts > HookAggregator > BeforeToolSelection merge strategy > should merge tool configurations with ANY mode 0ms
 âœ“ src/hooks/hookAggregator.test.ts > HookAggregator > BeforeToolSelection merge strategy > should merge tool configurations with AUTO mode when all are AUTO 0ms
 âœ“ src/hooks/hookAggregator.test.ts > HookAggregator > BeforeModel/AfterModel merge strategy > should use field replacement strategy 0ms
 âœ“ src/hooks/hookAggregator.test.ts > HookAggregator > extractAdditionalContext > should extract additional context from hook outputs 0ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordTokenUsageMetrics > should record token usage for 'tool' type with 125 tokens for model 'gemini-pro' 307ms
 âœ“ src/tools/web-search.test.ts > WebSearchTool > build > should return an invocation for a valid query 14ms
 âœ“ src/tools/web-search.test.ts > WebSearchTool > build > should throw an error for an empty query 1ms
 âœ“ src/tools/web-search.test.ts > WebSearchTool > build > should throw an error for a query with only whitespace 1ms
 âœ“ src/tools/web-search.test.ts > WebSearchTool > getDescription > should return a description of the search 1ms
 âœ“ src/tools/web-search.test.ts > WebSearchTool > execute > should return search results for a successful query 1ms
 âœ“ src/tools/web-search.test.ts > WebSearchTool > execute > should handle no search results found 1ms
 âœ“ src/tools/web-search.test.ts > WebSearchTool > execute > should return a WEB_SEARCH_FAILED error on failure 5ms
 âœ“ src/tools/web-search.test.ts > WebSearchTool > execute > should correctly format results with sources and citations 1ms
 âœ“ src/tools/web-search.test.ts > WebSearchTool > execute > should insert markers at correct byte positions for multibyte text 1ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream with retries > should yield a RETRY event when an invalid stream is encountered 503ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > initialize > should initialize successfully with no hooks 2ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > initialize > should not load hooks if folder is not trusted 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > initialize > should load hooks from project configuration 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > initialize > should load plugin hooks 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > initialize > should handle invalid configuration gracefully 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > initialize > should validate hook configurations 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > initialize > should respect disabled hooks using friendly name 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > getHooksForEvent > should return hooks for specific event 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > getHooksForEvent > should return empty array for events with no hooks 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > setHookEnabled > should enable and disable hooks 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > setHookEnabled > should warn when hook not found 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > setHookEnabled > should prefer hook name over command for identification 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > setHookEnabled > should use command as identifier when name is missing 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > malformed configuration handling > should handle non-array definitions gracefully 1ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > malformed configuration handling > should handle object instead of array for definitions 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > malformed configuration handling > should handle null definition gracefully 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > malformed configuration handling > should handle definition without hooks array 1ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > malformed configuration handling > should handle non-array hooks property 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > malformed configuration handling > should handle non-object hookConfig in hooks array 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > malformed configuration handling > should handle mixed valid and invalid hook configurations 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > project hook warnings > should check for untrusted project hooks when folder is trusted 1ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > project hook warnings > should not warn if hooks are already trusted 0ms
 âœ“ src/hooks/hookRegistry.test.ts > HookRegistry > project hook warnings > should not check for untrusted hooks if folder is not trusted 0ms
 âœ“ src/safety/checker-runner.test.ts > CheckerRunner > should run in-process checker successfully 2ms
 âœ“ src/safety/checker-runner.test.ts > CheckerRunner > should handle in-process checker errors 0ms
 âœ“ src/safety/checker-runner.test.ts > CheckerRunner > should respect timeout for in-process checkers 1ms
 âœ“ src/safety/checker-runner.test.ts > CheckerRunner > should use minimal context when requested 0ms
 âœ“ src/safety/checker-runner.test.ts > CheckerRunner > should pass config to in-process checker via toolCall 1ms
 âœ“ src/safety/checker-runner.test.ts > CheckerRunner > External Checkers > should spawn external checker directly 4ms
 âœ“ src/safety/checker-runner.test.ts > CheckerRunner > External Checkers > should include checker name in timeout error message 0ms
 âœ“ src/safety/checker-runner.test.ts > CheckerRunner > External Checkers > should send SIGKILL if process ignores SIGTERM 0ms
 âœ“ src/safety/checker-runner.test.ts > CheckerRunner > External Checkers > should include checker name in non-zero exit code error message 0ms
 âœ“ src/agents/subagent-tool-wrapper.test.ts > SubagentToolWrapper > constructor > should call convertInputConfigToJsonSchema with the correct agent inputConfig 3ms
 âœ“ src/agents/subagent-tool-wrapper.test.ts > SubagentToolWrapper > constructor > should correctly configure the tool properties from the agent definition 0ms
 âœ“ src/agents/subagent-tool-wrapper.test.ts > SubagentToolWrapper > constructor > should fall back to the agent name for displayName if it is not provided 0ms
 âœ“ src/agents/subagent-tool-wrapper.test.ts > SubagentToolWrapper > constructor > should generate a valid tool schema using the definition and converted schema 0ms
 âœ“ src/agents/subagent-tool-wrapper.test.ts > SubagentToolWrapper > createInvocation > should create a LocalSubagentInvocation with the correct parameters 12ms
 âœ“ src/agents/subagent-tool-wrapper.test.ts > SubagentToolWrapper > createInvocation > should pass the messageBus to the LocalSubagentInvocation constructor 0ms
 âœ“ src/agents/subagent-tool-wrapper.test.ts > SubagentToolWrapper > createInvocation > should throw a validation error for invalid parameters before creating an invocation 1ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > initialize > should log the count of loaded agents in debug mode 3ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > initialize > should use preview flash model for codebase investigator if main model is preview pro 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > initialize > should use preview flash model for codebase investigator if main model is preview auto 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > initialize > should use the model from the investigator settings 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > initialize > should load agents from user and project directories with correct precedence 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > initialize > should NOT load TOML agents when enableAgents is false 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > initialize > should register introspection agent if enabled 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > initialize > should NOT register introspection agent if disabled 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > registration logic > should register a valid agent definition 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > registration logic > should register a remote agent definition 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > registration logic > should log remote agent registration in debug mode 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > registration logic > should handle special characters in agent names 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > registration logic > should reject an agent definition missing a name 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > registration logic > should reject an agent definition missing a description 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > registration logic > should overwrite an existing agent definition 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > registration logic > should log overwrites when in debug mode 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > registration logic > should not log overwrites when not in debug mode 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > registration logic > should handle bulk registrations correctly 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > inheritance and refresh > should resolve "inherit" to the current model from configuration 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > inheritance and refresh > should update inherited models when the main model changes 1ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > accessors > getDefinition should return the correct definition 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > accessors > getDefinition should return undefined for unknown agents 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > accessors > getAllDefinitions should return all registered definitions 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > getToolDescription > should return default message when no agents are registered 0ms
 âœ“ src/agents/registry.test.ts > AgentRegistry > getToolDescription > should return formatted list of agents when agents are available 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > windowsCodePageToEncoding > should map common Windows code pages correctly 1ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > windowsCodePageToEncoding > should return null for unmapped code pages and warn 1ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > windowsCodePageToEncoding > should handle all Windows-specific code pages 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > detectEncodingFromBuffer > should detect encoding using chardet successfully 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > detectEncodingFromBuffer > should handle chardet returning mixed case encoding 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > detectEncodingFromBuffer > should return null when chardet fails 1ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > detectEncodingFromBuffer > should return null when chardet returns null 1ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > detectEncodingFromBuffer > should return null when chardet returns non-string 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Windows > should parse Windows chcp output correctly 1ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Windows > should handle different chcp output formats 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Windows > should handle chcp output with extra whitespace 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Windows > should return null when chcp command fails 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Windows > should return null when chcp output cannot be parsed 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Windows > should return null when code page is not a number 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Windows > should return null when code page maps to null 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Unix-like > should parse locale from LC_ALL environment variable 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Unix-like > should parse locale from LC_CTYPE when LC_ALL is not set 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Unix-like > should parse locale from LANG when LC_ALL and LC_CTYPE are not set 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Unix-like > should handle locale charmap command when environment variables are empty 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Unix-like > should handle locale charmap with mixed case 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Unix-like > should return null when locale charmap fails 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Unix-like > should handle locale without encoding (no dot) 1ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Unix-like > should handle empty locale environment variables 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Unix-like > should return locale as-is when locale format has no dot 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Unix-like > should prioritize LC_ALL over other environment variables 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getSystemEncoding - Unix-like > should prioritize LC_CTYPE over LANG 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getEncodingForBuffer > should use cached system encoding on subsequent calls 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getEncodingForBuffer > should fall back to buffer detection when system encoding fails 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getEncodingForBuffer > should fall back to utf-8 when both system and buffer detection fail 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getEncodingForBuffer > should not cache buffer detection results 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getEncodingForBuffer > should handle Windows system encoding 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > getEncodingForBuffer > should cache null system encoding result 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > Cross-platform behavior > should work correctly on macOS 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > Cross-platform behavior > should work correctly on other Unix-like systems 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > Cross-platform behavior > should handle unknown platforms as Unix-like 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > Edge cases and error handling > should handle empty buffer gracefully 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > Edge cases and error handling > should handle very large buffers 0ms
 âœ“ src/utils/systemEncoding.test.ts > Shell Command Processor - Encoding Functions > Edge cases and error handling > should handle Unicode content 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateJson - Success Scenarios > should call generateContent with correct parameters, defaults, and utilize retry mechanism 3ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateJson - Success Scenarios > should include system instructions when provided 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateJson - Success Scenarios > should use the provided promptId 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateJson - Success Scenarios > should pass maxAttempts to retryWithBackoff when provided 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateJson - Success Scenarios > should call retryWithBackoff without maxAttempts when not provided 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateJson - Content Validation and Retries > should validate content using shouldRetryOnContent function 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateJson - Response Cleaning > should clean JSON wrapped in markdown backticks and log telemetry 1ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateJson - Response Cleaning > should handle extra whitespace correctly without logging malformed telemetry 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateJson - Response Cleaning > should use the resolved model name when logging malformed JSON telemetry 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateJson - Error Handling > should throw and report error for empty response after retry exhaustion 1ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateJson - Error Handling > should throw and report error for invalid JSON syntax after retry exhaustion 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateJson - Error Handling > should throw and report generic API errors 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateJson - Error Handling > should throw immediately without reporting if aborted 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateEmbedding > should call embedContent with correct parameters and return embeddings 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateEmbedding > should return an empty array if an empty array is passed 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateEmbedding > should throw an error if API response has no embeddings array 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateEmbedding > should throw an error if API response has an empty embeddings array 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateEmbedding > should throw an error if API returns a mismatched number of embeddings 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateEmbedding > should throw an error if any embedding has nullish values 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateEmbedding > should throw an error if any embedding has an empty values array 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateEmbedding > should propagate errors from the API call 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateContent > should call generateContent with correct parameters and utilize retry mechanism 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateContent > should validate content using shouldRetryOnContent function 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > generateContent > should throw and report error for empty response after retry exhaustion 0ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > Availability Service Integration > should mark model as healthy on success 1ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > Availability Service Integration > marks the final attempted model healthy after a retry with availability enabled 2ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > Availability Service Integration > should consume sticky attempt if selection has attempts 1ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > Availability Service Integration > should mark healthy and honor availability selection when using generateJson 1ms
 âœ“ src/core/baseLlmClient.test.ts > BaseLlmClient > Availability Service Integration > should refresh configuration when model changes mid-retry 1ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should return the result on the first attempt if successful 2ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should retry and succeed if failures are within maxAttempts 2ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should throw an error if all attempts fail 2ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should default to 3 maxAttempts if no options are provided 2ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should default to 3 maxAttempts if options.maxAttempts is undefined 1ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should not retry if shouldRetry returns false 0ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should throw an error if maxAttempts is not a positive number 0ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should use default shouldRetry if not provided, retrying on ApiError 429 2ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should use default shouldRetry if not provided, not retrying on ApiError 400 0ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should use default shouldRetry if not provided, retrying on generic error with status 429 2ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should use default shouldRetry if not provided, not retrying on generic error with status 400 0ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should respect maxDelayMs 3ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should handle jitter correctly, ensuring varied delays 4ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > Fetch error retries > should retry on 'fetch failed' when retryFetchErrors is true 1ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > Fetch error retries > should retry on common network error codes (ECONNRESET) 2ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > Fetch error retries > should retry on common network error codes in cause (ETIMEDOUT) 1ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > Fetch error retries > should retry on 'fetch failed' when retryFetchErrors is true (short delays) 1ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > Fetch error retries > should not retry on 'fetch failed' when retryFetchErrors is false 0ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > Fetch error retries > should retry on network error code (ETIMEDOUT) even when retryFetchErrors is false 1ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > Flash model fallback for OAuth users > should trigger fallback for OAuth personal users on TerminalQuotaError 2ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > Flash model fallback for OAuth users > should use retryDelayMs from RetryableQuotaError 1ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > Flash model fallback for OAuth users > should invoke onPersistent429 callback (delegating decision) for non-Google auth users (authType: gemini-api-key) on TerminalQuotaError 0ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > Flash model fallback for OAuth users > should invoke onPersistent429 callback (delegating decision) for non-Google auth users (authType: vertex-ai) on TerminalQuotaError 0ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > Flash model fallback for OAuth users > should invoke onPersistent429 callback (delegating decision) for non-Google auth users (authType: undefined) on TerminalQuotaError 0ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should abort the retry loop when the signal is aborted 1ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should trigger fallback for OAuth personal users on persistent 500 errors 1ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > should trigger fallback for OAuth personal users on ModelNotFoundError 1ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > Availability Context Integration > updates availability context per attempt and applies transitions to the correct policy 1ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > Availability Context Integration > marks sticky_retry after retries are exhausted for transient failures 1ms
 âœ“ src/utils/retry.test.ts > retryWithBackoff > Availability Context Integration > maps different failure kinds to correct terminal reasons 0ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordTokenUsageMetrics > should record token usage for 'input' type with 200 tokens for model 'gemini-different-model' 241ms
 âœ“ src/hooks/hookEventHandler.test.ts > HookEventHandler > fireBeforeToolEvent > should fire BeforeTool event with correct input 2ms
 âœ“ src/hooks/hookEventHandler.test.ts > HookEventHandler > fireBeforeToolEvent > should return empty result when no hooks to execute 0ms
 âœ“ src/hooks/hookEventHandler.test.ts > HookEventHandler > fireBeforeToolEvent > should handle execution errors gracefully 0ms
 âœ“ src/hooks/hookEventHandler.test.ts > HookEventHandler > fireBeforeToolEvent > should emit feedback when some hooks fail 1ms
 âœ“ src/hooks/hookEventHandler.test.ts > HookEventHandler > fireAfterToolEvent > should fire AfterTool event with tool response 0ms
 âœ“ src/hooks/hookEventHandler.test.ts > HookEventHandler > fireBeforeAgentEvent > should fire BeforeAgent event with prompt 0ms
 âœ“ src/hooks/hookEventHandler.test.ts > HookEventHandler > fireNotificationEvent > should fire Notification event 0ms
 âœ“ src/hooks/hookEventHandler.test.ts > HookEventHandler > fireSessionStartEvent > should fire SessionStart event with source 0ms
 âœ“ src/hooks/hookEventHandler.test.ts > HookEventHandler > fireBeforeModelEvent > should fire BeforeModel event with LLM request 0ms
 âœ“ src/hooks/hookEventHandler.test.ts > HookEventHandler > createBaseInput > should create base input with correct fields 0ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordLinesChanged metric > should not record lines added/removed if not initialized 304ms
 âœ“ src/prompts/prompt-registry.test.ts > PromptRegistry > should register a prompt 1ms
 âœ“ src/prompts/prompt-registry.test.ts > PromptRegistry > should get all prompts, sorted by name 6ms
 âœ“ src/prompts/prompt-registry.test.ts > PromptRegistry > should get a specific prompt by name 0ms
 âœ“ src/prompts/prompt-registry.test.ts > PromptRegistry > should get prompts by server, sorted by name 0ms
 âœ“ src/prompts/prompt-registry.test.ts > PromptRegistry > should handle prompt name collision by renaming 0ms
 âœ“ src/prompts/prompt-registry.test.ts > PromptRegistry > should clear all prompts 0ms
 âœ“ src/prompts/prompt-registry.test.ts > PromptRegistry > should remove prompts by server 0ms
 âœ“ src/utils/debugLogger.test.ts > DebugLogger > should call console.log with the correct arguments 2ms
 âœ“ src/utils/debugLogger.test.ts > DebugLogger > should call console.warn with the correct arguments 0ms
 âœ“ src/utils/debugLogger.test.ts > DebugLogger > should call console.error with the correct arguments 0ms
 âœ“ src/utils/debugLogger.test.ts > DebugLogger > should call console.debug with the correct arguments 0ms
 âœ“ src/utils/debugLogger.test.ts > DebugLogger > should handle multiple arguments correctly for all methods 0ms
 âœ“ src/utils/debugLogger.test.ts > DebugLogger > should handle calls with no arguments 0ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream with retries > should retry on invalid content, succeed, and report metrics 502ms
 âœ“ src/routing/modelRouterService.test.ts > ModelRouterService > should initialize with a CompositeStrategy 3ms
 âœ“ src/routing/modelRouterService.test.ts > ModelRouterService > should initialize the CompositeStrategy with the correct child strategies in order 2ms
 âœ“ src/routing/modelRouterService.test.ts > ModelRouterService > route() > should delegate routing to the composite strategy 5ms
 âœ“ src/routing/modelRouterService.test.ts > ModelRouterService > route() > should log a telemetry event on a successful decision 2ms
 âœ“ src/routing/modelRouterService.test.ts > ModelRouterService > route() > should log a telemetry event and re-throw on a failed decision 2ms
 âœ“ src/utils/customHeaderUtils.test.ts > parseCustomHeaders > should return an empty object if input is undefined 1ms
 âœ“ src/utils/customHeaderUtils.test.ts > parseCustomHeaders > should return an empty object if input is empty string 0ms
 âœ“ src/utils/customHeaderUtils.test.ts > parseCustomHeaders > should parse a single header correctly 0ms
 âœ“ src/utils/customHeaderUtils.test.ts > parseCustomHeaders > should parse multiple headers separated by commas 0ms
 âœ“ src/utils/customHeaderUtils.test.ts > parseCustomHeaders > should ignore entries without colon 0ms
 âœ“ src/utils/customHeaderUtils.test.ts > parseCustomHeaders > should trim whitespace around names and values 0ms
 âœ“ src/utils/customHeaderUtils.test.ts > parseCustomHeaders > should handle headers with colons in the value 0ms
 âœ“ src/utils/customHeaderUtils.test.ts > parseCustomHeaders > should skip headers with empty name 0ms
 âœ“ src/utils/customHeaderUtils.test.ts > parseCustomHeaders > should skip completely empty entries 0ms
 âœ“ src/utils/customHeaderUtils.test.ts > parseCustomHeaders > should handle Authorization Bearer with different casing 0ms
 âœ“ src/utils/customHeaderUtils.test.ts > parseCustomHeaders > should handle values with commas correctly 0ms
 âœ“ src/utils/secure-browser-launcher.test.ts > secure-browser-launcher > URL validation > should allow valid HTTP URLs 2ms
 âœ“ src/utils/secure-browser-launcher.test.ts > secure-browser-launcher > URL validation > should allow valid HTTPS URLs 0ms
 âœ“ src/utils/secure-browser-launcher.test.ts > secure-browser-launcher > URL validation > should reject non-HTTP(S) protocols 1ms
 âœ“ src/utils/secure-browser-launcher.test.ts > secure-browser-launcher > URL validation > should reject invalid URLs 0ms
 âœ“ src/utils/secure-browser-launcher.test.ts > secure-browser-launcher > URL validation > should reject URLs with control characters 0ms
 âœ“ src/utils/secure-browser-launcher.test.ts > secure-browser-launcher > Command injection prevention > should prevent PowerShell command injection on Windows 0ms
 âœ“ src/utils/secure-browser-launcher.test.ts > secure-browser-launcher > Command injection prevention > should handle URLs with special shell characters safely 1ms
 âœ“ src/utils/secure-browser-launcher.test.ts > secure-browser-launcher > Command injection prevention > should properly escape single quotes in URLs on Windows 0ms
 âœ“ src/utils/secure-browser-launcher.test.ts > secure-browser-launcher > Platform-specific behavior > should use correct command on macOS 0ms
 âœ“ src/utils/secure-browser-launcher.test.ts > secure-browser-launcher > Platform-specific behavior > should use PowerShell on Windows 0ms
 âœ“ src/utils/secure-browser-launcher.test.ts > secure-browser-launcher > Platform-specific behavior > should use xdg-open on Linux 0ms
 âœ“ src/utils/secure-browser-launcher.test.ts > secure-browser-launcher > Platform-specific behavior > should throw on unsupported platforms 0ms
 âœ“ src/utils/secure-browser-launcher.test.ts > secure-browser-launcher > Error handling > should handle browser launch failures gracefully 0ms
 âœ“ src/utils/secure-browser-launcher.test.ts > secure-browser-launcher > Error handling > should try fallback browsers on Linux 0ms
 âœ“ src/services/chatRecordingService.test.ts > ChatRecordingService > initialize > should create a new session if none is provided 2ms
 âœ“ src/services/chatRecordingService.test.ts > ChatRecordingService > initialize > should resume from an existing session if provided 2ms
 âœ“ src/services/chatRecordingService.test.ts > ChatRecordingService > recordMessage > should record a new message 1ms
 âœ“ src/services/chatRecordingService.test.ts > ChatRecordingService > recordMessage > should create separate messages when recording multiple messages 0ms
 âœ“ src/services/chatRecordingService.test.ts > ChatRecordingService > recordThought > should queue a thought 0ms
 âœ“ src/services/chatRecordingService.test.ts > ChatRecordingService > recordMessageTokens > should update the last message with token info 0ms
 âœ“ src/services/chatRecordingService.test.ts > ChatRecordingService > recordMessageTokens > should queue token info if the last message already has tokens 0ms
 âœ“ src/services/chatRecordingService.test.ts > ChatRecordingService > recordToolCalls > should add new tool calls to the last message 0ms
 âœ“ src/services/chatRecordingService.test.ts > ChatRecordingService > recordToolCalls > should create a new message if the last message is not from gemini 0ms
 âœ“ src/services/chatRecordingService.test.ts > ChatRecordingService > deleteSession > should delete the session file 0ms
 âœ“ src/utils/filesearch/crawlCache.test.ts > CrawlCache > getCacheKey > should generate a consistent hash 1ms
 âœ“ src/utils/filesearch/crawlCache.test.ts > CrawlCache > getCacheKey > should generate a different hash for different directories 0ms
 âœ“ src/utils/filesearch/crawlCache.test.ts > CrawlCache > getCacheKey > should generate a different hash for different ignore content 0ms
 âœ“ src/utils/filesearch/crawlCache.test.ts > CrawlCache > getCacheKey > should generate a different hash for different maxDepth values 0ms
 âœ“ src/utils/filesearch/crawlCache.test.ts > CrawlCache > in-memory cache operations > should write and read data from the cache 0ms
 âœ“ src/utils/filesearch/crawlCache.test.ts > CrawlCache > in-memory cache operations > should return undefined for a nonexistent key 0ms
 âœ“ src/utils/filesearch/crawlCache.test.ts > CrawlCache > in-memory cache operations > should clear the cache 0ms
 âœ“ src/utils/filesearch/crawlCache.test.ts > CrawlCache > in-memory cache operations > should automatically evict a cache entry after its TTL expires 2ms
 âœ“ src/utils/filesearch/crawlCache.test.ts > CrawlCache > in-memory cache operations > should reset the timer when an entry is updated 1ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordLinesChanged metric > should record lines added with function_name after initialization 304ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > buildWellKnownUrls > should build standard root-based URLs by default 1ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > buildWellKnownUrls > should build path-based URLs when includePathSuffix is true 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > buildWellKnownUrls > should handle root path correctly 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > buildWellKnownUrls > should handle trailing slash in path 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > fetchProtectedResourceMetadata > should fetch protected resource metadata successfully 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > fetchProtectedResourceMetadata > should return null when fetch fails 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > fetchAuthorizationServerMetadata > should fetch authorization server metadata successfully 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > fetchAuthorizationServerMetadata > should return null when fetch fails 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > discoverAuthorizationServerMetadata > should handle URLs without path components correctly 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > discoverAuthorizationServerMetadata > should handle URLs with path components correctly 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > discoverOAuthConfig > should succeed when resource metadata matches server URL 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > discoverOAuthConfig > should throw error when resource metadata does not match server URL 1ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > metadataToOAuthConfig > should convert metadata to OAuth config 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > metadataToOAuthConfig > should handle empty scopes 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > parseWWWAuthenticateHeader > should parse resource metadata URI from WWW-Authenticate header 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > parseWWWAuthenticateHeader > should return null when no resource metadata URI is found 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > extractBaseUrl > should extract base URL from MCP server URL 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > extractBaseUrl > should handle URLs with ports 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > isSSEEndpoint > should return true for SSE endpoints 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > isSSEEndpoint > should return true for non-MCP endpoints 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > isSSEEndpoint > should return false for MCP endpoints 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > buildResourceParameter > should build resource parameter from endpoint URL 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > buildResourceParameter > should handle URLs with ports 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > buildResourceParameter > should strip query parameters from the URL 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > buildResourceParameter > should strip URL fragments from the URL 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > buildResourceParameter > should throw an error for invalid URLs 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > parseTokenExpiry > should return the expiry time in milliseconds for a valid token 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > parseTokenExpiry > should return undefined for a token without an expiry time 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > parseTokenExpiry > should return undefined for a token with an invalid expiry time 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > parseTokenExpiry > should return undefined for a malformed token 0ms
 âœ“ src/mcp/oauth-utils.test.ts > OAuthUtils > parseTokenExpiry > should return undefined for a token with invalid JSON in payload 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > should have correct initial metrics 1ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > should emit an update event when an event is added 1ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > API Response Event Processing > should process a single ApiResponseEvent 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > API Response Event Processing > should aggregate multiple ApiResponseEvents for the same model 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > API Response Event Processing > should handle ApiResponseEvents for different models 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > API Error Event Processing > should process a single ApiErrorEvent 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > API Error Event Processing > should aggregate ApiErrorEvents and ApiResponseEvents 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > Tool Call Event Processing > should process a single successful ToolCallEvent 1ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > Tool Call Event Processing > should process a single failed ToolCallEvent 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > Tool Call Event Processing > should process a ToolCallEvent with modify decision 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > Tool Call Event Processing > should process a ToolCallEvent without a decision 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > Tool Call Event Processing > should aggregate multiple ToolCallEvents for the same tool 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > Tool Call Event Processing > should handle ToolCallEvents for different tools 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > resetLastPromptTokenCount > should reset the last prompt token count to 0 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > resetLastPromptTokenCount > should emit an update event when resetLastPromptTokenCount is called 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > resetLastPromptTokenCount > should not affect other metrics when resetLastPromptTokenCount is called 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > resetLastPromptTokenCount > should work correctly when called multiple times 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > Tool Call Event with Line Count Metadata > should aggregate valid line count metadata 0ms
 âœ“ src/telemetry/uiTelemetry.test.ts > UiTelemetryService > Tool Call Event with Line Count Metadata > should ignore null/undefined values in line count metadata 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > getAllCredentials > should return empty map when token file does not exist 3ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > getAllCredentials > should load tokens from file successfully 1ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > getAllCredentials > should handle corrupted token file gracefully 1ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > getAllCredentials > should handle file read errors other than ENOENT 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > saveToken > should save token with restricted permissions 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > saveToken > should update existing token for same server 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > saveToken > should handle write errors gracefully 1ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > getCredentials > should return token for existing server 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > getCredentials > should return null for non-existent server 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > getCredentials > should return null when no tokens file exists 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > deleteCredentials > should remove token for specific server 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > deleteCredentials > should remove token file when no tokens remain 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > deleteCredentials > should handle removal of non-existent token gracefully 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > deleteCredentials > should handle file operation errors gracefully 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > isTokenExpired > should return false for token without expiry 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > isTokenExpired > should return false for valid token 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > isTokenExpired > should return true for expired token 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > isTokenExpired > should return true for token expiring within buffer time 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > clearAll > should remove token file successfully 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > clearAll > should handle non-existent file gracefully 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag false > clearAll > should handle other file errors gracefully 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag true > should use HybridTokenStorage to list all credentials 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag true > should use HybridTokenStorage to list servers 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag true > should use HybridTokenStorage to set credentials 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag true > should use HybridTokenStorage to save a token 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag true > should use HybridTokenStorage to get credentials 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag true > should use HybridTokenStorage to delete credentials 0ms
 âœ“ src/mcp/oauth-token-storage.test.ts > MCPOAuthTokenStorage > with encrypted flag true > should use HybridTokenStorage to clear all tokens 0ms
 âœ“ src/utils/flashFallback.test.ts > Retry Utility Fallback Integration > should execute the injected FallbackHandler contract correctly 2ms
 âœ“ src/utils/flashFallback.test.ts > Retry Utility Fallback Integration > should trigger onPersistent429 on TerminalQuotaError for OAuth users 2ms
 âœ“ src/utils/flashFallback.test.ts > Retry Utility Fallback Integration > should not trigger onPersistent429 for API key users 1ms
 âœ“ src/utils/flashFallback.test.ts > Retry Utility Fallback Integration > should properly disable simulation state after fallback (Test Utility) 0ms
 âœ“ src/policy/policy-updater.test.ts > createPolicyUpdater > should add multiple rules when commandPrefix is an array 2ms
 âœ“ src/policy/policy-updater.test.ts > createPolicyUpdater > should add a single rule when commandPrefix is a string 1ms
 âœ“ src/policy/policy-updater.test.ts > createPolicyUpdater > should persist multiple rules correctly to TOML 4ms
 âœ“ src/policy/policy-updater.test.ts > ShellToolInvocation Policy Update > should extract multiple root commands for chained commands 0ms
 âœ“ src/policy/policy-updater.test.ts > ShellToolInvocation Policy Update > should extract a single root command 0ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > should enforce the singleton pattern 1ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > loadAgent > should create and cache an A2AClient 3ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > loadAgent > should throw an error if an agent with the same name is already loaded 1ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > loadAgent > should use native fetch by default 0ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > loadAgent > should use provided custom authentication handler 1ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > loadAgent > should log a debug message upon loading an agent 0ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > sendMessage > should send a message to the correct agent 1ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > sendMessage > should use contextId and taskId when provided 0ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > sendMessage > should return result from client 0ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > sendMessage > should throw prefixed error on failure 0ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > sendMessage > should throw an error if the agent is not found 0ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > getTask > should get a task from the correct agent 0ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > getTask > should throw prefixed error on failure 0ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > getTask > should throw an error if the agent is not found 0ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > cancelTask > should cancel a task on the correct agent 0ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > cancelTask > should throw prefixed error on failure 0ms
 âœ“ src/agents/a2a-client-manager.test.ts > A2AClientManager > cancelTask > should throw an error if the agent is not found 0ms
 âœ“ src/routing/strategies/classifierStrategy.test.ts > ClassifierStrategy > should call generateJson with the correct parameters 3ms
 âœ“ src/routing/strategies/classifierStrategy.test.ts > ClassifierStrategy > should route to FLASH model for a simple task 2ms
 âœ“ src/routing/strategies/classifierStrategy.test.ts > ClassifierStrategy > should route to PRO model for a complex task 0ms
 âœ“ src/routing/strategies/classifierStrategy.test.ts > ClassifierStrategy > should return null if the classifier API call fails 0ms
 âœ“ src/routing/strategies/classifierStrategy.test.ts > ClassifierStrategy > should return null if the classifier returns a malformed JSON object 0ms
 âœ“ src/routing/strategies/classifierStrategy.test.ts > ClassifierStrategy > should filter out tool-related history before sending to classifier 0ms
 âœ“ src/routing/strategies/classifierStrategy.test.ts > ClassifierStrategy > should respect HISTORY_SEARCH_WINDOW and HISTORY_TURNS_FOR_CONTEXT 0ms
 âœ“ src/routing/strategies/classifierStrategy.test.ts > ClassifierStrategy > should use a fallback promptId if not found in context 0ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream with retries > should set temperature to 1 on retry 504ms
 âœ“ src/utils/pathCorrector.test.ts > pathCorrector > should correct a relative path if it is unambiguous in the target dir 2ms
 âœ“ src/utils/pathCorrector.test.ts > pathCorrector > should correct a partial relative path if it is unambiguous in another workspace dir 2ms
 âœ“ src/utils/pathCorrector.test.ts > pathCorrector > should return an error for a relative path that does not exist 4ms
 âœ“ src/utils/pathCorrector.test.ts > pathCorrector > should return an error for an ambiguous path 1ms
 âœ“ src/utils/channel.test.ts > channel > isStable > should return true for a stable version 1ms
 âœ“ src/utils/channel.test.ts > channel > isStable > should return false for a nightly version 0ms
 âœ“ src/utils/channel.test.ts > channel > isStable > should return false for a preview version 0ms
 âœ“ src/utils/channel.test.ts > channel > isStable > should return false if package.json is not found 0ms
 âœ“ src/utils/channel.test.ts > channel > isStable > should return false if version is not defined 0ms
 âœ“ src/utils/channel.test.ts > channel > isNightly > should return false for a stable version 0ms
 âœ“ src/utils/channel.test.ts > channel > isNightly > should return true for a nightly version 0ms
 âœ“ src/utils/channel.test.ts > channel > isNightly > should return false for a preview version 0ms
 âœ“ src/utils/channel.test.ts > channel > isNightly > should return true if package.json is not found 0ms
 âœ“ src/utils/channel.test.ts > channel > isNightly > should return true if version is not defined 0ms
 âœ“ src/utils/channel.test.ts > channel > isPreview > should return false for a stable version 0ms
 âœ“ src/utils/channel.test.ts > channel > isPreview > should return false for a nightly version 0ms
 âœ“ src/utils/channel.test.ts > channel > isPreview > should return true for a preview version 0ms
 âœ“ src/utils/channel.test.ts > channel > isPreview > should return false if package.json is not found 0ms
 âœ“ src/utils/channel.test.ts > channel > isPreview > should return false if version is not defined 0ms
 âœ“ src/utils/channel.test.ts > channel > getReleaseChannel > should return STABLE for a stable version 0ms
 âœ“ src/utils/channel.test.ts > channel > getReleaseChannel > should return NIGHTLY for a nightly version 0ms
 âœ“ src/utils/channel.test.ts > channel > getReleaseChannel > should return PREVIEW for a preview version 1ms
 âœ“ src/utils/channel.test.ts > channel > getReleaseChannel > should return NIGHTLY if package.json is not found 0ms
 âœ“ src/utils/channel.test.ts > channel > getReleaseChannel > should return NIGHTLY if version is not defined 0ms
 âœ“ src/utils/channel.test.ts > channel > memoization > should only call getPackageJson once for the same cwd 0ms
 âœ“ src/utils/channel.test.ts > channel > memoization > should call getPackageJson again for a different cwd 0ms
 âœ“ src/hooks/trustedHooks.test.ts > TrustedHooksManager > initialization > should load existing trusted hooks 2ms
 âœ“ src/hooks/trustedHooks.test.ts > TrustedHooksManager > initialization > should handle missing config file 1ms
 âœ“ src/hooks/trustedHooks.test.ts > TrustedHooksManager > getUntrustedHooks > should return names of untrusted hooks 0ms
 âœ“ src/hooks/trustedHooks.test.ts > TrustedHooksManager > getUntrustedHooks > should use command if name is missing 0ms
 âœ“ src/hooks/trustedHooks.test.ts > TrustedHooksManager > getUntrustedHooks > should detect change in command as untrusted 0ms
 âœ“ src/hooks/trustedHooks.test.ts > TrustedHooksManager > persistence > should save to file when trusting hooks 1ms
 âœ“ src/hooks/trustedHooks.test.ts > TrustedHooksManager > persistence > should create directory if missing on save 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > formatEvent > should format init event as JSONL 1ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > formatEvent > should format user message event 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > formatEvent > should format assistant message event with delta 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > formatEvent > should format tool_use event 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > formatEvent > should format tool_result event (success) 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > formatEvent > should format tool_result event (error) 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > formatEvent > should format error event 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > formatEvent > should format result event with success status 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > formatEvent > should format result event with error status 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > formatEvent > should produce minified JSON without pretty-printing 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > emitEvent > should write formatted event to stdout 1ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > emitEvent > should emit multiple events sequentially 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > convertToStreamStats > should aggregate token counts from single model 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > convertToStreamStats > should aggregate token counts from multiple models 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > convertToStreamStats > should aggregate cached token counts correctly 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > convertToStreamStats > should handle empty metrics 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > convertToStreamStats > should use session-level tool calls count 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > convertToStreamStats > should pass through duration unchanged 0ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > JSON validity > should produce valid JSON for all event types 1ms
 âœ“ src/output/stream-json-formatter.test.ts > StreamJsonFormatter > JSON validity > should preserve field types 0ms
 âœ“ src/hooks/hookTranslator.test.ts > HookTranslator > defaultHookTranslator > should be an instance of HookTranslatorGenAIv1 1ms
 âœ“ src/hooks/hookTranslator.test.ts > HookTranslator > LLM Request Translation > should convert SDK request to hook format 0ms
 âœ“ src/hooks/hookTranslator.test.ts > HookTranslator > LLM Request Translation > should handle string contents 0ms
 âœ“ src/hooks/hookTranslator.test.ts > HookTranslator > LLM Request Translation > should handle conversion errors gracefully 0ms
 âœ“ src/hooks/hookTranslator.test.ts > HookTranslator > LLM Request Translation > should convert hook request back to SDK format 0ms
 âœ“ src/hooks/hookTranslator.test.ts > HookTranslator > LLM Response Translation > should convert SDK response to hook format 0ms
 âœ“ src/hooks/hookTranslator.test.ts > HookTranslator > LLM Response Translation > should convert hook response back to SDK format 0ms
 âœ“ src/hooks/hookTranslator.test.ts > HookTranslator > Tool Config Translation > should convert SDK tool config to hook format 0ms
 âœ“ src/hooks/hookTranslator.test.ts > HookTranslator > Tool Config Translation > should convert hook tool config back to SDK format 0ms
 âœ“ src/hooks/hookTranslator.test.ts > HookTranslator > Tool Config Translation > should handle undefined tool config 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > getInstance > should return a singleton instance 1ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > start > should create a performance mark for a phase 1ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > start > should record start time with details 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > start > should return undefined when starting a phase that is already active 1ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > end > should create a performance measure for a started phase 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > end > should merge details when ending a phase 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > end > should overwrite details with same key 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > flush > should call recordStartupPerformance for each completed phase 1ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > flush > should not record phases without duration 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > flush > should include common details in all metrics 1ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > flush > should merge phase-specific details with common details 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > flush > should clear phases after flushing 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > flush > should detect Docker environment 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > flush > should calculate CPU usage correctly 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > flush > should use debug logging instead of standard logging 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > integration scenarios > should handle a complete startup profiling workflow 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > integration scenarios > should handle nested timing correctly 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > sanity checking > should return undefined when starting a phase that is already active 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > sanity checking > should allow restarting a phase after it has ended 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > sanity checking > should not throw error when ending a phase that is already ended 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > sanity checking > should not record metrics for incomplete phases 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > sanity checking > should handle mix of complete and incomplete phases 0ms
 âœ“ src/telemetry/startupProfiler.test.ts > StartupProfiler > sanity checking > should log startup stats event 0ms
 âœ“ src/telemetry/telemetry.test.ts > telemetry > should initialize the telemetry service 5ms
 âœ“ src/telemetry/telemetry.test.ts > telemetry > should shutdown the telemetry service 2ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordLinesChanged metric > should record lines removed with function_name after initialization 277ms
 âœ“ src/core/openaiCompatibleContentGenerator.test.ts > OpenAICompatibleContentGenerator > should generate content successfully 3ms
 âœ“ src/core/openaiCompatibleContentGenerator.test.ts > OpenAICompatibleContentGenerator > should handle API errors 1ms
 âœ“ src/core/openaiCompatibleContentGenerator.test.ts > OpenAICompatibleContentGenerator > should generate content stream successfully 1ms
 âœ“ src/core/openaiCompatibleContentGenerator.test.ts > OpenAICompatibleContentGenerator > should return 0 tokens for countTokens 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > createIdeContextStore > should return undefined initially for ide context 1ms
 âœ“ src/ide/ideContext.test.ts > ideContext > createIdeContextStore > should set and retrieve the ide context 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > createIdeContextStore > should update the ide context when called multiple times 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > createIdeContextStore > should handle empty string for file path 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > createIdeContextStore > should notify subscribers when ide context changes 1ms
 âœ“ src/ide/ideContext.test.ts > ideContext > createIdeContextStore > should stop notifying a subscriber after unsubscribe 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > createIdeContextStore > should clear the ide context 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > createIdeContextStore > should set the context and notify subscribers when no workspaceState is present 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > createIdeContextStore > should handle an empty openFiles array 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > createIdeContextStore > should sort openFiles by timestamp in descending order 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > createIdeContextStore > should mark only the most recent file as active and clear other active files 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > createIdeContextStore > should truncate selectedText if it exceeds the max length 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > createIdeContextStore > should not truncate selectedText if it is within the max length 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > createIdeContextStore > should truncate the openFiles list if it exceeds the max length 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > FileSchema > should validate a file with only required fields 1ms
 âœ“ src/ide/ideContext.test.ts > ideContext > FileSchema > should validate a file with all fields 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > FileSchema > should fail validation if path is missing 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > FileSchema > should fail validation if timestamp is missing 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > IdeContextSchema > should validate an empty context 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > IdeContextSchema > should validate a context with an empty workspaceState 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > IdeContextSchema > should validate a context with an empty openFiles array 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > IdeContextSchema > should validate a context with a valid file 0ms
 âœ“ src/ide/ideContext.test.ts > ideContext > IdeContextSchema > should fail validation with an invalid file 0ms
 âœ“ src/hooks/types.test.ts > Hook Types > HookEventName > should contain all required event names 1ms
 âœ“ src/hooks/types.test.ts > Hook Types > HookType > should contain command type 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > createHookOutput > should return DefaultHookOutput for unknown event names 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > createHookOutput > should return BeforeModelHookOutput for BeforeModel event 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > createHookOutput > should return AfterModelHookOutput for AfterModel event 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > createHookOutput > should return BeforeToolSelectionHookOutput for BeforeToolSelection event 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > createHookOutput > should return BeforeToolHookOutput for BeforeTool event 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > DefaultHookOutput > should construct with provided data 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > DefaultHookOutput > should return false for isBlockingDecision if decision is not block or deny 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > DefaultHookOutput > should return true for isBlockingDecision if decision is block or deny 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > DefaultHookOutput > should return true for shouldStopExecution if continue is false 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > DefaultHookOutput > should return false for shouldStopExecution if continue is true or undefined 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > DefaultHookOutput > should return reason if available 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > DefaultHookOutput > should return stopReason if reason is not available 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > DefaultHookOutput > should return "No reason provided" if neither reason nor stopReason are available 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > DefaultHookOutput > applyLLMRequestModifications should return target unchanged 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > DefaultHookOutput > applyToolConfigModifications should return target unchanged 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > DefaultHookOutput > getAdditionalContext should return additionalContext if present 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > DefaultHookOutput > getAdditionalContext should return undefined if additionalContext is not present 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > DefaultHookOutput > getAdditionalContext should return undefined if hookSpecificOutput is undefined 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > DefaultHookOutput > getBlockingError should return blocked: true and reason if blocking decision 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > DefaultHookOutput > getBlockingError should return blocked: false if not blocking decision 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > BeforeModelHookOutput > getSyntheticResponse should return synthetic response if llm_response is present 1ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > BeforeModelHookOutput > getSyntheticResponse should return undefined if llm_response is not present 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > BeforeModelHookOutput > applyLLMRequestModifications should apply modifications if llm_request is present 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > BeforeModelHookOutput > applyLLMRequestModifications should return target unchanged if llm_request is not present 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > BeforeToolSelectionHookOutput > applyToolConfigModifications should apply modifications if toolConfig is present 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > BeforeToolSelectionHookOutput > applyToolConfigModifications should return target unchanged if toolConfig is not present 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > BeforeToolSelectionHookOutput > applyToolConfigModifications should initialize tools array if not present 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > AfterModelHookOutput > getModifiedResponse should return modified response if llm_response is present and has content 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > AfterModelHookOutput > getModifiedResponse should return undefined if llm_response is present but no content 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > AfterModelHookOutput > getModifiedResponse should return undefined if llm_response is not present 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > AfterModelHookOutput > getModifiedResponse should return a synthetic stop response if shouldStopExecution is true 0ms
 âœ“ src/hooks/types.test.ts > Hook Output Classes > AfterModelHookOutput > getModifiedResponse should return a synthetic stop response with default reason if shouldStopExecution is true and no stopReason 0ms
 âœ“ src/core/loggingContentGenerator.test.ts > LoggingContentGenerator > generateContent > should log request and response on success 4ms
 âœ“ src/core/loggingContentGenerator.test.ts > LoggingContentGenerator > generateContent > should log error on failure 1ms
 âœ“ src/core/loggingContentGenerator.test.ts > LoggingContentGenerator > generateContentStream > should log request and response on success 0ms
 âœ“ src/core/loggingContentGenerator.test.ts > LoggingContentGenerator > generateContentStream > should log error on failure 0ms
 âœ“ src/core/loggingContentGenerator.test.ts > LoggingContentGenerator > getWrapped > should return the wrapped content generator 0ms
 âœ“ src/core/loggingContentGenerator.test.ts > LoggingContentGenerator > countTokens > should call the wrapped countTokens method 0ms
 âœ“ src/core/loggingContentGenerator.test.ts > LoggingContentGenerator > embedContent > should call the wrapped embedContent method 0ms
 âœ“ src/services/sessionSummaryUtils.test.ts > sessionSummaryUtils > getPreviousSession > should return null if chats directory does not exist 3ms
 âœ“ src/services/sessionSummaryUtils.test.ts > sessionSummaryUtils > getPreviousSession > should return null if no session files exist 0ms
 âœ“ src/services/sessionSummaryUtils.test.ts > sessionSummaryUtils > getPreviousSession > should return null if most recent session already has summary 0ms
 âœ“ src/services/sessionSummaryUtils.test.ts > sessionSummaryUtils > getPreviousSession > should return null if most recent session has 1 or fewer user messages 0ms
 âœ“ src/services/sessionSummaryUtils.test.ts > sessionSummaryUtils > getPreviousSession > should return path if most recent session has more than 1 user message and no summary 0ms
 âœ“ src/services/sessionSummaryUtils.test.ts > sessionSummaryUtils > getPreviousSession > should select most recently created session by filename 0ms
 âœ“ src/services/sessionSummaryUtils.test.ts > sessionSummaryUtils > getPreviousSession > should return null if most recent session file is corrupted 0ms
 âœ“ src/services/sessionSummaryUtils.test.ts > sessionSummaryUtils > generateSummary > should not throw if getPreviousSession returns null 1ms
 âœ“ src/services/sessionSummaryUtils.test.ts > sessionSummaryUtils > generateSummary > should generate and save summary for session needing one 2ms
 âœ“ src/services/sessionSummaryUtils.test.ts > sessionSummaryUtils > generateSummary > should handle errors gracefully without throwing 0ms
 âœ“ src/tools/mcp-client-manager.test.ts > McpClientManager > should discover tools from all configured 2ms
 âœ“ src/tools/mcp-client-manager.test.ts > McpClientManager > should not discover tools if folder is not trusted 0ms
 âœ“ src/tools/mcp-client-manager.test.ts > McpClientManager > should not start blocked servers 0ms
 âœ“ src/tools/mcp-client-manager.test.ts > McpClientManager > should only start allowed servers if allow list is not empty 0ms
 âœ“ src/tools/mcp-client-manager.test.ts > McpClientManager > should start servers from extensions 1ms
 âœ“ src/tools/mcp-client-manager.test.ts > McpClientManager > should not start servers from disabled extensions 0ms
 âœ“ src/tools/mcp-client-manager.test.ts > McpClientManager > should add blocked servers to the blockedMcpServers list 1ms
 âœ“ src/tools/mcp-client-manager.test.ts > McpClientManager > restart > should restart all running servers 0ms
 âœ“ src/tools/mcp-client-manager.test.ts > McpClientManager > restartServer > should restart the specified server 0ms
 âœ“ src/tools/mcp-client-manager.test.ts > McpClientManager > restartServer > should throw an error if the server does not exist 1ms
 âœ“ src/tools/mcp-client-manager.test.ts > McpClientManager > getMcpInstructions > should not return instructions for servers that do not have instructions 0ms
 âœ“ src/tools/mcp-client-manager.test.ts > McpClientManager > Promise rejection handling > should handle errors thrown during client initialization 0ms
 âœ“ src/tools/mcp-client-manager.test.ts > McpClientManager > Promise rejection handling > should handle errors thrown in the async IIFE before try block 0ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream with retries > should fail after all retries on persistent invalid content and report metrics 505ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream with retries > API error retry behavior > should not retry on 400 Bad Request errors 2ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream with retries > API error retry behavior > should retry on 429 Rate Limit errors 1ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream with retries > API error retry behavior > should retry on 5xx server errors 1ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > sendMessageStream with retries > API error retry behavior > should retry on specific fetch errors when configured 1ms
 âœ“ src/core/apiKeyCredentialStorage.test.ts > ApiKeyCredentialStorage > should load an API key 2ms
 âœ“ src/core/apiKeyCredentialStorage.test.ts > ApiKeyCredentialStorage > should return null if no API key is stored 0ms
 âœ“ src/core/apiKeyCredentialStorage.test.ts > ApiKeyCredentialStorage > should save an API key 1ms
 âœ“ src/core/apiKeyCredentialStorage.test.ts > ApiKeyCredentialStorage > should clear an API key when saving empty key 0ms
 âœ“ src/core/apiKeyCredentialStorage.test.ts > ApiKeyCredentialStorage > should clear an API key when saving null key 0ms
 âœ“ src/core/apiKeyCredentialStorage.test.ts > ApiKeyCredentialStorage > should clear an API key 0ms
 âœ“ src/core/apiKeyCredentialStorage.test.ts > ApiKeyCredentialStorage > should not throw when clearing an API key fails 3ms
 âœ“ src/ide/ide-installer.test.ts > ide-installer > getIdeInstaller > returns a VsCodeInstaller for "'vscode'" 2ms
 âœ“ src/ide/ide-installer.test.ts > ide-installer > getIdeInstaller > returns a VsCodeInstaller for "'firebasestudio'" 0ms
 âœ“ src/ide/ide-installer.test.ts > ide-installer > getIdeInstaller > returns an AntigravityInstaller for "antigravity" 0ms
 âœ“ src/ide/ide-installer.test.ts > ide-installer > VsCodeInstaller > install > identifies the path to code cli on platform: 'win32' 1ms
 âœ“ src/ide/ide-installer.test.ts > ide-installer > VsCodeInstaller > install > identifies the path to code cli on platform: 'darwin' 0ms
 âœ“ src/ide/ide-installer.test.ts > ide-installer > VsCodeInstaller > install > identifies the path to code cli on platform: 'linux' 0ms
 âœ“ src/ide/ide-installer.test.ts > ide-installer > VsCodeInstaller > install > installs the extension using code cli 1ms
 âœ“ src/ide/ide-installer.test.ts > ide-installer > VsCodeInstaller > install > installs the extension using code cli on windows 0ms
 âœ“ src/ide/ide-installer.test.ts > ide-installer > VsCodeInstaller > install > returns that the cli was installed successfully 0ms
 âœ“ src/ide/ide-installer.test.ts > ide-installer > VsCodeInstaller > install > returns that the cli was installed successfully 0ms
 âœ“ src/ide/ide-installer.test.ts > ide-installer > VsCodeInstaller > install > should return a failure message if { name: 'vscode', â€¦(1) } is not installed 0ms
 âœ“ src/ide/ide-installer.test.ts > ide-installer > VsCodeInstaller > install > should return a failure message if { name: 'firebasestudio', â€¦(1) } is not installed 0ms
 âœ“ src/ide/ide-installer.test.ts > AntigravityInstaller > installs the extension using the alias 0ms
 âœ“ src/ide/ide-installer.test.ts > AntigravityInstaller > returns a failure message if the alias is not set 0ms
 âœ“ src/ide/ide-installer.test.ts > AntigravityInstaller > returns a failure message if the command is not found 0ms
 âœ“ src/mcp/token-storage/hybrid-token-storage.test.ts > HybridTokenStorage > storage selection > should use keychain when available 3ms
 âœ“ src/mcp/token-storage/hybrid-token-storage.test.ts > HybridTokenStorage > storage selection > should use file storage when GEMINI_FORCE_FILE_STORAGE is set 0ms
 âœ“ src/mcp/token-storage/hybrid-token-storage.test.ts > HybridTokenStorage > storage selection > should fall back to file storage when keychain is unavailable 0ms
 âœ“ src/mcp/token-storage/hybrid-token-storage.test.ts > HybridTokenStorage > storage selection > should fall back to file storage when keychain throws error 0ms
 âœ“ src/mcp/token-storage/hybrid-token-storage.test.ts > HybridTokenStorage > storage selection > should cache storage selection 0ms
 âœ“ src/mcp/token-storage/hybrid-token-storage.test.ts > HybridTokenStorage > getCredentials > should delegate to selected storage 0ms
 âœ“ src/mcp/token-storage/hybrid-token-storage.test.ts > HybridTokenStorage > setCredentials > should delegate to selected storage 0ms
 âœ“ src/mcp/token-storage/hybrid-token-storage.test.ts > HybridTokenStorage > deleteCredentials > should delegate to selected storage 0ms
 âœ“ src/mcp/token-storage/hybrid-token-storage.test.ts > HybridTokenStorage > listServers > should delegate to selected storage 0ms
 âœ“ src/mcp/token-storage/hybrid-token-storage.test.ts > HybridTokenStorage > getAllCredentials > should delegate to selected storage 0ms
 âœ“ src/mcp/token-storage/hybrid-token-storage.test.ts > HybridTokenStorage > clearAll > should delegate to selected storage 0ms
 âœ“ src/utils/checkpointUtils.test.ts > checkpoint utils > getToolCallDataSchema > should return a schema that validates a basic tool call data object 1ms
 âœ“ src/utils/checkpointUtils.test.ts > checkpoint utils > getToolCallDataSchema > should validate with an optional history schema 0ms
 âœ“ src/utils/checkpointUtils.test.ts > checkpoint utils > getToolCallDataSchema > should fail validation if history items do not match the schema 0ms
 âœ“ src/utils/checkpointUtils.test.ts > checkpoint utils > getToolCallDataSchema > should validate clientHistory with the correct schema 0ms
 âœ“ src/utils/checkpointUtils.test.ts > checkpoint utils > generateCheckpointFileName > should generate a filename with timestamp, basename, and tool name 1ms
 âœ“ src/utils/checkpointUtils.test.ts > checkpoint utils > generateCheckpointFileName > should return null if file_path is not in the tool arguments 0ms
 âœ“ src/utils/checkpointUtils.test.ts > checkpoint utils > formatCheckpointDisplayList and getTruncatedCheckpointNames > getTruncatedCheckpointNames should remove the .json extension 0ms
 âœ“ src/utils/checkpointUtils.test.ts > checkpoint utils > formatCheckpointDisplayList and getTruncatedCheckpointNames > formatCheckpointDisplayList should return a newline-separated string of truncated names 0ms
 âœ“ src/utils/checkpointUtils.test.ts > checkpoint utils > processRestorableToolCalls > should create checkpoints for restorable tool calls 1ms
 âœ“ src/utils/checkpointUtils.test.ts > checkpoint utils > processRestorableToolCalls > should handle git snapshot failure by using current commit hash 0ms
 âœ“ src/utils/checkpointUtils.test.ts > checkpoint utils > processRestorableToolCalls > should skip tool calls with no file_path 0ms
 âœ“ src/utils/checkpointUtils.test.ts > checkpoint utils > processRestorableToolCalls > should log an error if git snapshot fails and then skip the tool call 0ms
 âœ“ src/utils/checkpointUtils.test.ts > checkpoint utils > getCheckpointInfoList > should parse valid checkpoint files and return a list of info 0ms
 âœ“ src/utils/checkpointUtils.test.ts > checkpoint utils > getCheckpointInfoList > should ignore files with invalid JSON 0ms
 âœ“ src/utils/checkpointUtils.test.ts > checkpoint utils > getCheckpointInfoList > should ignore files that are missing a messageId 0ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordFileOperationMetric > 'should not record metrics if not initâ€¦' 353ms
 âœ“ src/utils/googleErrors.test.ts > parseGoogleApiError > should return null for non-gaxios errors 1ms
 âœ“ src/utils/googleErrors.test.ts > parseGoogleApiError > should parse a standard gaxios error 1ms
 âœ“ src/utils/googleErrors.test.ts > parseGoogleApiError > should parse an error with details stringified in the message 0ms
 âœ“ src/utils/googleErrors.test.ts > parseGoogleApiError > should return null if details are not in the expected format 0ms
 âœ“ src/utils/googleErrors.test.ts > parseGoogleApiError > should return null if there are no valid details 0ms
 âœ“ src/utils/googleErrors.test.ts > parseGoogleApiError > should parse a doubly nested error in the message 0ms
 âœ“ src/utils/googleErrors.test.ts > parseGoogleApiError > should parse an error that is not in a response object 0ms
 âœ“ src/utils/googleErrors.test.ts > parseGoogleApiError > should parse an error that is a JSON string 0ms
 âœ“ src/utils/googleErrors.test.ts > parseGoogleApiError > should parse the user-provided nested error string 0ms
 âœ“ src/utils/googleErrors.test.ts > parseGoogleApiError > should parse an error that is an array 0ms
 âœ“ src/utils/googleErrors.test.ts > parseGoogleApiError > should parse a gaxios error where data is an array 0ms
 âœ“ src/utils/googleErrors.test.ts > parseGoogleApiError > should parse a gaxios error where data is a stringified array 0ms
 âœ“ src/utils/googleErrors.test.ts > parseGoogleApiError > should parse an error with a malformed @type key (returned by Gemini API) 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > constructor > should initialize with default interval 1ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > constructor > should initialize with custom interval 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > constructor > should throw on negative interval 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > shouldRecord > should allow first recording 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > shouldRecord > should block immediate subsequent recordings 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > shouldRecord > should allow recording after interval 1ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > shouldRecord > should handle different metric keys independently 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > shouldRecord > should use shorter interval for high priority events 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > shouldRecord > should still block high priority events if interval not met 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > forceRecord > should update last record time 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > forceRecord > should block subsequent recordings after force record 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > getTimeUntilNextAllowed > should return 0 for new metric 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > getTimeUntilNextAllowed > should return correct time after recording 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > getTimeUntilNextAllowed > should return 0 after interval has passed 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > getTimeUntilNextAllowed > should account for high priority interval 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > getStats > should return empty stats initially 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > getStats > should return correct stats after recordings 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > getStats > should handle single recording correctly 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > reset > should clear all rate limiting state 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > cleanup > should remove old entries 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > cleanup > should preserve recent entries 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > cleanup > should use default cleanup age 0ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > edge cases > should handle zero interval 1ms
 âœ“ src/telemetry/rate-limiter.test.ts > RateLimiter > edge cases > should handle very large intervals 0ms
 âœ“ src/agents/local-invocation.test.ts > LocalSubagentInvocation > should pass the messageBus to the parent constructor 2ms
 âœ“ src/agents/local-invocation.test.ts > LocalSubagentInvocation > getDescription > should format the description with inputs 0ms
 âœ“ src/agents/local-invocation.test.ts > LocalSubagentInvocation > getDescription > should truncate long input values 0ms
 âœ“ src/agents/local-invocation.test.ts > LocalSubagentInvocation > getDescription > should truncate the overall description if it exceeds the limit 0ms
 âœ“ src/agents/local-invocation.test.ts > LocalSubagentInvocation > execute > should initialize and run the executor successfully 2ms
 âœ“ src/agents/local-invocation.test.ts > LocalSubagentInvocation > execute > should stream THOUGHT_CHUNK activities from the executor 0ms
 âœ“ src/agents/local-invocation.test.ts > LocalSubagentInvocation > execute > should NOT stream other activities (e.g., TOOL_CALL_START, ERROR) 0ms
 âœ“ src/agents/local-invocation.test.ts > LocalSubagentInvocation > execute > should run successfully without an updateOutput callback 0ms
 âœ“ src/agents/local-invocation.test.ts > LocalSubagentInvocation > execute > should handle executor run failure 0ms
 âœ“ src/agents/local-invocation.test.ts > LocalSubagentInvocation > execute > should handle executor creation failure 0ms
 âœ“ src/agents/local-invocation.test.ts > LocalSubagentInvocation > execute > should handle abortion signal during execution 0ms
 âœ“ src/ide/detect-ide.test.ts > detectIde > should return undefined if TERM_PROGRAM is not vscode 1ms
 âœ“ src/ide/detect-ide.test.ts > detectIde > should detect Devin 0ms
 âœ“ src/ide/detect-ide.test.ts > detectIde > should detect Replit 0ms
 âœ“ src/ide/detect-ide.test.ts > detectIde > should detect Cursor 0ms
 âœ“ src/ide/detect-ide.test.ts > detectIde > should detect Codespaces 0ms
 âœ“ src/ide/detect-ide.test.ts > detectIde > should detect Cloud Shell via EDITOR_IN_CLOUD_SHELL 0ms
 âœ“ src/ide/detect-ide.test.ts > detectIde > should detect Cloud Shell via CLOUD_SHELL 0ms
 âœ“ src/ide/detect-ide.test.ts > detectIde > should detect Trae 0ms
 âœ“ src/ide/detect-ide.test.ts > detectIde > should detect Firebase Studio via MONOSPACE_ENV 0ms
 âœ“ src/ide/detect-ide.test.ts > detectIde > should detect VSCode when no other IDE is detected and command includes "code" 0ms
 âœ“ src/ide/detect-ide.test.ts > detectIde > should detect VSCodeFork when no other IDE is detected and command does not include "code" 0ms
 âœ“ src/ide/detect-ide.test.ts > detectIde > should detect AntiGravity 0ms
 âœ“ src/ide/detect-ide.test.ts > detectIde with ideInfoFromFile > should use the name and displayName from the file 0ms
 âœ“ src/ide/detect-ide.test.ts > detectIde with ideInfoFromFile > should fall back to env detection if name is missing 0ms
 âœ“ src/ide/detect-ide.test.ts > detectIde with ideInfoFromFile > should fall back to env detection if displayName is missing 0ms
 âœ“ src/tools/base-tool-invocation.test.ts > BaseToolInvocation > should propagate serverName to ToolConfirmationRequest 3ms
 âœ“ src/tools/base-tool-invocation.test.ts > BaseToolInvocation > should NOT propagate serverName if not provided 2ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordFileOperationMetric > 'should record file creation with all â€¦' 364ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > convertToFunctionResponse > should handle simple string llmContent 1ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > convertToFunctionResponse > should handle llmContent as a single Part with text 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > convertToFunctionResponse > should handle llmContent as a PartListUnion array with a single text Part 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > convertToFunctionResponse > should handle llmContent as a PartListUnion array with multiple Parts 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > convertToFunctionResponse > should handle llmContent with fileData for Gemini 3 model (should be siblings) 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > convertToFunctionResponse > should handle llmContent with inlineData for Gemini 3 model (should be nested) 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > convertToFunctionResponse > should handle llmContent with fileData for non-Gemini 3 models 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > convertToFunctionResponse > should preserve existing functionResponse metadata 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > convertToFunctionResponse > should handle llmContent as an array of multiple Parts (text and inlineData) 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > convertToFunctionResponse > should handle llmContent as an array with a single inlineData Part 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > convertToFunctionResponse > should handle llmContent as a generic Part (not text, inlineData, or fileData) 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > convertToFunctionResponse > should handle empty string llmContent 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > convertToFunctionResponse > should handle llmContent as an empty array 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > convertToFunctionResponse > should handle llmContent as a Part with undefined inlineData/fileData/text 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getCitations > should return empty array for no candidates 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getCitations > should return empty array if no citationMetadata 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getCitations > should return citations with title and uri 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getCitations > should return citations with uri only if no title 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getCitations > should filter out citations without uri 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getResponseTextFromParts > should return undefined for no parts 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getResponseTextFromParts > should extract text from a single text part 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getResponseTextFromParts > should concatenate text from multiple text parts 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getResponseTextFromParts > should ignore function call parts 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getResponseTextFromParts > should return undefined if only function call parts exist 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCalls > should return undefined for no candidates 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCalls > should return undefined for empty candidates array 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCalls > should return undefined for no parts 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCalls > should extract a single function call 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCalls > should extract multiple function calls 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCalls > should ignore text parts 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCalls > should return undefined if only text parts exist 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCallsFromParts > should return undefined for no parts 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCallsFromParts > should extract a single function call 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCallsFromParts > should extract multiple function calls 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCallsFromParts > should ignore text parts 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCallsFromParts > should return undefined if only text parts exist 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCallsAsJson > should return JSON string of function calls 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCallsAsJson > should return undefined if no function calls 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCallsFromPartsAsJson > should return JSON string of function calls from parts 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getFunctionCallsFromPartsAsJson > should return undefined if no function calls in parts 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getStructuredResponse > should return only text if only text exists 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getStructuredResponse > should return only function call JSON if only function calls exist 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getStructuredResponse > should return text and function call JSON if both exist 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getStructuredResponse > should return undefined if neither text nor function calls exist 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getStructuredResponseFromParts > should return only text if only text exists in parts 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getStructuredResponseFromParts > should return only function call JSON if only function calls exist in parts 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getStructuredResponseFromParts > should return text and function call JSON if both exist in parts 0ms
 âœ“ src/utils/generateContentResponseUtilities.test.ts > generateContentResponseUtilities > getStructuredResponseFromParts > should return undefined if neither text nor function calls exist in parts 0ms
 âœ“ src/utils/ignorePatterns.test.ts > FileExclusions > getCoreIgnorePatterns > should return basic ignore patterns 1ms
 âœ“ src/utils/ignorePatterns.test.ts > FileExclusions > getDefaultExcludePatterns > should return comprehensive patterns by default 0ms
 âœ“ src/utils/ignorePatterns.test.ts > FileExclusions > getDefaultExcludePatterns > should respect includeDefaults option 0ms
 âœ“ src/utils/ignorePatterns.test.ts > FileExclusions > getDefaultExcludePatterns > should include custom patterns 0ms
 âœ“ src/utils/ignorePatterns.test.ts > FileExclusions > getDefaultExcludePatterns > should include runtime patterns 0ms
 âœ“ src/utils/ignorePatterns.test.ts > FileExclusions > getDefaultExcludePatterns > should respect includeDynamicPatterns option 0ms
 âœ“ src/utils/ignorePatterns.test.ts > FileExclusions > getReadManyFilesExcludes > should provide legacy compatibility 0ms
 âœ“ src/utils/ignorePatterns.test.ts > FileExclusions > getGlobExcludes > should return core patterns for glob operations 0ms
 âœ“ src/utils/ignorePatterns.test.ts > FileExclusions > getGlobExcludes > should include additional excludes 0ms
 âœ“ src/utils/ignorePatterns.test.ts > FileExclusions > with Config > should use config custom excludes when available 0ms
 âœ“ src/utils/ignorePatterns.test.ts > FileExclusions > with Config > should handle config without getCustomExcludes method 0ms
 âœ“ src/utils/ignorePatterns.test.ts > FileExclusions > with Config > should include config custom excludes in glob patterns 0ms
 âœ“ src/utils/ignorePatterns.test.ts > FileExclusions > buildExcludePatterns > should be an alias for getDefaultExcludePatterns 0ms
 âœ“ src/utils/ignorePatterns.test.ts > BINARY_EXTENSIONS > should include common binary file extensions 0ms
 âœ“ src/utils/ignorePatterns.test.ts > BINARY_EXTENSIONS > should include additional binary extensions 0ms
 âœ“ src/utils/ignorePatterns.test.ts > BINARY_EXTENSIONS > should include media file extensions 0ms
 âœ“ src/utils/ignorePatterns.test.ts > BINARY_EXTENSIONS > should be sorted 0ms
 âœ“ src/utils/ignorePatterns.test.ts > BINARY_EXTENSIONS > should not contain invalid extensions from brace patterns 0ms
 âœ“ src/utils/ignorePatterns.test.ts > extractExtensionsFromPatterns > should extract simple extensions 0ms
 âœ“ src/utils/ignorePatterns.test.ts > extractExtensionsFromPatterns > should extract compound extensions 0ms
 âœ“ src/utils/ignorePatterns.test.ts > extractExtensionsFromPatterns > should extract dotfiles 0ms
 âœ“ src/utils/ignorePatterns.test.ts > extractExtensionsFromPatterns > should handle brace expansion patterns 0ms
 âœ“ src/utils/ignorePatterns.test.ts > extractExtensionsFromPatterns > should combine simple and brace expansion patterns 0ms
 âœ“ src/utils/ignorePatterns.test.ts > extractExtensionsFromPatterns > should handle empty brace expansion 0ms
 âœ“ src/utils/ignorePatterns.test.ts > extractExtensionsFromPatterns > should ignore invalid patterns 0ms
 âœ“ src/utils/ignorePatterns.test.ts > extractExtensionsFromPatterns > should remove duplicates and sort results 0ms
 âœ“ src/utils/ignorePatterns.test.ts > extractExtensionsFromPatterns > should handle complex brace patterns with multiple extensions 0ms
 âœ“ src/utils/ignorePatterns.test.ts > extractExtensionsFromPatterns > should handle edge cases with path.extname 0ms
 âœ“ src/routing/strategies/compositeStrategy.test.ts > CompositeStrategy > should try strategies in order and return the first successful decision 2ms
 âœ“ src/routing/strategies/compositeStrategy.test.ts > CompositeStrategy > should fall back to the terminal strategy if no other strategy provides a decision 0ms
 âœ“ src/routing/strategies/compositeStrategy.test.ts > CompositeStrategy > should handle errors in non-terminal strategies and continue 1ms
 âœ“ src/routing/strategies/compositeStrategy.test.ts > CompositeStrategy > should re-throw an error from the terminal strategy 0ms
 âœ“ src/routing/strategies/compositeStrategy.test.ts > CompositeStrategy > should correctly finalize the decision metadata 0ms
 âœ“ src/routing/strategies/compositeStrategy.test.ts > CompositeStrategy > should calculate total latency if child latency is not provided 0ms
 âœ“ src/confirmation-bus/message-bus.test.ts > MessageBus > publish > should emit error for invalid message 3ms
 âœ“ src/confirmation-bus/message-bus.test.ts > MessageBus > publish > should validate tool confirmation requests have correlationId 0ms
 âœ“ src/confirmation-bus/message-bus.test.ts > MessageBus > publish > should emit confirmation response when policy allows 1ms
 âœ“ src/confirmation-bus/message-bus.test.ts > MessageBus > publish > should emit rejection and response when policy denies 0ms
 âœ“ src/confirmation-bus/message-bus.test.ts > MessageBus > publish > should pass through to UI when policy says ASK_USER 0ms
 âœ“ src/confirmation-bus/message-bus.test.ts > MessageBus > publish > should emit other message types directly 0ms
 âœ“ src/confirmation-bus/message-bus.test.ts > MessageBus > subscribe/unsubscribe > should allow subscribing to specific message types 0ms
 âœ“ src/confirmation-bus/message-bus.test.ts > MessageBus > subscribe/unsubscribe > should allow unsubscribing from message types 0ms
 âœ“ src/confirmation-bus/message-bus.test.ts > MessageBus > subscribe/unsubscribe > should support multiple subscribers for the same message type 0ms
 âœ“ src/confirmation-bus/message-bus.test.ts > MessageBus > error handling > should not crash on errors during message processing 1ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (default behavior) > should return empty string for undefined or null 1ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (default behavior) > should return string input unchanged 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (default behavior) > should concatenate strings from an array 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (default behavior) > should return text property when provided a text part 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (default behavior) > should return empty string for non-text parts 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (verbose) > should return empty string for undefined or null 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (verbose) > should return string input unchanged 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (verbose) > should join parts if the value is an array 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (verbose) > should return the text property if the part is an object with text 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (verbose) > should return descriptive string for videoMetadata part 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (verbose) > should return descriptive string for thought part 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (verbose) > should return descriptive string for codeExecutionResult part 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (verbose) > should return descriptive string for executableCode part 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (verbose) > should return descriptive string for fileData part 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (verbose) > should return descriptive string for functionCall part 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (verbose) > should return descriptive string for functionResponse part 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (verbose) > should return descriptive string for inlineData part 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (verbose) > should return an empty string for an unknown part type 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > partToString (verbose) > should handle complex nested arrays with various part types 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > getResponseText > should return null when no candidates exist 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > getResponseText > should return concatenated text from first candidate 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > getResponseText > should ignore parts without text 2ms
 âœ“ src/utils/partUtils.test.ts > partUtils > getResponseText > should return null when candidate has no parts 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > getResponseText > should return null if the first candidate has no content property 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > flatMapTextParts > should return an empty array for empty input 1ms
 âœ“ src/utils/partUtils.test.ts > partUtils > flatMapTextParts > should transform a simple string input 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > flatMapTextParts > should transform a single text part object 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > flatMapTextParts > should transform an array of text parts and flatten the result 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > flatMapTextParts > should pass through non-text parts unmodified 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > flatMapTextParts > should handle a mix of text and non-text parts in an array 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > flatMapTextParts > should handle a transform that returns an empty array 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > appendToLastTextPart > should append to an empty prompt 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > appendToLastTextPart > should append to a prompt with a string as the last part 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > appendToLastTextPart > should append to a prompt with a text part object as the last part 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > appendToLastTextPart > should append a new text part if the last part is not a text part 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > appendToLastTextPart > should not append anything if the text to append is empty 0ms
 âœ“ src/utils/partUtils.test.ts > partUtils > appendToLastTextPart > should use a custom separator 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape spaces 1ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape tabs 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape parentheses 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape square brackets 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape curly braces 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape semicolons 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape ampersands 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape pipes 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape asterisks 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape question marks 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape dollar signs 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape backticks 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape single quotes 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape double quotes 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape hash symbols 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape exclamation marks 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape tildes 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should escape less than and greater than signs 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should handle multiple special characters 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should not double-escape already escaped characters 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should handle escaped backslashes correctly 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should handle complex escaped backslash scenarios 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should handle paths without special characters 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should handle complex real-world examples 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should handle empty strings 0ms
 âœ“ src/utils/paths.test.ts > escapePath > should handle paths with only special characters 0ms
 âœ“ src/utils/paths.test.ts > unescapePath > should unescape spaces 0ms
 âœ“ src/utils/paths.test.ts > unescapePath > should unescape tabs 0ms
 âœ“ src/utils/paths.test.ts > unescapePath > should unescape parentheses 0ms
 âœ“ src/utils/paths.test.ts > unescapePath > should unescape square brackets 0ms
 âœ“ src/utils/paths.test.ts > unescapePath > should unescape curly braces 0ms
 âœ“ src/utils/paths.test.ts > unescapePath > should unescape multiple special characters 0ms
 âœ“ src/utils/paths.test.ts > unescapePath > should handle paths without escaped characters 0ms
 âœ“ src/utils/paths.test.ts > unescapePath > should handle all special characters 0ms
 âœ“ src/utils/paths.test.ts > unescapePath > should be the inverse of escapePath 0ms
 âœ“ src/utils/paths.test.ts > unescapePath > should handle empty strings 0ms
 âœ“ src/utils/paths.test.ts > unescapePath > should not affect backslashes not followed by special characters 0ms
 âœ“ src/utils/paths.test.ts > unescapePath > should handle escaped backslashes in unescaping 0ms
 âœ“ src/utils/paths.test.ts > isSubpath > should return true for a direct subpath 0ms
 âœ“ src/utils/paths.test.ts > isSubpath > should return true for the same path 0ms
 âœ“ src/utils/paths.test.ts > isSubpath > should return false for a parent path 0ms
 âœ“ src/utils/paths.test.ts > isSubpath > should return false for a completely different path 0ms
 âœ“ src/utils/paths.test.ts > isSubpath > should handle relative paths 0ms
 âœ“ src/utils/paths.test.ts > isSubpath > should handle paths with .. 0ms
 âœ“ src/utils/paths.test.ts > isSubpath > should handle root paths 0ms
 âœ“ src/utils/paths.test.ts > isSubpath > should handle trailing slashes 0ms
 âœ“ src/utils/paths.test.ts > isSubpath on Windows > should return true for a direct subpath on Windows 0ms
 âœ“ src/utils/paths.test.ts > isSubpath on Windows > should return true for the same path on Windows 0ms
 âœ“ src/utils/paths.test.ts > isSubpath on Windows > should return false for a parent path on Windows 0ms
 âœ“ src/utils/paths.test.ts > isSubpath on Windows > should return false for a different drive on Windows 0ms
 âœ“ src/utils/paths.test.ts > isSubpath on Windows > should be case-insensitive for drive letters on Windows 0ms
 âœ“ src/utils/paths.test.ts > isSubpath on Windows > should be case-insensitive for path components on Windows 0ms
 âœ“ src/utils/paths.test.ts > isSubpath on Windows > should handle mixed slashes on Windows 0ms
 âœ“ src/utils/paths.test.ts > isSubpath on Windows > should handle trailing slashes on Windows 0ms
 âœ“ src/utils/paths.test.ts > isSubpath on Windows > should handle relative paths correctly on Windows 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should not shorten a path that is shorter than maxLen 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should not shorten a path that is equal to maxLen 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should shorten a long path, keeping start and end from a short limit 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should shorten a long path, keeping more from the end from a longer limit 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should handle deep paths where few segments from the end fit 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should handle deep paths where many segments from the end fit 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should handle a long filename in the root when it needs shortening 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should handle root path 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should handle a path with one long segment after root 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should handle a path with just a long filename (no root) 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should fallback to truncating earlier segments while keeping the last intact 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should fallback by truncating start and middle segments when needed 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should show only the last segment when maxLen is tiny 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should fall back to simple truncation when the last segment exceeds maxLen 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should handle relative paths without a root 0ms
 âœ“ src/utils/paths.test.ts > shortenPath > on POSIX > should ignore empty segments created by repeated separators 0ms
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should not shorten a path that is shorter than maxLen
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should not shorten a path that is equal to maxLen
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should shorten a long path, keeping start and end from a short limit
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should shorten a long path, keeping more from the end from a longer limit
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should handle deep paths where few segments from the end fit
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should handle deep paths where many segments from the end fit
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should handle a long filename in the root when it needs shortening
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should handle root path
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should handle a path with one long segment after root
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should handle a path with just a long filename (no root)
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should fallback to truncating earlier segments while keeping the last intact
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should fallback by truncating start and middle segments when needed
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should show only the last segment for tiny maxLen values
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should keep the drive prefix when space allows
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should fall back when the last segment exceeds maxLen on Windows
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should handle UNC paths with limited space
 â†“ src/utils/paths.test.ts > shortenPath > on Windows > should collapse UNC paths further when maxLen shrinks
 âœ“ src/telemetry/activity-detector.test.ts > ActivityDetector > constructor > should initialize with default idle threshold 1ms
 âœ“ src/telemetry/activity-detector.test.ts > ActivityDetector > constructor > should initialize with custom idle threshold 0ms
 âœ“ src/telemetry/activity-detector.test.ts > ActivityDetector > recordActivity > should update last activity time 1ms
 âœ“ src/telemetry/activity-detector.test.ts > ActivityDetector > isUserActive > should return true immediately after construction 0ms
 âœ“ src/telemetry/activity-detector.test.ts > ActivityDetector > isUserActive > should return true within idle threshold 0ms
 âœ“ src/telemetry/activity-detector.test.ts > ActivityDetector > isUserActive > should return false after idle threshold 0ms
 âœ“ src/telemetry/activity-detector.test.ts > ActivityDetector > isUserActive > should return true again after recording new activity 0ms
 âœ“ src/telemetry/activity-detector.test.ts > ActivityDetector > getTimeSinceLastActivity > should return time elapsed since last activity 0ms
 âœ“ src/telemetry/activity-detector.test.ts > ActivityDetector > getLastActivityTime > should return the timestamp of last activity 0ms
 âœ“ src/telemetry/activity-detector.test.ts > Global Activity Detector Functions > global instance > should expose a global ActivityDetector via getActivityDetector 0ms
 âœ“ src/telemetry/activity-detector.test.ts > Global Activity Detector Functions > getActivityDetector > should always return the global instance 0ms
 âœ“ src/telemetry/activity-detector.test.ts > Global Activity Detector Functions > recordUserActivity > should record activity on existing detector 0ms
 âœ“ src/telemetry/activity-detector.test.ts > Global Activity Detector Functions > isUserActive > should reflect global detector state 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return original error if not a Google API error 2ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return RetryableQuotaError when message contains "Please retry in Xs" 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return RetryableQuotaError when error is a string and message contains "Please retry in Xms" 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return original error if code is not 429 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return TerminalQuotaError for daily quota violations in QuotaFailure 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return TerminalQuotaError for daily quota violations in ErrorInfo 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return TerminalQuotaError for long retry delays 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return RetryableQuotaError for short retry delays 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return RetryableQuotaError for per-minute quota violations in QuotaFailure 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return RetryableQuotaError for per-minute quota violations in ErrorInfo 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return RetryableQuotaError for another short retry delay 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return RetryableQuotaError for Cloud Code RATE_LIMIT_EXCEEDED with retry delay 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return TerminalQuotaError for Cloud Code QUOTA_EXHAUSTED 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should prioritize daily limit over retry info 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return RetryableQuotaError for any 429 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should classify nested JSON string 404 error as ModelNotFoundError 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should fallback to string parsing for retry delays when details array is empty 1ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return RetryableQuotaError without delay time for generic 429 without specific message 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return RetryableQuotaError without delay time for 429 with empty details and no regex match 0ms
 âœ“ src/utils/googleQuotaErrors.test.ts > classifyGoogleError > should return RetryableQuotaError without delay time for 429 with some detail 0ms
 âœ“ src/safety/context-builder.test.ts > ContextBuilder > should build full context with all fields 1ms
 âœ“ src/safety/context-builder.test.ts > ContextBuilder > should build minimal context with only required keys 0ms
 âœ“ src/safety/context-builder.test.ts > ContextBuilder > should handle missing history 0ms
 âœ“ src/ide/process-utils.test.ts > getIdeProcessInfo > on Unix > should traverse up to find the shell and return grandparent process info 1ms
 âœ“ src/ide/process-utils.test.ts > getIdeProcessInfo > on Unix > should return parent process info if grandparent lookup fails 0ms
 âœ“ src/ide/process-utils.test.ts > getIdeProcessInfo > on Windows > should traverse up and find the great-grandchild of the root process 1ms
 âœ“ src/ide/process-utils.test.ts > getIdeProcessInfo > on Windows > should handle short process chains 0ms
 âœ“ src/ide/process-utils.test.ts > getIdeProcessInfo > on Windows > should handle PowerShell failure gracefully 0ms
 âœ“ src/ide/process-utils.test.ts > getIdeProcessInfo > on Windows > should handle malformed JSON output gracefully 0ms
 âœ“ src/ide/process-utils.test.ts > getIdeProcessInfo > on Windows > should handle single process output from ConvertTo-Json 0ms
 âœ“ src/ide/process-utils.test.ts > getIdeProcessInfo > on Windows > should handle missing process in map during traversal 0ms
 âœ“ src/hooks/hookPlanner.test.ts > HookPlanner > createExecutionPlan > should return empty plan when no hooks registered 1ms
 âœ“ src/hooks/hookPlanner.test.ts > HookPlanner > createExecutionPlan > should create plan for hooks without matchers 1ms
 âœ“ src/hooks/hookPlanner.test.ts > HookPlanner > createExecutionPlan > should filter hooks by tool name matcher 0ms
 âœ“ src/hooks/hookPlanner.test.ts > HookPlanner > createExecutionPlan > should filter hooks by regex matcher 0ms
 âœ“ src/hooks/hookPlanner.test.ts > HookPlanner > createExecutionPlan > should handle wildcard matcher 0ms
 âœ“ src/hooks/hookPlanner.test.ts > HookPlanner > createExecutionPlan > should handle empty string matcher 0ms
 âœ“ src/hooks/hookPlanner.test.ts > HookPlanner > createExecutionPlan > should handle invalid regex matcher gracefully 0ms
 âœ“ src/hooks/hookPlanner.test.ts > HookPlanner > createExecutionPlan > should deduplicate identical hooks 1ms
 âœ“ src/hooks/hookPlanner.test.ts > HookPlanner > createExecutionPlan > should deduplicate based on both name and command 1ms
 âœ“ src/hooks/hookPlanner.test.ts > HookPlanner > createExecutionPlan > should match trigger for session events 0ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > should correctly retry and append to an existing history mid-conversation 503ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > constructor > should initialize with default values 1ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > constructor > should initialize with custom values 0ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > constructor > should throw on negative threshold 2ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > shouldRecordMetric > should return true for first measurement 0ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > shouldRecordMetric > should return false for small increases 0ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > shouldRecordMetric > should return true for significant increases 0ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > shouldRecordMetric > should handle decreasing values correctly 0ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > shouldRecordMetric > should update high-water mark when threshold exceeded 0ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > shouldRecordMetric > should handle multiple metric types independently 0ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > smoothing functionality > should reduce noise from garbage collection spikes 0ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > smoothing functionality > should eventually respond to sustained growth 0ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > getHighWaterMark > should return 0 for unknown metric types 0ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > getHighWaterMark > should return correct value for known metric types 0ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > getAllHighWaterMarks > should return empty object initially 0ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > getAllHighWaterMarks > should return all recorded marks 0ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > resetHighWaterMark > should reset specific metric type 0ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > resetAllHighWaterMarks > should reset all metrics 0ms
 âœ“ src/telemetry/high-water-mark-tracker.test.ts > HighWaterMarkTracker > time-based cleanup > should clean up old readings 1ms
 âœ“ src/telemetry/activity-monitor.test.ts > ActivityMonitor > constructor > should initialize with default config 1ms
 âœ“ src/telemetry/activity-monitor.test.ts > ActivityMonitor > constructor > should initialize with custom config 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > ActivityMonitor > start and stop > should start and stop monitoring 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > ActivityMonitor > start and stop > should not start monitoring when already active 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > ActivityMonitor > recordActivity > should record activity events 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > ActivityMonitor > recordActivity > should include metadata in activity events 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > ActivityMonitor > recordActivity > should not record activity when monitoring is disabled 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > ActivityMonitor > recordActivity > should limit event buffer size 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > ActivityMonitor > listeners > should notify listeners of activity events 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > ActivityMonitor > listeners > should remove listeners correctly 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > ActivityMonitor > listeners > should handle listener errors gracefully 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > ActivityMonitor > getActivityStats > should return correct activity statistics 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > ActivityMonitor > getActivityStats > should return null time range for empty buffer 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > ActivityMonitor > updateConfig > should update configuration correctly 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > Global activity monitoring functions > initializeActivityMonitor > should create global monitor instance 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > Global activity monitoring functions > initializeActivityMonitor > should return same instance on subsequent calls 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > Global activity monitoring functions > recordGlobalActivity > should record activity through global monitor 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > Global activity monitoring functions > recordGlobalActivity > should handle missing global monitor gracefully 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > Global activity monitoring functions > startGlobalActivityMonitoring > should start global monitoring with default config 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > Global activity monitoring functions > startGlobalActivityMonitoring > should start global monitoring with custom config 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > Global activity monitoring functions > stopGlobalActivityMonitoring > should stop global monitoring 0ms
 âœ“ src/telemetry/activity-monitor.test.ts > Global activity monitoring functions > stopGlobalActivityMonitoring > should handle missing global monitor gracefully 0ms
 âœ“ src/utils/llm-edit-fixer.test.ts > FixLLMEditWithInstruction > should use the promptId from the AsyncLocalStorage context when available 3ms
 âœ“ src/utils/llm-edit-fixer.test.ts > FixLLMEditWithInstruction > should generate and use a fallback promptId when context is not available 0ms
 âœ“ src/utils/llm-edit-fixer.test.ts > FixLLMEditWithInstruction > should construct the user prompt correctly 0ms
 âœ“ src/utils/llm-edit-fixer.test.ts > FixLLMEditWithInstruction > should return a cached result on subsequent identical calls 0ms
 âœ“ src/utils/llm-edit-fixer.test.ts > FixLLMEditWithInstruction > should not use cache for calls with different parameters 0ms
 âœ“ src/utils/llm-edit-fixer.test.ts > FixLLMEditWithInstruction > cache collision prevention > should prevent cache collisions when parameters contain separator sequences 0ms
 âœ“ src/utils/llm-edit-fixer.test.ts > FixLLMEditWithInstruction > cache collision prevention > should handle YAML frontmatter without cache collisions 0ms
 âœ“ src/utils/llm-edit-fixer.test.ts > FixLLMEditWithInstruction > should return null if the LLM call times out 1ms
 âœ“ src/commands/restore.test.ts > performRestore > should yield load_history if history and clientHistory are present 1ms
 âœ“ src/commands/restore.test.ts > performRestore > should call restoreProjectFromSnapshot and yield a message if commitHash and gitService are present 1ms
 âœ“ src/commands/restore.test.ts > performRestore > should yield an error message if restoreProjectFromSnapshot throws "unable to read tree" error 0ms
 âœ“ src/commands/restore.test.ts > performRestore > should re-throw other errors from restoreProjectFromSnapshot 0ms
 âœ“ src/commands/restore.test.ts > performRestore > should yield load_history then a message if both are present 0ms
 âœ“ src/commands/restore.test.ts > performRestore > should yield error message if commitHash is present but gitService is undefined 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > should resolve a basic alias to its model and settings 2ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > should apply a simple override on top of an alias 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > should apply the most specific override rule 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > should use the last override in case of a tie in specificity 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > should correctly pass through generation config from an alias 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > should let an override generation config win over an alias config 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > should merge settings from global, alias, and multiple matching overrides 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > should match an agent:core override when agent is undefined 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > alias inheritance > should resolve a simple "extends" chain 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > alias inheritance > should override parent properties from child alias 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > alias inheritance > should resolve a multi-level "extends" chain 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > alias inheritance > should throw an error for circular dependencies 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > alias inheritance > abstract aliases > should allow an alias to extend an abstract alias without a model 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > alias inheritance > abstract aliases > should throw an error if a resolved alias chain has no model 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > alias inheritance > abstract aliases > should resolve an abstract alias if an override provides the model 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > alias inheritance > should throw an error if an extended alias does not exist 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > deep merging > should deep merge nested config objects from aliases and overrides 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > deep merging > should not deeply merge merge arrays from aliases and overrides 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > runtime aliases > should resolve a simple runtime-registered alias 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > custom aliases > should resolve a custom alias 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > custom aliases > should allow custom aliases to override built-in aliases 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > unrecognized models > should apply overrides to unrecognized model names 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > unrecognized models > should apply scoped overrides to unrecognized model names 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > custom overrides > should apply custom overrides on top of defaults 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > retry behavior > should apply retry-specific overrides when isRetry is true 0ms
 âœ“ src/services/modelConfigService.test.ts > ModelConfigService > retry behavior > should prioritize retry overrides over generic overrides 0ms
 âœ“ src/core/nonInteractiveToolExecutor.test.ts > executeToolCall > should execute a tool successfully 6ms
 âœ“ src/core/nonInteractiveToolExecutor.test.ts > executeToolCall > should return an error if tool is not found 1ms
 âœ“ src/core/nonInteractiveToolExecutor.test.ts > executeToolCall > should return an error if tool validation fails 0ms
 âœ“ src/core/nonInteractiveToolExecutor.test.ts > executeToolCall > should return an error if tool execution fails 0ms
 âœ“ src/core/nonInteractiveToolExecutor.test.ts > executeToolCall > should return an unhandled exception error if execution throws 0ms
 âœ“ src/core/nonInteractiveToolExecutor.test.ts > executeToolCall > should correctly format llmContent with inlineData 0ms
 âœ“ src/core/nonInteractiveToolExecutor.test.ts > executeToolCall > should calculate contentLength for a string llmContent 0ms
 âœ“ src/core/nonInteractiveToolExecutor.test.ts > executeToolCall > should have undefined contentLength for array llmContent with no string parts 0ms
 âœ“ src/utils/nextSpeakerChecker.test.ts > checkNextSpeaker > should return null if history is empty 3ms
 âœ“ src/utils/nextSpeakerChecker.test.ts > checkNextSpeaker > should return null if the last speaker was the user 0ms
 âœ“ src/utils/nextSpeakerChecker.test.ts > checkNextSpeaker > should return { next_speaker: 'model' } when model intends to continue 1ms
 âœ“ src/utils/nextSpeakerChecker.test.ts > checkNextSpeaker > should return { next_speaker: 'user' } when model asks a question 0ms
 âœ“ src/utils/nextSpeakerChecker.test.ts > checkNextSpeaker > should return { next_speaker: 'user' } when model makes a statement 0ms
 âœ“ src/utils/nextSpeakerChecker.test.ts > checkNextSpeaker > should return null if baseLlmClient.generateJson throws an error 0ms
 âœ“ src/utils/nextSpeakerChecker.test.ts > checkNextSpeaker > should return null if baseLlmClient.generateJson returns invalid JSON (missing next_speaker) 0ms
 âœ“ src/utils/nextSpeakerChecker.test.ts > checkNextSpeaker > should return null if baseLlmClient.generateJson returns a non-string next_speaker 0ms
 âœ“ src/utils/nextSpeakerChecker.test.ts > checkNextSpeaker > should return null if baseLlmClient.generateJson returns an invalid next_speaker string value 0ms
 âœ“ src/utils/nextSpeakerChecker.test.ts > checkNextSpeaker > should call generateJson with the correct parameters 0ms
 âœ“ src/services/contextManager.test.ts > ContextManager > refresh > should load and format global and environment memory 3ms
 âœ“ src/services/contextManager.test.ts > ContextManager > refresh > should emit MemoryChanged event when memory is refreshed 0ms
 âœ“ src/services/contextManager.test.ts > ContextManager > discoverContext > should discover and load new context 0ms
 âœ“ src/services/contextManager.test.ts > ContextManager > discoverContext > should return empty string if no new files found 0ms
working stdoutworking stderr âœ“ src/utils/stdio.test.ts > stdio utils > patchStdio redirects stdout and stderr to coreEvents 2ms
 âœ“ src/utils/stdio.test.ts > stdio utils > createWorkingStdio writes to real stdout/stderr bypassing patch 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should allow safe, common environment variables 1ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should allow variables prefixed with GEMINI_CLI_ 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should redact variables with sensitive names from the denylist 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should redact variables with names matching all sensitive patterns (case-insensitive) 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should redact variables with values matching all private key patterns 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should redact variables with values matching all token and credential patterns 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should not redact variables that look similar to sensitive patterns 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should not redact variables with undefined or empty values if name is safe 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should allow variables that do not match any redaction rules 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should handle an empty environment 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should handle a mixed environment with allowed and redacted variables 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should ensure all names in the sets are capitalized 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should ensure all of the regex in the patterns lists are case insensitive 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should allow variables specified in allowedEnvironmentVariables 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should block variables specified in blockedEnvironmentVariables 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should prioritize allowed over blocked if a variable is in both (though user configuration should avoid this) 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should be case insensitive for allowed and blocked lists 0ms
 âœ“ src/services/environmentSanitization.test.ts > sanitizeEnvironment > should not perform any redaction if enableEnvironmentVariableRedaction is false 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should format the response as JSON 1ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should format the response as JSON with a session ID 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should strip ANSI escape sequences from response text 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should strip control characters from response text 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should preserve newlines and tabs in response text 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should format the response as JSON with stats 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should format error as JSON 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should format response with error as JSON 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should format error using formatError method 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should format error using formatError method with a session ID 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should format custom error using formatError method 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should format complete JSON output with response, stats, and error 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should handle error messages containing JSON content 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should handle error messages with quotes and special characters 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should handle error messages with control characters 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should strip ANSI escape sequences from error messages 0ms
 âœ“ src/output/json-formatter.test.ts > JsonFormatter > should strip unsafe control characters from error messages 0ms
 âœ“ src/utils/installationManager.test.ts > InstallationManager > getInstallationId > should create and write a new installation ID if one does not exist 2ms
 âœ“ src/utils/installationManager.test.ts > InstallationManager > getInstallationId > should read an existing installation ID from a file 1ms
 âœ“ src/utils/installationManager.test.ts > InstallationManager > getInstallationId > should return the same ID on subsequent calls 1ms
 âœ“ src/utils/installationManager.test.ts > InstallationManager > getInstallationId > should handle read errors and return a fallback ID 0ms
 âœ“ src/services/fileSystemService.test.ts > StandardFileSystemService > readTextFile > should read file content using fs 2ms
 âœ“ src/services/fileSystemService.test.ts > StandardFileSystemService > readTextFile > should propagate fs.readFile errors 1ms
 âœ“ src/services/fileSystemService.test.ts > StandardFileSystemService > writeTextFile > should write file content using fs 0ms
 âœ“ src/mcp/token-storage/base-token-storage.test.ts > BaseTokenStorage > validateCredentials > should validate valid credentials 1ms
 âœ“ src/mcp/token-storage/base-token-storage.test.ts > BaseTokenStorage > validateCredentials > should throw for 'missing server name' 0ms
 âœ“ src/mcp/token-storage/base-token-storage.test.ts > BaseTokenStorage > validateCredentials > should throw for 'missing token' 0ms
 âœ“ src/mcp/token-storage/base-token-storage.test.ts > BaseTokenStorage > validateCredentials > should throw for 'missing access token' 0ms
 âœ“ src/mcp/token-storage/base-token-storage.test.ts > BaseTokenStorage > validateCredentials > should throw for 'missing token type' 0ms
 âœ“ src/mcp/token-storage/base-token-storage.test.ts > BaseTokenStorage > isTokenExpired > should return tokens without expiry for undefined 0ms
 âœ“ src/mcp/token-storage/base-token-storage.test.ts > BaseTokenStorage > isTokenExpired > should return valid tokens for 1767888419189 0ms
 âœ“ src/mcp/token-storage/base-token-storage.test.ts > BaseTokenStorage > isTokenExpired > should return expired tokens for 1767881219189 0ms
 âœ“ src/mcp/token-storage/base-token-storage.test.ts > BaseTokenStorage > isTokenExpired > should return tokens within 5-minute buffer (4 minutes from now) for 1767885059189 0ms
 âœ“ src/mcp/token-storage/base-token-storage.test.ts > BaseTokenStorage > sanitizeServerName > should handle valid characters 0ms
 âœ“ src/mcp/token-storage/base-token-storage.test.ts > BaseTokenStorage > sanitizeServerName > should handle invalid characters with underscore replacement 0ms
 âœ“ src/mcp/token-storage/base-token-storage.test.ts > BaseTokenStorage > sanitizeServerName > should handle special characters 0ms
 âœ“ src/core/coreToolHookTriggers.test.ts > executeToolWithHooks > should prioritize continue: false over decision: block in BeforeTool 1ms
 âœ“ src/core/coreToolHookTriggers.test.ts > executeToolWithHooks > should block execution in BeforeTool if decision is block 0ms
 âœ“ src/core/coreToolHookTriggers.test.ts > executeToolWithHooks > should handle continue: false in AfterTool 0ms
 âœ“ src/core/coreToolHookTriggers.test.ts > executeToolWithHooks > should block result in AfterTool if decision is deny 0ms
 âœ“ src/core/coreToolHookTriggers.test.ts > executeToolWithHooks > should apply modified tool input from BeforeTool hook 1ms
 âœ“ src/core/coreToolHookTriggers.test.ts > executeToolWithHooks > should not modify input if hook does not provide tool_input 0ms
 âœ“ src/services/modelConfig.golden.test.ts > ModelConfigService Golden Test > should match the golden file for resolved default aliases 7ms
 âœ“ src/services/modelConfig.golden.test.ts > ModelConfigService Golden Test > should match the golden file for resolved default aliases with isRetry=true 5ms
 âœ“ src/tools/tools.test.ts > DeclarativeTool > validateBuildAndExecute > should return INVALID_TOOL_PARAMS error if build fails 3ms
 âœ“ src/tools/tools.test.ts > DeclarativeTool > validateBuildAndExecute > should return EXECUTION_FAILED error if execute fails 0ms
 âœ“ src/tools/tools.test.ts > DeclarativeTool > validateBuildAndExecute > should return the result of execute on success 0ms
 âœ“ src/tools/tools.test.ts > hasCycleInSchema > should detect a simple direct cycle 0ms
 âœ“ src/tools/tools.test.ts > hasCycleInSchema > should detect a cycle from object properties referencing parent properties 0ms
 âœ“ src/tools/tools.test.ts > hasCycleInSchema > should detect a cycle from array items referencing parent properties 0ms
 âœ“ src/tools/tools.test.ts > hasCycleInSchema > should detect a cycle between sibling properties 0ms
 âœ“ src/tools/tools.test.ts > hasCycleInSchema > should not detect a cycle in a valid schema 0ms
 âœ“ src/tools/tools.test.ts > hasCycleInSchema > should handle non-cyclic sibling refs 0ms
 âœ“ src/tools/tools.test.ts > hasCycleInSchema > should handle nested but not cyclic refs 0ms
 âœ“ src/tools/tools.test.ts > hasCycleInSchema > should return false for an empty schema 0ms
 âœ“ src/utils/errors.test.ts > isAuthenticationError > should detect error with code: 401 property (MCP SDK style) 1ms
 âœ“ src/utils/errors.test.ts > isAuthenticationError > should detect UnauthorizedError instance 0ms
 âœ“ src/utils/errors.test.ts > isAuthenticationError > should return false for 404 errors 0ms
 âœ“ src/utils/errors.test.ts > isAuthenticationError > should handle null and undefined gracefully 0ms
 âœ“ src/utils/errors.test.ts > isAuthenticationError > should handle non-error objects 0ms
 âœ“ src/utils/errors.test.ts > isAuthenticationError > should detect 401 in various message formats 0ms
 âœ“ src/utils/errors.test.ts > toFriendlyError > should return BadRequestError for 400 0ms
 âœ“ src/utils/errors.test.ts > toFriendlyError > should return UnauthorizedError for 401 0ms
 âœ“ src/utils/errors.test.ts > toFriendlyError > should return ForbiddenError for 403 0ms
 âœ“ src/utils/errors.test.ts > toFriendlyError > should parse stringified JSON data 0ms
 âœ“ src/utils/errors.test.ts > toFriendlyError > should return original error if response data is undefined 0ms
 âœ“ src/utils/errors.test.ts > toFriendlyError > should return original error if error object is missing in data 0ms
 âœ“ src/utils/errors.test.ts > toFriendlyError > should return original error if error code or message is missing 0ms
 âœ“ src/utils/errors.test.ts > toFriendlyError > should return original error for unknown codes 0ms
 âœ“ src/utils/errors.test.ts > toFriendlyError > should return original error if not a Gaxios error object 0ms
 âœ“ src/safety/registry.test.ts > CheckerRegistry > should resolve built-in in-process checkers 1ms
 âœ“ src/safety/registry.test.ts > CheckerRegistry > should throw for unknown in-process checkers 1ms
 âœ“ src/safety/registry.test.ts > CheckerRegistry > should validate checker names 0ms
 âœ“ src/safety/registry.test.ts > CheckerRegistry > should throw for unknown external checkers (for now) 0ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordFileOperationMetric > 'should record file read with minimal â€¦' 375ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > should retry if the model returns a completely empty stream (no chunks) 502ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > should queue a subsequent sendMessageStream call until the first stream is fully consumed 2ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > Fallback Integration (Retries) > should call handleFallback with the specific failed model and retry if handler returns true 1ms
 âœ“ src/core/turn.test.ts > Turn > constructor > should initialize pendingToolCalls and debugResponses 1ms
 âœ“ src/core/turn.test.ts > Turn > run > should yield content events for text parts 1ms
 âœ“ src/core/turn.test.ts > Turn > run > should yield tool_call_request events for function calls 1ms
 âœ“ src/core/turn.test.ts > Turn > run > should yield UserCancelled event if signal is aborted 0ms
 âœ“ src/core/turn.test.ts > Turn > run > should yield InvalidStream event if sendMessageStream throws InvalidStreamError 0ms
 âœ“ src/core/turn.test.ts > Turn > run > should yield Error event and report if sendMessageStream throws 0ms
 âœ“ src/core/turn.test.ts > Turn > run > should handle function calls with undefined name or args 0ms
 âœ“ src/core/turn.test.ts > Turn > run > 'should yield finished event when respâ€¦' 0ms
 âœ“ src/core/turn.test.ts > Turn > run > 'should yield finished event for MAX_Tâ€¦' 0ms
 âœ“ src/core/turn.test.ts > Turn > run > 'should yield finished event for SAFETâ€¦' 0ms
 âœ“ src/core/turn.test.ts > Turn > run > should yield finished event with undefined reason when there is no finish reason 0ms
 âœ“ src/core/turn.test.ts > Turn > run > should handle multiple responses with different finish reasons 0ms
 âœ“ src/core/turn.test.ts > Turn > run > should yield citation and finished events when response has citationMetadata 0ms
 âœ“ src/core/turn.test.ts > Turn > run > should yield a single citation event for multiple citations in one response 0ms
 âœ“ src/core/turn.test.ts > Turn > run > should not yield citation event if there is no finish reason 0ms
 âœ“ src/core/turn.test.ts > Turn > run > should ignore citations without a URI 0ms
 âœ“ src/core/turn.test.ts > Turn > run > should not crash when cancelled request has malformed error 0ms
 âœ“ src/core/turn.test.ts > Turn > run > should yield a Retry event when it receives one from the chat stream 0ms
 âœ“ src/core/turn.test.ts > Turn > run > 'should yield content events with tracâ€¦' 0ms
 âœ“ src/core/turn.test.ts > Turn > run > 'should yield thought events with tracâ€¦' 0ms
 âœ“ src/core/turn.test.ts > Turn > getDebugResponses > should return collected debug responses 0ms
 âœ“ src/core/fakeContentGenerator.test.ts > FakeContentGenerator > should return responses for generateContent 1ms
 âœ“ src/core/fakeContentGenerator.test.ts > FakeContentGenerator > should return responses for generateContentStream 0ms
 âœ“ src/core/fakeContentGenerator.test.ts > FakeContentGenerator > should return responses for countTokens 0ms
 âœ“ src/core/fakeContentGenerator.test.ts > FakeContentGenerator > should return responses for embedContent 0ms
 âœ“ src/core/fakeContentGenerator.test.ts > FakeContentGenerator > should handle a mixture of calls 0ms
 âœ“ src/core/fakeContentGenerator.test.ts > FakeContentGenerator > should throw error when no more responses 1ms
 âœ“ src/core/fakeContentGenerator.test.ts > FakeContentGenerator > fromFile > should create a generator from a file 0ms
 âœ“ src/core/recordingContentGenerator.test.ts > RecordingContentGenerator > should record generateContent responses 2ms
 âœ“ src/core/recordingContentGenerator.test.ts > RecordingContentGenerator > should record generateContentStream responses 0ms
 âœ“ src/core/recordingContentGenerator.test.ts > RecordingContentGenerator > should record countTokens responses 0ms
 âœ“ src/core/recordingContentGenerator.test.ts > RecordingContentGenerator > should record embedContent responses 0ms
 âœ“ src/agents/schema-utils.test.ts > convertInputConfigToJsonSchema > type conversion > should correctly convert an InputConfig with various primitive types 2ms
 âœ“ src/agents/schema-utils.test.ts > convertInputConfigToJsonSchema > type conversion > should correctly handle array types for strings and numbers 0ms
 âœ“ src/agents/schema-utils.test.ts > convertInputConfigToJsonSchema > required field handling > should produce an undefined `required` field when no inputs are required 0ms
 âœ“ src/agents/schema-utils.test.ts > convertInputConfigToJsonSchema > required field handling > should list all properties in `required` when all are marked as required 1ms
 âœ“ src/agents/schema-utils.test.ts > convertInputConfigToJsonSchema > edge cases > should return a valid, empty schema for an empty input config 0ms
 âœ“ src/agents/schema-utils.test.ts > convertInputConfigToJsonSchema > error handling > should throw an informative error for an unsupported input type 0ms
 âœ“ src/availability/policyCatalog.test.ts > policyCatalog > returns preview chain when preview enabled 2ms
 âœ“ src/availability/policyCatalog.test.ts > policyCatalog > returns default chain when preview disabled 0ms
 âœ“ src/availability/policyCatalog.test.ts > policyCatalog > marks preview transients as sticky retries 1ms
 âœ“ src/availability/policyCatalog.test.ts > policyCatalog > applies default actions and state transitions for unspecified kinds 0ms
 âœ“ src/availability/policyCatalog.test.ts > policyCatalog > clones policy maps so edits do not leak between calls 0ms
 âœ“ src/availability/policyCatalog.test.ts > policyCatalog > passes when there is exactly one last-resort policy 1ms
 âœ“ src/availability/policyCatalog.test.ts > policyCatalog > fails when no policies are marked last-resort 0ms
 âœ“ src/availability/policyCatalog.test.ts > policyCatalog > fails when a single-model chain is not last-resort 0ms
 âœ“ src/availability/policyCatalog.test.ts > policyCatalog > fails when multiple policies are marked last-resort 0ms
 âœ“ src/availability/policyCatalog.test.ts > policyCatalog > createDefaultPolicy seeds default actions and states 0ms
 âœ“ src/core/converter.test.ts > converter > toCodeAssistRequest > should convert a simple request with project 2ms
 âœ“ src/core/converter.test.ts > converter > toCodeAssistRequest > should convert a request without a project 0ms
 âœ“ src/core/converter.test.ts > converter > toCodeAssistRequest > should convert a request with sessionId 1ms
 âœ“ src/core/converter.test.ts > converter > toCodeAssistRequest > should handle string content 0ms
 âœ“ src/core/converter.test.ts > converter > toCodeAssistRequest > should handle Part[] content 0ms
 âœ“ src/core/converter.test.ts > converter > toCodeAssistRequest > should handle system instructions 0ms
 âœ“ src/core/converter.test.ts > converter > toCodeAssistRequest > should handle generation config 0ms
 âœ“ src/core/converter.test.ts > converter > toCodeAssistRequest > should handle all generation config fields 0ms
 âœ“ src/core/converter.test.ts > converter > fromCodeAssistResponse > should convert a simple response 0ms
 âœ“ src/core/converter.test.ts > converter > fromCodeAssistResponse > should handle prompt feedback and usage metadata 0ms
 âœ“ src/core/converter.test.ts > converter > fromCodeAssistResponse > should handle automatic function calling history 0ms
 âœ“ src/core/converter.test.ts > converter > fromCodeAssistResponse > should handle modelVersion 0ms
 âœ“ src/core/converter.test.ts > converter > fromCodeAssistResponse > should handle traceId 0ms
 âœ“ src/core/converter.test.ts > converter > fromCodeAssistResponse > should handle missing traceId 0ms
 âœ“ src/core/converter.test.ts > converter > toContents > should handle Content 0ms
 âœ“ src/core/converter.test.ts > converter > toContents > should handle array of Contents 0ms
 âœ“ src/core/converter.test.ts > converter > toContents > should handle Part 0ms
 âœ“ src/core/converter.test.ts > converter > toContents > should handle array of Parts 0ms
 âœ“ src/core/converter.test.ts > converter > toContents > should handle string 0ms
 âœ“ src/core/converter.test.ts > converter > toContents > should handle array of strings 0ms
 âœ“ src/core/converter.test.ts > converter > toContents > should convert thought parts to text parts for API compatibility 0ms
 âœ“ src/core/converter.test.ts > converter > toContents > should combine text and thought for text parts with thoughts 0ms
 âœ“ src/core/converter.test.ts > converter > toContents > should preserve non-thought properties while removing thought 0ms
 âœ“ src/core/converter.test.ts > converter > toContents > should convert invalid text content to valid text part with thought 0ms
 âœ“ src/tools/diffOptions.test.ts > getDiffStat > should return 0 for all stats when there are no changes 1ms
 âœ“ src/tools/diffOptions.test.ts > getDiffStat > should correctly report model additions 0ms
 âœ“ src/tools/diffOptions.test.ts > getDiffStat > should correctly report model removals 0ms
 âœ“ src/tools/diffOptions.test.ts > getDiffStat > should correctly report model modifications 0ms
 âœ“ src/tools/diffOptions.test.ts > getDiffStat > should correctly report user additions 0ms
 âœ“ src/tools/diffOptions.test.ts > getDiffStat > should correctly report user removals 0ms
 âœ“ src/tools/diffOptions.test.ts > getDiffStat > should correctly report user modifications 0ms
 âœ“ src/tools/diffOptions.test.ts > getDiffStat > should handle complex changes from both model and user 0ms
 âœ“ src/tools/diffOptions.test.ts > getDiffStat > should report a single line modification as one addition and one removal 0ms
 âœ“ src/telemetry/semantic.test.ts > toChatMessage > should correctly handle text parts 1ms
 âœ“ src/telemetry/semantic.test.ts > toChatMessage > should correctly handle function call parts 0ms
 âœ“ src/telemetry/semantic.test.ts > toChatMessage > should correctly handle function response parts 0ms
 âœ“ src/telemetry/semantic.test.ts > toChatMessage > should correctly handle reasoning parts with text 0ms
 âœ“ src/telemetry/semantic.test.ts > toChatMessage > should correctly handle reasoning parts without text 0ms
 âœ“ src/telemetry/semantic.test.ts > toChatMessage > should correctly handle text parts that are not reasoning parts 0ms
 âœ“ src/telemetry/semantic.test.ts > toChatMessage > should correctly handle "generic" parts 0ms
 âœ“ src/telemetry/semantic.test.ts > toChatMessage > should correctly handle unknown parts 0ms
 âœ“ src/telemetry/semantic.test.ts > toSystemInstruction > should correctly handle a string 0ms
 âœ“ src/telemetry/semantic.test.ts > toSystemInstruction > should correctly handle a Content object with a text part 0ms
 âœ“ src/telemetry/semantic.test.ts > toSystemInstruction > should correctly handle a Content object with multiple parts 0ms
 âœ“ src/telemetry/semantic.test.ts > toInputMessages > should correctly convert an array of Content objects 0ms
 âœ“ src/telemetry/semantic.test.ts > toOutputMessages > should correctly convert an array of Candidate objects 0ms
 âœ“ src/telemetry/semantic.test.ts > toFinishReasons > should return an empty array if candidates is undefined 0ms
 âœ“ src/telemetry/semantic.test.ts > toFinishReasons > should return an empty array if candidates is an empty array 0ms
 âœ“ src/telemetry/semantic.test.ts > toFinishReasons > should correctly convert a single candidate 0ms
 âœ“ src/telemetry/semantic.test.ts > toFinishReasons > should correctly convert multiple candidates 0ms
 âœ“ src/telemetry/semantic.test.ts > toOutputType > should return TEXT for text/plain 0ms
 âœ“ src/telemetry/semantic.test.ts > toOutputType > should return JSON for application/json 0ms
 âœ“ src/telemetry/semantic.test.ts > toOutputType > should return the custom mime type for other strings 0ms
 âœ“ src/telemetry/semantic.test.ts > toOutputType > should return undefined for undefined input 0ms
 âœ“ src/utils/thoughtUtils.test.ts > parseThought > should correctly parse 'a standard thought with subject and dâ€¦' 1ms
 âœ“ src/utils/thoughtUtils.test.ts > parseThought > should correctly parse 'leading and trailing whitespace in thâ€¦' 0ms
 âœ“ src/utils/thoughtUtils.test.ts > parseThought > should correctly parse 'whitespace surrounding the subject coâ€¦' 0ms
 âœ“ src/utils/thoughtUtils.test.ts > parseThought > should correctly parse 'a thought with only a subject' 0ms
 âœ“ src/utils/thoughtUtils.test.ts > parseThought > should correctly parse 'a thought with only a description (noâ€¦' 0ms
 âœ“ src/utils/thoughtUtils.test.ts > parseThought > should correctly parse 'an empty string input' 0ms
 âœ“ src/utils/thoughtUtils.test.ts > parseThought > should correctly parse 'newlines within the subject and descrâ€¦' 0ms
 âœ“ src/utils/thoughtUtils.test.ts > parseThought > should correctly parse 'only the first subject if multiple arâ€¦' 0ms
 âœ“ src/utils/thoughtUtils.test.ts > parseThought > should correctly parse 'text before and after the subject' 0ms
 âœ“ src/utils/thoughtUtils.test.ts > parseThought > should correctly parse 'an unclosed subject tag' 0ms
 âœ“ src/utils/thoughtUtils.test.ts > parseThought > should correctly parse 'an empty subject tag' 0ms
 âœ“ src/utils/tokenCalculation.test.ts > calculateRequestTokenCount > should use countTokens API for media requests (images/files) 1ms
 âœ“ src/utils/tokenCalculation.test.ts > calculateRequestTokenCount > should estimate tokens locally for tool calls 0ms
 âœ“ src/utils/tokenCalculation.test.ts > calculateRequestTokenCount > should estimate tokens locally for simple ASCII text 0ms
 âœ“ src/utils/tokenCalculation.test.ts > calculateRequestTokenCount > should estimate tokens locally for CJK text with higher weight 0ms
 âœ“ src/utils/tokenCalculation.test.ts > calculateRequestTokenCount > should handle mixed content 0ms
 âœ“ src/utils/tokenCalculation.test.ts > calculateRequestTokenCount > should handle empty text 0ms
 âœ“ src/utils/tokenCalculation.test.ts > calculateRequestTokenCount > should fallback to local estimation when countTokens API fails 0ms
 âœ“ src/utils/version.test.ts > version > should return CLI_VERSION from env if set 1ms
 âœ“ src/utils/version.test.ts > version > should return version from package.json if CLI_VERSION is not set 0ms
 âœ“ src/utils/version.test.ts > version > should return "unknown" if package.json is not found and CLI_VERSION is not set 0ms
 âœ“ src/prompts/mcp-prompts.test.ts > getMCPServerPrompts > should return prompts from the registry for a given server 2ms
 âœ“ src/prompts/mcp-prompts.test.ts > getMCPServerPrompts > should return an empty array if there is no prompt registry 0ms
 âœ“ src/availability/modelAvailabilityService.test.ts > ModelAvailabilityService > returns available snapshot when no state recorded 1ms
 âœ“ src/availability/modelAvailabilityService.test.ts > ModelAvailabilityService > tracks retry-once-per-turn failures 0ms
 âœ“ src/availability/modelAvailabilityService.test.ts > ModelAvailabilityService > tracks terminal failures 0ms
 âœ“ src/availability/modelAvailabilityService.test.ts > ModelAvailabilityService > does not override terminal failure with sticky failure 0ms
 âœ“ src/availability/modelAvailabilityService.test.ts > ModelAvailabilityService > selects models respecting terminal and sticky states 0ms
 âœ“ src/availability/modelAvailabilityService.test.ts > ModelAvailabilityService > preserves consumed state when marking retry-once-per-turn again 0ms
 âœ“ src/availability/modelAvailabilityService.test.ts > ModelAvailabilityService > clears consumed state when marked healthy 0ms
 âœ“ src/availability/modelAvailabilityService.test.ts > ModelAvailabilityService > resetTurn resets consumed state for multiple sticky models 0ms
 âœ“ src/availability/modelAvailabilityService.test.ts > ModelAvailabilityService > resetTurn does not affect terminal models 0ms
 âœ“ src/agents/codebase-investigator.test.ts > CodebaseInvestigatorAgent > should have the correct agent definition 1ms
 âœ“ src/agents/codebase-investigator.test.ts > CodebaseInvestigatorAgent > should process output to a formatted JSON string 0ms
 âœ“ src/services/modelConfig.integration.test.ts > ModelConfigService Integration > should resolve a simple model, applying core agent defaults 1ms
 âœ“ src/services/modelConfig.integration.test.ts > ModelConfigService Integration > should correctly apply a simple inherited alias and merge with global defaults 0ms
 âœ“ src/services/modelConfig.integration.test.ts > ModelConfigService Integration > should resolve a multi-level inherited alias 0ms
 âœ“ src/services/modelConfig.integration.test.ts > ModelConfigService Integration > should apply an inherited alias and a broad model-based override 0ms
 âœ“ src/services/modelConfig.integration.test.ts > ModelConfigService Integration > should apply settings for an unknown model but a known agent 0ms
 âœ“ src/services/modelConfig.integration.test.ts > ModelConfigService Integration > should apply the most specific override for a known inherited alias and agent 0ms
 âœ“ src/services/modelConfig.integration.test.ts > ModelConfigService Integration > should correctly apply agent override on top of a multi-level inherited alias 0ms
 âœ“ src/services/modelConfig.integration.test.ts > ModelConfigService Integration > should resolve an abstract alias if a specific override provides the model 0ms
 âœ“ src/services/modelConfig.integration.test.ts > ModelConfigService Integration > should not apply core agent overrides when a different agent is specified 0ms
 âœ“ src/services/modelConfig.integration.test.ts > ModelConfigService Integration > should correctly merge static aliases, runtime aliases, and overrides 0ms
 âœ“ src/agents/utils.test.ts > templateString > should replace a single placeholder with a string value 1ms
 âœ“ src/agents/utils.test.ts > templateString > should replace multiple unique placeholders 0ms
 âœ“ src/agents/utils.test.ts > templateString > should replace multiple instances of the same placeholder 0ms
 âœ“ src/agents/utils.test.ts > templateString > should handle various data types for input values 0ms
 âœ“ src/agents/utils.test.ts > templateString > should return the original string if no placeholders are present 0ms
 âœ“ src/agents/utils.test.ts > templateString > should correctly handle an empty template string 0ms
 âœ“ src/agents/utils.test.ts > templateString > should ignore extra keys in the inputs object that are not in the template 0ms
 âœ“ src/agents/utils.test.ts > templateString > should throw an error if a required key is missing from the inputs 0ms
 âœ“ src/agents/utils.test.ts > templateString > should throw an error listing all missing keys if multiple are missing 0ms
 âœ“ src/agents/utils.test.ts > templateString > should be case-sensitive with placeholder keys 0ms
 âœ“ src/agents/utils.test.ts > templateString > should not replace malformed or incomplete placeholders 0ms
 âœ“ src/agents/utils.test.ts > templateString > should work correctly with an empty inputs object if the template has no placeholders 0ms
 âœ“ src/utils/safeJsonStringify.test.ts > safeJsonStringify > should stringify normal objects without issues 1ms
 âœ“ src/utils/safeJsonStringify.test.ts > safeJsonStringify > should handle circular references by replacing them with [Circular] 0ms
 âœ“ src/utils/safeJsonStringify.test.ts > safeJsonStringify > should handle complex circular structures like HttpsProxyAgent 0ms
 âœ“ src/utils/safeJsonStringify.test.ts > safeJsonStringify > should respect the space parameter for formatting 0ms
 âœ“ src/utils/safeJsonStringify.test.ts > safeJsonStringify > should handle circular references with formatting 0ms
 âœ“ src/utils/safeJsonStringify.test.ts > safeJsonStringify > should handle arrays with circular references 0ms
 âœ“ src/utils/safeJsonStringify.test.ts > safeJsonStringify > should handle null and undefined values 0ms
 âœ“ src/utils/safeJsonStringify.test.ts > safeJsonStringify > should handle primitive values 0ms
 âœ“ src/commands/extensions.test.ts > listExtensions > should call config.getExtensions and return the result 1ms
 âœ“ src/resources/resource-registry.test.ts > ResourceRegistry > stores resources per server 1ms
 âœ“ src/resources/resource-registry.test.ts > ResourceRegistry > clears resources for server before adding new ones 0ms
 âœ“ src/resources/resource-registry.test.ts > ResourceRegistry > finds resources by serverName:uri identifier 0ms
 âœ“ src/resources/resource-registry.test.ts > ResourceRegistry > clears resources for a server 0ms
 âœ“ src/commands/init.test.ts > performInit > returns info if GEMINI.md already exists 1ms
 âœ“ src/commands/init.test.ts > performInit > returns submit_prompt if GEMINI.md does not exist 0ms
 âœ“ src/utils/textUtils.test.ts > safeLiteralReplace > returns original string when oldString empty or not found 1ms
 âœ“ src/utils/textUtils.test.ts > safeLiteralReplace > fast path when newString has no $ 0ms
 âœ“ src/utils/textUtils.test.ts > safeLiteralReplace > treats $ literally 0ms
 âœ“ src/utils/textUtils.test.ts > safeLiteralReplace > does not interpret replacement patterns like $&, $', $` and $1 0ms
 âœ“ src/utils/textUtils.test.ts > safeLiteralReplace > preserves end-of-line $ in regex-like text 0ms
 âœ“ src/utils/textUtils.test.ts > safeLiteralReplace > handles multiple $ characters 0ms
 âœ“ src/utils/textUtils.test.ts > safeLiteralReplace > preserves pre-escaped $$ literally 0ms
 âœ“ src/utils/textUtils.test.ts > safeLiteralReplace > handles complex malicious patterns from PR #7871 0ms
 âœ“ src/utils/textUtils.test.ts > safeLiteralReplace > handles multiple replacements correctly 0ms
 âœ“ src/utils/textUtils.test.ts > safeLiteralReplace > preserves $ at different positions 0ms
 âœ“ src/utils/textUtils.test.ts > safeLiteralReplace > handles edge case with $$$$ 0ms
 âœ“ src/utils/textUtils.test.ts > safeLiteralReplace > handles newString with only dollar signs 0ms
 âœ“ src/tools/tool-names.test.ts > tool-names > isValidToolName > should validate built-in tool names 1ms
 âœ“ src/tools/tool-names.test.ts > tool-names > isValidToolName > should validate discovered tool names 0ms
 âœ“ src/tools/tool-names.test.ts > tool-names > isValidToolName > should validate MCP tool names (server__tool) 0ms
 âœ“ src/tools/tool-names.test.ts > tool-names > isValidToolName > should reject invalid tool names 0ms
 âœ“ src/tools/tool-names.test.ts > tool-names > isValidToolName > should handle wildcards when allowed 0ms
 âœ“ src/utils/filesearch/result-cache.test.ts > ResultCache basic usage 1ms
 âœ“ src/utils/filesearch/result-cache.test.ts > ResultCache cache hit/miss 0ms
 âœ“ src/utils/filesearch/result-cache.test.ts > ResultCache best base query 0ms
 âœ“ src/core/tokenLimits.test.ts > tokenLimit > should return the correct token limit for gemini-1.5-pro 1ms
 âœ“ src/core/tokenLimits.test.ts > tokenLimit > should return the correct token limit for gemini-1.5-flash 0ms
 âœ“ src/core/tokenLimits.test.ts > tokenLimit > should return the default token limit for an unknown model 0ms
 âœ“ src/core/tokenLimits.test.ts > tokenLimit > should return the default token limit if no model is provided 0ms
 âœ“ src/core/tokenLimits.test.ts > tokenLimit > should have the correct default token limit value 0ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > should discard valid partial content from a failed attempt upon retry 502ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > stripThoughtsFromHistory > should strip thought signatures 2ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > ensureActiveLoopHasThoughtSignatures > should add thoughtSignature to the first functionCall in each model turn of the active loop 2ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > ensureActiveLoopHasThoughtSignatures > should not modify contents if there is no user text message 2ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > ensureActiveLoopHasThoughtSignatures > should handle an empty history 2ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > ensureActiveLoopHasThoughtSignatures > should handle history with only a user message 2ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > Availability Service Integration > should mark healthy on successful stream 2ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > Availability Service Integration > caps retries to a single attempt when selection is sticky 2ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > Availability Service Integration > should pass attempted model to onPersistent429 callback which calls handleFallback 3ms
 âœ“ src/core/geminiChat.test.ts > CodeflyChat > Availability Service Integration > re-resolves generateContentConfig when active model changes between retries 2ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordFileOperationMetric > 'should record file update with some aâ€¦' 519ms
 âœ“ src/config/storage.test.ts > Storage â€“ getGlobalSettingsPath > returns path to ~/.gemini/settings.json 1ms
 âœ“ src/config/storage.test.ts > Storage â€“ additional helpers > getWorkspaceSettingsPath returns project/.gemini/settings.json 0ms
 âœ“ src/config/storage.test.ts > Storage â€“ additional helpers > getUserCommandsDir returns ~/.gemini/commands 0ms
 âœ“ src/config/storage.test.ts > Storage â€“ additional helpers > getProjectCommandsDir returns project/.gemini/commands 0ms
 âœ“ src/config/storage.test.ts > Storage â€“ additional helpers > getUserSkillsDir returns ~/.gemini/skills 0ms
 âœ“ src/config/storage.test.ts > Storage â€“ additional helpers > getProjectSkillsDir returns project/.gemini/skills 0ms
 âœ“ src/config/storage.test.ts > Storage â€“ additional helpers > getUserAgentsDir returns ~/.gemini/agents 0ms
 âœ“ src/config/storage.test.ts > Storage â€“ additional helpers > getProjectAgentsDir returns project/.gemini/agents 0ms
 âœ“ src/config/storage.test.ts > Storage â€“ additional helpers > getMcpOAuthTokensPath returns ~/.gemini/mcp-oauth-tokens.json 0ms
 âœ“ src/config/storage.test.ts > Storage â€“ additional helpers > getGlobalBinDir returns ~/.gemini/tmp/bin 0ms
 âœ“ src/routing/strategies/overrideStrategy.test.ts > OverrideStrategy > should return null when the override model is auto 1ms
 âœ“ src/routing/strategies/overrideStrategy.test.ts > OverrideStrategy > should return a decision with the override model when one is specified 0ms
 âœ“ src/routing/strategies/overrideStrategy.test.ts > OverrideStrategy > should handle different override model names 0ms
 âœ“ src/utils/formatters.test.ts > bytesToMB > converts bytes to megabytes 1ms
 âœ“ src/utils/formatters.test.ts > formatMemoryUsage > formats values below one megabyte in KB 0ms
 âœ“ src/utils/formatters.test.ts > formatMemoryUsage > formats values below one gigabyte in MB 0ms
 âœ“ src/utils/formatters.test.ts > formatMemoryUsage > formats values of one gigabyte or larger in GB 0ms
 âœ“ src/telemetry/telemetry-utils.test.ts > getProgrammingLanguage > should return 'TypeScript' when 'file_path is present' 1ms
 âœ“ src/telemetry/telemetry-utils.test.ts > getProgrammingLanguage > should return 'Python' when 'absolute_path is present' 0ms
 âœ“ src/telemetry/telemetry-utils.test.ts > getProgrammingLanguage > should return 'Go' when 'path is present' 0ms
 âœ“ src/telemetry/telemetry-utils.test.ts > getProgrammingLanguage > should return undefined when 'no file path is present' 0ms
 âœ“ src/telemetry/telemetry-utils.test.ts > getProgrammingLanguage > should return undefined when 'unknown file extensions' 0ms
 âœ“ src/telemetry/telemetry-utils.test.ts > getProgrammingLanguage > should return undefined when 'files with no extension' 0ms
 âœ“ src/routing/strategies/defaultStrategy.test.ts > DefaultStrategy > should always route to the default Gemini model 1ms
 âœ“ src/index.test.ts > placeholder tests > should pass 1ms
 âœ“ src/agents/introspection-agent.test.ts > IntrospectionAgent > should have the correct agent definition metadata 1ms
 âœ“ src/agents/introspection-agent.test.ts > IntrospectionAgent > should have correctly configured inputs and outputs 0ms
 âœ“ src/agents/introspection-agent.test.ts > IntrospectionAgent > should use the correct model and tools 0ms
 âœ“ src/agents/introspection-agent.test.ts > IntrospectionAgent > should have expected prompt placeholders 0ms
 âœ“ src/agents/introspection-agent.test.ts > IntrospectionAgent > should process output to a formatted JSON string 0ms
 âœ“ src/agents/remote-invocation.test.ts > RemoteAgentInvocation > should be instantiated with correct params 2ms
 âœ“ src/agents/remote-invocation.test.ts > RemoteAgentInvocation > should return false for confirmation details (not yet implemented) 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > constructor > should create an event with all fields 2ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > constructor > should create an event with minimal fields 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > toOpenTelemetryAttributes with logPrompts=true > should include all fields when logPrompts is enabled 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > toOpenTelemetryAttributes with logPrompts=true > should include hook_input and hook_output as JSON strings 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > toOpenTelemetryAttributes with logPrompts=false > should exclude PII-sensitive fields when logPrompts is disabled 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > toOpenTelemetryAttributes with logPrompts=false > should sanitize hook_name when logPrompts is disabled 2ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > toOpenTelemetryAttributes with logPrompts=false > should still include error field even when logPrompts is disabled 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > sanitizeHookName edge cases > should handle commands with multiple spaces 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > sanitizeHookName edge cases > should handle mixed path separators 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > sanitizeHookName edge cases > should handle trailing slashes 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > toLogBody > should format success message correctly 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > toLogBody > should format failure message correctly 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > integration scenarios > should handle enterprise scenario with full logging 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > integration scenarios > should handle public telemetry scenario with minimal logging 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > real-world sensitive command examples > should sanitize commands with API keys 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > real-world sensitive command examples > should sanitize commands with database credentials 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > real-world sensitive command examples > should sanitize commands with environment variables containing secrets 0ms
 âœ“ src/telemetry/sanitize.test.ts > Telemetry Sanitization > HookCallEvent > real-world sensitive command examples > should sanitize Python scripts with file paths 0ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordFileOperationMetric > 'should record file update with no optâ€¦' 585ms
 âœ“ src/utils/extensionLoader.test.ts > SimpleExtensionLoader > should start active extensions 2ms
 âœ“ src/utils/extensionLoader.test.ts > SimpleExtensionLoader > should not start inactive extensions 0ms
 âœ“ src/utils/extensionLoader.test.ts > SimpleExtensionLoader > interactive extension loading and unloading > should not call `start` or `stop` if the loader is not already started 0ms
 âœ“ src/utils/extensionLoader.test.ts > SimpleExtensionLoader > interactive extension loading and unloading > should start extensions that were explicitly loaded prior to initializing the loader 0ms
 âœ“ src/utils/extensionLoader.test.ts > SimpleExtensionLoader > interactive extension loading and unloading > when enableExtensionReloading === $i > should reload extension features 0ms
 âœ“ src/utils/extensionLoader.test.ts > SimpleExtensionLoader > interactive extension loading and unloading > when enableExtensionReloading === $i > Should only reload memory once all extensions are done 0ms
 âœ“ src/utils/extensionLoader.test.ts > SimpleExtensionLoader > interactive extension loading and unloading > when enableExtensionReloading === $i > should not reload extension features 0ms
 â†“ src/utils/extensionLoader.test.ts > SimpleExtensionLoader > interactive extension loading and unloading > when enableExtensionReloading === $i > Should only reload memory once all extensions are done
 âœ“ src/utils/extensionLoader.test.ts > SimpleExtensionLoader > restartExtension > should stop and then start the extension 1ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordModelRoutingMetrics > should not record metrics if not initialized 196ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordModelRoutingMetrics > should record latency for a successful routing decision 70ms
 âœ“ src/config/flashFallback.test.ts > Flash Model Fallback Configuration > getModel > should return contentGeneratorConfig model if available 2ms
 âœ“ src/config/flashFallback.test.ts > Flash Model Fallback Configuration > getModel > should fall back to initial model if contentGeneratorConfig is not available 0ms
 âœ“ src/config/flashFallback.test.ts > Flash Model Fallback Configuration > activateFallbackMode > should set model to fallback and log event 1ms
 âœ“ src/telemetry/config.test.ts > telemetry/config helpers > parseBooleanEnvFlag > returns undefined for undefined 1ms
 âœ“ src/telemetry/config.test.ts > telemetry/config helpers > parseBooleanEnvFlag > parses true values 0ms
 âœ“ src/telemetry/config.test.ts > telemetry/config helpers > parseBooleanEnvFlag > parses false/other values as false 0ms
 âœ“ src/telemetry/config.test.ts > telemetry/config helpers > parseTelemetryTargetValue > parses string values 0ms
 âœ“ src/telemetry/config.test.ts > telemetry/config helpers > parseTelemetryTargetValue > accepts enum values 0ms
 âœ“ src/telemetry/config.test.ts > telemetry/config helpers > parseTelemetryTargetValue > returns undefined for unknown 0ms
 âœ“ src/telemetry/config.test.ts > telemetry/config helpers > resolveTelemetrySettings > falls back to settings when no argv/env provided 0ms
 âœ“ src/telemetry/config.test.ts > telemetry/config helpers > resolveTelemetrySettings > uses env over settings and argv over env 0ms
 âœ“ src/telemetry/config.test.ts > telemetry/config helpers > resolveTelemetrySettings > resolves useCliAuth from settings 0ms
 âœ“ src/telemetry/config.test.ts > telemetry/config helpers > resolveTelemetrySettings > resolves useCliAuth from env 0ms
 âœ“ src/telemetry/config.test.ts > telemetry/config helpers > resolveTelemetrySettings > env overrides settings for useCliAuth 0ms
 âœ“ src/telemetry/config.test.ts > telemetry/config helpers > resolveTelemetrySettings > falls back to OTEL_EXPORTER_OTLP_ENDPOINT when GEMINI var is missing 0ms
 âœ“ src/telemetry/config.test.ts > telemetry/config helpers > resolveTelemetrySettings > throws on unknown protocol values 1ms
 âœ“ src/telemetry/config.test.ts > telemetry/config helpers > resolveTelemetrySettings > throws on unknown target values 0ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordModelRoutingMetrics > should record latency and failure for a failed routing decision 58ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordAgentRunMetrics > should not record metrics if not initialized 53ms
 âœ“ src/utils/tool-utils.test.ts > getToolSuggestion > should suggest the top N closest tool names for a typo 1ms
 âœ“ src/utils/tool-utils.test.ts > doesToolInvocationMatch > should not match a partial command prefix 0ms
 âœ“ src/utils/tool-utils.test.ts > doesToolInvocationMatch > should match an exact command 0ms
 âœ“ src/utils/tool-utils.test.ts > doesToolInvocationMatch > should match a command with an alias 0ms
 âœ“ src/utils/tool-utils.test.ts > doesToolInvocationMatch > should match a command that is a prefix 0ms
 âœ“ src/utils/tool-utils.test.ts > doesToolInvocationMatch > for non-shell tools > should match by tool name 0ms
 âœ“ src/utils/tool-utils.test.ts > doesToolInvocationMatch > for non-shell tools > should match by tool class name 0ms
 âœ“ src/utils/tool-utils.test.ts > doesToolInvocationMatch > for non-shell tools > should not match if neither name is in the patterns 0ms
 âœ“ src/utils/tool-utils.test.ts > doesToolInvocationMatch > for non-shell tools > should match by tool name when passed as a string 0ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > recordAgentRunMetrics > should record agent run metrics 53ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > OpenTelemetry GenAI Semantic Convention Metrics > recordGenAiClientTokenUsage > should not record metrics when not initialized 49ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > OpenTelemetry GenAI Semantic Convention Metrics > recordGenAiClientTokenUsage > should record input token usage with correct attributes 46ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > OpenTelemetry GenAI Semantic Convention Metrics > recordGenAiClientTokenUsage > should record output token usage with correct attributes 49ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > OpenTelemetry GenAI Semantic Convention Metrics > recordGenAiClientTokenUsage > should record token usage with optional attributes 42ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > OpenTelemetry GenAI Semantic Convention Metrics > recordGenAiClientOperationDuration > should not record metrics when not initialized 48ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > OpenTelemetry GenAI Semantic Convention Metrics > recordGenAiClientOperationDuration > should record successful operation duration with correct attributes 42ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > OpenTelemetry GenAI Semantic Convention Metrics > recordGenAiClientOperationDuration > should record failed operation duration with error type 49ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > OpenTelemetry GenAI Semantic Convention Metrics > recordGenAiClientOperationDuration > should record operation duration with server details 42ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > OpenTelemetry GenAI Semantic Convention Metrics > recordGenAiClientOperationDuration > should handle minimal required attributes 43ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordStartupPerformance > should not record metrics when performance monitoring is disabled 38ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordStartupPerformance > should record startup performance with phase and details 43ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordStartupPerformance > should record startup performance without details 44ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordStartupPerformance > should handle floating-point duration values from performance.now() 38ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordMemoryUsage > should record memory usage for 'heap_used' 42ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordMemoryUsage > should record memory usage for 'heap_total' 43ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordMemoryUsage > should record memory usage for 'external' 41ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordMemoryUsage > should record memory usage for 'rss' 54ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordMemoryUsage > should record memory usage for 'heap_used' 40ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordCpuUsage > should record CPU usage percentage 41ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordCpuUsage > should record CPU usage without component 40ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordToolQueueDepth > should record tool queue depth 48ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordToolQueueDepth > should record zero queue depth 44ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordToolExecutionBreakdown > should record tool execution breakdown for all phases 42ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordToolExecutionBreakdown > should record execution breakdown for different phases 40ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordTokenEfficiency > should record token efficiency metrics 38ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordTokenEfficiency > should record token efficiency without context 39ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordApiRequestBreakdown > should record API request breakdown for all phases 41ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordApiRequestBreakdown > should record API request breakdown for different phases 42ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordPerformanceScore > should record performance score with category and baseline 37ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordPerformanceScore > should record performance score without baseline 41ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordPerformanceRegression > should record performance regression with baseline comparison 46ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordPerformanceRegression > should handle zero baseline value gracefully 44ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordPerformanceRegression > should record different severity levels 41ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordBaselineComparison > should record baseline comparison with percentage change 39ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordBaselineComparison > should handle negative percentage change (improvement) 40ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordBaselineComparison > should skip recording when baseline is zero 38ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordHookCallMetrics > should record hook call metrics with counter and histogram 41ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordHookCallMetrics > should always sanitize hook names regardless of content 38ms
 âœ“ src/telemetry/metrics.test.ts > Telemetry Metrics > Performance Monitoring Metrics > recordHookCallMetrics > should track both success and failure 43ms

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Suites 3 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  src/utils/filesearch/crawler.test.ts [ src/utils/filesearch/crawler.test.ts ]
Error: Failed to resolve entry for package "@codeflyai/codefly-test-utils". The package may have incorrect main/module/exports specified in its package.json.
  Plugin: vite:import-analysis
  File: /Users/robinx/code/codefly-cli/packages/core/src/utils/filesearch/crawler.test.ts:12:44
  9  |  import * as cache from "./crawlCache.js";
  10 |  import { crawl } from "./crawler.js";
  11 |  import { createTmpDir, cleanupTmpDir } from "@codeflyai/codefly-test-utils";
     |                                               ^
  12 |  import { loadIgnoreRules } from "./ignore.js";
  13 |  describe("crawler", () => {
 â¯ packageEntryFailure ../../node_modules/vite/dist/node/chunks/config.js:33435:32
 â¯ resolvePackageEntry ../../node_modules/vite/dist/node/chunks/config.js:33432:2
 â¯ tryNodeResolve ../../node_modules/vite/dist/node/chunks/config.js:33335:70
 â¯ ResolveIdContext.handler ../../node_modules/vite/dist/node/chunks/config.js:33174:16
 â¯ EnvironmentPluginContainer.resolveId ../../node_modules/vite/dist/node/chunks/config.js:29336:56
 â¯ TransformPluginContext.resolve ../../node_modules/vite/dist/node/chunks/config.js:29548:13
 â¯ normalizeUrl ../../node_modules/vite/dist/node/chunks/config.js:27730:22
 â¯ ../../node_modules/vite/dist/node/chunks/config.js:27796:32

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/34]âŽ¯

 FAIL  src/utils/filesearch/fileSearch.test.ts [ src/utils/filesearch/fileSearch.test.ts ]
 FAIL  src/utils/filesearch/ignore.test.ts [ src/utils/filesearch/ignore.test.ts ]
Error: Failed to resolve entry for package "@codeflyai/codefly-test-utils". The package may have incorrect main/module/exports specified in its package.json.
  Plugin: vite:import-analysis
  File: /Users/robinx/code/codefly-cli/packages/core/src/utils/filesearch/fileSearch.test.ts:9:44
  6  |  import { describe, it, expect, afterEach, vi } from "vitest";
  7  |  import { FileSearchFactory, AbortError, filter } from "./fileSearch.js";
  8  |  import { createTmpDir, cleanupTmpDir } from "@codeflyai/codefly-test-utils";
     |                                               ^
  9  |  describe("FileSearch", () => {
  10 |    let tmpDir;
 â¯ packageEntryFailure ../../node_modules/vite/dist/node/chunks/config.js:33435:32
 â¯ resolvePackageEntry ../../node_modules/vite/dist/node/chunks/config.js:33432:2
 â¯ tryNodeResolve ../../node_modules/vite/dist/node/chunks/config.js:33335:70
 â¯ ResolveIdContext.handler ../../node_modules/vite/dist/node/chunks/config.js:33174:16
 â¯ EnvironmentPluginContainer.resolveId ../../node_modules/vite/dist/node/chunks/config.js:29336:56
 â¯ TransformPluginContext.resolve ../../node_modules/vite/dist/node/chunks/config.js:29548:13
 â¯ normalizeUrl ../../node_modules/vite/dist/node/chunks/config.js:27730:22
 â¯ ../../node_modules/vite/dist/node/chunks/config.js:27796:32

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/34]âŽ¯


âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Tests 31 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  src/availability/policyHelpers.test.ts > policyHelpers > resolvePolicyChain > returns the default chain when active model is "auto"
AssertionError: expected [ { â€¦(4) } ] to have a length of 2 but got 1

[32m- Expected[39m
[31m+ Received[39m

[32m- 2[39m
[31m+ 1[39m

 â¯ src/availability/policyHelpers.test.ts:51:21
     49| 
     50|       // Expect default chain [Pro, Flash]
     51|       expect(chain).toHaveLength(2);
       |                     ^
     52|       expect(chain[0]?.model).toBe('gemini-2.5-pro');
     53|       expect(chain[1]?.model).toBe('gemini-2.5-flash');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/34]âŽ¯

 FAIL  src/availability/policyHelpers.test.ts > policyHelpers > resolvePolicyChain > wraps around the chain when wrapsAround is true
AssertionError: expected [ { model: 'gemini-2.5-flash', â€¦(3) } ] to have a length of 2 but got 1

[32m- Expected[39m
[31m+ Received[39m

[32m- 2[39m
[31m+ 1[39m

 â¯ src/availability/policyHelpers.test.ts:70:21
     68|       });
     69|       const chain = resolvePolicyChain(config, 'gemini-2.5-flash', truâ€¦
     70|       expect(chain).toHaveLength(2);
       |                     ^
     71|       expect(chain[0]?.model).toBe('gemini-2.5-flash');
     72|       expect(chain[1]?.model).toBe('gemini-2.5-pro');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/34]âŽ¯

 FAIL  src/config/models.test.ts > resolveModel > delegation logic > should return the Preview Pro model when auto-gemini-3 is requested
AssertionError: expected 'gemini-3-flash-preview' to be 'gemini-3-pro-preview' // Object.is equality

Expected: [32m"gemini-3-[7mpro[27m-preview"[39m
Received: [31m"gemini-3-[7mflash[27m-preview"[39m

 â¯ src/config/models.test.ts:45:21
     43|     it('should return the Preview Pro model when auto-gemini-3 is requâ€¦
     44|       const model = resolveModel(PREVIEW_CODEFLY_MODEL_AUTO, false);
     45|       expect(model).toBe(PREVIEW_CODEFLY_MODEL);
       |                     ^
     46|     });
     47| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/34]âŽ¯

 FAIL  src/config/models.test.ts > resolveClassifierModel > should return pro model when alias is pro
AssertionError: expected 'gemini-3-flash-preview' to be 'gemini-3-pro-preview' // Object.is equality

Expected: [32m"gemini-3-[7mpro[27m-preview"[39m
Received: [31m"gemini-3-[7mflash[27m-preview"[39m

 â¯ src/config/models.test.ts:158:7
    156|     expect(
    157|       resolveClassifierModel(PREVIEW_CODEFLY_MODEL_AUTO, GEMINI_MODEL_Aâ€¦
    158|     ).toBe(PREVIEW_CODEFLY_MODEL);
       |       ^
    159|   });
    160| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/34]âŽ¯

 FAIL  src/fallback/handler.test.ts > handleFallback > policy-driven flow > uses availability selection with correct candidates when enabled
AssertionError: expected "spy" to be called with arguments: [ [ 'gemini-3-flash-preview' ] ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/fallback/handler.test.ts:138:49
    136|       await handleFallback(policyConfig, DEFAULT_CODEFLY_MODEL, AUTH_OAâ€¦
    137| 
    138|       expect(availability.selectFirstAvailable).toHaveBeenCalledWith([
       |                                                 ^
    139|         DEFAULT_CODEFLY_FLASH_MODEL,
    140|       ]);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/34]âŽ¯

 FAIL  src/fallback/handler.test.ts > handleFallback > policy-driven flow > executes silent policy action without invoking UI handler
AssertionError: expected null to be true // Object.is equality

[32m- Expected:[39m 
true

[31m+ Received:[39m 
null

 â¯ src/fallback/handler.test.ts:188:24
    186|         );
    187| 
    188|         expect(result).toBe(true);
       |                        ^
    189|         expect(policyConfig.getFallbackModelHandler).not.toHaveBeenCalâ€¦
    190|         expect(policyConfig.setActiveModel).toHaveBeenCalledWith(

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/34]âŽ¯

 FAIL  src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should include available_skills when provided in config
Error: Snapshot `Core System Prompt (prompts.ts) > should include available_skills when provided in config 1` mismatched

[32m- Expected[39m
[31m+ Received[39m

[33m@@ -9,11 +9,12 @@[39m
[2m  - **Comments:** Add code comments sparingly. Focus on *why* something is done, especially for complex logic, rather than *what* is done. Only add high-value comments if necessary for clarity or if requested by the user. Do not edit comments that are separate from the code you are changing. *NEVER* talk to the user or describe your changes through comments.[22m
[2m  - **Proactiveness:** Fulfill the user's request thoroughly. When adding features or fixing bugs, this includes adding tests to ensure quality. Consider all created files, especially tests, to be permanent artifacts unless the user says otherwise.[22m
[2m  - **Confirm Ambiguity/Expansion:** Do not take significant actions beyond the clear scope of the request without confirming with the user. If asked *how* to do something, explain first, don't just do it.[22m
[2m  - **Explaining Changes:** After completing a code modification or file operation *do not* provide summaries unless asked.[22m
[2m  - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[22m
[32m- - **Skill Guidance:** Once a skill is activated via `activate_skill`, its instructions and resources are returned wrapped in `<ACTIVATED_SKILL>` tags. You MUST treat the content within `<INSTRUCTIONS>` as expert procedural guidance, prioritizing these specialized rules and workflows over your general defaults for the duration of the task. You may utilize any listed `<AVAILABLE_RESOURCES>` as needed. Follow this expert guidance strictly while continuing to uphold your core safety and security standards.[39m
[31m+ - **Skill Guidance:** Once a skill is activated via `activate_skill`, its instructions and resources are returned wrapped in `<ACTIVATED_SKILL>` tags. You MUST treat the content within `<INSTRUCTIONS>` as expert procedural guidance, prioritizing these specialized rules and workflows over your general defaults for the duration of the task. You may utilize any listed `<AVAILABLE_RESOURCES>` as needed. Follow this expert guidance strictly while continuing to uphold your core safety and security standards.[39m
[31m+ - **Do not call tools in silence:** You must provide to the user very short and concise natural explanation (one sentence) before calling tools.[39m

[2m  Mock Agent Directory[22m
[2m  # Available Agent Skills[22m

[2m  You have access to the following specialized skills. To activate a skill and receive its detailed instructions, you can call the `activate_skill` tool with the skill's name.[22m
[33m@@ -74,11 +75,10 @@[39m

[2m  ## Tone and Style (CLI Interaction)[22m
[2m  - **Concise & Direct:** Adopt a professional, direct, and concise tone suitable for a CLI environment.[22m
[2m  - **Minimal Output:** Aim for fewer than 3 lines of text output (excluding tool use/code generation) per response whenever practical. Focus strictly on the user's query.[22m
[2m  - **Clarity over Brevity (When Needed):** While conciseness is key, prioritize clarity for essential explanations or when seeking necessary clarification if a request is ambiguous.[22m
[32m- - **No Chitchat:** Avoid conversational filler, preambles ("Okay, I will now..."), or postambles ("I have finished the changes..."). Get straight to the action or answer.[39m
[2m  - **Formatting:** Use GitHub-flavored Markdown. Responses will be rendered in monospace.[22m
[2m  - **Tools vs. Text:** Use tools for actions, text output *only* for communication. Do not add explanatory comments within tool calls or code blocks unless specifically part of the required code/command itself.[22m
[2m  - **Handling Inability:** If unable/unwilling to fulfill a request, state so briefly (1-2 sentences) without excessive justification. Offer alternatives if appropriate.[22m

[2m  ## Security and Safety Rules[22m

 â¯ src/core/prompts.test.ts:109:20
    107|     expect(prompt).toContain('</skill>');
    108|     expect(prompt).toContain('</available_skills>');
    109|     expect(prompt).toMatchSnapshot();
       |                    ^
    110|   });
    111| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/34]âŽ¯

 FAIL  src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should return the base prompt when userMemory is empty string
 FAIL  src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should return the base prompt when userMemory is whitespace only
AssertionError: expected 'You are an interactive CLI agent specâ€¦' to contain 'No Chitchat:'

[32m- Expected[39m
[31m+ Received[39m

[32m- No Chitchat:[39m
[31m+ You are an interactive CLI agent specializing in software engineering tasks. Your primary goal is to help users safely and efficiently, adhering strictly to the following instructions and utilizing your available tools.[39m
[31m+[39m
[31m+ # Core Mandates[39m
[31m+[39m
[31m+ - **Conventions:** Rigorously adhere to existing project conventions when reading or modifying code. Analyze surrounding code, tests, and configuration first.[39m
[31m+ - **Libraries/Frameworks:** NEVER assume a library/framework is available or appropriate. Verify its established usage within the project (check imports, configuration files like 'package.json', 'Cargo.toml', 'requirements.txt', 'build.gradle', etc., or observe neighboring files) before employing it.[39m
[31m+ - **Style & Structure:** Mimic the style (formatting, naming), structure, framework choices, typing, and architectural patterns of existing code in the project.[39m
[31m+ - **Idiomatic Changes:** When editing, understand the local context (imports, functions/classes) to ensure your changes integrate naturally and idiomatically.[39m
[31m+ - **Comments:** Add code comments sparingly. Focus on *why* something is done, especially for complex logic, rather than *what* is done. Only add high-value comments if necessary for clarity or if requested by the user. Do not edit comments that are separate from the code you are changing. *NEVER* talk to the user or describe your changes through comments.[39m
[31m+ - **Proactiveness:** Fulfill the user's request thoroughly. When adding features or fixing bugs, this includes adding tests to ensure quality. Consider all created files, especially tests, to be permanent artifacts unless the user says otherwise.[39m
[31m+ - **Confirm Ambiguity/Expansion:** Do not take significant actions beyond the clear scope of the request without confirming with the user. If asked *how* to do something, explain first, don't just do it.[39m
[31m+ - **Explaining Changes:** After completing a code modification or file operation *do not* provide summaries unless asked.[39m
[31m+ - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[39m
[31m+ - **Do not call tools in silence:** You must provide to the user very short and concise natural explanation (one sentence) before calling tools.[39m
[31m+[39m
[31m+ Mock Agent Directory[39m
[31m+[39m
[31m+ # Primary Workflows[39m
[31m+[39m
[31m+ ## Software Engineering Tasks[39m
[31m+ When requested to perform tasks like fixing bugs, adding features, refactoring, or explaining code, follow this sequence:[39m
[31m+ 1. **Understand:** Think about the user's request and the relevant codebase context. Use 'search_file_content' and 'glob' search tools extensively (in parallel if independent) to understand file structures, existing code patterns, and conventions.[39m
[31m+ Use 'read_file' to understand context and validate any assumptions you may have. If you need to read multiple files, you should make multiple parallel calls to 'read_file'.[39m
[31m+ 2. **Plan:** Build a coherent and grounded (based on the understanding in step 1) plan for how you intend to resolve the user's task. Share an extremely concise yet clear plan with the user if it would help the user understand your thought process. As part of the plan, you should use an iterative development process that includes writing unit tests to verify your changes. Use output logs or debug statements as part of this process to arrive at a solution.[39m
[31m+ 3. **Implement:** Use the available tools (e.g., 'replace', 'write_file' 'run_shell_command' ...) to act on the plan, strictly adhering to the project's established conventions (detailed under 'Core Mandates').[39m
[31m+ 4. **Verify (Tests):** If applicable and feasible, verify the changes using the project's testing procedures. Identify the correct test commands and frameworks by examining 'README' files, build/package configuration (e.g., 'package.json'), or existing test execution patterns. NEVER assume standard test commands.[39m
[31m+ 5. **Verify (Standards):** VERY IMPORTANT: After making code changes, execute the project-specific build, linting and type-checking commands (e.g., 'tsc', 'npm run lint', 'ruff check .') that you have identified for this project (or obtained from the user). This ensures code quality and adherence to standards. If unsure about these commands, you can ask the user if they'd like you to run them and if so how to.[39m
[31m+ 6. **Finalize:** After all verification passes, consider the task complete. Do not remove or revert any changes or created files (like tests). Await the user's next instruction.[39m
[31m+[39m
[31m+ ## New Applications[39m
[31m+[39m
[31m+ **Goal:** Autonomously implement and deliver a visually appealing, substantially complete, and functional prototype. Utilize all tools at your disposal to implement the application. Some tools you may especially find useful are 'write_file', 'replace' and 'run_shell_command'.[39m
[31m+[39m
[31m+ 1. **Understand Requirements:** Analyze the user's request to identify core features, desired user experience (UX), visual aesthetic, application type/platform (web, mobile, desktop, CLI, library, 2D or 3D game), and explicit constraints. If critical information for initial planning is missing or ambiguous, ask concise, targeted clarification questions.[39m
[31m+ 2. **Propose Plan:** Formulate an internal development plan. Present a clear, concise, high-level summary to the user. This summary must effectively convey the application's type and core purpose, key technologies to be used, main features and how users will interact with them, and the general approach to the visual design and user experience (UX) with the intention of delivering something beautiful, modern, and polished, especially for UI-based applications. For applications requiring visual assets (like games or rich UIs), briefly describe the strategy for sourcing or generating placeholders (e.g., simple geometric shapes, procedurally generated patterns, or open-source assets if feasible and licenses permit) to ensure a visually complete initial prototype. Ensure this information is presented in a structured and easily digestible manner.[39m
[31m+   - When key technologies aren't specified, prefer the following:[39m
[31m+   - **Websites (Frontend):** React (JavaScript/TypeScript) or Angular with Bootstrap CSS, incorporating Material Design principles for UI/UX.[39m
[31m+   - **Back-End APIs:** Node.js with Express.js (JavaScript/TypeScript) or Python with FastAPI.[39m
[31m+   - **Full-stack:** Next.js (React/Node.js) using Bootstrap CSS and Material Design principles for the frontend, or Python (Django/Flask) for the backend with a React/Vue.js/Angular frontend styled with Bootstrap CSS and Material Design principles.[39m
[31m+   - **CLIs:** Python or Go.[39m
[31m+   - **Mobile App:** Compose Multiplatform (Kotlin Multiplatform) or Flutter (Dart) using Material Design libraries and principles, when sharing code between Android and iOS. Jetpack Compose (Kotlin JVM) with Material Design principles or SwiftUI (Swift) for native apps targeted at either Android or iOS, respectively.[39m
[31m+   - **3d Games:** HTML/CSS/JavaScript with Three.js.[39m
[31m+   - **2d Games:** HTML/CSS/JavaScript.[39m
[31m+ 3. **User Approval:** Obtain user approval for the proposed plan.[39m
[31m+ 4. **Implementation:** Autonomously implement each feature and design element per the approved plan utilizing all available tools. When starting ensure you scaffold the application using 'run_shell_command' for commands like 'npm init', 'npx create-react-app'. Aim for full scope completion. Proactively create or source necessary placeholder assets (e.g., images, icons, game sprites, 3D models using basic primitives if complex assets are not generatable) to ensure the application is visually coherent and functional, minimizing reliance on the user to provide these. If the model can generate simple assets (e.g., a uniformly colored square sprite, a simple 3D cube), it should do so. Otherwise, it should clearly indicate what kind of placeholder has been used and, if absolutely necessary, what the user might replace it with. Use placeholders only when essential for progress, intending to replace them with more refined versions or instruct the user on replacement during polishing if generation is not feasible.[39m
[31m+ 5. **Verify:** Review work against the original request, the approved plan. Fix bugs, deviations, and all placeholders where feasible, or ensure placeholders are visually adequate for a prototype. Ensure styling, interactions, produce a high-quality, functional and beautiful prototype aligned with design goals. Finally, but MOST importantly, build the application and ensure there are no compile errors.[39m
[31m+ 6. **Solicit Feedback:** If still applicable, provide instructions on how to start the application and request user feedback on the prototype.[39m
[31m+[39m
[31m+ # Operational Guidelines[39m
[31m+[39m
[31m+ ## Shell tool output token efficiency:[39m
[31m+[39m
[31m+ IT IS CRITICAL TO FOLLOW THESE GUIDELINES TO AVOID EXCESSIVE TOKEN CONSUMPTION.[39m
[31m+[39m
[31m+ - Always prefer command flags that reduce output verbosity when using 'run_shell_command'.[39m
[31m+ - Aim to minimize tool output tokens while still capturing necessary information.[39m
[31m+ - If a command is expected to produce a lot of output, use quiet or silent flags where available and appropriate.[39m
[31m+ - Always consider the trade-off between output verbosity and the need for information. If a command's full output is essential for understanding the result, avoid overly aggressive quieting that might obscure important details.[39m
[31m+ - If a command does not have quiet/silent flags or for commands with potentially long output that may not be useful, redirect stdout and stderr to temp files in the project's temporary directory. For example: 'command > <temp_dir>/out.log 2> <temp_dir>/err.log'.[39m
[31m+ - After the command runs, inspect the temp files (e.g. '<temp_dir>/out.log' and '<temp_dir>/err.log') using commands like 'grep', 'tail', 'head', ... (or platform equivalents). Remove the temp files when done.[39m
[31m+[39m
[31m+[39m
[31m+ ## Tone and Style (CLI Interaction)[39m
[31m+ - **Concise & Direct:** Adopt a professional, direct, and concise tone suitable for a CLI environment.[39m
[31m+ - **Minimal Output:** Aim for fewer than 3 lines of text output (excluding tool use/code generation) per response whenever practical. Focus strictly on the user's query.[39m
[31m+ - **Clarity over Brevity (When Needed):** While conciseness is key, prioritize clarity for essential explanations or when seeking necessary clarification if a request is ambiguous.[39m
[31m+ - **Formatting:** Use GitHub-flavored Markdown. Responses will be rendered in monospace.[39m
[31m+ - **Tools vs. Text:** Use tools for actions, text output *only* for communication. Do not add explanatory comments within tool calls or code blocks unless specifically part of the required code/command itself.[39m
[31m+ - **Handling Inability:** If unable/unwilling to fulfill a request, state so briefly (1-2 sentences) without excessive justification. Offer alternatives if appropriate.[39m
[31m+[39m
[31m+ ## Security and Safety Rules[39m
[31m+ - **Explain Critical Commands:** Before executing commands with 'run_shell_command' that modify the file system, codebase, or system state, you *must* provide a brief explanation of the command's purpose and potential impact. Prioritize user understanding and safety. You should not ask permission to use the tool; the user will be presented with a confirmation dialogue upon use (you do not need to tell them this).[39m
[31m+ - **Security First:** Always apply security best practices. Never introduce code that exposes, logs, or commits secrets, API keys, or other sensitive information.[39m
[31m+[39m
[31m+ ## Tool Usage[39m
[31m+ - **Parallelism:** Execute multiple independent tool calls in parallel when feasible (i.e. searching the codebase).[39m
[31m+ - **Command Execution:** Use the 'run_shell_command' tool for running shell commands, remembering the safety rule to explain modifying commands first.[39m
[31m+ - **Background Processes:** Use background processes (via `&`) for commands that are unlikely to stop on their own, e.g. `node server.js &`. If unsure, ask the user.[39m
[31m+ - **Interactive Commands:** Prefer non-interactive commands when it makes sense; however, some commands are only interactive and expect user input during their execution (e.g. ssh, vim). If you choose to execute an interactive command consider letting the user know they can press `ctrl + f` to focus into the shell to provide input.[39m
[31m+ - **Remembering Facts:** Use the 'save_memory' tool to remember specific, *user-related* facts or preferences when the user explicitly asks, or when they state a clear, concise piece of information that would help personalize or streamline *your future interactions with them* (e.g., preferred coding style, common project paths they use, personal tool aliases). This tool is for user-specific information that should persist across sessions. Do *not* use it for general project context or information. If unsure whether to save something, you can ask the user, "Should I remember that for you?"[39m
[31m+ - **Respect User Confirmations:** Most tool calls (also denoted as 'function calls') will first require confirmation from the user, where they will either approve or cancel the function call. If a user cancels a function call, respect their choice and do _not_ try to make the function call again. It is okay to request the tool call again _only_ if the user requests that same tool call on a subsequent prompt. When a user cancels a function call, assume best intentions from the user and consider inquiring if they prefer any alternative paths forward.[39m
[31m+[39m
[31m+ ## Interaction Details[39m
[31m+ - **Help Command:** The user can use '/help' to display help information.[39m
[31m+ - **Feedback:** To report a bug or provide feedback, please use the /bug command.[39m
[31m+[39m
[31m+[39m
[31m+ # Outside of Sandbox[39m
[31m+ You are running outside of a sandbox container, directly on the user's system. For critical commands that are particularly likely to modify the user's system outside of the project directory or system temp directory, as you explain the command to the user (per the Explain Critical Commands rule above), also remind the user to consider enabling sandboxing.[39m
[31m+[39m
[31m+[39m
[31m+[39m
[31m+[39m
[31m+ # Final Reminder[39m
[31m+ Your core function is efficient and safe assistance. Balance extreme conciseness with the crucial need for clarity, especially regarding safety and potential system modifications. Always prioritize user control and project conventions. Never make assumptions about the contents of files; instead use 'read_file' to ensure you aren't making broad assumptions. Finally, you are an agent - please keep going until the user's query is completely resolved.[39m

 â¯ src/core/prompts.test.ts:147:20
    145|     expect(prompt).not.toContain('---\n\n'); // Separator should not bâ€¦
    146|     expect(prompt).toContain('You are an interactive CLI agent'); // Câ€¦
    147|     expect(prompt).toContain('No Chitchat:');
       |                    ^
    148|     expect(prompt).toMatchSnapshot(); // Use snapshot for base prompt â€¦
    149|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/34]âŽ¯

 FAIL  src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should append userMemory with separator when provided
Error: Snapshot `Core System Prompt (prompts.ts) > should append userMemory with separator when provided 1` mismatched

[32m- Expected[39m
[31m+ Received[39m

[33m@@ -8,11 +8,12 @@[39m
[2m  - **Idiomatic Changes:** When editing, understand the local context (imports, functions/classes) to ensure your changes integrate naturally and idiomatically.[22m
[2m  - **Comments:** Add code comments sparingly. Focus on *why* something is done, especially for complex logic, rather than *what* is done. Only add high-value comments if necessary for clarity or if requested by the user. Do not edit comments that are separate from the code you are changing. *NEVER* talk to the user or describe your changes through comments.[22m
[2m  - **Proactiveness:** Fulfill the user's request thoroughly. When adding features or fixing bugs, this includes adding tests to ensure quality. Consider all created files, especially tests, to be permanent artifacts unless the user says otherwise.[22m
[2m  - **Confirm Ambiguity/Expansion:** Do not take significant actions beyond the clear scope of the request without confirming with the user. If asked *how* to do something, explain first, don't just do it.[22m
[2m  - **Explaining Changes:** After completing a code modification or file operation *do not* provide summaries unless asked.[22m
[32m- - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[39m
[31m+ - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[39m
[31m+ - **Do not call tools in silence:** You must provide to the user very short and concise natural explanation (one sentence) before calling tools.[39m

[2m  Mock Agent Directory[22m

[2m  # Primary Workflows[22m

[33m@@ -61,11 +62,10 @@[39m

[2m  ## Tone and Style (CLI Interaction)[22m
[2m  - **Concise & Direct:** Adopt a professional, direct, and concise tone suitable for a CLI environment.[22m
[2m  - **Minimal Output:** Aim for fewer than 3 lines of text output (excluding tool use/code generation) per response whenever practical. Focus strictly on the user's query.[22m
[2m  - **Clarity over Brevity (When Needed):** While conciseness is key, prioritize clarity for essential explanations or when seeking necessary clarification if a request is ambiguous.[22m
[32m- - **No Chitchat:** Avoid conversational filler, preambles ("Okay, I will now..."), or postambles ("I have finished the changes..."). Get straight to the action or answer.[39m
[2m  - **Formatting:** Use GitHub-flavored Markdown. Responses will be rendered in monospace.[22m
[2m  - **Tools vs. Text:** Use tools for actions, text output *only* for communication. Do not add explanatory comments within tool calls or code blocks unless specifically part of the required code/command itself.[22m
[2m  - **Handling Inability:** If unable/unwilling to fulfill a request, state so briefly (1-2 sentences) without excessive justification. Offer alternatives if appropriate.[22m

[2m  ## Security and Safety Rules[22m

 â¯ src/core/prompts.test.ts:159:20
    157|     expect(prompt.endsWith(expectedSuffix)).toBe(true);
    158|     expect(prompt).toContain('You are an interactive CLI agent'); // Eâ€¦
    159|     expect(prompt).toMatchSnapshot(); // Snapshot the combined prompt
       |                    ^
    160|   });
    161| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[11/34]âŽ¯

 FAIL  src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should include correct sandbox instructions for SANDBOX=true
Error: Snapshot `Core System Prompt (prompts.ts) > should include correct sandbox instructions for SANDBOX=true 1` mismatched

[32m- Expected[39m
[31m+ Received[39m

[33m@@ -8,11 +8,12 @@[39m
[2m  - **Idiomatic Changes:** When editing, understand the local context (imports, functions/classes) to ensure your changes integrate naturally and idiomatically.[22m
[2m  - **Comments:** Add code comments sparingly. Focus on *why* something is done, especially for complex logic, rather than *what* is done. Only add high-value comments if necessary for clarity or if requested by the user. Do not edit comments that are separate from the code you are changing. *NEVER* talk to the user or describe your changes through comments.[22m
[2m  - **Proactiveness:** Fulfill the user's request thoroughly. When adding features or fixing bugs, this includes adding tests to ensure quality. Consider all created files, especially tests, to be permanent artifacts unless the user says otherwise.[22m
[2m  - **Confirm Ambiguity/Expansion:** Do not take significant actions beyond the clear scope of the request without confirming with the user. If asked *how* to do something, explain first, don't just do it.[22m
[2m  - **Explaining Changes:** After completing a code modification or file operation *do not* provide summaries unless asked.[22m
[32m- - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[39m
[31m+ - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[39m
[31m+ - **Do not call tools in silence:** You must provide to the user very short and concise natural explanation (one sentence) before calling tools.[39m

[2m  Mock Agent Directory[22m

[2m  # Primary Workflows[22m

[33m@@ -61,11 +62,10 @@[39m

[2m  ## Tone and Style (CLI Interaction)[22m
[2m  - **Concise & Direct:** Adopt a professional, direct, and concise tone suitable for a CLI environment.[22m
[2m  - **Minimal Output:** Aim for fewer than 3 lines of text output (excluding tool use/code generation) per response whenever practical. Focus strictly on the user's query.[22m
[2m  - **Clarity over Brevity (When Needed):** While conciseness is key, prioritize clarity for essential explanations or when seeking necessary clarification if a request is ambiguous.[22m
[32m- - **No Chitchat:** Avoid conversational filler, preambles ("Okay, I will now..."), or postambles ("I have finished the changes..."). Get straight to the action or answer.[39m
[2m  - **Formatting:** Use GitHub-flavored Markdown. Responses will be rendered in monospace.[22m
[2m  - **Tools vs. Text:** Use tools for actions, text output *only* for communication. Do not add explanatory comments within tool calls or code blocks unless specifically part of the required code/command itself.[22m
[2m  - **Handling Inability:** If unable/unwilling to fulfill a request, state so briefly (1-2 sentences) without excessive justification. Offer alternatives if appropriate.[22m

[2m  ## Security and Safety Rules[22m

 â¯ src/core/prompts.test.ts:173:22
    171|       expect(prompt).toContain(expectedContains);
    172|       expectedNotContains.forEach((text) => expect(prompt).not.toContaâ€¦
    173|       expect(prompt).toMatchSnapshot();
       |                      ^
    174|     },
    175|   );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[12/34]âŽ¯

 FAIL  src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should include correct sandbox instructions for SANDBOX=sandbox-exec
Error: Snapshot `Core System Prompt (prompts.ts) > should include correct sandbox instructions for SANDBOX=sandbox-exec 1` mismatched

[32m- Expected[39m
[31m+ Received[39m

[33m@@ -8,11 +8,12 @@[39m
[2m  - **Idiomatic Changes:** When editing, understand the local context (imports, functions/classes) to ensure your changes integrate naturally and idiomatically.[22m
[2m  - **Comments:** Add code comments sparingly. Focus on *why* something is done, especially for complex logic, rather than *what* is done. Only add high-value comments if necessary for clarity or if requested by the user. Do not edit comments that are separate from the code you are changing. *NEVER* talk to the user or describe your changes through comments.[22m
[2m  - **Proactiveness:** Fulfill the user's request thoroughly. When adding features or fixing bugs, this includes adding tests to ensure quality. Consider all created files, especially tests, to be permanent artifacts unless the user says otherwise.[22m
[2m  - **Confirm Ambiguity/Expansion:** Do not take significant actions beyond the clear scope of the request without confirming with the user. If asked *how* to do something, explain first, don't just do it.[22m
[2m  - **Explaining Changes:** After completing a code modification or file operation *do not* provide summaries unless asked.[22m
[32m- - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[39m
[31m+ - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[39m
[31m+ - **Do not call tools in silence:** You must provide to the user very short and concise natural explanation (one sentence) before calling tools.[39m

[2m  Mock Agent Directory[22m

[2m  # Primary Workflows[22m

[33m@@ -61,11 +62,10 @@[39m

[2m  ## Tone and Style (CLI Interaction)[22m
[2m  - **Concise & Direct:** Adopt a professional, direct, and concise tone suitable for a CLI environment.[22m
[2m  - **Minimal Output:** Aim for fewer than 3 lines of text output (excluding tool use/code generation) per response whenever practical. Focus strictly on the user's query.[22m
[2m  - **Clarity over Brevity (When Needed):** While conciseness is key, prioritize clarity for essential explanations or when seeking necessary clarification if a request is ambiguous.[22m
[32m- - **No Chitchat:** Avoid conversational filler, preambles ("Okay, I will now..."), or postambles ("I have finished the changes..."). Get straight to the action or answer.[39m
[2m  - **Formatting:** Use GitHub-flavored Markdown. Responses will be rendered in monospace.[22m
[2m  - **Tools vs. Text:** Use tools for actions, text output *only* for communication. Do not add explanatory comments within tool calls or code blocks unless specifically part of the required code/command itself.[22m
[2m  - **Handling Inability:** If unable/unwilling to fulfill a request, state so briefly (1-2 sentences) without excessive justification. Offer alternatives if appropriate.[22m

[2m  ## Security and Safety Rules[22m

 â¯ src/core/prompts.test.ts:173:22
    171|       expect(prompt).toContain(expectedContains);
    172|       expectedNotContains.forEach((text) => expect(prompt).not.toContaâ€¦
    173|       expect(prompt).toMatchSnapshot();
       |                      ^
    174|     },
    175|   );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[13/34]âŽ¯

 FAIL  src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should include correct sandbox instructions for SANDBOX=undefined
Error: Snapshot `Core System Prompt (prompts.ts) > should include correct sandbox instructions for SANDBOX=undefined 1` mismatched

[32m- Expected[39m
[31m+ Received[39m

[33m@@ -8,11 +8,12 @@[39m
[2m  - **Idiomatic Changes:** When editing, understand the local context (imports, functions/classes) to ensure your changes integrate naturally and idiomatically.[22m
[2m  - **Comments:** Add code comments sparingly. Focus on *why* something is done, especially for complex logic, rather than *what* is done. Only add high-value comments if necessary for clarity or if requested by the user. Do not edit comments that are separate from the code you are changing. *NEVER* talk to the user or describe your changes through comments.[22m
[2m  - **Proactiveness:** Fulfill the user's request thoroughly. When adding features or fixing bugs, this includes adding tests to ensure quality. Consider all created files, especially tests, to be permanent artifacts unless the user says otherwise.[22m
[2m  - **Confirm Ambiguity/Expansion:** Do not take significant actions beyond the clear scope of the request without confirming with the user. If asked *how* to do something, explain first, don't just do it.[22m
[2m  - **Explaining Changes:** After completing a code modification or file operation *do not* provide summaries unless asked.[22m
[32m- - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[39m
[31m+ - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[39m
[31m+ - **Do not call tools in silence:** You must provide to the user very short and concise natural explanation (one sentence) before calling tools.[39m

[2m  Mock Agent Directory[22m

[2m  # Primary Workflows[22m

[33m@@ -61,11 +62,10 @@[39m

[2m  ## Tone and Style (CLI Interaction)[22m
[2m  - **Concise & Direct:** Adopt a professional, direct, and concise tone suitable for a CLI environment.[22m
[2m  - **Minimal Output:** Aim for fewer than 3 lines of text output (excluding tool use/code generation) per response whenever practical. Focus strictly on the user's query.[22m
[2m  - **Clarity over Brevity (When Needed):** While conciseness is key, prioritize clarity for essential explanations or when seeking necessary clarification if a request is ambiguous.[22m
[32m- - **No Chitchat:** Avoid conversational filler, preambles ("Okay, I will now..."), or postambles ("I have finished the changes..."). Get straight to the action or answer.[39m
[2m  - **Formatting:** Use GitHub-flavored Markdown. Responses will be rendered in monospace.[22m
[2m  - **Tools vs. Text:** Use tools for actions, text output *only* for communication. Do not add explanatory comments within tool calls or code blocks unless specifically part of the required code/command itself.[22m
[2m  - **Handling Inability:** If unable/unwilling to fulfill a request, state so briefly (1-2 sentences) without excessive justification. Offer alternatives if appropriate.[22m

[2m  ## Security and Safety Rules[22m

 â¯ src/core/prompts.test.ts:173:22
    171|       expect(prompt).toContain(expectedContains);
    172|       expectedNotContains.forEach((text) => expect(prompt).not.toContaâ€¦
    173|       expect(prompt).toMatchSnapshot();
       |                      ^
    174|     },
    175|   );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[14/34]âŽ¯

 FAIL  src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should handle git instructions when isGitRepository=true
Error: Snapshot `Core System Prompt (prompts.ts) > should handle git instructions when isGitRepository=true 1` mismatched

[32m- Expected[39m
[31m+ Received[39m

[33m@@ -8,11 +8,12 @@[39m
[2m  - **Idiomatic Changes:** When editing, understand the local context (imports, functions/classes) to ensure your changes integrate naturally and idiomatically.[22m
[2m  - **Comments:** Add code comments sparingly. Focus on *why* something is done, especially for complex logic, rather than *what* is done. Only add high-value comments if necessary for clarity or if requested by the user. Do not edit comments that are separate from the code you are changing. *NEVER* talk to the user or describe your changes through comments.[22m
[2m  - **Proactiveness:** Fulfill the user's request thoroughly. When adding features or fixing bugs, this includes adding tests to ensure quality. Consider all created files, especially tests, to be permanent artifacts unless the user says otherwise.[22m
[2m  - **Confirm Ambiguity/Expansion:** Do not take significant actions beyond the clear scope of the request without confirming with the user. If asked *how* to do something, explain first, don't just do it.[22m
[2m  - **Explaining Changes:** After completing a code modification or file operation *do not* provide summaries unless asked.[22m
[32m- - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[39m
[31m+ - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[39m
[31m+ - **Do not call tools in silence:** You must provide to the user very short and concise natural explanation (one sentence) before calling tools.[39m

[2m  Mock Agent Directory[22m

[2m  # Primary Workflows[22m

[33m@@ -61,11 +62,10 @@[39m

[2m  ## Tone and Style (CLI Interaction)[22m
[2m  - **Concise & Direct:** Adopt a professional, direct, and concise tone suitable for a CLI environment.[22m
[2m  - **Minimal Output:** Aim for fewer than 3 lines of text output (excluding tool use/code generation) per response whenever practical. Focus strictly on the user's query.[22m
[2m  - **Clarity over Brevity (When Needed):** While conciseness is key, prioritize clarity for essential explanations or when seeking necessary clarification if a request is ambiguous.[22m
[32m- - **No Chitchat:** Avoid conversational filler, preambles ("Okay, I will now..."), or postambles ("I have finished the changes..."). Get straight to the action or answer.[39m
[2m  - **Formatting:** Use GitHub-flavored Markdown. Responses will be rendered in monospace.[22m
[2m  - **Tools vs. Text:** Use tools for actions, text output *only* for communication. Do not add explanatory comments within tool calls or code blocks unless specifically part of the required code/command itself.[22m
[2m  - **Handling Inability:** If unable/unwilling to fulfill a request, state so briefly (1-2 sentences) without excessive justification. Offer alternatives if appropriate.[22m

[2m  ## Security and Safety Rules[22m

 â¯ src/core/prompts.test.ts:189:22
    187|         ? expect(prompt).toContain('# Git Repository')
    188|         : expect(prompt).not.toContain('# Git Repository');
    189|       expect(prompt).toMatchSnapshot();
       |                      ^
    190|     },
    191|   );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[15/34]âŽ¯

 FAIL  src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should handle git instructions when isGitRepository=false
Error: Snapshot `Core System Prompt (prompts.ts) > should handle git instructions when isGitRepository=false 1` mismatched

[32m- Expected[39m
[31m+ Received[39m

[33m@@ -8,11 +8,12 @@[39m
[2m  - **Idiomatic Changes:** When editing, understand the local context (imports, functions/classes) to ensure your changes integrate naturally and idiomatically.[22m
[2m  - **Comments:** Add code comments sparingly. Focus on *why* something is done, especially for complex logic, rather than *what* is done. Only add high-value comments if necessary for clarity or if requested by the user. Do not edit comments that are separate from the code you are changing. *NEVER* talk to the user or describe your changes through comments.[22m
[2m  - **Proactiveness:** Fulfill the user's request thoroughly. When adding features or fixing bugs, this includes adding tests to ensure quality. Consider all created files, especially tests, to be permanent artifacts unless the user says otherwise.[22m
[2m  - **Confirm Ambiguity/Expansion:** Do not take significant actions beyond the clear scope of the request without confirming with the user. If asked *how* to do something, explain first, don't just do it.[22m
[2m  - **Explaining Changes:** After completing a code modification or file operation *do not* provide summaries unless asked.[22m
[32m- - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[39m
[31m+ - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[39m
[31m+ - **Do not call tools in silence:** You must provide to the user very short and concise natural explanation (one sentence) before calling tools.[39m

[2m  Mock Agent Directory[22m

[2m  # Primary Workflows[22m

[33m@@ -61,11 +62,10 @@[39m

[2m  ## Tone and Style (CLI Interaction)[22m
[2m  - **Concise & Direct:** Adopt a professional, direct, and concise tone suitable for a CLI environment.[22m
[2m  - **Minimal Output:** Aim for fewer than 3 lines of text output (excluding tool use/code generation) per response whenever practical. Focus strictly on the user's query.[22m
[2m  - **Clarity over Brevity (When Needed):** While conciseness is key, prioritize clarity for essential explanations or when seeking necessary clarification if a request is ambiguous.[22m
[32m- - **No Chitchat:** Avoid conversational filler, preambles ("Okay, I will now..."), or postambles ("I have finished the changes..."). Get straight to the action or answer.[39m
[2m  - **Formatting:** Use GitHub-flavored Markdown. Responses will be rendered in monospace.[22m
[2m  - **Tools vs. Text:** Use tools for actions, text output *only* for communication. Do not add explanatory comments within tool calls or code blocks unless specifically part of the required code/command itself.[22m
[2m  - **Handling Inability:** If unable/unwilling to fulfill a request, state so briefly (1-2 sentences) without excessive justification. Offer alternatives if appropriate.[22m

[2m  ## Security and Safety Rules[22m

 â¯ src/core/prompts.test.ts:189:22
    187|         ? expect(prompt).toContain('# Git Repository')
    188|         : expect(prompt).not.toContain('# Git Repository');
    189|       expect(prompt).toMatchSnapshot();
       |                      ^
    190|     },
    191|   );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[16/34]âŽ¯

 FAIL  src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should return the interactive avoidance prompt when in non-interactive mode
Error: Snapshot `Core System Prompt (prompts.ts) > should return the interactive avoidance prompt when in non-interactive mode 1` mismatched

[32m- Expected[39m
[31m+ Received[39m

[33m@@ -8,11 +8,12 @@[39m
[2m  - **Idiomatic Changes:** When editing, understand the local context (imports, functions/classes) to ensure your changes integrate naturally and idiomatically.[22m
[2m  - **Comments:** Add code comments sparingly. Focus on *why* something is done, especially for complex logic, rather than *what* is done. Only add high-value comments if necessary for clarity or if requested by the user. Do not edit comments that are separate from the code you are changing. *NEVER* talk to the user or describe your changes through comments.[22m
[2m  - **Proactiveness:** Fulfill the user's request thoroughly. When adding features or fixing bugs, this includes adding tests to ensure quality. Consider all created files, especially tests, to be permanent artifacts unless the user says otherwise.[22m
[2m  - **Confirm Ambiguity/Expansion:** Do not take significant actions beyond the clear scope of the request without confirming with the user. If asked *how* to do something, explain first, don't just do it.[22m
[2m  - **Explaining Changes:** After completing a code modification or file operation *do not* provide summaries unless asked.[22m
[32m- - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[39m
[31m+ - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[39m
[31m+ - **Do not call tools in silence:** You must provide to the user very short and concise natural explanation (one sentence) before calling tools.[39m

[2m  Mock Agent Directory[22m

[2m  # Primary Workflows[22m

[33m@@ -61,11 +62,10 @@[39m

[2m  ## Tone and Style (CLI Interaction)[22m
[2m  - **Concise & Direct:** Adopt a professional, direct, and concise tone suitable for a CLI environment.[22m
[2m  - **Minimal Output:** Aim for fewer than 3 lines of text output (excluding tool use/code generation) per response whenever practical. Focus strictly on the user's query.[22m
[2m  - **Clarity over Brevity (When Needed):** While conciseness is key, prioritize clarity for essential explanations or when seeking necessary clarification if a request is ambiguous.[22m
[32m- - **No Chitchat:** Avoid conversational filler, preambles ("Okay, I will now..."), or postambles ("I have finished the changes..."). Get straight to the action or answer.[39m
[2m  - **Formatting:** Use GitHub-flavored Markdown. Responses will be rendered in monospace.[22m
[2m  - **Tools vs. Text:** Use tools for actions, text output *only* for communication. Do not add explanatory comments within tool calls or code blocks unless specifically part of the required code/command itself.[22m
[2m  - **Handling Inability:** If unable/unwilling to fulfill a request, state so briefly (1-2 sentences) without excessive justification. Offer alternatives if appropriate.[22m

[2m  ## Security and Safety Rules[22m

 â¯ src/core/prompts.test.ts:198:20
    196|     const prompt = getCoreSystemPrompt(mockConfig, '');
    197|     expect(prompt).toContain('**Interactive Commands:**'); // Check foâ€¦
    198|     expect(prompt).toMatchSnapshot(); // Use snapshot for base prompt â€¦
       |                    ^
    199|   });
    200| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[17/34]âŽ¯

 FAIL  src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should handle CodebaseInvestigator with tools=codebase_investigator
Error: Snapshot `Core System Prompt (prompts.ts) > should handle CodebaseInvestigator with tools=codebase_investigator 1` mismatched

[32m- Expected[39m
[31m+ Received[39m

[33m@@ -9,10 +9,11 @@[39m
[2m  - **Comments:** Add code comments sparingly. Focus on *why* something is done, especially for complex logic, rather than *what* is done. Only add high-value comments if necessary for clarity or if requested by the user. Do not edit comments that are separate from the code you are changing. *NEVER* talk to the user or describe your changes through comments.[22m
[2m  - **Proactiveness:** Fulfill the user's request thoroughly. When adding features or fixing bugs, this includes adding tests to ensure quality. Consider all created files, especially tests, to be permanent artifacts unless the user says otherwise.[22m
[2m  - **Handle Ambiguity/Expansion:** Do not take significant actions beyond the clear scope of the request.[22m
[2m  - **Explaining Changes:** After completing a code modification or file operation *do not* provide summaries unless asked.[22m
[2m  - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[22m
[31m+ - **Do not call tools in silence:** You must provide to the user very short and concise natural explanation (one sentence) before calling tools.[39m
[2m    - **Continue the work** You are not to interact with the user. Do your best to complete the task at hand, using your best judgement and avoid asking user for any additional information.[22m

[2m  Mock Agent Directory[22m

[2m  # Primary Workflows[22m
[33m@@ -59,11 +60,10 @@[39m

[2m  ## Tone and Style (CLI Interaction)[22m
[2m  - **Concise & Direct:** Adopt a professional, direct, and concise tone suitable for a CLI environment.[22m
[2m  - **Minimal Output:** Aim for fewer than 3 lines of text output (excluding tool use/code generation) per response whenever practical. Focus strictly on the user's query.[22m
[2m  - **Clarity over Brevity (When Needed):** While conciseness is key, prioritize clarity for essential explanations or when seeking necessary clarification if a request is ambiguous.[22m
[32m- - **No Chitchat:** Avoid conversational filler, preambles ("Okay, I will now..."), or postambles ("I have finished the changes..."). Get straight to the action or answer.[39m
[2m  - **Formatting:** Use GitHub-flavored Markdown. Responses will be rendered in monospace.[22m
[2m  - **Tools vs. Text:** Use tools for actions, text output *only* for communication. Do not add explanatory comments within tool calls or code blocks unless specifically part of the required code/command itself.[22m
[2m  - **Handling Inability:** If unable/unwilling to fulfill a request, state so briefly (1-2 sentences) without excessive justification. Offer alternatives if appropriate.[22m

[2m  ## Security and Safety Rules[22m

 â¯ src/core/prompts.test.ts:245:22
    243|         );
    244|       }
    245|       expect(prompt).toMatchSnapshot();
       |                      ^
    246|     },
    247|   );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[18/34]âŽ¯

 FAIL  src/core/prompts.test.ts > Core System Prompt (prompts.ts) > should handle CodebaseInvestigator with tools=
Error: Snapshot `Core System Prompt (prompts.ts) > should handle CodebaseInvestigator with tools= 1` mismatched

[32m- Expected[39m
[31m+ Received[39m

[33m@@ -9,10 +9,11 @@[39m
[2m  - **Comments:** Add code comments sparingly. Focus on *why* something is done, especially for complex logic, rather than *what* is done. Only add high-value comments if necessary for clarity or if requested by the user. Do not edit comments that are separate from the code you are changing. *NEVER* talk to the user or describe your changes through comments.[22m
[2m  - **Proactiveness:** Fulfill the user's request thoroughly. When adding features or fixing bugs, this includes adding tests to ensure quality. Consider all created files, especially tests, to be permanent artifacts unless the user says otherwise.[22m
[2m  - **Handle Ambiguity/Expansion:** Do not take significant actions beyond the clear scope of the request.[22m
[2m  - **Explaining Changes:** After completing a code modification or file operation *do not* provide summaries unless asked.[22m
[2m  - **Do Not revert changes:** Do not revert changes to the codebase unless asked to do so by the user. Only revert changes made by you if they have resulted in an error or if the user has explicitly asked you to revert the changes.[22m
[31m+ - **Do not call tools in silence:** You must provide to the user very short and concise natural explanation (one sentence) before calling tools.[39m
[2m    - **Continue the work** You are not to interact with the user. Do your best to complete the task at hand, using your best judgement and avoid asking user for any additional information.[22m

[2m  Mock Agent Directory[22m

[2m  # Primary Workflows[22m
[33m@@ -60,11 +61,10 @@[39m

[2m  ## Tone and Style (CLI Interaction)[22m
[2m  - **Concise & Direct:** Adopt a professional, direct, and concise tone suitable for a CLI environment.[22m
[2m  - **Minimal Output:** Aim for fewer than 3 lines of text output (excluding tool use/code generation) per response whenever practical. Focus strictly on the user's query.[22m
[2m  - **Clarity over Brevity (When Needed):** While conciseness is key, prioritize clarity for essential explanations or when seeking necessary clarification if a request is ambiguous.[22m
[32m- - **No Chitchat:** Avoid conversational filler, preambles ("Okay, I will now..."), or postambles ("I have finished the changes..."). Get straight to the action or answer.[39m
[2m  - **Formatting:** Use GitHub-flavored Markdown. Responses will be rendered in monospace.[22m
[2m  - **Tools vs. Text:** Use tools for actions, text output *only* for communication. Do not add explanatory comments within tool calls or code blocks unless specifically part of the required code/command itself.[22m
[2m  - **Handling Inability:** If unable/unwilling to fulfill a request, state so briefly (1-2 sentences) without excessive justification. Offer alternatives if appropriate.[22m

[2m  ## Security and Safety Rules[22m

 â¯ src/core/prompts.test.ts:245:22
    243|         );
    244|       }
    245|       expect(prompt).toMatchSnapshot();
       |                      ^
    246|     },
    247|   );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[19/34]âŽ¯

 FAIL  src/policy/config.test.ts > createPolicyEngineConfig > should support argsPattern in policy rules
AssertionError: expected undefined to be defined
 â¯ src/policy/config.test.ts:632:18
    630|         r.decision === PolicyDecision.ALLOW,
    631|     );
    632|     expect(rule).toBeDefined();
       |                  ^
    633|     // Priority 150 in user tier â†’ 2.150
    634|     expect(rule?.priority).toBeCloseTo(2.15, 5);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[20/34]âŽ¯

 FAIL  src/policy/config.test.ts > createPolicyEngineConfig > should load safety_checker configuration from TOML
AssertionError: expected undefined to be defined
 â¯ src/policy/config.test.ts:733:18
    731|       (r) => r.toolName === 'write_file' && r.decision === PolicyDecisâ€¦
    732|     );
    733|     expect(rule).toBeDefined();
       |                  ^
    734| 
    735|     const checker = config.checkers?.find(

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[21/34]âŽ¯

 FAIL  src/services/chatCompressionService.test.ts > modelStringToModelConfigAlias > should handle valid names
AssertionError: expected 'chat-compression-default' to be 'chat-compression-2.5-pro' // Object.is equality

Expected: [32m"chat-compression-[7m2.5-pro[27m"[39m
Received: [31m"chat-compression-[7mdefault[27m"[39m

 â¯ src/services/chatCompressionService.test.ts:115:61
    113|       'chat-compression-3-pro',
    114|     );
    115|     expect(modelStringToModelConfigAlias('gemini-2.5-pro')).toBe(
       |                                                             ^
    116|       'chat-compression-2.5-pro',
    117|     );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22/34]âŽ¯

 FAIL  src/telemetry/loggers.test.ts > loggers > logUserPrompt > should not log prompt if disabled
AssertionError: expected "spy" to be called with arguments: [ { â€¦(2) } ][90m

Received: 

[1m  1st spy call:

[22m[33m@@ -1,9 +1,9 @@[90m
[2m  [[22m
[2m    {[22m
[2m      "attributes": {[22m
[32m-       "auth_type": "compute-default-credentials",[90m
[31m+       "auth_type": "gemini-api-key",[90m
[2m        "event.name": "gemini_cli.user_prompt",[22m
[2m        "event.timestamp": "2025-01-01T00:00:00.000Z",[22m
[2m        "installation.id": "test-installation-id",[22m
[2m        "interactive": false,[22m
[2m        "prompt_id": "prompt-id-9",[22m
[39m[90m

Number of calls: [1m1[22m
[39m
 â¯ src/telemetry/loggers.test.ts:302:31
    300|       logUserPrompt(mockConfig, event);
    301| 
    302|       expect(mockLogger.emit).toHaveBeenCalledWith({
       |                               ^
    303|         body: 'User prompt. Length: 11.',
    304|         attributes: {

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[23/34]âŽ¯

 FAIL  src/telemetry/loggers.test.ts > loggers > logApiResponse > should log an API response with all fields
AssertionError: expected "spy" to be called with arguments: [ { â€¦(5) }, 100, { â€¦(3) } ][90m

Received: 

[1m  1st spy call:

[22m[33m@@ -8,11 +8,11 @@[90m
[2m    },[22m
[2m    100,[22m
[2m    {[22m
[2m      "genAiAttributes": {[22m
[2m        "gen_ai.operation.name": "generate_content",[22m
[32m-       "gen_ai.provider.name": "gcp.vertex_ai",[90m
[31m+       "gen_ai.provider.name": "gcp.gen_ai",[90m
[2m        "gen_ai.request.model": "test-model",[22m
[2m        "gen_ai.response.model": "test-model",[22m
[2m      },[22m
[2m      "model": "test-model",[22m
[2m      "status_code": 200,[22m
[39m[90m

Number of calls: [1m1[22m
[39m
 â¯ src/telemetry/loggers.test.ts:440:52
    438|       });
    439| 
    440|       expect(mockMetrics.recordApiResponseMetrics).toHaveBeenCalledWitâ€¦
       |                                                    ^
    441|         mockConfig,
    442|         100,

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[24/34]âŽ¯

 FAIL  src/telemetry/loggers.test.ts > loggers > logApiError > should log an API error with all fields
AssertionError: expected "spy" to be called with arguments: [ { â€¦(5) }, 100, { â€¦(3) } ][90m

Received: 

[1m  1st spy call:

[22m[33m@@ -9,11 +9,11 @@[90m
[2m    100,[22m
[2m    {[22m
[2m      "genAiAttributes": {[22m
[2m        "error.type": "ApiError",[22m
[2m        "gen_ai.operation.name": "generate_content",[22m
[32m-       "gen_ai.provider.name": "gcp.vertex_ai",[90m
[31m+       "gen_ai.provider.name": "gcp.gen_ai",[90m
[2m        "gen_ai.request.model": "test-model",[22m
[2m        "gen_ai.response.model": "test-model",[22m
[2m      },[22m
[2m      "model": "test-model",[22m
[2m      "status_code": 503,[22m
[39m[90m

Number of calls: [1m1[22m
[39m
 â¯ src/telemetry/loggers.test.ts:601:52
    599|       );
    600| 
    601|       expect(mockMetrics.recordApiResponseMetrics).toHaveBeenCalledWitâ€¦
       |                                                    ^
    602|         mockConfig,
    603|         100,

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[25/34]âŽ¯

 FAIL  src/telemetry/loggers.test.ts > loggers > logApiRequest > should log an API request with request_text
AssertionError: expected 2nd "spy" call to have been called with [ { â€¦(2) } ]

[32m- Expected[39m
[31m+ Received[39m

[2m  [[22m
[2m    {[22m
[32m-     "attributes": ObjectContaining {[39m
[31m+     "attributes": {[39m
[2m        "event.name": "gen_ai.client.inference.operation.details",[22m
[32m-       "gen_ai.provider.name": "gcp.vertex_ai",[39m
[31m+       "event.timestamp": "2025-01-01T00:00:00.000Z",[39m
[31m+       "gen_ai.input.messages": "[]",[39m
[31m+       "gen_ai.operation.name": "generate_content",[39m
[31m+       "gen_ai.provider.name": "gcp.gen_ai",[39m
[2m        "gen_ai.request.model": "test-model",[22m
[31m+       "installation.id": "test-installation-id",[39m
[31m+       "interactive": false,[39m
[31m+       "session.id": "test-session-id",[39m
[31m+       "user.email": "test-user@example.com",[39m
[2m      },[22m
[2m      "body": "GenAI operation request details from test-model.",[22m
[2m    },[22m
[2m  ][22m

 â¯ src/telemetry/loggers.test.ts:661:31
    659|       });
    660| 
    661|       expect(mockLogger.emit).toHaveBeenNthCalledWith(2, {
       |                               ^
    662|         body: 'GenAI operation request details from test-model.',
    663|         attributes: expect.objectContaining({

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[26/34]âŽ¯

 FAIL  src/telemetry/loggers.test.ts > loggers > logApiRequest > should log an API request without request_text
AssertionError: expected 2nd "spy" call to have been called with [ { â€¦(2) } ]

[32m- Expected[39m
[31m+ Received[39m

[2m  [[22m
[2m    {[22m
[32m-     "attributes": ObjectContaining {[39m
[31m+     "attributes": {[39m
[2m        "event.name": "gen_ai.client.inference.operation.details",[22m
[32m-       "gen_ai.provider.name": "gcp.vertex_ai",[39m
[31m+       "event.timestamp": "2025-01-01T00:00:00.000Z",[39m
[31m+       "gen_ai.input.messages": "[]",[39m
[31m+       "gen_ai.operation.name": "generate_content",[39m
[31m+       "gen_ai.provider.name": "gcp.gen_ai",[39m
[2m        "gen_ai.request.model": "test-model",[22m
[31m+       "installation.id": "test-installation-id",[39m
[31m+       "interactive": false,[39m
[31m+       "session.id": "test-session-id",[39m
[31m+       "user.email": "test-user@example.com",[39m
[2m      },[22m
[2m      "body": "GenAI operation request details from test-model.",[22m
[2m    },[22m
[2m  ][22m

 â¯ src/telemetry/loggers.test.ts:690:31
    688|       });
    689| 
    690|       expect(mockLogger.emit).toHaveBeenNthCalledWith(2, {
       |                               ^
    691|         body: 'GenAI operation request details from test-model.',
    692|         attributes: expect.objectContaining({

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[27/34]âŽ¯

 FAIL  src/telemetry/loggers.test.ts > loggers > logModelRouting > should log the event to Clearcut and OTEL, and record metrics
AssertionError: expected "recordModelRoutingMetrics" to be called with arguments: [ { â€¦(2) } ][90m

Received: 

[1m  1st recordModelRoutingMetrics call:

[22m[2m  [[22m
[2m    {[22m
[2m      "getSessionId": [Function getSessionId],[22m
[2m      "isInteractive": [Function isInteractive],[22m
[2m    },[22m
[31m+   ModelRoutingEvent {[90m
[31m+     "decision_model": "gemini-pro",[90m
[31m+     "decision_source": "default",[90m
[31m+     "error_message": undefined,[90m
[31m+     "event.name": "model_routing",[90m
[31m+     "event.timestamp": "2025-01-01T00:00:00.000Z",[90m
[31m+     "failed": false,[90m
[31m+     "reasoning": "test-reason",[90m
[31m+     "routing_latency_ms": 100,[90m
[31m+   },[90m
[2m  ][22m
[39m[90m

Number of calls: [1m1[22m
[39m
 â¯ src/telemetry/loggers.test.ts:1676:49
    1674|       });
    1675| 
    1676|       expect(metrics.recordModelRoutingMetrics).toHaveBeenCalledWith(
       |                                                 ^
    1677|         mockConfig,
    1678|       );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[28/34]âŽ¯

 FAIL  src/telemetry/loggers.test.ts > loggers > logAgentFinish > should log agent finish event and record metrics
AssertionError: expected "recordAgentRunMetrics" to be called with arguments: [ { â€¦(2) } ][90m

Received: 

[1m  1st recordAgentRunMetrics call:

[22m[2m  [[22m
[2m    {[22m
[2m      "getSessionId": [Function getSessionId],[22m
[2m      "isInteractive": [Function isInteractive],[22m
[2m    },[22m
[31m+   AgentFinishEvent {[90m
[31m+     "agent_id": "agent-123",[90m
[31m+     "agent_name": "TestAgent",[90m
[31m+     "duration_ms": 1000,[90m
[31m+     "event.name": "agent_finish",[90m
[31m+     "event.timestamp": "2025-01-01T00:00:00.000Z",[90m
[31m+     "terminate_reason": "GOAL",[90m
[31m+     "turn_count": 5,[90m
[31m+   },[90m
[2m  ][22m
[39m[90m

Number of calls: [1m1[22m
[39m
 â¯ src/telemetry/loggers.test.ts:1969:45
    1967|       });
    1968| 
    1969|       expect(metrics.recordAgentRunMetrics).toHaveBeenCalledWith(mockCâ€¦
       |                                             ^
    1970|     });
    1971|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[29/34]âŽ¯

 FAIL  src/telemetry/sdk.test.ts > Telemetry SDK > should initialize with GCP exporters when credentials are provided via post_auth
AssertionError: expected "spy" to be called with arguments: [ Array(1) ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[32m-   "Telemetry reinit with credentials.",[90m
[31m+   "CLI auth is requested but no credentials, deferring telemetry initialization.",[90m
[2m  ][22m
[39m[90m

Number of calls: [1m1[22m
[39m
 â¯ src/telemetry/sdk.test.ts:331:31
    329|     await vi.waitFor(() => {
    330|       // Check if debugLogger was called, which indicates the listenerâ€¦
    331|       expect(debugLogger.log).toHaveBeenCalledWith(
       |                               ^
    332|         'Telemetry reinit with credentials.',
    333|       );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[30/34]âŽ¯

 FAIL  src/utils/errorParsing.test.ts > parseAndFormatApiError > should format a 429 API error with the default message
AssertionError: expected '[API Error: Rate limit exceeded (Statâ€¦' to contain 'Possible quota limitations in place oâ€¦'

[32m- Expected[39m
[31m+ Received[39m

[32m- Possible quota limitations in place or slow response times detected. Switching to the gemini-[7m2.5[27m-flash[7m model[27m[39m
[31m+ [API Error: Rate limit exceeded (Status: RESOURCE_EXHAUSTED)][39m
[31m+ Possible quota limitations in place or slow response times detected. Switching to the gemini-[7m3[27m-flash[7m-preview model for the rest of this session.[27m[39m

 â¯ src/utils/errorParsing.test.ts:35:20
     33|     );
     34|     expect(result).toContain('[API Error: Rate limit exceeded');
     35|     expect(result).toContain(
       |                    ^
     36|       'Possible quota limitations in place or slow response times deteâ€¦
     37|     );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[31/34]âŽ¯

 FAIL  src/routing/strategies/fallbackStrategy.test.ts > FallbackStrategy > should return fallback decision if model is unavailable and fallback found
AssertionError: expected null not to be null
 â¯ src/routing/strategies/fallbackStrategy.test.ts:92:26
     90|     const decision = await strategy.route(mockContext, mockConfig, mocâ€¦
     91| 
     92|     expect(decision).not.toBeNull();
       |                          ^
     93|     expect(decision?.model).toBe(DEFAULT_CODEFLY_FLASH_MODEL);
     94|     expect(decision?.metadata.source).toBe('fallback');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[32/34]âŽ¯


  Snapshots  10 failed
             2 obsolete
             â†³ src/core/prompts.test.ts
               Â· Core System Prompt (prompts.ts) > should return the base prompt when userMemory is empty string 1
               Â· Core System Prompt (prompts.ts) > should return the base prompt when userMemory is whitespace only 1

 Test Files  13 failed | 186 passed (199)
      Tests  31 failed | 3532 passed | 24 skipped (3587)
   Start at  23:06:51
   Duration  11.88s (transform 3.83s, setup 786ms, collect 69.01s, tests 28.81s, environment 20ms, prepare 8.82s)

npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path /Users/robinx/code/codefly-cli/packages/core
npm error workspace @codeflyai/codefly-core@0.24.0-nightly.20251227.37be16243
npm error location /Users/robinx/code/codefly-cli/packages/core
npm error command failed
npm error command sh -c vitest run --reporter=verbose
